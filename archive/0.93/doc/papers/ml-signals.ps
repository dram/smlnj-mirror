%!PS-Adobe-2.0
%%Creator: dvips by Radical Eye Software
%%Title: paper.dvi
%%Pages: 19 1
%%BoundingBox: 0 0 612 792
%%EndComments
%%BeginDocument: tex.pro
/TeXDict 200 dict def TeXDict begin /bdf{bind def}def /@rigin{72 Resolution
div dup neg scale translate}bdf /@letter{Resolution dup -10 mul @rigin}bdf
/@landscape{[0 1 -1 0 0 0]concat Resolution dup @rigin}bdf /@a4{Resolution dup
-10.6929133858 mul @rigin}bdf /@legal{Resolution dup -13 mul @rigin}bdf
/@manualfeed{statusdict /manualfeed true put}bdf /@copies{/#copies exch def}
bdf /@FontMatrix[1 0 0 -1 0 0]def /@FontBBox[0 0 0 0]def /dmystr(ZZf@@@)def
/newname{dmystr cvn}bdf /df{/fontname exch def dmystr 2 fontname cvx(@@@@)cvs
putinterval newname 7 dict def newname load begin /FontType 3 def /FontMatrix
@FontMatrix def /FontBBox @FontBBox def /BitMaps 256 array def /BuildChar{
CharBuilder}def /Encoding IdentityEncoding def end fontname{/foo setfont}2
array copy cvx def fontname load 0 dmystr 6 string copy cvn cvx put}bdf /dfe{
newname dup load definefont setfont}bdf /ch-image{ch-data 0 get}bdf /ch-width{
ch-data 1 get}bdf /ch-height{ch-data 2 get}bdf /ch-xoff{ch-data 3 get}bdf
/ch-yoff{ch-data 4 get}bdf /ch-dx{ch-data 5 get}bdf /CharBuilder{save 3 1 roll
exch /BitMaps get exch get /ch-data exch def ch-data null ne{ch-dx 0 ch-xoff
ch-yoff neg ch-xoff ch-width add ch-height ch-yoff sub setcachedevice ch-width
ch-height true[1 0 0 -1 -.1 ch-xoff sub ch-height ch-yoff sub .1 add]{
ch-image}imagemask}if restore}bdf /dc{/ch-code exch def /ch-data exch def
newname load /BitMaps get ch-code ch-data put}bdf /bop{gsave /SaveImage save
def 0 0 moveto}bdf /eop{clear SaveImage restore showpage grestore}bdf /@start{
/Resolution exch def /IdentityEncoding 256 array def 0 1 255{IdentityEncoding
exch 1 string dup 0 3 index put cvn put}for}bdf /p{show}bdf /RuleMatrix[1 0 0
-1 -.1 -.1]def /BlackDots 8 string def /v{gsave currentpoint translate false
RuleMatrix{BlackDots}imagemask grestore}bdf /a{moveto}bdf /delta 0 def /tail{
dup /delta exch def 0 rmoveto}bdf /b{exch show tail}bdf /c{show delta 4 sub
tail}bdf /d{show delta 3 sub tail}bdf /e{show delta 2 sub tail}bdf /f{show
delta 1 sub tail}bdf /g{show delta 0 rmoveto}bdf /h{show delta 1 add tail}bdf
/i{show delta 2 add tail}bdf /j{show delta 3 add tail}bdf /k{show delta 4 add
tail}bdf /l{show -4 0 rmoveto}bdf /m{show -3 0 rmoveto}bdf /n{show -2 0
rmoveto}bdf /o{show -1 0 rmoveto}bdf /q{show 1 0 rmoveto}bdf /r{show 2 0
rmoveto}bdf /s{show 3 0 rmoveto}bdf /t{show 4 0 rmoveto}bdf /w{0 rmoveto}bdf
/x{0 exch rmoveto}bdf /y{3 2 roll show moveto}bdf /bos{/section save def}bdf
/eos{clear section restore}bdf end
%%EndDocument
%%BeginDocument: texps.pro
TeXDict begin /rf{655360 div mul Resolution mul 7227 div /PixPerEm exch def
findfont dup length 1 add dict /newfont exch def{1 index /FID ne{newfont 3 1
roll put}{pop pop}ifelse}forall 256 dict begin newfont /Encoding get 0 1 255{
2 copy get 3 index 2 index get 1000 mul PixPerEm div def pop}for pop pop
newfont /Metrics currentdict put end /fontname exch def dmystr 2 fontname cvx
(@@@@)cvs putinterval newname dup newfont definefont[PixPerEm 0 0 PixPerEm neg
0 0]makefont def fontname{/foo setfont}2 array copy cvx def fontname load 0
dmystr 6 string copy cvn cvx put}bdf /ObliqueSlant{dup sin exch cos div neg}
bdf /SlantFont{/foo exch def[1 0 foo 1 0 0]TransFont}bdf /ExtendFont{/foo exch
def 3 2 roll[exch{foo div}forall]3 1 roll[foo 0 0 1 0 0]TransFont}bdf
/TransFont{exch findfont exch makefont dup length dict /newfont exch def{1
index /FID ne{newfont 3 1 roll put}{pop pop}ifelse}forall dup newfont
definefont pop}bdf end
%%EndDocument
TeXDict begin 300 @start /fa [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 7 10 12 15 15 25 23 10 10 10 15 17 7 10 7 8 15 15 15 15 15 15
15 15 15 15 8 8 17 17 17 13 28 22 20 20 22 18 17 22 22 10 12 22 18 27 22 22 17
22 20 17 18 22 22 28 22 22 18 10 8 10 14 15 10 13 15 13 15 13 10 15 15 8 8 15
8 23 15 15 15 15 10 12 8 15 15 22 15 15 13 14 6 14 16 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 10 15 15 5 15 15 15 15 5 13 15 10
10 17 17 0 15 15 15 7 0 14 10 10 13 13 15 30 30 0 13 0 10 10 10 10 10 10 10 10
0 10 10 0 10 10 10 30 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 27 0 8 0 0 0 0 18 22 27
9 0 0 0 0 0 20 0 0 0 8 0 0 8 15 22 15 0 0 0 0 ] /Times-Roman 1000 471859 rf
/fb [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 9 12 16
19 19 31 29 12 12 12 19 25 9 12 9 10 19 19 19 19 19 19 19 19 19 19 12 12 25 25
25 19 34 23 23 25 27 23 23 27 27 12 17 25 21 31 25 27 23 27 23 19 21 27 23 31
23 21 21 15 10 15 16 19 12 19 19 17 19 17 10 19 19 10 10 17 10 27 19 19 19 19
15 15 10 19 17 25 17 17 15 15 10 15 20 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 15 19 19 6 19 19 19 19 8 21 19 12 12 19 19 0 19 19
19 9 0 20 13 12 21 21 19 33 37 0 19 0 12 12 12 12 12 12 12 12 0 12 12 0 12 12
12 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 33 0 10 0 0 0 0 21 27 35 12 0 0 0 0 0 25
0 0 0 10 0 0 10 19 25 19 0 0 0 0 ] /Times-Italic 1000 589824 rf /fc [ 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 30 30 30 30 30 30 30
30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30
30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30
30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30 30
30 30 30 30 30 30 30 30 30 30 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 30 30 30 30 30 30 30 30 30 30 30 30 30 0 0 0 30 30 30 30 0
30 30 30 30 30 30 30 0 0 30 0 30 30 30 30 30 30 30 30 0 30 30 0 30 30 30 30 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 30 0 0 0 0 30 30 0 30 0 0 0 0 0 0 0 0 0 30 0
0 30 30 0 30 0 0 0 0 ] /Courier 1000 786432 rf /fd [ 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 12 17 28 25 25 50 41 17 17 17 25 28 12
17 12 14 25 25 25 25 25 25 25 25 25 25 17 17 28 28 28 25 46 36 33 36 36 33 30
39 39 19 25 39 33 47 36 39 30 39 36 28 33 36 36 50 36 36 33 17 14 17 29 25 17
25 28 22 28 22 17 25 28 14 17 28 14 41 28 25 28 28 22 19 17 28 25 36 25 25 22
20 11 20 26 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 17 25 25 8 25 25 25 25 14 25 25 17 17 28 28 0 25 25 25 12 0 27 17 17 25 25
25 50 50 0 25 0 17 17 17 17 17 17 17 17 0 17 17 0 17 17 17 50 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 50 0 15 0 0 0 0 33 39 50 16 0 0 0 0 0 36 0 0 0 14 0 0 14 25 36
28 0 0 0 0 ] /Times-Bold 1000 786432 rf /fe [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 9 12 21 19 19 37 31 12 12 12 19 21 9 12 9 10
19 19 19 19 19 19 19 19 19 19 12 12 21 21 21 19 35 27 25 27 27 25 23 29 29 15
19 29 25 35 27 29 23 29 27 21 25 27 27 37 27 27 25 12 10 12 22 19 12 19 21 17
21 17 12 19 21 10 12 21 10 31 21 19 21 21 17 15 12 21 19 27 19 19 17 15 8 15
19 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 12 19
19 6 19 19 19 19 10 19 19 12 12 21 21 0 19 19 19 9 0 20 13 12 19 19 19 37 37 0
19 0 12 12 12 12 12 12 12 12 0 12 12 0 12 12 12 37 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 37 0 11 0 0 0 0 25 29 37 12 0 0 0 0 0 27 0 0 0 10 0 0 10 19 27 21 0 0 0 0
] /Times-Bold 1000 589824 rf /ff [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 6 8 10 12 12 21 19 8 8 8 12 14 6 8 6 7 12 12 12 12 12 12
12 12 12 12 7 7 14 14 14 11 23 18 17 17 18 15 14 18 18 8 10 18 15 22 18 18 14
18 17 14 15 18 18 24 18 18 15 8 7 8 12 12 8 11 12 11 12 11 8 12 12 7 7 12 7 19
12 12 12 12 8 10 7 12 12 18 12 12 11 12 5 12 13 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 8 12 12 4 12 12 12 12 4 11 12 8 8 14 14
0 12 12 12 6 0 11 9 8 11 11 12 25 25 0 11 0 8 8 8 8 8 8 8 8 0 8 8 0 8 8 8 25 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 22 0 7 0 0 0 0 15 18 22 8 0 0 0 0 0 17 0 0 0 7 0
0 7 12 18 12 0 0 0 0 ] /Times-Roman 1000 393216 rf /fg df[<01FE0007FF001FFF80
3E0780380300700000700000E00000E00000E00000E00000E00000E000007000007001C03801C0
3E03C01FFF8007FF0001FC00>18 20 3 0 24]99 dc[<7E3E00FEFF807FFFC00FC1C00F80E00F
00E00E00E00E00E00E00E00E00E00E00E00E00E00E00E00E00E00E00E00E00E00E00E07FC3FCFF
E7FE7FC3FC>23 20 0 0 24]110 dc[<01F0000FFE001FFF003E0F803803807001C07001C0E000
E0E000E0E000E0E000E0E000E0F001E07001C07803C03C07803E0F801FFF000FFE0001F000>19
20 2 0 24]111 dc[<0180000380000380000380000380007FFFC0FFFFC0FFFFC0038000038000
0380000380000380000380000380000380000380000380400380E00380E00380E001C1C001FFC0
00FF80003E00>19 25 1 0 24]116 dc dfe /fh [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22
22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22
22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22
22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22 22
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 22 22 22
22 22 22 22 22 22 22 22 22 22 0 0 0 22 22 22 22 0 22 22 22 22 22 22 22 0 0 22
0 22 22 22 22 22 22 22 22 0 22 22 0 22 22 22 22 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 22 0 0 0 0 22 22 0 22 0 0 0 0 0 0 0 0 0 22 0 0 22 22 0 22 0 0 0 0 ]
/Courier 1000 589824 rf /fi df[<007C0001C3000701810E01C11E00C11C00E23C00E27800
E27800E47800E4F000E8F000F0F000F0F000E0F000E07000E07003E030046118383207C01C>24
20 2 0 29]11 dc[<01801801C01C038038038038038038038038070070070070070070070070
0E00E00E00E00E00E00E00E11E01C21E01C21E03C21E05C43F08C439F078380000380000700000
700000700000700000E00000E00000C00000>24 29 1 9 27]22 dc[<0FFFF01FFFF03FFFF060
4000C0400080C00000C00000800001800001800001800001800003800003000003000007000007
00000700000E0000060000>21 20 2 0 20]28 dc dfe /fj [ 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 8 11 14 17 17 28 26 11 11 11 17 19 8 11
8 9 17 17 17 17 17 17 17 17 17 17 9 9 19 19 19 15 31 24 22 22 24 20 18 24 24
11 13 24 20 30 24 24 18 24 22 18 20 24 24 31 24 24 20 11 9 11 16 17 11 15 17
15 17 15 11 17 17 9 9 17 9 26 17 17 17 17 11 13 9 17 17 24 17 17 15 16 7 16 18
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 11 17 17 6
17 17 17 17 6 15 17 11 11 18 18 0 17 17 17 8 0 15 12 11 15 15 17 33 33 0 15 0
11 11 11 11 11 11 11 11 0 11 11 0 11 11 11 33 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
30 0 9 0 0 0 0 20 24 30 10 0 0 0 0 0 22 0 0 0 9 0 0 9 17 24 17 0 0 0 0 ]
/Times-Roman 1000 524288 rf /fk df[<07E01FF83FFC7FFE7FFEFFFFFFFFFFFFFFFFFFFFFF
FFFFFFFFFF7FFE7FFE3FFC1FF807E0>16 18 3 -2 23]15 dc[<C000C000E00060006000700030
0030003800180018001C000C000C000E0006000600070003000300038001800180018001C000C0
00C000E000600060007000300030003800180018001C000C000C000E00060006000700030003>
16 45 3 11 23]110 dc dfe /fl [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 9 12 15 19 19 31 29 12 12 12 19 21 9 12 9 10 19 19 19 19 19 19
19 19 19 19 10 10 21 21 21 17 34 27 25 25 27 23 21 27 27 12 15 27 23 33 27 27
21 27 25 21 23 27 27 35 27 27 23 12 10 12 18 19 12 17 19 17 19 17 12 19 19 10
10 19 10 29 19 19 19 19 12 15 10 19 19 27 19 19 17 18 7 18 20 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 12 19 19 6 19 19 19 19 7
17 19 12 12 21 21 0 19 19 19 9 0 17 13 12 17 17 19 37 37 0 17 0 12 12 12 12 12
12 12 12 0 12 12 0 12 12 12 37 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 33 0 10 0 0 0 0
23 27 33 12 0 0 0 0 0 25 0 0 0 10 0 0 10 19 27 19 0 0 0 0 ] /Times-Roman 1000
589824 rf /fm [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 11 15 25 23 23 46 38 15 15 15 23 26 11 15 11 13 23 23 23 23 23 23 23 23 23
23 15 15 26 26 26 23 42 33 30 33 33 30 28 36 36 18 23 36 30 43 33 36 28 36 33
25 30 33 33 46 33 33 30 15 13 15 27 23 15 23 25 20 25 20 15 23 25 13 15 25 13
38 25 23 25 25 20 18 15 25 23 33 23 23 20 18 10 18 24 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 15 23 23 8 23 23 23 23 13 23 23 15
15 25 25 0 23 23 23 11 0 25 16 15 23 23 23 46 46 0 23 0 15 15 15 15 15 15 15
15 0 15 15 0 15 15 15 46 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 46 0 14 0 0 0 0 30 36
46 15 0 0 0 0 0 33 0 0 0 13 0 0 13 23 33 25 0 0 0 0 ] /Times-Bold 1000 720896
rf /fn [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 27 27
27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27
27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27
27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 27
27 27 27 27 27 27 27 27 27 27 27 27 27 27 27 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 27 27 27 27 27 27 27 27 27 27 27 27 27 0 0 0
27 27 27 27 0 27 27 27 27 27 27 27 0 0 27 0 27 27 27 27 27 27 27 27 0 27 27 0
27 27 27 27 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 27 0 0 0 0 27 27 0 27 0 0 0 0
0 0 0 0 0 27 0 0 27 27 0 27 0 0 0 0 ] /Courier 1000 720896 rf /fo [ 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 9 12 15 18 18 30 28 12
12 12 18 21 9 12 9 10 18 18 18 18 18 18 18 18 18 18 10 10 21 21 21 16 34 26 24
24 26 22 20 26 26 12 14 26 22 32 26 26 20 26 24 20 22 26 26 34 26 26 22 12 10
12 17 18 12 16 18 16 18 16 12 18 18 10 10 18 10 28 18 18 18 18 12 14 10 18 18
26 18 18 16 18 7 18 20 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 12 18 18 6 18 18 18 18 7 16 18 12 12 20 20 0 18 18 18 9 0 17 13 12
16 16 18 37 37 0 16 0 12 12 12 12 12 12 12 12 0 12 12 0 12 12 12 37 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 32 0 10 0 0 0 0 22 26 32 11 0 0 0 0 0 24 0 0 0 10 0 0 10
18 26 18 0 0 0 0 ] /Times-Roman 1000 576716 rf /fp [ 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 11 15 19 23 23 38 36 15 15 15 23 31 11
15 11 13 23 23 23 23 23 23 23 23 23 23 15 15 31 31 31 23 42 28 28 30 33 28 28
33 33 15 20 30 25 38 30 33 28 33 28 23 25 33 28 38 28 25 25 18 13 18 19 23 15
23 23 20 23 20 13 23 23 13 13 20 13 33 23 23 23 23 18 18 13 23 20 30 20 20 18
18 13 18 25 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 18 23 23 8 23 23 23 23 10 25 23 15 15 23 23 0 23 23 23 11 0 24 16 15 25 25
23 41 46 0 23 0 15 15 15 15 15 15 15 15 0 15 15 0 15 15 15 41 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 41 0 13 0 0 0 0 25 33 43 14 0 0 0 0 0 30 0 0 0 13 0 0 13 23 30
23 0 0 0 0 ] /Times-Italic 1000 720896 rf /fq [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 11 15 19 23 23 38 36 15 15 15 23 26 11 15 11
13 23 23 23 23 23 23 23 23 23 23 13 13 26 26 26 20 42 33 30 30 33 28 25 33 33
15 18 33 28 41 33 33 25 33 30 25 28 33 33 43 33 33 28 15 13 15 21 23 15 20 23
20 23 20 15 23 23 13 13 23 13 36 23 23 23 23 15 18 13 23 23 33 23 23 20 22 9
22 25 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 15
23 23 8 23 23 23 23 8 20 23 15 15 25 25 0 23 23 23 11 0 21 16 15 20 20 23 46
46 0 20 0 15 15 15 15 15 15 15 15 0 15 15 0 15 15 15 46 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 41 0 13 0 0 0 0 28 33 41 14 0 0 0 0 0 30 0 0 0 13 0 0 13 23 33 23 0
0 0 0 ] /Times-Roman 1000 720896 rf /fr [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 15 19 32 29 29 58 48 19 19 19 29 33 15 19 15 16 29
29 29 29 29 29 29 29 29 29 19 19 33 33 33 29 54 42 39 42 42 39 36 45 45 23 29
45 39 55 42 45 36 45 42 32 39 42 42 58 42 42 39 19 16 19 34 29 19 29 32 26 32
26 19 29 32 16 19 32 16 48 32 29 32 32 26 23 19 32 29 42 29 29 26 23 13 23 30
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 19 29 29
10 29 29 29 29 16 29 29 19 19 32 32 0 29 29 29 15 0 31 20 19 29 29 29 58 58 0
29 0 19 19 19 19 19 19 19 19 0 19 19 0 19 19 19 58 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 58 0 17 0 0 0 0 39 45 58 19 0 0 0 0 0 42 0 0 0 16 0 0 16 29 42 32 0 0 0 0
] /Times-Bold 1000 917504 rf /fs [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 10 14 23 21 21 42 35 14 14 14 21 24 10 14 10 12 21 21 21
21 21 21 21 21 21 21 14 14 24 24 24 21 39 30 28 30 30 28 25 32 32 16 21 32 28
39 30 32 25 32 30 23 28 30 30 42 30 30 28 14 12 14 24 21 14 21 23 18 23 18 14
21 23 12 14 23 12 35 23 21 23 23 18 16 14 23 21 30 21 21 18 16 9 16 22 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 14 21 21 7 21 21
21 21 12 21 21 14 14 23 23 0 21 21 21 10 0 22 15 14 21 21 21 42 42 0 21 0 14
14 14 14 14 14 14 14 0 14 14 0 14 14 14 42 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 42
0 12 0 0 0 0 28 32 42 14 0 0 0 0 0 30 0 0 0 12 0 0 12 21 30 23 0 0 0 0 ]
/Times-Bold 1000 655360 rf /ft [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25
25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25
25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25
25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 25 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 25 25 25 25 25 25 25
25 25 25 25 25 25 0 0 0 25 25 25 25 0 25 25 25 25 25 25 25 0 0 25 0 25 25 25
25 25 25 25 25 0 25 25 0 25 25 25 25 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 25 0
0 0 0 25 25 0 25 0 0 0 0 0 0 0 0 0 25 0 0 25 25 0 25 0 0 0 0 ] /Courier 1000
655360 rf /fu [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 12 17 20 25 25 41 39 17 17 17 25 28 12 17 12 14 25 25 25 25 25 25 25 25 25
25 14 14 28 28 28 22 46 36 33 33 36 30 28 36 36 17 19 36 30 44 36 36 28 36 33
28 30 36 36 47 36 36 30 17 14 17 23 25 17 22 25 22 25 22 17 25 25 14 14 25 14
39 25 25 25 25 17 19 14 25 25 36 25 25 22 24 10 24 27 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 17 25 25 8 25 25 25 25 9 22 25 17
17 28 28 0 25 25 25 12 0 23 17 17 22 22 25 50 50 0 22 0 17 17 17 17 17 17 17
17 0 17 17 0 17 17 17 50 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 44 0 14 0 0 0 0 30 36
44 15 0 0 0 0 0 33 0 0 0 14 0 0 14 25 36 25 0 0 0 0 ] /Times-Roman 1000 786432
rf /fv [ 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 10 14
17 21 21 35 32 14 14 14 21 23 10 14 10 12 21 21 21 21 21 21 21 21 21 21 12 12
23 23 23 18 38 30 28 28 30 25 23 30 30 14 16 30 25 37 30 30 23 30 28 23 25 30
30 39 30 30 25 14 12 14 19 21 14 18 21 18 21 18 14 21 21 12 12 21 12 32 21 21
21 21 14 16 12 21 21 30 21 21 18 20 8 20 22 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 14 21 21 7 21 21 21 21 7 18 21 14 14 23 23 0
21 21 21 10 0 19 15 14 18 18 21 42 42 0 18 0 14 14 14 14 14 14 14 14 0 14 14 0
14 14 14 42 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 37 0 11 0 0 0 0 25 30 37 13 0 0 0
0 0 28 0 0 0 12 0 0 12 21 30 21 0 0 0 0 ] /Times-Roman 1000 655360 rf /fw df[<
0C000C008C40EDC07F800C007F80EDC08C400C000C00>10 11 3 -1 16]3 dc dfe /fx [ 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 15 19 24 29 29 48
45 19 19 19 29 33 15 19 15 16 29 29 29 29 29 29 29 29 29 29 16 16 33 33 33 26
54 42 39 39 42 36 32 42 42 19 23 42 36 52 42 42 32 42 39 32 36 42 42 55 42 42
36 19 16 19 27 29 19 26 29 26 29 26 19 29 29 16 16 29 16 45 29 29 29 29 19 23
16 29 29 42 29 29 26 28 12 28 31 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 19 29 29 10 29 29 29 29 10 26 29 19 19 32 32 0 29 29 29
15 0 26 20 19 26 26 29 58 58 0 26 0 19 19 19 19 19 19 19 19 0 19 19 0 19 19 19
58 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 52 0 16 0 0 0 0 36 42 52 18 0 0 0 0 0 39 0
0 0 16 0 0 16 29 42 29 0 0 0 0 ] /Times-Roman 1000 917504 rf /fy df[<00C00000
E00000C00000C00040C080E0C1C0F0C3C07CCF801EDE0003F00000C00003F0001EDE007CCF80F0
C3C0E0C1C040C08000C00000C00000E00000C000>18 21 3 -2 25]3 dc dfe /fz [ 0 0 0 0
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 18 23 29 35 35 59 55
23 23 23 35 40 18 23 18 20 35 35 35 35 35 35 35 35 35 35 20 20 40 40 40 31 65
51 47 47 51 43 39 51 51 23 27 51 43 63 51 51 39 51 47 39 43 51 51 67 51 51 43
23 20 23 33 35 23 31 35 31 35 31 23 35 35 20 20 35 20 55 35 35 35 35 23 27 20
35 35 51 35 35 31 34 14 34 38 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0
0 0 0 0 0 0 0 0 0 0 23 35 35 12 35 35 35 35 13 31 35 23 23 39 39 0 35 35 35 18
0 32 25 23 31 31 35 71 71 0 31 0 23 23 23 23 23 23 23 23 0 23 23 0 23 23 23 71
0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 0 63 0 19 0 0 0 0 43 51 63 22 0 0 0 0 0 47 0 0 0
20 0 0 20 35 51 35 0 0 0 0 ] /Times-Roman 1000 1114112 rf end
%%EndProlog
%%BeginSetup
%%Feature: *Resolution 300
 TeXDict begin @letter
%%EndSetup
%%Page: 0 1
 bop 413 699 a fz(Asynchronous)21 b(Signals)d(in)g(Standard)i(ML)1511 672 y fy
(\003)801 848 y fx(John)15 b(H.)f(Reppy)834 997 y(TR)g(90-1144)826 1072 y(Aug\
ust)g(1990)585 1522 y(Department)h(of)g(Computer)g(Science)758 1596 y(Cornell)
g(University)768 1671 y(Ithaca,)f(NY)g(14853)75 2632 y 720 2 v 124 2662 a fw
(\003)142 2677 y fv(This)c(work)g(was)h(supported,)f(in)f(part,)h(by)g(the)g
(NSF)h(and)f(ONR)g(under)g(NSF)h(grant)e(CCR-85-14862)p eop
%%Page: 1 2
 bop 426 265 a fz(Asynchronous)21 b(Signals)e(in)e(Standard)j(ML)1524 239 y fy
(\003)826 412 y fu(John)13 b(H.)g(Reppy)789 470 y(Cornell)f(University)751 528
y ft(jhr@cs.cornell.edu)822 651 y fu(August)g(1,)h(1990)898 775 y fs(Abstract)
251 850 y fv(W)m(e)c(describe)h(the)e(design,)h(implementation)f(and)h(use)g
(of)g(a)g(mechanism)h(for)f(handling)e(asynchronous)189 899 y(signals,)k(such)
h(as)h(user)e(interrupts,)g(in)g(the)h(New)g(Jersey)g(implementation)f(of)g
(Standard)g(ML.)i(Providing)189 949 y(this)6 b(kind)h(of)g(mechanism)i(is)f
(a)g(necessary)h(requirement)f(for)f(the)h(development)f(of)g(real-world)g
(application)189 999 y(programs.)18 b(Our)11 b(mechanism)i(uses)f(\256rst-cla\
ss)f(continuations)e(to)i(represent)h(the)f(execution)g(state)g(at)h(the)189
1049 y(time)7 b(at)h(which)f(a)h(signal)f(occurs.)15 b(It)7 b(has)h(been)g
(used)f(to)g(support)f(pre-emptive)i(scheduling)e(in)h(concurrency)189 1099 y
(packages)13 b(and)g(for)f(forcing)f(break-points)g(in)h(debuggers,)h(as)h
(well)e(as)h(for)f(handling)f(user)h(interrupts)f(in)189 1148 y(the)f fs(SML/\
NJ)f fv(interactive)h(environment.)75 1312 y fr(1)58 b(Intr)o(oduction)75 1451
y fq(Programs)7 b(normally)g(receive)g(communication)g(from)g(the)g(outside)f
(world)h(via)f(input)g(operations.)12 b(This)7 b(method)75 1521 y(of)16 b(com\
munication)d(is)i(inherently)g(synchronous:)23 b(there)16 b(is)f(no)g(way)h
(for)g(the)f(outside)g(world)g(to)g(force)h(the)75 1592 y(program)10 b(to)g
(accept)i(communication.)i(But)d(sometimes)e(it)h(is)g(necessary)h(to)f(commu\
nicate)g(asynchronously;)75 1662 y(for)k(example,)f(if)h(the)f(user)g(wants)g
(to)g(interrupt)g(execution,)g(or)h(if)f(the)g(operating)g(system)f(needs)h
(to)g(inform)g(a)75 1733 y(program)g(that)f(its)g(terminal)h(connection)f(has)
h(been)g(lost.)21 b(Most)12 b(operating)g(systems)g(provide)h(a)g(mechanism)
75 1804 y(for)g(asynchronously)e fp(signaling)g fq(a)h(program)h(in)f(these)g
(situations.)19 b(For)13 b(example,)g(on)f(U)p fo(NIX)h fq(systems,)f(when)75
1874 y(a)g(user)f(types)g(the)h(break)g(character)h(\(e.g.,)g(control-C\),)f
(the)f(terminal)g(driver)h(sends)f(a)h fn(SIGINT)h fq(signal)e(to)g(the)75
1945 y(process)h(attached)g(to)g(the)g(terminal.)17 b(Under)c(U)p fo(NIX)g fq
(a)f(program)g(can)g(establish)f(a)h fp(handler)f fq(that)h(the)g(operating)
75 2015 y(system)h(will)f(call)i(when)f(a)h(given)g(signal)e(occurs.)24 b(The)
14 b(signal)f(handler)g(is,)h(in)g(ef)o(fect,)h(a)f(limited)e(co-routine)75
2086 y(of)f(the)g(main)f(program.)17 b(Most)9 b(programs)i(use)g(the)f(defaul\
t)h(signal)f(handlers,)h(but)g(some)f(applications)g(require)75 2156 y(specia\
lized)j(handlers.)23 b(For)14 b(example,)g(an)g(editor)f(will)f(save)i(the)f
(edited)g(state)g(of)h(a)f(\256le)h(when)g(the)f(terminal)75 2227 y(connectio\
n)h(is)h(lost)f(\(signi\256ed)g(by)h fn(SIGHUP)i fq(on)e(U)p fo(NIX)p fq(\).)
29 b(Providing)14 b(a)h(signal)f(handling)g(mechanism)g(is)h(a)75 2298 y(nece\
ssary)d(requirement)f(for)h(implementing)d(programs)i(such)g(as)g(editors.)
146 2389 y(The)h fm(SML)i fq(de\256nition)d(\([MTH90]\))i(includes)e(a)i(weak)
g(mechanism)e(for)i(handling)e(asynchronous)h(inter)o(-)75 2459 y(rupts)d(gen\
erated)h(from)f(the)h(keyboard)f(\(e.g.,)j fn(SIGINT)g fq(on)d(U)p fo(NIX)h fq
(systems\).)16 b(When)9 b(the)h(user)f(types)g(the)h(break)75 2530 y(characte\
r)n(,)16 b(the)e(exception)f fn(Interrupt)18 b fq(is)13 b(raised.)24 b(This)
14 b(exception)f(is)g(primarily)g(used)h(to)f(force)i(control)75 2601 y(back)
d(up)f(to)g(the)g(top-level)g(read-eval-print)g(loop,)g(and)h(it)f(has)g(a)g
(number)g(of)h(problems:)75 2635 y 720 2 v 124 2662 a fw(\003)142 2677 y fl
(This)d(work)g(was)g(supported,)f(in)h(part,)h(by)e(the)h(NSF)g(and)g(ONR)g
(under)f(NSF)h(grant)g(CCR-85-14862)p eop
%%Page: 2 3
 bop 143 82 a fk(\017)23 b fp(Lack)c(of)f(r)n(obustness:)30 b fq(it)19 b(is)f
(not)g(possible)f(to)i(write)f(a)h(robust)f fn(Interrupt)k fq(handler)m(.)40 b
(Multiple)189 153 y fn(SIGINT)p fq(s)13 b(can)e(create)g(race)h(conditions)d
(in)h(an)h(exception)g(handler)f(that)h(handles)f fn(Interrupt)p fq(,)15 b
(and,)189 223 y(in)e(addition,)g(there)h(is)g(no)f(mechanism)g(for)h(masking)
e(interrupts.)23 b(The)14 b(race)h(conditions)d(are)i(a)g(direct)189 294 y
(result)g(of)h(using)e(exceptions,)j(which)e(are)i(otherwise)e(a)h(synchronou\
s)f(control-\257ow)g(mechanism,)h(to)189 364 y(support)10 b(asynchronous)h
(control-\257ow)m(.)143 472 y fk(\017)23 b fp(Lack)11 b(of)e(generality:)15 b
fq(there)c(is)e(no)h(support)f(for)i(other)f(kinds)f(of)h(signals,)g(such)g
(as)g(hang-ups)f(or)i(interval)189 543 y(timer)f(interrupts.)16 b(Real-world)
c(applications)e(must)h(be)g(able)h(to)e(deal)i(with)f(these)g(situations.)
143 651 y fk(\017)23 b fp(Lack)12 b(of)f(\257exibility:)16 b fq(there)c(is)f
(no)g(way)h(to)f(reliably)g(resume)g(execution)g(at)h(the)f(point)f(where)j
(the)e(signal)189 721 y(occurred.)17 b(A)12 b(general)f(mechanism)g(should)f
(provide)h(a)h(way)f(to)g(restart)h(after)g(a)f(signal.)75 850 y(W)l(e)21 b
(have)g(designed)f(and)g(implemented)f(a)i(general-purpose)g(signal)e(mechani\
sm)h(for)h(the)f(New)h(Jersey)75 921 y(implementation)9 b(of)j fm(SML)p fq
(that)f(addresses)h(these)f(concerns.)146 1012 y(Standard)j(ML)h(of)f(NJ)h
(\()p fm(SML/NJ)p fq(\))g(is)f(a)h(publicly)e(available)i(implementation)d
(of)j fm(SML)g fq(developed)f(by)75 1083 y(Dave)g(MacQueen)h(and)f(Andrew)g
(Appel,)h(with)e(contributions)f(from)i(a)h(number)e(of)i(other)f(people)1703
1068 y fj([AM87)n(])1811 1083 y fq(.)25 b(It)75 1153 y(runs)7 b(on)h(a)g(vari\
ety)f(of)h(U)p fo(NIX)p fq(-based)h(systems)d(and)i(has)g(a)g(highly)e(portab\
le)i(run-time)f(system)1546 1139 y fj([Appel90)m(])1681 1153 y fq(.)16 b fm
(SML/NJ)75 1224 y fp(supports)7 b(\256rst-class)h fq(continuations)f(as)i(an)
g(extension)958 1209 y fj([DHM)n(])1056 1224 y fq(.)16 b(Our)9 b(mechanism)f
(treats)h(asynchronous)f(signals)75 1294 y(as)h(continuation)e(producing)h
(operations.)15 b(A)9 b(signal)f(handler)h(is)f(a)h(function)g(from)f(continu\
ations)f(to)i(continua-)75 1365 y(tions:)14 b(it)9 b(takes)h(take)g(the)f(cur\
rent)h(continuation)f(at)g(the)h(time)f(of)h(the)f(signal)g(and)h(returns)f
(a,)i(possibly)d(dif)o(ferent,)75 1435 y(continuation.)21 b(Because)15 b(of)f
(the)f(problems)f(with)h(asynchronous)g(exceptions,)g(we)h(have)g(chosen)f
(to)g(replace)75 1506 y(the)g(use)g(of)h(the)f(exception)g fn(Interrupt)j fq
(by)d(our)h(mechanism.)21 b(This)13 b(means)g(that)g(exceptions)f(are)i(alway\
s)75 1577 y(synchronous)e(in)i fm(SML/NJ)p fq(,)g(which)f(has)h(advantages)g
(for)f(compiling)f(and)i(reasoning)f(about)g(the)h(language.)75 1647 y(This)d
(paper)g(describes)h(the)f(mechanism)f(and)i(its)e(implementation,)g(and)h
(describes)g(some)g(applications)1778 1631 y fj(1)1796 1647 y fq(.)75 1814 y
fr(2)58 b(Continuations)17 b(in)e(SML/NJ)75 1953 y fm(SML/NJ)k fq(uses)f(a)g
(continuation-passing)e(style)h(\(CPS\))j(code)f(generator)n(,)i(which)d(prod\
uces)g(high)f(quality)75 2023 y(code)161 2009 y fj([AJ89)o(])253 2023 y fq
(.)h(The)11 b(use)h(of)f(CPS)i(in)e(the)g(compiler)g(allows)g(the)g(easy)h
(introduction)e(of)h(\256rst-class)h(continuations)75 2094 y(into)19 b(the)i
(language.)43 b(Unlike)20 b(in)g fm(Scheme)p fq(,)25 b(continuations)18 b(are)
k(statically)d(typed)1477 2079 y fj([DHM)o(])1576 2094 y fq(;)25 b(they)20 b
(have)g(the)75 2164 y(polymorphic)10 b(type)h(\252)p fi(\013)h fn(cont)p fq
(.\272)19 b(There)11 b(are)i(two)e(built-in)e(operations)i(on)g(continuations\
:)146 2268 y fh(val)23 b(callcc)137 b(:)23 b(\('a)h(cont)g(->)f('a\))h(->)f
('a)146 2314 y(val)g(throw)159 b(:)23 b('a)g(cont)h(->)g(\('a)f(->)h('b\))75
2442 y fq(A)12 b fi(\034)19 b fg(cont)11 b fq(is)h(the)g(type)f(of)i(a)f(func\
tion)f(representing)h(the)g(rest)g(of)g(the)g(program)g(with)f(a)h(formal)g
(parameter)h(of)75 2513 y(type)g fi(\034)5 b fq(.)24 b(Continuations)12 b(are)
i(created)g(using)f fn(callcc)j fq(\(call)e(with)f(current)h(continuation\))e
(and)h(are)i(applied)75 2584 y(using)10 b fn(throw)p fq(.)19 b(A)12 b(simple)
e(example)h(is)g(the)g(expression:)75 2624 y 720 2 v 128 2652 a ff(1)142 2668
y fl(This)e(paper)f(faithfully)j(describes)c(the)i(mechanism)f(as)g(provided)
g(in)i(August)e(1,)h(1990)f(release)g fe(SML/NJ)i fl(\(version)e(0.62\).)964
2802 y fq(2)p eop
%%Page: 3 4
 bop 146 82 a fh(callcc)24 b(\(fn)g(\(k)f(:)g(int)h(cont\))g(=>)g(\(throw)h
(k)d(5;)i(6\)\))f(+)g(7)75 209 y fq(The)13 b(variable)g fn(k)g fq(is)g(bound)
f(to)g(the)h fn(int)h(cont)h fq(that)d(adds)h fn(7)h fq(to)e(its)g(ar)o(gumen\
t;)h(the)g fn(throw)i fq(applies)d fn(k)i fq(to)e fn(5)p fq(,)75 280 y(giving)
f fn(12)p fq(.)19 b(Continuations)11 b(provide)g(a)h(natural)g(mechanism)f
(for)i(implementing)c(co-routines)1636 265 y fj([W)m(and80)o(])1768 280 y fq
(,)j(such)75 350 y(as)f(signal)g(handlers.)146 442 y(A)h(subtlety)f(of)i(the)
f(continuation)f(mechanism)h(is)g(the)g(interaction)g(between)h fn(callcc)i fq
(and)d(exceptions.)75 512 y(Normally)m(,)17 b(exception)f(handlers)f(are)i
(dynamically)e(scoped,)j(but)d fn(callcc)k fq(binds)c(the)h(current)g(excepti\
on)75 583 y(handler)9 b(into)e(the)i(continuation)e(it)h(passes)h(to)f(its)g
(ar)o(gument.)15 b(T)m(o)9 b(illustrate,)f(consider)h(the)f(following)g(examp\
le:)146 685 y fh(exception)26 b(Foo)146 731 y(val)d(\(f)g(:)g(unit)h(->)g('a\
\))f(=)g(\(fn)h(\(\))f(=>)g(raise)i(Foo\))146 776 y(val)e(\(g)g(:)g(unit)h
(->)g('a\))f(=)g(throw)i(\()280 822 y(callcc)g(\(fn)f(k)e(=>)i(\(callcc)h(\(f\
n)f(k')f(=>)g(throw)i(k)e(k'\);)h(raise)g(Foo\)\)\))146 868 y(fun)f(h)g(x)g
(=)g(\(\(x)g(\(\)\))h(handle)h(Foo)f(=>)f(1\))75 995 y fq(Applying)14 b fn
(h)i fq(to)g fn(f)g fq(will)f(produce)g(the)h(value)g fn(1)p fq(;)i(applying)
c(it)h(to)h fn(g)g fq(will)f(produce)g(an)h(uncaught)f(exception)75 1065 y fn
(Foo)p fq(.)j(This)9 b(is)h(because)h fn(g)g fq(raises)g fn(Foo)h fq(in)e(the)
g(exception)g(context)g(in)g(which)g(it)g(was)g(bound,)h(instead)f(of)g(in)g
(the)75 1136 y(context)h(of)g fn(h)p fq(')m(s)i(handler)m(.)75 1302 y fr(3)58
b(ML)14 b(signal)h(handling)75 1441 y fq(Our)c(approach)h(to)f(supporting)f
(asynchronous)h(signals)f(in)h fm(ML)h fq(is)f(to)g(view)g(them)g(a)h fp(cont\
inuation)d(pr)n(oducing)75 1511 y fq(operations.)22 b(When)13 b(a)g(signal)g
(occurs,)h(the)f(run-time)f(system)g(captures)i(the)f(current)g fm(ML)h fq
(state)f(as)g(a)h(contin-)75 1582 y(uation,)i(which)f(we)g(call)g(the)g fp
(r)n(esumption)f(continuation)p fq(,)h(and)g(passes)g(it)f(to)h(a)h(signal)e
(handler)m(.)29 b(The)15 b(signal)75 1652 y(handler)c(returns)f(a)h(new)f(con\
tinuation)f(with)h(which)g(the)h(run-time)e(system)h(resumes)g fm(ML)p fq(.)i
(As)e(with)g(the)g(U)p fo(NIX)75 1723 y fq(signal)h(mechanism,)f(the)i(interr\
upted)e(thread)i(and)f(signal)g(handler)g(are)h(co-routines.)75 1868 y fd(3.1)
50 b fc(System.Signals)75 1990 y fq(The)17 b(structure)g fn(System.Signals)23
b fq(in)16 b(the)h fm(SML/NJ)h fq(pervasive)f(environment)f(provides)g(a)i
(low-level)75 2061 y(interface)d(to)e(the)g fm(ML)i fq(signal)e(handling)f
(\(see)j(\256gure)f(1\).)24 b(There)14 b(are)h(a)f(number)f(of)h(signals,)g
(corresponding)75 2131 y(to)e(a)h(subset)e(of)h(the)h(U)p fo(NIX)g fq(signals)
639 2117 y fj([UNIX)o(])755 2131 y fq(plus)f(a)g(signal)g(generated)h(after)g
(garbage)g(collections)e(\()p fn(SIGGC)p fq(\).)k(A)75 2202 y(signal)c(may)g
(be)h(either)g(be)g(ignored)g(or)f(caught.)18 b(The)12 b(function)f fn(setHan\
dler)16 b fq(is)11 b(used)h(to)f(install)g(a)h(handler)75 2272 y(for)i(a)h
(given)e(signal,)h(and)g(the)g(function)g fn(inqHandler)k fq(is)13 b(used)h
(to)g(get)f(the)h(current)h(handler)m(.)25 b(A)14 b(value)g(of)75 2343 y fn
(NONE)e fq(for)e(the)h(handler)f(in)g(these)g(operations)f(speci\256es)i(an)f
(ignored)g(signal.)16 b(The)10 b(function)g fn(maskSignals)75 2413 y fq(is)j
(used)g(to)g(turn)g(signal)f(masking)g(on)h(and)g(of)o(f.)24 b(This)12 b(oper\
ation)h(is)g(cumulative,)g(so)g(that)g(multiple)e(masking)75 2484 y(operation\
s)g(will)f(nest.)146 2575 y(An)h fm(ML)h fq(signal)e(handler)i(has)f(the)g
(type:)146 2677 y fh(\(int)24 b(*)e(unit)j(cont\))f(->)f(unit)h(cont)964 2802
y fq(3)p eop
%%Page: 4 5
 bop 146 113 a fh(signature)26 b(SIGNALS)f(=)190 158 y(sig)235 204 y(datatype)
h(signal)280 250 y(=)d(SIGHUP)i(|)e(SIGINT)i(|)d(SIGQUIT)k(|)d(SIGALRM)i(|)e
(SIGTERM)i(|)e(SIGURG)280 295 y(|)g(SIGCHLD)i(|)e(SIGIO)i(|)d(SIGWINCH)k(|)d
(SIGUSR1)i(|)e(SIGUSR2)280 341 y(|)g(SIGTSTP)i(|)e(SIGCONT)i(\(*)f(not)f(yet)
h(supported)i(*\))280 387 y(|)d(SIGGC)235 432 y(val)h(setHandler)i(:)d(\(sign\
al)j(*)c(\(\(int)j(*)e(unit)h(cont\))g(->)g(unit)g(cont\))g(option\))661 478 y
(->)f(unit)235 524 y(val)h(inqHandler)i(:)d(signal)i(->)e(\(\(int)i(*)e(unit)
h(cont\))g(->)g(unit)g(cont\))g(option)235 569 y(val)g(maskSignals)j(:)c(bool)
h(->)f(unit)190 615 y(end)695 763 y fq(Figure)11 b(1:)16 b(Signature)c fn(SIG\
NALS)519 779 y 900 2 v 75 904 a fq(It)i(takes)f(a)h(count)f(of)h(pending)f
(signals)714 887 y fj(2)745 904 y fq(and)h(the)f(interrupted)g(thread')m(s)i
(resumption)d(continuation)g(as)h(ar)o(gu-)75 974 y(ments.)k(The)12 b(signal)
f(that)h(is)f(to)g(be)h(handled)g(is)f(not)g(given)g(as)h(an)g(ar)o(gument,)g
(but)g(is)f(implicit)f(in)h(the)h(choice)g(of)75 1045 y(handler)e(called.)16 b
(The)10 b(return)f(value)h(of)g(the)f(handler)h(is)f(the)g(continuation)f(wit\
h)h(which)h(execution)f(is)g(resumed.)75 1115 y(All)h(signals)g(are)i(masked)
e(while)g(the)h(handler)g(is)f(executing:)15 b(if)c(a)g(signal)f(occurs,)i
(then)e(it)g(is)h(delayed)g(until)e(the)75 1186 y(handler)i(returns.)17 b(Thi\
s)11 b(is)f(why)h(the)g(handler)h(returns)f(a)h(continuation)d(instead)i(of)g
(directly)g(throwing)f(to)h(it.)17 b(If)75 1256 y(a)11 b(signal)e(handler)i
(raises)f(an)g(exception,)h(instead)f(of)g(returning)g(normally)m(,)g(it)g
(is)g(treated)g(as)h(a)f(run-time)g(system)75 1327 y(error)n(,)j(and)e fm(SML\
/NJ)h fq(will)e(exit)h(with)g(an)g fp(uncaught)g(exception)g fq(error)m(.)
1214 1311 y fj(3)1235 1327 y fq(.)146 1418 y(In)g(order)i(to)e(write)h(robust)
f(signal)g(handlers,)h(there)g(needs)g(to)f(be)h(some)g(mechanism)f(for)h(ato\
mic)f(actions:)75 1489 y(i.e.,)k(actions)d(that)g(cannot)h(be)g(interrupted)g
(by)f(a)h(signal.)21 b(W)l(e)14 b(guarantee)f(that)g(signal)f(handlers)h(will)
f(execute)75 1560 y(atomically)m(.)18 b(Signals)11 b(are)i(masked)e(upon)h
(entry)g(to)f(the)h(handler)g(and)g(unmasked)f(when)h(the)g(handler)g(returns\
.)75 1630 y(Signals)i(that)g(occur)g(during)g(execution)g(of)g(a)h(handler)f
(are)h(postponed)e(until)g(they)h(are)h(unmasked.)25 b(Signals)75 1701 y(may)
15 b(also)g(be)h(masked)f(by)g(calling)g(the)g fn(maskSignals)20 b fq(functio\
n)15 b(with)g(the)g(value)g fn(true)p fq(.)31 b(Note)16 b(that)f(it)75 1771 y
(is)f fp(not)f fq(possible)g(to)h(unmask)f(signals)g(during)h(the)g(execution)
f(of)i(a)f(signal)f(handler)n(,)j(although)d(one)h(can)g(turn)75 1842 y(maski\
ng)e(on.)20 b(T)m(o)13 b(avoid)f(delaying)g(the)h(servicing)f(of)h(a)g(signal)
f(unnecessarily)m(,)h(it)f(is)g(good)g(practice)i(to)e(write)75 1912 y(short)
d(and)g(simple)f(signal)h(handlers.)15 b(If)10 b(an)g(application)e(requires)
h(a)h(more)f(complicated)g(and)g(time)g(consuming)75 1983 y(handler)i(action,)
h(then)f(techniques)g(similar)f(to)h(those)g(of)g(section)g(4.1)g(should)f
(be)i(used.)75 2128 y fd(3.2)50 b(Exceptions)75 2250 y fq(The)16 b(signal)f
(handler)h(executes)g(in)g(a)g(dif)o(ferent)g(exception)g(handler)f(context)h
(than)f(that)h(of)g(the)g(interrupted)75 2321 y(thread.)23 b(For)14 b(this)e
(reason,)j(the)e(use)g(of)g fn(callcc)j fq(to)d(build)f(the)h(return)h(value)
f(of)h(the)f(handler)g(requires)h(care.)75 2391 y(For)e(example,)f(consider)g
(the)h(following)e(handler:)75 2432 y 720 2 v 128 2460 a ff(2)142 2476 y fl
(The)g(pending)f(signal)g(count)h(is)g(necessary)e(because)g(delays)h(in)h
(the)g(handling)g(of)g(a)g(signal)g(can)f(result)i(in)g(multiple)g(occurrence\
s)75 2521 y(of)e(the)g(signal)g(before)g(being)f(handled.)128 2552 y ff(3)142
2568 y fl(A)i(higher)o(-level)f(signal)f(interface)h(would)g(presumably)f(imp\
lement)h(something)f(more)h(tolerant.)964 2802 y fq(4)p eop
%%Page: 5 6
 bop 146 82 a fh(fun)23 b(handler)j(\(_,)d(resumek\))j(=)280 128 y(callcc)f
(\(fn)f(k1)f(=>)g(\()325 174 y(callcc)i(\(fn)e(k2)h(=>)f(\(throw)i(k1)e(k2\)\
\);)325 219 y(doSomething\(\);)325 265 y(throw)h(resumek)i(\(\)\)\))75 385 y
fq(The)8 b(function)f fn(doSomething)12 b fq(is)c(called)g(in)f(the)h(excepti\
on)f(handler)h(context)f(bound)g(by)h(the)f(outer)h fn(callcc)p fq(,)75 456 y
(which)17 b(is)h(the)f(context)h(in)f(which)g(the)h(handler)g(was)g(called.)
36 b(If)18 b fn(doSomething)k fq(raises)c(an)g(unhandled)75 526 y(exception,)
11 b(it)g(will)g(cause)g fm(SML/NJ)h fq(to)f(terminate)g(with)g(an)g(uncaught)
g(exception)g(error)m(.)75 670 y fd(3.3)50 b(The)13 b(default)d(handlers)75
792 y fq(The)15 b(structure)f fn(Signals)k fq(de\256nes)d(default)f(handlers)
h(for)g(some)f(signals.)25 b(T)m(able)15 b(1)f(lists)g(the)g(signals)g(with)
75 862 y(a)i(short)f(description)f(and)h(the)h(default)f(handler)g(action)g
(provided)g(by)g(the)h(structure)f fn(Signals)p fq(.)32 b(Most)14 b(of)352 958
y fm(signal)595 975 y 2 57 v 621 958 a(default)e(action)913 975 y 2 57 v 938
958 a(description)327 977 y 1297 2 v 352 1016 a fn(SIGHUP)595 1033 y 2 57 v
621 1016 a fq(quit)913 1033 y 2 57 v 938 1016 a(hangup)352 1073 y fn(SIGINT)
595 1090 y 2 57 v 621 1073 a fq(raise)f(Interrupt)913 1090 y 2 57 v 938 1073 a
(interrupt)g(\(e.g.,)i(control-C\))352 1129 y fn(SIGQUIT)595 1146 y 2 57 v 621
1129 a fq(quit)913 1146 y 2 57 v 938 1129 a(quit)e(\(e.g.,)i(control-)p fk
(n)p fq(\))352 1186 y fn(SIGALRM)595 1203 y 2 57 v 621 1186 a fq(ignore)913
1203 y 2 57 v 938 1186 a(alarm)f(clock)f(\(interval)g(timer\))352 1242 y fn
(SIGTERM)595 1259 y 2 57 v 621 1242 a fq(quit)913 1259 y 2 57 v 938 1242 a
(software)h(termination)e(signal)352 1299 y fn(SIGURG)595 1316 y 2 57 v 621
1299 a fq(ignore)913 1316 y 2 57 v 938 1299 a(ur)o(gent)i(condition)d(present)
j(on)f(a)h(socket)352 1355 y fn(SIGCHLD)595 1372 y 2 57 v 621 1355 a fq(ignor\
e)913 1372 y 2 57 v 938 1355 a(child)f(status)f(has)i(been)f(changed)352 1412
y fn(SIGIO)595 1429 y 2 57 v 621 1412 a fq(ignore)913 1429 y 2 57 v 938 1412 a
(I/O)h(is)e(possible)h(on)g(a)g(descriptor)352 1468 y fn(SIGWINCH)595 1485 y 2
57 v 621 1468 a fq(ignore)913 1485 y 2 57 v 938 1468 a(window)g(changed)352
1524 y fn(SIGUSR1)595 1541 y 2 57 v 621 1524 a fq(ignore)913 1541 y 2 57 v 938
1524 a(user)o(-de\256ned)h(signal)f(1)352 1581 y fn(SIGUSR2)595 1598 y 2 57 v
621 1581 a fq(ignore)913 1598 y 2 57 v 938 1581 a(user)o(-de\256ned)h(signal)
f(2)352 1637 y fn(SIGTSTP)595 1654 y 2 57 v 621 1637 a fq(n.a.)913 1654 y 2 57
v 938 1637 a(currently)h(unsupported)352 1694 y fn(SIGCONT)595 1711 y 2 57 v
621 1694 a fq(n.a.)913 1711 y 2 57 v 938 1694 a(currently)g(unsupported)352
1750 y fn(SIGGC)595 1767 y 2 57 v 621 1750 a fq(ignore)913 1767 y 2 57 v 938
1750 a(garbage)g(collection)694 1844 y(T)m(able)f(1:)16 b(Default)11 b(signal)
g(actions)519 1861 y 900 2 v 75 1968 a(these)g(signals)f(correspond)i(to)f
(standard)g(U)p fo(NIX)h fq(signals)983 1953 y fj([UNIX)o(])1087 1968 y fq
(.)17 b(The)11 b(signals)g fn(SIGTSTP)j fq(and)d fn(SIGCONT)j fq(are)75 2038 y
(currently)f(unsupported,)f(but)g(will)g(be)h(implemented)e(in)h(the)h(near)g
(future.)21 b fn(SIGGC)15 b fq(is)d(generated)h(following)75 2109 y(every)f
(garbage)g(collection.)75 2252 y fd(3.4)50 b(Handling)11 b fc(SIGINT)75 2374 y
fq(As)d(we)g(noted)g(above,)h(we)f(implement)f(a)h(non-standard)g(policy)f
(for)h(handling)f(user)i(interrupts.)14 b(W)l(e)9 b(decided)f(on)75 2445 y
(this)f(policy)h(after)h(struggling)d(with)i(a)g(version)g(of)g(this)g(mechan\
ism)f(that)h(supported)f(asynchronous)h(exceptions)75 2516 y(\(such)j(as)h fn
(Interrupt)p fq(\))493 2501 y fj([Reppy90)r(])639 2516 y fq(.)146 2607 y(Our)
h(approach)h(is)e(to)h(eliminate)f(asynchronous)h(exceptions,)g(including)f
(the)h(exception)g fn(Interrupt)p fq(.)75 2677 y(Although)d(this)g(means)h
(a)h(variance)g(with)f(the)g(de\256nition,)g(it)g(is)g(a)g(fairly)h(minor)e
(one.)17 b(The)11 b(de\256nition)g(states:)964 2802 y(5)p eop
%%Page: 6 7
 bop 189 82 a fq(If)16 b(the)h(evaluation)e(of)h(a)h fp(topdec)f fq(yields)g
(an)g(exception)g(\(for)h(instance)f(because)g(of)h(a)f fn(raise)189 153 y fq
(expression)9 b(or)g(external)h(intervention\))f(then)g(the)h(result)f(of)h
(executing)f(the)h(program)f(\252)p fp(topdec)h(;)p fq(\272)189 223 y(is)16 b
(the)g(original)g(basis)g(together)g(with)g(the)g(state)g(which)g(is)g(in)h
(force)g(when)f(the)h(exception)f(is)189 294 y(generated.)200 364 y(\([MTH90]\
,)c(page)f(64\))75 492 y(W)l(e)e(believe)f(that)g(the)g fp(intent)g fq(here)h
(is)e(to)h(specify)g(a)h(policy)e(with)h(respect)g(to)g(the)g(top-level)g(rea\
d-eval-print)g(loop.)75 563 y(This)g(policy)g(can)g(be)g(easily)f(implemented)
f(without)h(the)g(exception)g fn(Interrupt)p fq(.)16 b(The)8 b(read-eval-prin\
t)g(loop)75 633 y(captures)k(its)f(state)g(at)h(the)f(beginning)g(of)g(each)i
(iteration)e(as)g(a)h(continuation.)k(The)c fn(SIGINT)i fq(handler)e(throws)
75 704 y(to)h(this)g(continuation,)g(which)g(restores)h(the)f(original)g(basi\
s.)23 b(By)14 b(banishing)e(asynchronous)h(exceptions)g(we)75 774 y(make)c
(reasoning)g(about)g(programs)f(that)h(use)g(exceptions)g(more)g(tractable,)h
(as)f(well)g(as)h(allowing)e(the)h(compiler)75 845 y(more)i(latitude)g(in)g
(optimizing)e(away)j(exception)f(handlers.)75 1012 y fr(4)58 b(Applications)
75 1150 y fq(The)10 b(interface)i(provided)d(by)h(structure)h fn(Signals)i fq
(is)d(low-level,)g(but)g(general)h(enough)f(to)g(provide)f(the)i(basis)75 1221
y(for)16 b(more)g(sophisticated)f(mechanisms.)30 b(In)16 b(this)g(section)f
(we)i(illustrate)e(the)h(use)g(of)g(oure)g(mechanism)f(by)75 1291 y(describin\
g)c(a)g(number)g(of)h(applications)e(and)h(programming)f(techniques.)75 1437 y
fd(4.1)50 b(Masking)12 b(signals)75 1559 y fq(Our)f(mechanism)g(allows)g(all)
g(signals)f(to)h(be)g(masked;)g(but)g(there)h(is)e(no)i(mechanism)e(for)i(mas\
king)e(individual)75 1629 y(signals.)16 b(In)c(this)e(section,)i(we)g(describ\
e)f(a)h(signal)f(handling)f(package)i(that)f(allows)g(a)h(mask)f(to)g(be)h
(attached)f(to)75 1700 y(each)h(handler)m(.)17 b(This)10 b(mask)h(speci\256es)
g(a)h(set)f(of)g(signals)f(to)g(be)i(masked)e(during)h(the)g(handler)r(')m
(s)g(execution.)16 b(W)l(e)75 1770 y(have)c(the)f(following)f(interface:)146
1873 y fh(type)24 b(handler)h(=)e(\(int)h(*)f(unit)h(cont\))g(->)g(unit)g(con\
t)146 1919 y(type)g(mask)g(=)f(signal)h(list)146 1964 y(val)f(install)j(:)c
(\(signal)k(*)d(\(handler)i(*)e(mask\))i(option\))g(->)e(handler)j(option)75
2092 y fn(Install)14 b fq(installs)c(a)i(signal)e(handler)i(and)f(associated)
g(signal)g(mask,)g(returning)g(the)g(previous)f(handler)m(.)146 2183 y(In)16 b
(order)i(to)e(provide)g(this)g(\256ner)i(grain)f(masking)e(of)i(signals,)h
(the)e(installed)g(signal)g(handlers)h(are)g(run)75 2254 y(outside)f(the)g
(context)h(of)f(the)h(handlers)f(provided)h(by)f fn(System.Signals)22 b fq
(\(recall)c(that)e(those)g(handlers)75 2325 y(mask)10 b(all)h(signals\).)k
(When)c(a)g(signal)f(occurs,)i(the)e fm(ML)i fq(signal)e(handler)g(sets)h(the)
f(handler)h(mask)f(and)h(returns)g(a)75 2395 y(continuation)e(that)h(will)g
(call)g(the)g(installed)g(handler)m(.)17 b(When)10 b(the)h(installed)e(handle\
r)i(returns,)g(the)f(signal)g(mask)75 2466 y(is)k(reset)g(and)g(control)f(is)
h(thrown)f(to)h(the)g(returned)g(continuation.)23 b(If)15 b(a)f(masked)f(sign\
al)h(occurs,)h(it)e(is)h(added)75 2536 y(to)e(a)g(list)f(of)h(pending)f(signa\
ls.)17 b(This)11 b(list)g(is)h(checked)g(when)g(the)g(installed)f(handler)h
(returns)g(and,)g(if)g(there)g(are)75 2607 y(pending)g(signals,)g(then)g(the)
h(returned)g(continuation)e(is)h(passed)g(to)g(the)h(installed)e(handler)i
(of)g(the)f(\256rst)h(signal)75 2677 y(on)e(the)g(pending)g(list.)16 b(This)
10 b(implementation)f(requires)j(about)f(100)g(lines)f(of)i fm(ML)g fq(code.)
964 2802 y(6)p eop
%%Page: 7 8
 bop 75 82 a fd(4.2)50 b(Concurr)o(ency)75 204 y fq(First-class)13 b(continua\
tions)e(provide)h(an)h(attractive)g(basis)g(for)g(implementing)e(light-weight)
g(threads)1732 190 y fj([W)m(and80)o(])1864 204 y fq(.)75 275 y(The)i(continu\
ations)e(of)i fm(SML/NJ)g fq(have)g(been)g(used)g(to)f(implement)g(co-routine)
g(packages)h(\(e.g.)22 b([Reppy89)q(,)75 345 y(Ramsey90]\),)c(but)e(providing)
f(pre-emptive)h(scheduling)f(requires)i(additional)e(run-time)g(system)h(supp\
ort.)75 416 y(This)11 b(was)h(one)g(of)g(the)g(major)f(reasons)h(for)g(develo\
ping)f(the)h(signal)f(handling)g(mechanism)g(described)h(in)f(this)75 486 y
(paper)m(.)146 578 y(Shared)18 b(data-structures,)i(such)e(as)g(the)g(process)
g(ready)h(queue,)h(must)d(be)h(accessed)h(atomically)e(with)75 648 y(respect)
12 b(to)f(process)g(switches.)17 b(T)m(o)11 b(insure)g(this,)f(we)i(use)g(a)f
(simple)g(scheme)g(to)g(mark)g(the)h(beginning)e(and)h(end)75 719 y(of)h(crit\
ical)g(regions)g(\(see)h(\256gure)g(2\))654 702 y fj(4)673 719 y fq(.)19 b
(W)l(e)13 b(assume)f(that)g(threads)g(are)h(represented)g(by)f fn(unit)i fq
(continuations,)146 852 y fh(val)23 b(atomicLevel)k(=)c(ref)h(0)146 898 y(val)
f(signalPending)28 b(=)23 b(ref)h(false)146 943 y(fun)f(atomicBegin)k(\(\))c
(=)g(\(atomicLevel)28 b(:=)23 b(!atomicLevel)k(+)c(1\))146 989 y(fun)g(atomic\
End)j(\(\))e(=)e(let)i(val)g(level)g(=)f(!atomicLevel)28 b(-)22 b(1)280 1035 y
(in)325 1080 y(if)h(\(!signalPending)29 b(andalso)c(\(level)g(=)e(0\)\))370
1126 y(then)h(callcc)h(\(fn)e(k)g(=>)g(\()415 1172 y(enqueue)i(k;)415 1217 y
(let)e(val)h(next)g(=)f(dequeue)i(\(\))415 1263 y(in)459 1309 y(atomicLevel)i
(:=)d(0;)459 1354 y(signalPending)k(:=)23 b(false;)459 1400 y(throw)i(next)f
(\(\))415 1446 y(end\)\))370 1491 y(else)415 1537 y(atomicLevel)j(:=)c(level)
280 1583 y(end)146 1628 y(fun)g(alrmHandler)k(\(_,)d(k)f(:)g(unit)h(cont\))g
(=)280 1674 y(if)f(\(!atomicLevel)28 b(>)23 b(0\))325 1720 y(then)h(\(signalP\
ending)k(:=)23 b(true;)i(k\))325 1765 y(else)f(\(enqueue)i(k;)d(dequeue)i(\(\
\)\))480 1913 y fq(Figure)12 b(2:)k(Pre-emptive)c(scheduling)e(with)g(atomic)
h(regions)519 1929 y 900 2 v 75 2040 a(and)h(that)g(we)g(have)h(functions)e fn
(enqueue)k fq(and)d fn(dequeue)j fq(to)d(manipulate)f(the)h(queue)g(of)h(read\
y)f(threads.)20 b(If)75 2110 y(a)14 b(signal)e(occurs)i(in)e(an)i(atomic)f
(region,)g(then)g(the)h(handler)f(sets)g(the)g fn(signalPending)18 b fq(\257a\
g)c(and)f(doesn')o(t)75 2181 y(switch)18 b(threads.)40 b(When)18 b(the)h(thre\
ad)g(leaves)g(the)g(critical)g(region,)i(it)d(will)g(note)h(the)f(pending)g
(fault)h(and)75 2252 y(relinquish)12 b(control.)23 b(The)13 b(pre-emptive)h
(scheduler)f(is)g(quite)g(simple;)g(if)g(the)h(current)g(thread)f(is)g(in)g
(a)h(critical)75 2322 y(region,)k(then)e(the)h fn(signalPending)22 b fq(\257a\
g)17 b(is)f(set)h(and)f(the)h(current)g(thread)g(is)f(resumed,)i(otherwise)e
(the)75 2393 y(current)c(thread)f(is)g(placed)h(in)f(the)g(ready)h(queue)f
(and)h(another)f(thread)g(is)g(dispatched.)75 2433 y 720 2 v 128 2461 a ff
(4)142 2477 y fl(T)m(o)e(simplify)h(this)g(presentation,)e(we)h(only)g(concer\
n)e(ourselves)h(with)h fh(SIGALRM)p fl(.)964 2802 y fq(7)p eop
%%Page: 8 9
 bop 75 82 a fd(4.3)50 b(Debugging)75 204 y fq(T)m(olmach)15 b(and)g(Appel)h
(have)f(built)g(a)h(replay)f(debugger)h(for)g fm(SML/NJ)1247 190 y fj([T)m
(A90])1344 204 y fq(.)30 b(They)15 b(use)h(source-to-source)75 275 y(transfor\
mations)8 b(in)g(the)h(compiler)f(to)h(instrument)e(the)i(user)r(')m(s)g(code\
.)17 b(The)9 b(debugger)g(uses)f(a)i(software)f(counter)75 345 y(to)g(keep)h
(track)g(of)g(the)g(current)g(\252time.\272)16 b(The)9 b(instrumentation)f
(code)i(increments)f(this)g(counter)g(and)h(compares)75 416 y(it)16 b(against)
h(a)g(\252tar)o(get\272)g(time)g(at)g(important)e(points,)i(called)g fp(event\
s)p fq(,)i(in)e(the)f(code)i(\(e.g.,)h(binding)d(sites)g(and)75 486 y(functio\
n)d(entry-points\).)22 b(When)14 b(the)g(current)g(time)e(matches)i(the)f(tar)
o(get)h(time,)g(then)f(control)g(is)g(transferred)75 557 y(to)e(the)h(debugge\
r)g(thread)g(\(the)g(debugger)g(and)g(user)g(program)f(are)i(co-routines\).)
18 b(One)12 b(thing)f(that)g(debuggers)75 628 y(should)h(provide)g(is)g(a)h
(way)g(for)g(the)g(user)g(to)f(asynchronously)f(force)j(a)f(break-point)f(in)
g(the)h(execution)f(of)h(the)75 698 y(program.)22 b(W)n(ith)12 b(our)h(signal)
f(mechanism,)h(this)f(function)g(is)h(easy)g(to)g(provide.)21 b(The)13 b(foll\
owing)f(handler)h(for)75 769 y fn(SIGINT)i fq(will)d(force)i(a)f(break-point)
f(at)h(the)f(next)h(debugger)f(event,)i(by)e(resetting)g(the)h(tar)o(get)g
(time)f(and)g(then)75 839 y(resuming)e(the)i(user)r(')m(s)f(thread.)146 943 y
fh(fun)23 b(sigintHandler)28 b(\(_,)c(k\))f(=)g(\(targetTime)k(:=)c(!currentT\
ime+1;)29 b(k\))75 1072 y fq(Of)12 b(course,)h(a)f(more)g(sophisticated)e(imp\
lementation)g(is)h(possible)g(that)g(would)g(allow)g(programs)h(that)f(handle)
75 1142 y(signals)18 b(\(such)h(as)g(concurrent)h(programs\))e(to)h(be)g(debu\
gged.)40 b(The)19 b(debugger)g(would)f(provide)h(its)f(own)75 1213 y(implemen\
tation)9 b(of)j(the)f fn(Signal)j fq(structure,)d(which)g(would)g(intercept)g
(interesting)f(signals.)75 1380 y fr(5)58 b(Implementation)75 1518 y fq(There)
16 b(are)h(two)e(levels)g(to)g(the)h(implementation:)22 b(the)16 b(underlying)
e(run-time)h(support)g(for)h(mapping)e(U)p fo(NIX)75 1589 y fq(signals)g(to)h
fm(ML)h fq(signals,)f(and)g(the)g(implementation)e(of)i(the)g(structure)g fn
(System.Signals)p fq(.)34 b(Following)75 1659 y(a)13 b(quick)f(introduction)f
(to)h(the)g fm(SML/NJ)h fq(run-time)f(system,)g(we)h(describe)g(the)f(impleme\
ntation)e(bottom-up.)75 1730 y(Then)17 b(there)g(is)f(a)h(discussion)e(of)h
(the)h(implementation)d(of)j(robust)f(I/O,)h(followed)f(by)g(some)g(performan\
ce)75 1801 y(measurements.)75 1946 y fd(5.1)50 b(The)13 b(SML/NJ)f(run-time)f
(system)75 2068 y fq(The)i fm(SML/NJ)h fq(run-time)e(system)g(is)h(described)
g(in)g([Appel90)o(]\),)i(but)e(it)f(has)h(been)h(extensively)e(modi\256ed)g
(to)75 2139 y(support)e(signals.)16 b(W)l(e)c(describe)g(the)f(relevant)h(fea\
tures)f(here.)146 2230 y(The)16 b fm(SML/NJ)h fq(compiler)e(uses)h fp(continu\
ation-passing)d(style)j fq(\(CPS\))i(code)f(generation)1616 2216 y fj([AJ89)o
(])1708 2230 y fq(.)32 b(Unlike)75 2300 y(other)11 b(CPS-based)h(compilers)e
(\([KKR+86])i(for)f(example\),)g fm(SML/NJ)h fq(has)f(no)f(run-time)g(stack;)
h(the)g(function)75 2371 y(return)d(continuations)e(are)j(heap)f(allocated.)
16 b(The)8 b(generated)h(code)f(is)g(also)f(heap)h(allocated,)h(so)f(special)
g(tagging)75 2442 y(techniques)j(are)h(used)f(to)g(allow)g(the)g(garbage)h
(collector)f(to)g(deal)h(with)e(program)h(counters)g(and)h(code)f(objects.)
146 2533 y(Because)16 b(there)g(is)f(no)h(run-time)e(stack,)j(the)f fm(SML/NJ)
g fq(code)g(generator)g(uses)f(a)h(register)f(model.)29 b(The)75 2603 y fm
(ML)17 b fq(state)f(consists)f(of)h(a)g(three)h(special-purpose)f(registers)g
(and)g(a)h(machine)e(dependent)h(number)g(of)g(root)75 2674 y(registers.)33 b
(Other)16 b(registers)h(may)f(be)h(used)f(as)h(temporaries,)h(but)e(these)h
(are)g(not)f(visible)g(to)g(the)h(run-time)964 2802 y(8)p eop
%%Page: 9 10
 bop 75 82 a fq(system.)17 b(Five)12 b(of)g(the)g(root)f(registers)h(have)g
(special)f(meaning:)17 b(one)12 b(is)f(the)h(program)f(counter)n(,)i(one)e
(holds)g(the)75 153 y(current)i(exception)f(handler)h(context,)g(and)g(the)f
(other)h(three)g(are)h(used)e(in)g(the)h(standard)g(calling)f(convention.)75
223 y(There)h(are)g(two)f(kinds)g(of)g(functions:)17 b(a)c(two-ar)o(gument)f
(function)g(has)g(the)g(standard)h(ar)o(gument)f(and)g(closure)75 294 y(regis\
ters)e(as)g(parameters;)h(a)g(three-ar)o(gument)f(function)g(also)g(has)g(the)
g(standard)g(return)g(continuation)f(register)75 364 y(as)g(a)g(parameter)m
(.)17 b(T)m(wo-ar)o(gument)8 b(functions)f(are)j(functions)d(that)h(never)i
(return,)f(such)g(as)f(return)h(continuations)75 435 y(and)i(the)h(continuati\
ons)d(produced)i(by)g fn(callcc)p fq(.)146 526 y(A)g fm(C)g fq(structure,)g
(called)g(the)g fp(state)f(vector)p fq(,)i(is)e(used)h(to)g(hold)f(the)h fm
(ML)g fq(state)g(in)g(the)g(run-time)f(system.)15 b(T)m(wo)75 597 y(assembly)
f(routines)g(provide)h(the)g(interface)h(between)f fm(C)g fq(and)g fm(ML)g fq
(code.)29 b(The)15 b(run-time)f(system)g(invokes)75 667 y fm(ML)c fq(code)f
(by)g(loading)f(the)h(state)f(vector)i(and)f(calling)f fn(restoreregs)p fq
(,)14 b(which)9 b(loads)g(the)g(machine)f(registers)75 738 y(from)13 b(the)g
(state)g(vector)g(and)h(jumps)e(to)g(the)h(given)g(program)g(counter)m(.)23 b
(When)13 b fm(ML)h fq(code)g(requires)f(a)h(service)75 809 y(from)k(the)h(run\
-time)f(system,)i(it)e(loads)g(a)h(global)f(variable)h fn(request)i fq(with)d
(a)h(request)g(code,)i(and)d(calls)75 879 y fn(saveregs)p fq(,)d(which)d(save\
s)f(the)h fm(ML)g fq(state)f(and)h(returns)g(to)f(the)g fm(C)h fq(code)g(that)
f(called)h fn(restoreregs)p fq(.)22 b(The)75 950 y fn(restoreregs)p fq(/)p fn
(saveregs)d fq(protocol)10 b(is)h(essentially)f(a)i(co-routine)f(switch.)146
1041 y fm(SML/NJ)g fq(has)f(a)h(simple,)f(but)g(ef)o(\256cient,)i(semi-genera\
tional)d(garbage)j(collector)1463 1027 y fj([Appel89a)n(])1614 1041 y fq(.)k
(Allocation)10 b(is)75 1112 y(also)g(fast:)16 b(it)10 b(is)g(open-coded)h(and)
f(only)g(requires)h(a)g(couple)f(more)g(instructions)f(than)h(object)h(initia\
lization.)j(A)75 1182 y(heap)d(limit)e(check)j(is)e(generated)h(at)g(the)g
(entry)g(point)e(of)i(each)h fp(code)f(tr)n(ee)1246 1166 y fj(5)1265 1182 y fq
(.)16 b(If)c(there)f(is)f(not)g(enough)h(free)h(space)75 1253 y(for)17 b(the)
f(maximum)f(possible)g(allocation)g(in)h(the)g(code)h(tree,)i(then)d(a)g fp
(garbage)g(collection)f(trap)h fq(\(GC-trap\))75 1323 y(occurs)194 1307 y fj
(6)213 1323 y fq(.)g(The)11 b(entry-point)e(of)h(a)h(code)f(tree)h(is)f(proce\
eded)h(by)f(an)g(object)g(descriptor)g(word,)h(thus)e(the)h(program)75 1394 y
(counter)h(at)h(the)f(trap)g(point)g(is)g(a)g(valid)g(heap)h(pointer)m(.)k
(Handling)11 b(a)g(GC-trap)h(involves)f(the)g(following)f(steps:)132 1523 y
(1.)23 b(The)11 b(run-time)g(routine)g fn(ghandle)k fq(catches)d(the)f(trap)h
(and)f(records)h(the)g(program)f(counter)h(of)g(the)f(trap)189 1593 y(locatio\
n)i(in)g(the)h(state)g(vector)n(,)h(sets)f fn(request)j fq(to)c fn(REQ_GC)k fq
(and)c(returns)h(control)g(to)f(the)h(assembly)189 1664 y(coded)d(routine)g fn
(saveregs)p fq(.)132 1772 y(2.)23 b fn(Saveregs)14 b fq(saves)e(the)f(ML)g
(state)g(in)g(the)g(state)g(vector)h(and)f(passes)g(control)g(up)g(to)g fn
(run_ml)p fq(.)132 1880 y(3.)23 b(The)11 b(garbage)h(collector)f(is)g(then)g
(run,)h(using)e(the)h(state)g(vector)h(as)f(the)h(root)f(set.)132 1988 y(4.)
23 b(After)12 b(garbage)g(collection,)g fn(run_ml)i fq(calls)e fn(restoreregs)
p fq(,)17 b(which)12 b(loads)f(the)h(machine)f(registers)189 2058 y(from)g
(the)g(state)g(vector)n(,)h(and)g(jumps)e(to)h(the)g(trap)g(location.)75 2203
y fd(5.2)50 b(Run-time)12 b(support)f(for)h(signals)75 2325 y fq(The)f(major)
g(problem)f(with)g(handling)g(an)h(asynchronous)f(signal)g(is)g(to)h(avoid)f
(corrupting)h(the)f(heap.)17 b(The)11 b fm(ML)75 2396 y fq(signal)g(handler)i
(cannot)f(be)g(dispatched)g(immediately)m(,)f(since)i(the)f(current)h(thread)
f(may)g(be)h(in)f(the)g(middle)f(of)75 2467 y(an)i(allocation.)19 b(There)12 b
(are)i(a)e(number)g(of)h(ways)f(to)g(deal)g(with)g(this)f(problem.)19 b(One)
13 b(approach)g(is)f(to)g(have)g(the)75 2537 y(run-time)h(system)g(recognize)
i(this)d(situation)h(and)h(emulate)f(the)h(instruction)e(stream)i(until)f(the)
g(allocation)h(is)75 2578 y 720 2 v 128 2606 a ff(5)142 2622 y fl(A)c fb(code)
d(tr)o(ee)h fl(\(or)i fb(extended)e(basic)g(block)p fl(\))g(is)i(an)e(acyclic)
g(set)h(of)h(blocks)e(with)h(one)g(entry-point)g(and)f(one,)h(or)g(more,)h
(exits.)128 2652 y ff(6)142 2668 y fl(The)f(GC-trap)g(is)h(just)f(a)g(U)p fa
(NIX)f fl(signal.)964 2802 y fq(9)p eop
%%Page: 10 11
 bop 75 82 a fq(complete)243 68 y fj([MK87)n(,)9 b(Appel89b)n(])499 82 y fq
(.)16 b(This)10 b(approach)h(has)f(the)g(substantial)f(disadvantage)g(that)h
(it)g(requires)g(an)h(emulator)75 153 y(for)h(every)f(dif)o(ferent)h(architec\
ture,)h(reducing)e(portability)1022 136 y fj(7)1039 153 y fq(.)146 244 y(Inst\
ead,)25 b(we)e(use)f(an)h(approach)g(similar)e(to)h(the)g(one)h(used)f(by)g fm
(Argus)h fq(for)g(light-weight)e(context)75 315 y(switches)233 300 y fj([LCJS\
87)o(])361 315 y fq(:)26 b(we)17 b(synchronize)f(signals)f(with)g(\252safe\
\272)j(points)d(in)h(the)g(code.)31 b(The)17 b(heap)f(limit)f(checks)75 385 y
(at)e(the)f(code)h(tree)g(entry-points)f(are)h(a)g(convenient)g(choice)g(for)
g(the)f(synchronization)g(points;)f(by)i(delaying)f(a)75 456 y(signal)d(until)
f(the)h(next)g(check)h(we)g(can)g(guarantee)g(safety)m(.)16 b(When)10 b(an)f
(asynchronous)g(signal)g(occurs,)h(we)g(adjust)75 526 y(the)k(limit)e(registe\
r)i(to)g(force)h(a)f(garbage)h(collection)e(trap)h(on)g(the)g(next)g(limit)e
(check.)26 b(The)14 b(run-time)f(system)75 597 y(recognizes)c(this)f(as)h(rea\
lly)g(being)g(a)g(signal,)g(and)g(passes)g(it)f(to)h(the)g fm(SML)h fq(signal)
e(handler)1492 580 y fj(8)1510 597 y fq(.)16 b(This)9 b(technique)f(has)75 667
y(the)h(additional)f(advantage)h(that)f(it)h(doesn')o(t)f(incur)h(any)g(addit\
ional)f(run-time)g(overhead)i(on)f(normal)f(execution.)146 759 y(More)15 b
(speci\256cally)m(,)i(let)e(us)g(consider)g(the)g(case)h(of)g(a)f(signal)g
(occurring)g(during)g(the)g(execution)g(of)g fm(ML)75 829 y fq(code.)i(When)
12 b(a)f(signal)g(occurs,)h(the)f(following)f(steps)h(are)h(taken:)132 956 y
(1.)23 b(The)15 b(run-time)g(routine)g fn(sighandler)20 b fq(catches)c(the)f
(signal.)29 b(It)16 b(records)g(the)f(signal)g(and)g(resumes)189 1027 y(execu\
tion)c(of)g fm(ML)h fq(code)g(via)f(an)g(assembly)g(routine)g(that)f(adjusts)
h(the)g(heap)h(limit)d(register)m(.)132 1134 y(2.)23 b(The)11 b fm(ML)h fq
(code)g(executes)f(until)f(the)i(next)f(heap)g(limit)f(check,)i(which)f(will)
g(trap.)132 1241 y(3.)23 b fn(Ghandle)7 b fq(recognizes)g(that)g(the)g(GC-tra\
p)g(is)g(really)g(a)g(signal)g(trap,)h(and)f(sets)g fn(request)g fq(to)g fn
(REQ_SIGNAL)p fq(.)189 1312 y(It)19 b(saves)g(the)g(faulting)f(program)g(coun\
ter)i(and)f(returns)f(control)h(to)g(the)f(assembly)g(coded)i(routine)189 1382
y fn(saveregs)p fq(.)132 1489 y(4.)j(As)12 b(with)g(a)g(GC-trap,)i fn(savereg\
s)i fq(saves)c(the)h(ML)f(state)g(in)g(the)g(state)g(vector)h(and)f(passes)g
(control)g(up)189 1560 y(to)f fn(run_ml)p fq(.)132 1667 y(5.)23 b fn(Run_ml)
13 b fq(allocates)e(a)g(resume)g(continuation)f(using)g(the)h(saved)g(state,)
g(builds)f(an)h(ar)o(gument)g(tuple)f(and)189 1738 y(calls)h(the)g fm(ML)h fq
(signal)e(handler)i(\(via)f fn(restoreregs)p fq(\).)132 1845 y(6.)23 b(The)15
b fm(ML)g fq(handler)g(deals)g(with)f(the)h(signal)f(and)h(then)f(returns)h
(a)g(resume)g(continuation.)26 b(The)15 b(return)189 1915 y(continuation)i
(of)h(the)g fm(ML)i fq(handler)e(is)g(a)h(piece)g(of)f(assembly)g(code)h(that)
f(calls)g fn(saveregs)k fq(with)189 1986 y fn(request)14 b fq(set)d(to)g fn
(REQ_SIG_RETURN)p fq(.)132 2093 y(7.)23 b fn(Run_ml)13 b fq(calls)f(the)f(res\
ume)g(continuation)f(\(via)h fn(restoreregs)p fq(\).)75 2220 y(Of)d(course,)i
(another)e(signal)g(can)g(occur)h(while)f(we)g(are)h(in)f(the)g(process)h(of)
f(handling)f(a)i(signal,)f(so)g(it)g(is)g(necessary)75 2291 y(to)i(provide)g
(some)g(concurrency)h(control.)k(W)l(e)d(use)e(a)g(small)g(collection)f(of)i
(global)e(variables)h(for)h(this)e(purpose)75 2361 y(\(see)18 b(\256gure)g
(3\).)35 b(The)17 b fn(inML)i fq(\257ag)f(is)f(set)g(by)g fn(restoreregs)22 b
fq(and)17 b(cleared)h(by)f fn(saveregs)p fq(;)24 b(it)16 b(marks)75 2432 y
(when)g(execution)f(is)g(in)h fm(ML)g fq(code.)31 b(The)15 b(\257ag)i fn(hand\
lerPending)k fq(is)15 b(set)h(by)g fn(sighandler)j fq(\(step)d(1\))75 2502 y
(to)e(note)h(that)f(a)h(handler)f(trap)h(is)f(pending.)26 b(This)14 b(\257ag)
h(is)f(cleared)i(by)e fn(ghandle)j fq(\(step)e(3\),)h(which)e(sets)g(the)75
2542 y 720 2 v 128 2569 a ff(7)142 2585 y fe(SML/NJ)c fl(is)f(currently)g(sup\
ported)f(for)i(5)f(dif)o(ferent)h(machine)e(architectures,)g(so)h(this)g(is)h
(a)e(major)i(concern.)128 2616 y ff(8)142 2632 y fl(The)g(run-time)h(system)e
(checks)e(on)j(the)g(available)f(memory)h(and,)g(if)h(necessary)m(,)d(does)h
(a)h(garbage)e(collection)i(prior)h(to)f(invoking)75 2677 y(the)f fe(ML)h fl
(signal)e(handler)n(.)952 2802 y fq(10)p eop
%%Page: 11 12
 bop 146 115 a fh(int)68 b(inML;)249 b(/*)23 b(This)h(flag)g(is)f(set)h(when)
g(we)f(are)h(executing)i(ML)d(code.)47 b(*/)146 161 y(int)68 b(handlerPending\
;)29 b(/*)23 b(This)h(flag)g(is)f(set)h(when)g(a)f(handler)i(trap)f(is)g(pend\
ing,)h(*/)639 207 y(/*)e(and)h(cleared)h(when)f(the)g(handler)h(trap)f(occurs\
.)182 b(*/)146 252 y(int)68 b(inSigHandler;)73 b(/*)23 b(This)h(flag)g(is)f
(set)h(when)g(a)f(handler)i(trap)f(occurs)h(and)46 b(*/)639 298 y(/*)23 b(is)
g(cleared)j(when)e(the)f(ML)h(handler)h(returns.)227 b(*/)146 344 y(int)68 b
(maskSignals)27 b(=)c(0;/*)h(When)g(set,)g(signals)h(are)f(masked.)451 b(*/)
146 389 y(int)68 b(NumPendingSigs;)29 b(/*)23 b(This)h(is)f(the)h(total)g(num\
ber)h(of)f(signals)h(pending.)115 b(*/)624 537 y fq(Figure)11 b(3:)16 b(Concu\
rrency)d(control)d(globals)519 554 y 900 2 v 75 678 a fn(inSigHandler)16 b fq
(\257ag.)h(The)11 b fn(inSigHandler)k fq(\257ag)d(is)e(cleared)i(by)e fn(rest\
oreregs)16 b fq(\(step)10 b(7\),)i(after)f(the)75 749 y(signal)i(has)h(been)g
(handled.)25 b(If)14 b(either)h fn(handlerPending)k fq(or)14 b fn(inSigHandle\
r)19 b fq(is)14 b(set)g(when)g(a)g(signal)75 819 y(occurs,)e(then)g fn(sighan\
dler)j fq(records)d(the)g(signal,)f(but)g(does)g(not)g(adjust)g(the)h(heap)g
(limit)d(register)j(or)g(set)f(the)75 890 y fn(handlerPending)21 b fq(\257ag.)
28 b(The)14 b(U)p fo(NIX)i fq(signal)e(handlers)h fn(sighandler)k fq(and)c fn
(ghandle)j fq(are)d(installed)75 960 y(with)f(all)g(signals)g(masked,)h(so)f
(they)h(execute)g(atomically)m(.)25 b(This)14 b(atomicity)m(,)h(coupled)f(wit\
h)g(the)g(two-phase)75 1031 y(structure)e(of)h(handling)e(signals,)h(guarante\
es)h(that)f(any)g(signal)g(that)g(occurs)h(during)e(signal)h(handling)f(will)
h(be)75 1101 y(postponed)j(until)f(after)j(the)f(\256rst)f(signal)g(is)h(hand\
led.)30 b(The)16 b(\257ag)g fn(maskSignals)k fq(is)c(used)f(to)h(implement)75
1172 y(signal)11 b(masking)f(outside)g(of)h(a)h(signal)f(handler)m(.)146 1263
y(If)f(a)h(signal)e(occurs)i(during)e(execution)h(of)g fm(C)g fq(code)h(\(e.g\
.,)h(during)d(a)i(garbage)g(collection\),)f(then)g(we)g(record)75 1334 y(it)
15 b(and)g(resume)h(execution.)28 b(The)16 b(assembly)e(routine)h fn(restorer\
egs)20 b fq(checks)15 b(for)h(pending)f(signals)f(just)75 1404 y(prior)d(to)f
(resuming)g fm(ML)i fq(execution.)k(Figure)c(4)f(contains)f(the)h(Motorola)f
(MC680x0)g(code)h(for)g(this)g(operation)75 1475 y(After)k(setting)f(the)h fn
(inML)h fq(\257ags,)g(this)e(code)h(tests)f(for)i(pending)e(signals.)26 b(If)
15 b(there)g(are)h(any)m(,)g(then)e(it)h(checks)146 1607 y fh(_restoreregs:)
280 1653 y(...)280 1698 y(addql)25 b(#1,_inML)294 b(/*)24 b(note)g(that)g(we)
f(are)h(executing)i(ML)d(code)h(*/)280 1744 y(tstl)47 b(_NumPendingSigs)140 b
(/*)24 b(check)g(for)g(pending)h(signals)g(*/)280 1790 y(jeq)69 b(call_ml)280
1835 y(tstl)47 b(_maskSignals)206 b(/*)24 b(are)f(signals)j(masked?)f(*/)280
1881 y(jne)69 b(call_ml)280 1927 y(tstl)47 b(_inSigHandler)184 b(/*)24 b(are)
f(we)g(currently)k(handling)e(a)e(signal?)j(*/)280 1972 y(jne)69 b(call_ml)
280 2018 y(addql)25 b(#1,_handlerPending)74 b(/*)24 b(note)g(that)g(a)f(handl\
er)i(trap)f(is)f(pending)j(*/)280 2064 y(clrl)47 b(d5)426 b(/*)24 b(force)g
(a)f(trap)h(on)f(the)h(next)g(limit)g(check)h(*/)146 2109 y(call_ml:)280 2155
y(jmp)69 b(a5@)404 b(/*)24 b(jump)g(to)f(the)h(ML)f(code)h(*/)726 2303 y fq
(Figure)12 b(4:)k(Returning)11 b(to)g fm(ML)519 2319 y 900 2 v 75 2429 a fq
(to)j(see)h(if)f(it)g(is)g(in)g(the)h(second)f(phase)g(of)h(signal)f(handling\
,)g(and,)i(if)e(not,)h(it)f(starts)g(the)g(\256rst)h(phase)f(of)h(signal)75
2500 y(handling.)31 b(Since)17 b(starting)e(the)i(\256rst)f(phase)h(is)f(an)g
(idempotent)f(operation,)j(it)e(doesn')o(t)g(matter)g(if)g(a)h(signal)75 2570
y(occurs)12 b(at)f(this)f(point.)952 2802 y(11)p eop
%%Page: 12 13
 bop 75 82 a fd(5.3)50 b(The)13 b(implementation)e(of)h fc(System.Signals)75
204 y fq(The)j(implementation)d(of)j fn(System.Signals)21 b fq(is)14 b(fairly)
h(straight-forward.)27 b(At)14 b(the)h(core)g(of)g(the)g(imple-)75 275 y(ment\
ation)e(is)g(the)h(root)g fm(ML)g fq(signal)f(handler)n(,)j(which)d(is)h(call\
ed)g(by)f(the)h(run-time)g(code.)25 b(A)14 b(global)f(array)i(is)75 345 y(mai\
ntained,)c(that)g(records)g(the)h(current)f(status)g(of)g(each)h(signal:)146
449 y fh(datatype)25 b(sig_sts)190 495 y(=)e(ENABLED)j(of)d(\(\(int)h(*)f(uni\
t)h(cont\))h(->)e(unit)h(cont\))190 540 y(|)f(DISABLED)146 586 y(val)g(sigvec)
i(:)e(sig_sts)i(array)75 715 y fq(The)c(functions)e fn(setHandler)25 b fq(and)
20 b fn(inqHandler)25 b fq(update)20 b(the)g(array)h(appropriately)m(.)44 b
(If)21 b(a)g(call)f(to)75 785 y fn(setHandler)c fq(makes)11 b(a)h(disabled)f
(signal)f(enabled,)i(or)g(visa-versa,)g(then)g(the)f(run-time)g(system)f(is)h
(noti\256ed)75 856 y(by)k(a)h(call)f(to)g(the)g fm(C)g fq(function)f fn(enabl\
esig)833 839 y fj(9)856 856 y fq(.)28 b(The)16 b(code)f(for)h(the)f(root)f fm
(ML)i fq(signal)f(handler)g(is)g(given)f(in)75 926 y(\256gure)e(5.)k(The)11 b
(signal)f(handler)h(should)f(never)h(get)g(called)g(on)g(a)g(disabled)g(signa\
l,)f(since)h(the)g(run-time)f(system)146 1060 y fh(fun)23 b(sigHandler)k(\(co\
de,)e(count,)g(resume_k\))h(=)d(\()280 1105 y(case)h(\(InLine.subscript\(sigv\
ec,)33 b(code\)\))302 1151 y(of)24 b(DISABLED)h(=>)f(resume_k)325 1197 y(|)f
(\(ENABLED)i(handler\))h(=>)d(handler)j(\(count,)f(resume_k\)\))662 1344 y fq
(Figure)12 b(5:)k(Root)11 b fm(ML)h fq(signal)f(handler)519 1361 y 900 2 v 75
1471 a(blocks)h(them.)19 b(A)13 b(global)e(counter)i(is)f(used)g(to)g(keep)h
(track)g(of)f(the)h(nesting)e(level)h(of)h(signal)f(masking.)19 b(A)12 b(call)
75 1542 y(to)h fn(maskSignals)18 b fq(increments)13 b(or)g(decrements)h(this)
e(counter)i(depending)f(on)g(the)g(ar)o(gument.)23 b(On)14 b(a)f fn(0)p fq
(\261)p fn(1)75 1612 y fq(\()p fn(1)p fq(\261)p fn(0)p fq(\))f(transition,)f
(a)g(call)h(is)f(made)g(to)g(a)h fm(C)f fq(routine)g(that)g(sets)g(\(clears\))
h(the)f fn(maskSignals)16 b fq(\257ag.)75 1758 y fd(5.4)50 b(Signals)12 b(and)
g(I/O)g(operations)75 1880 y fm(SML/NJ)17 b fq(implements)e(in)h(and)g(out)g
(streams)g(as)g(a)h(buf)o(fered)g(I/O)g(library)f(written)g(in)g fm(ML)p fq
(.)h(The)g(run-time)75 1950 y(system)9 b(provides)h(an)h(interface)g(to)f(the)
g fn(read)j fq(and)d fn(write)j fq(system)c(calls)1282 1936 y fj([UNIX])1387
1950 y fq(,)i(which)f(are)h(used)g(by)f(the)g(I/O)75 2021 y(library)m(.)24 b
(The)14 b(implementation)e(of)i(the)g(stream)g(operations)f(raise)h(a)g(numbe\
r)g(of)g(problems)f(with)g(respect)h(to)75 2091 y(signals:)143 2220 y fk(\017)
23 b fq(An)14 b(input)g(operation,)h(such)f(as)h(reading)f(the)h(line)f(from)
g(the)h(terminal,)g(can)g(block)f(inde\256nitely)g(\(i.e.,)189 2291 y(until)9
b(the)i(user)g(hits)e(the)i(\252return\272)g(key\),)h(which)e(con\257icts)h
(with)f(the)g(desire)h(to)f(have)h(a)h(user)e(interrupt)g(to)189 2361 y(force)
i(control)f(back)g(to)g(the)g(top-level)g(prompt.)143 2469 y fk(\017)23 b fq
(A)14 b(signal)f(that)h(occurs)h(during)e(an)h(I/O)h(operation)e(may)h(cause)
h(inconsistencies)e(between)h(the)g(buf)o(fer)189 2540 y(and)d(the)g(operatin\
g)g(system.)16 b(This)10 b(results)h(in)g(input)f(being)h(lost)g(and)g(output)
f(being)h(printed)g(twice.)75 2580 y 720 2 v 128 2608 a ff(9)142 2624 y fl
(The)i(run-time)h(system)e(also)h(shadows)e(the)j(status)e(of)i fe(ML)g fl
(signals,)f(in)h(order)f(that)h(the)f(state)g(can)f(be)h(restored)g(for)h(exp\
orted)75 2670 y(images.)952 2802 y fq(12)p eop
%%Page: 13 14
 bop 143 82 a fk(\017)23 b fq(A)17 b(signal)f(that)g(occurs)h(during)f(an)h
(I/O)g(operation)g(may)f(cause)i(inconsistencies)d(between)i(the)g(user)189
153 y(program)11 b(and)g(the)g(buf)o(fer)m(.)75 281 y(Our)i(approach)g(to)f
(implementing)e(I/O)j(solves)f(the)g(\256rst)h(two)f(problems,)g(and)h(the)g
(third)f(problem)f(can)i(easily)75 352 y(be)f(solved,)f(using)f(signal)g(mask\
ing,)h(in)g(applications)f(that)h(require)h(it.)146 443 y(T)m(o)h(understand)
g(the)g(subtleties)f(of)i(this)f(interaction,)h(consider)f(the)h(case)g(of)f
(signal)g(occurring)h(during)f(a)75 514 y(call)c(to)f fn(read)p fq(.)18 b(The)
9 b(signal)f(handler)666 497 y fj(10)710 514 y fq(has)g(two)h(options:)k(it)8
b(can)i(either)e(interrupt)h(the)f(operation)h(or)f(resume)h(it.)75 584 y(Unf\
ortunately)m(,)h(neither)h(option)e(will)h(work.)17 b(If)11 b(the)f(signal)g
(occurs)h(immediately)e(following)g(the)i(completion)75 655 y(of)k(the)g fn
(read)p fq(,)i(then)e(interrupting)e(it)i(will)e(result)i(in)f(data)h(loss.)
26 b(On)15 b(the)g(other)g(hand,)g(if)g(the)g(signal)f(occurs)75 725 y(just)d
(prior)h(to)g(the)g(initiation)e(of)j(the)f fn(read)p fq(,)i(then)e(inde\256n\
ite)g(blocking)f(may)h(occur)m(.)20 b(Another)12 b(problem)g(with)75 796 y
(interrupting)d(an)i(I/O)g(operation)g(is)f(that)g(we)h(may)g(need)g(to)f(to)
h(restart)g(it)f(\(e.g.,)j(if)d(the)h(signal)f(is)g fn(SIGALRM)k fq(and)75 866
y(it)d(causes)g(a)h(context)f(switch\).)146 958 y(T)m(o)e(address)h(these)f
(problems,)h(we)g(divide)f(the)g(buf)o(fered)i(I/O)f(operations)f(into)f(two)
i(phases.)16 b(First)9 b(we)h(wait)75 1028 y(for)i(the)g(operation)f(to)h(be)
g(ready)m(,)h(and)f(then)f(we)h(actually)g(do)f(the)h(operation.)18 b(The)12 b
(\256rst)g(phase)g(is)f(idempotent,)75 1099 y(and)f(so)g(can)h(restarted)f
(safely)m(.)17 b(Once)10 b(the)g(I/O)g(operation)g(is)g(ready)m(,)h(we)f(make)
g(the)h fn(read)p fq(/)p fn(write)i fq(system)c(call)75 1169 y(and)i(update)h
(the)f(buf)o(fers.)17 b(T)m(o)11 b(illustrate,)g(the)g fm(ML)h fq(code)g(to)e
(\256ll)i(an)f(input)f(buf)o(fer)j(looks)d(something)g(like)146 1273 y fh(fun)
23 b(filbuf)i(\(INSTRMfilid,)j(buf,)c(pos,)g(len,)g(...\))g(=)f(\()280 1319 y
(in_wait)i(filid;)280 1364 y(protect)g(\(fn)f(_)f(=>)g(\(pos)h(:=)f(0;)h(len)
f(:=)h(read\(filid,)j(buf,)d(bufsize\)\)\))i(\(\)\))75 1493 y fq(The)12 b fn
(protect)j fq(function)c(\(\256gure)i(6\))f(is)f(used)h(to)f(guarantee)i(that)
e(the)h(buf)o(fer)g(and)g(operating)g(system)f(have)h(a)146 1626 y fh(fun)23 b
(protect)j(f)c(x)h(=)g(let)280 1671 y(open)h(System.Signals)280 1717 y(val)g
(_)f(=)f(maskSignals)27 b(true)280 1763 y(val)d(y)f(=)f(\(f)i(x\))f(handle)i
(ex)e(=>)g(\(maskSignals)28 b(false;)d(raise)f(ex\))280 1808 y(in)325 1854 y
(maskSignals)j(false;)325 1900 y(y)280 1945 y(end)683 2093 y fq(Figure)11 b
(6:)16 b(Protect)c(a)g(function)e(call)519 2109 y 900 2 v 75 2220 a(consisten\
t)g(view)h(of)h(the)f(\256le.)146 2311 y(The)16 b(run-time)g(system)f(provide\
s)g fp(wait)h(for)g(input/output)e fq(operations)h(to)h fm(ML)p fq(.)h(These)
g(operations)e(are)75 2382 y(unique)i(among)f(the)i(run-time)e(routines)h(in)
g(that)g fn(sighandler)k fq(will)c(interrupt)f(them.)35 b(Figure)17 b(7)h(giv\
es)75 2452 y(pseudo)9 b fm(C)g fq(code)g(for)h(the)f(wait)g(for)g(input)f(rou\
tine.)16 b(The)9 b fn(ioWaitFlag)k fq(is)c(used)g(to)g(mark)g(that)g(we)g(are)
h(waiting)75 2523 y(for)f(I/O.)g(If)h(it)e(is)g(set)h(when)g(a)g(signal)f(occ\
urs,)i(then)f fn(sighandler)k fq(does)8 b(a)h fn(longjmp)j fq(to)d(the)f(wait\
ing)g(routine,)75 2593 y(which)h(restores)g(the)f fm(ML)i fq(state)f(vector)g
(to)f(the)h(value)g(it)f(had)h(when)g(the)g(input)e(wait)i(routine)f(was)h
(called)g(by)g fm(ML)p fq(.)75 2634 y 720 2 v 115 2662 a ff(10)142 2677 y fl
(This)g(is)g(the)g fe(C)h fl(function)e fh(sighandler)p fl(,)14 b(not)9 b(an)
g fe(ML)h fl(handler)n(.)952 2802 y fq(13)p eop
%%Page: 14 15
 bop 146 115 a fh(if)23 b(\(setjmp\(env\))k(==)c(0\))h({)235 161 y(ioWaitFlg)
i(=)d(1;)235 207 y(if)g(\(NumPending)k(Sigs)e(==)e(0\))g({)334 252 y fb(wait)
10 b(for)f(input)g(to)g(be)g(available)235 298 y fh(})23 b(else)h({)280 344 y
(/*)f(A)g(signal)i(was)f(already)h(pending)g(*/)334 389 y fb(r)o(estor)o(e)7 b
(the)i fe(ML)g fb(state)g(vector)235 435 y fh(})235 481 y(ioWaitFlg)26 b(=)d
(0;)146 526 y(})f(else)i({)190 572 y(/*)g(A)e(signal)j(occured)h(while)e(wait\
ing)i(*/)245 618 y fb(r)o(estor)o(e)6 b(the)j fe(ML)h fb(state)e(vector)146
663 y fh(})756 811 y fq(Figure)k(7:)k(W)l(ait)11 b(for)h(input)519 827 y 900 2
v 75 952 a(The)j fm(ML)g fq(signal)f(handler)g(is)g(then)h(called)g(with)e
(a)i(resumption)f(continuation)f(that)h(will)f(retry)i(the)g(I/O)f(wait)75
1023 y(operation.)i(If)11 b(a)g(signal)f(occurs)g(before)h(we)g(set)f(the)h fn
(ioWaitFlag)p fq(,)k(then)10 b(we)h(also)f(restore)h(the)f fm(ML)h fq(state.)
17 b(If)75 1093 y(a)12 b(signal)e(occurs)i(after)g(the)f fn(ioWaitFlag)k fq
(has)d(been)f(cleared,)i(then)e(the)g(wait)g(operation)g(completes.)75 1239 y
fd(5.5)50 b(Performance)75 1361 y fq(Signals)13 b(such)g(as)h fn(SIGINT)i fq
(occur)e(infrequently)f(enough)g(that)g(performance)h(is)g(not)e(a)i(major)g
(concern,)h(but)75 1431 y(for)e(concurrency)h(packages)f(that)g(use)g fn(SIGA\
LRM)i fq(to)e(provide)f(pre-emption,)h(signal)f(handling)g(overhead)i(is)75
1502 y(an)c(issue.)15 b(T)m(able)9 b(2)h(contains)e(measurements)h(of)g(the)h
(overhead)f(of)h(handling)e fn(SIGALRM)k fq(signals)d(in)g fm(ML)p fq(.)h(Our)
553 1601 y(System)847 1618 y 2 57 v 872 1601 a(Relative)1049 1618 y 2 57 v
1074 1601 a fi(\026)p fq(S)j(per)1221 1618 y 2 57 v 1301 1601 a(Overhead)847
1674 y 2 57 v 893 1657 a(Speed)1049 1674 y 2 57 v 1081 1657 a(signal)1221 1674
y 2 57 v 1247 1657 a(\(50)e(signals/sec\))393 1676 y 1164 2 v 418 1715 a(Sun)
g(4/490)847 1732 y 2 57 v 920 1715 a(7.3)1049 1732 y 2 57 v 1128 1715 a(350)
1221 1732 y 2 57 v 1342 1715 a(1.7%)418 1772 y(Sun)g(SP)l(ARCstation)h(1+)847
1789 y 2 57 v 920 1772 a(4.6)1049 1789 y 2 57 v 1128 1772 a(530)1221 1789 y 2
57 v 1342 1772 a(2.6%)418 1828 y(DECstation)e(3100)847 1845 y 2 57 v 920 1828
a(4.2)1049 1845 y 2 57 v 1128 1828 a(420)1221 1845 y 2 57 v 1342 1828 a(2.1%)
418 1885 y(Sun)h(SP)l(ARCstation)h(1)847 1902 y 2 57 v 920 1885 a(3.8)1049
1902 y 2 57 v 1128 1885 a(600)1221 1902 y 2 57 v 1342 1885 a(3.0%)418 1941 y
(Sun)f(4/280)847 1958 y 2 57 v 920 1941 a(3.2)1049 1958 y 2 57 v 1128 1941 a
(460)1221 1958 y 2 57 v 1342 1941 a(2.3%)418 1998 y(NeXT)847 2015 y 2 57 v 920
1998 a(1.3)1049 2015 y 2 57 v 1094 1998 a(2,400)1221 2015 y 2 57 v 1348 1998 a
(12%)418 2054 y(Sun)g(3/60)847 2071 y 2 57 v 920 2054 a(1.0)1049 2071 y 2 57 v
1094 2054 a(1,300)1221 2071 y 2 57 v 1342 2054 a(6.3%)698 2148 y(T)m(able)g
(2:)16 b(Signal)11 b(handling)f(costs)519 2164 y 900 2 v 75 2275 a(benchmark)
h(is)f(a)h(simple)f(program)g(that)h(doesn')o(t)f(do)h(any)g(allocation.)k
(W)l(e)d(measured)f(the)f(time)g(it)h(took)f(to)g(run)75 2345 y(with)h(the)g
(interval)g(timer)h(turned)f(of)o(f)h(and)g(the)f(time)g(needed)h(with)f(the)
g(timer)g(on,)h(and)g(used)f(the)h(dif)o(ference)g(in)75 2416 y(these)g(times)
g(to)g(compute)g(the)g(overhead.)21 b(The)13 b(relative)f(speed)h(column)e
(in)h(table)h(2)f(relates)h(the)f(time)g(it)g(took)75 2487 y(to)g(run)g(the)g
(benchmark)h(\(without)e(signals\))g(on)h(the)h(various)e(systems.)19 b(The)
12 b(Sun)h(systems)e(were)i(all)f(running)75 2557 y(SunOS)17 b(4.0.3,)h(the)e
(DECstation)g(was)g(running)f(Ultrix)h(V2.2,)i(and)e(the)g(NeXT)h(was)f(runni\
ng)f(release)j(1.0.)75 2628 y(The)12 b(relatively)g(high)g(cost)g(of)h(signal)
e(handling)g(on)h(the)h(NeXT)f(machine)g(is)g(probably)g(because)h(the)f(NeXT\
')m(s)952 2802 y(14)p eop
%%Page: 15 16
 bop 75 82 a fq(implementation)9 b(of)j(U)p fo(NIX)g fq(signal)e(handling)h
(is)f(built)h(on)g(top)f(of)i(the)f(MACH)h(exception)e(mechanism.)75 249 y fr
(6)58 b(Futur)o(e)15 b(work)75 388 y fq(W)l(e)g(know)f(of)h(a)g(few)g(remaini\
ng)f(problems)f(with)h(the)h(current)g(implementation;)e(the)i(following)e
(is)h(a)h(brief)75 458 y(discussion)10 b(of)h(some)g(of)g(these.)75 604 y fd
(6.1)50 b(Incr)o(emental)13 b(garbage)f(collection)75 726 y fq(One)c(problem)
g(area)h(in)f(our)h(implementation)d(is)h(the)i(interaction)e(between)i(signa\
ls)e(and)h(the)g(garbage)h(collector)m(.)75 796 y(A)14 b(signal)f(that)g(occu\
rs)i(during)e(execution)g(of)h fm(C)g fq(code)h(in)e(the)h(run-time)f(kernel)
h(cannot)g(be)g(safely)g(handled,)75 867 y(but)h(must)f(be)i(delayed)f(until)
g(the)g(next)g(heap-limit)f(check)i(in)f(ML)g(code.)30 b(Most)14 b(of)i(the)f
(run-time)g(routines)75 937 y(are)j(quick)e(enough)h(so)g(that)f(this)g(isn')
o(t)h(a)g(problem,)h(but,)g(unfortunately)m(,)g(a)g(garbage)f(collection)f
(can)i(take)75 1008 y(several)11 b(seconds)360 991 y fj(11)395 1008 y fq(,)g
(during)f(which)h(several)g(hundred)f(timer)g(signals)g(can)h(occur)m(.)18 b
(One)11 b(solution)e(would)h(be)g(to)75 1078 y(use)j(a)h(full)f(generational)
g(collector)n(,)i(such)e(as)g(those)g(described)h(in)f([Ungar84])h(and)f([WM8\
9].)23 b(W)l(e)14 b(suspect,)75 1149 y(however)n(,)e(that)e(this)g(will)f(sti\
ll)h(be)h(inadequate)f(for)h(concurrent)g(applications)f(with)f(real-time)i
(responsiveness)75 1220 y(requirements.)k(What)9 b(is)f(really)g(needed)h(is)
f(a)h(way)g(to)f(interleave)g(small)g(amounts)f(of)h(garbage)i(collection)d
(work)75 1290 y(with)j(program)h(execution.)17 b(The)11 b fm(Pegasus)g fq(gar\
bage)h(collector)f(has)g(this)f(property)m(,)i(but)f(its)f(heap)h(architectur\
e)75 1361 y(involves)h(substantial)g(overhead)h(on)g(allocation)g(and)g(objec\
t)g(accesses)1243 1346 y fj([NR87])1345 1361 y fq(.)22 b(Another)13 b(approac\
h)h(is)e(to)h(use)75 1431 y(page-protection)h(tricks)478 1417 y fj([Shaw87)o
(,)8 b(AEL88])721 1431 y fq(,)16 b(but)e(these)g(techniques)g(may)g(be)g(too)
g(expensive)g(on)h(some)e(systems)75 1502 y(and)c(not)f(possible)f(on)i(other\
s.)16 b(W)l(e)9 b(are)h(exploring)e(these,)h(and)g(some)f(other)n(,)i(ways)f
(of)g(addressing)f(the)g(problem.)75 1647 y fd(6.2)50 b(Unimplemented)12 b
(signals)75 1769 y fq(The)19 b(current)f(implementation)f(does)h(not)g(suppor\
t)g(the)g(signals)f fn(SIGTSTP)22 b fq(and)c fn(SIGCONT)p fq(,)k(which)c(are)
75 1840 y(generated)f(as)f(a)g(result)g(of)g(suspending)f(and)h(resuming)f
(the)h(process.)32 b(Because)17 b(these)f(signals)f(cannot)h(be)75 1910 y(mas\
ked,)i(the)f(assumption)e(that)h fn(sig_handler)22 b fq(and)17 b fn(ghandle)i
fq(are)f(atomic)e(with)g(respect)i(to)e(signals)75 1981 y(doesn')o(t)11 b(hol\
d.)16 b(This)11 b(means)g(that)g(supporting)e(these)j(signals)e(will)g(requir\
e)i(some)f(cleverness.)75 2126 y fd(6.3)50 b(MACH)12 b(support)75 2248 y fq
(As)17 b(the)g(benchmarks)f(attest,)j(the)e(performance)h(under)f(MACH)g(leav\
es)g(something)e(to)i(be)g(desired.)34 b(The)75 2319 y(problem)14 b(is)g(that)
g(we)h(are)h(using)e(the)g(U)p fo(NIX)i fq(signal)e(mechanism,)h(which)f(is)g
(not)h(directly)f(supported)g(by)g(the)75 2389 y(MACH)i(kernel.)31 b(Providin\
g)15 b(an)h(implementation)d(based)j(directly)g(on)f(the)h(MACH)g(exception)g
(ports)f(will)75 2460 y(improve)c(performance)h(substantially)m(.)75 2501 y
720 2 v 115 2528 a ff(11)142 2544 y fl(About)f(2)g(ms.)20 b(of)12 b(CPU)f(tim\
e)h(per)g(kilobyte)f(of)g(live)h(data)f(on)g(a)g(Sun)f(SP)m(ARCstation.)19 b
(The)11 b(real-time)h(delays)e(are)i(often)f(much)75 2590 y(worse,)e(because)
d(of)k(paging.)952 2802 y fq(15)p eop
%%Page: 16 17
 bop 75 82 a fr(Acknowledgements)75 221 y fq(Bill)14 b(Aitken)f(made)h(the)g
(suggestion)f(that)g fm(SML)i fq(ought)e(to)h(have)g(a)h(signal)e(handling)g
(mechanism.)24 b(Andrew)75 291 y(Appel)11 b(helped)g(with)f(implementing)f
(the)i(heap)h(limit)d(checks,)j(and)f(discussions)f(with)g(Andrew)h(Appel,)h
(Dave)75 362 y(MacQueen)g(and)f(Norman)g(Ramsey)h(helped)f(in)g(cleaning)g
(up)g(the)g(interface.)952 2802 y(16)p eop
%%Page: 17 18
 bop 75 82 a fr(Refer)o(ences)75 203 y fq([AEL88])71 b(Appel,)16 b(A.W)l(.,)i
(J.R.)f(Ellis)d(and)h(K.)h(Li.)g(\252Real-time)g(concurrent)g(collection)e
(on)h(stock)g(multi-)311 260 y(processors,\272)10 b fp(Pr)n(oceedings)f(of)g
(the)h(SIGPLAN)g('88)g(Confer)n(ence)g(on)f(Pr)n(ogramming)f(Language)311 316
y(Design)j(and)f(Implementation,)h fq(June)g(1988,)g(pp.)h(11-20.)75 408 y
([Appel89a])28 b(Appel,)12 b(A.W)l(.)g(\252Simple)g(generational)g(garbage)g
(collection)f(and)h(fast)g(allocation,\272)g fp(Softwar)n(e)f(\261)311 465 y
(Practice)g(and)g(Experience)p fq(,)h(V)f(19,)h(Nr)m(.)g(2,)g(February)g(1989\
,)f(pp.)h(171-183.)75 557 y([Appel89b])25 b(Appel,)10 b(A.W)l(.)h(\252Allocat\
ion)e(without)g(locking,\272)h fp(Softwar)n(e)f(\261)h(Practice)g(and)g(Exper\
ience)p fq(,)h(V)f(19,)311 613 y(Nr)m(.)i(7,)g(July)e(1989,)i(pp.)f(703-705.)
75 705 y([Appel90])48 b(Appel,)21 b(A.W)l(.)f(\252A)f(runtime)f(system,\272)j
(to)d(appear)i(in)f(the)g fp(Journal)f(of)g(Lisp)h(and)g(Symbolic)311 762 y
(Computation)p fq(,)10 b(1990.)75 854 y([AJ89])109 b(Appel,)17 b(A.W)l(.)g
(and)g(T)m(.)f(Jim.)f(\252Continuation-passing,)h(closure-passing)g(style,\
\272)h fp(Confer)n(ence)311 910 y(Recor)n(d)8 b(of)g(the)g(16th)f(Annual)g
(ACM)i(Symposium)e(on)h(Principles)f(of)g(Pr)n(ogramming)g(Languages)p fq(,)
311 967 y(January)k(1989,)g(pp.)h(293-302.)75 1059 y([AM87])86 b(Appel,)16 b
(A.W)l(.)g(and)f(D.B.)i(MacQueen.)f(\252A)g(standard)f(ml)f(compiler)n(,\272)
j fp(Functional)d(Pr)n(ogram-)311 1115 y(ming)9 b(Languages)g(and)h(Computer)
f(Ar)n(chitectur)n(e)p fq(,)i(Lecture)f(Notes)f(in)h(Computer)f(Science)i(274\
,)311 1172 y(Springer)o(-V)-5 b(erlag,)12 b(September)g(1987,)f(pp.)h(301-324\
.)75 1264 y([DHM])99 b(Duba,)14 b(B.,)i(R.)e(Harper)h(and)f(D.B.)g(MacQueen.)
h(\252T)m(ype-checking)f(\256rst-class)f(continuations,\272)311 1320 y fp(in)
e(pr)n(eparation)p fq(.)75 1412 y([MTH90])58 b(Milner)n(,)17 b(R.,)i(M.)d(T)m
(ofte)f(and)i(R.)f(Harper)m(.)i fp(The)f(de\256nition)d(of)i(standar)n(d)f
(ml,)i fq(The)f(MIT)g(Press,)311 1469 y(Cambridge,)c(Mass.,)f(1990.)75 1561 y
([KKR+86])38 b(Kranz,)10 b(D.,)f(R.)g(Kelsey)m(,)g(J.)f(Rees,)i(P)-5 b(.)9 b
(Hudak,)g(J.)f(Philbin)f(and)h(N.)h(Adams.)f(\252Orbit:)14 b(an)8 b(optimizin\
g)311 1617 y(compiler)18 b(for)h(scheme,\272)j fp(Pr)n(oceedings)d(of)f(the)h
(SIGPLAN)h('86)f(Symposium)f(on)g(Compiler)311 1674 y(Construction)p fq(,)10 b
(July)h(1986,)g(pp.)g(219-233.)75 1766 y([LCJS87])59 b(Liskov)m(,)14 b(B.,)j
(D.)d(Curtis,)i(P)-5 b(.)15 b(Johnson)e(and)h(R.)h(Schei\257er)m(.)i(\252Impl\
ementation)c(of)h(Ar)o(gus,\272)i fp(Pr)n(o-)311 1822 y(ceedings)9 b(of)g(the)
h(Eleventh)f(ACM)h(Symposium)f(on)g(Operating)g(System)g(Principles)p fq(,)g
(November)311 1879 y(1987,)i(pp.)g(111-122.)75 1971 y([MK87])86 b(Moss,)16 b
(J.E.B.)g(and)g(W)l(.H.)g(Kohler)m(.)g(\252Concurrency)h(features)f(for)g(the)
f(trellis/owl)e(language,\272)311 2027 y fp(ECOOP'87)p fq(,)f(Lecture)g(Notes)
e(in)h(Computer)g(Science)i(276,)e(Springer)o(-V)-5 b(erlag,)13 b(pp.)e(171-1\
80.)75 2119 y([NR87])97 b(North,)22 b(S.C.)h(and)d(J.H.)h(Reppy)m(.)g(\252Con\
current)g(garbage)g(collection)f(on)g(stock)f(hardware,\272)311 2176 y fp(Fun\
ctional)d(Pr)n(ogramming)f(Languages)i(and)g(Computer)g(Ar)n(chitectur)n(e)p
fq(,)i(Lecture)f(Notes)e(in)311 2232 y(Computer)11 b(Science)h(274,)g(Springe\
r)o(-V)-5 b(erlag,)12 b(September)g(1987,)f(pp.)h(113-133.)75 2324 y([Ramsey9\
0])23 b(Ramsey)m(,)14 b(N.)f(\252Concurrent)h(programming)d(in)i(ml,\272)g fp
(T)l(echnical)g(Report)f(CS-TR-262-90)p fq(,)j(De-)311 2380 y(partment)c(of)g
(Computer)g(Science,)i(Princeton)e(University)m(,)g(April)g(1990.)75 2473 y
([Reppy89])41 b(Reppy)m(,)12 b(J.H.)f(\252First-class)g(synchronous)f(operati\
ons)g(in)h(standard)f(ml,\272)h fp(T)l(echnical)g(Report)g(TR)311 2529 y(89-1\
068)p fq(,)g(Computer)g(Science)h(Department,)g(Cornell)f(University)m(,)g
(December)h(1989.)75 2621 y([Reppy90])41 b(Reppy)m(,)15 b(J.H.)f(\252Asynchro\
nous)f(signals)g(in)h(standard)f(ml)g(\()p fm(SML/NJ)i fq(version)e(0.56\),\
\272)j fp(unpub-)311 2677 y(lished)10 b(draft)p fq(,)h(May)g(1990.)952 2802 y
(17)p eop
%%Page: 18 19
 bop 75 82 a fq([Shaw87])59 b(Shaw)m(,)11 b(R.A.)g(\252Improving)d(garbage)j
(collection)e(performance)h(in)f(virtual)g(memory)m(,\272)h fp(T)l(echnical)
311 139 y(Report)g(CSL-TR-87-323)p fq(,)j(Computer)e(Systems)g(Laboratory)m
(,)h(Stanford,)g(March)f(1987.)75 232 y([T)l(A90])103 b(T)m(olmach,)9 b(A.P)
-5 b(.)10 b(and)e(A.W)l(.)i(Appel.)f(\252Debugging)f(standard)h(ml)f(without)
f(reverse)j(engineering,\272)311 289 y fp(Pr)n(oceedings)f(of)g(the)h(1990)f
(ACM)h(Confer)n(ence)g(on)g(Lisp)f(and)g(Functional)f(Pr)n(ogramming)p fq(,)h
(June)311 345 y(1990,)i(pp.)g(1-12.)75 439 y([Ungar84])46 b(Ungar)n(,)13 b
(D.)g(\252Generation)g(scavenging:)18 b(a)13 b(non-disruptive)e(high)h(perfor\
mance)i(storage)e(recla-)311 496 y(mation)f(algorithm,\272)g fp(Pr)n(oceeding\
s)h(of)f(the)h(ACM)g(SIGSOFT/SIGPLAN)h(Softwar)n(e)e(Engineer)o(-)311 552 y
(ing)17 b(Symposium)f(on)h(Practical)g(Softwar)n(e)g(Development)h(Envir)n
(onments)p fq(,)g(April)f(1984,)i(pp.)311 609 y(157-167.)75 702 y([UNIX])92 b
fp(UNIX)9 b(pr)n(ogrammer)r(')-6 b(s)8 b(r)n(efer)n(ence)i(manual)p fq(,)f
(4.3)g(Berkeley)h(software)f(distribution,)f(April)g(1986.)75 796 y([W)l(and8\
0])55 b(W)l(and,)11 b(M.)g(\252Continuation-based)e(multiprocessing,\272)g fp
(Confer)n(ence)i(Recor)n(d)g(of)e(the)i(1980)e(Lisp)311 853 y(Confer)n(ence)p
fq(,)j(August)f(1980,)g(pp.)g(19-28.)75 946 y([WM89])76 b(W)n(ilson,)16 b(P)
-5 b(.R.)16 b(and)g(T)m(.G.)f(Moher)n(,)i(\252Design)e(of)g(the)g(opportunist\
ic)e(garbage)j(collector)n(,\272)h fp(Pr)n(o-)311 1003 y(ceedings)11 b(of)g
(OOPSLA)n('89)p fq(,)h(October)f(1989,)h(pp.)f(23-35.)952 2802 y(18)p eop
%%Trailer
 end
%%EOF
