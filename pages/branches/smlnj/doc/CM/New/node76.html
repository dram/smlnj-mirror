<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 3.2 Final//EN">

<!--Converted with LaTeX2HTML 99.1 release (March 30, 1999)
original version by:  Nikos Drakos, CBLU, University of Leeds
* revised and updated by:  Marcus Hennecke, Ross Moore, Herb Swan
* with significant contributions from:
  Jens Lippmann, Marek Rouchal, Martin Wilck and others -->
<HTML>
<HEAD>
<TITLE>12. Parallel and distributed compilation</TITLE>
<META NAME="description" CONTENT="12. Parallel and distributed compilation">
<META NAME="keywords" CONTENT="manual">
<META NAME="resource-type" CONTENT="document">
<META NAME="distribution" CONTENT="global">

<META HTTP-EQUIV="Content-Type" CONTENT="text/html; charset=iso-8859-1">
<META NAME="Generator" CONTENT="LaTeX2HTML v99.1 release">
<META HTTP-EQUIV="Content-Style-Type" CONTENT="text/css">

<LINK REL="STYLESHEET" HREF="manual.css">

<LINK REL="next" HREF="node79.html">
<LINK REL="previous" HREF="node64.html">
<LINK REL="up" HREF="manual.html">
<LINK REL="next" HREF="node77.html">
</HEAD>

<BODY >
<!--Navigation Panel-->
<A NAME="tex2html1218"
 HREF="node77.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html1214"
 HREF="manual.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html1208"
 HREF="node75.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A> 
<A NAME="tex2html1216"
 HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents_motif.gif"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html1219"
 HREF="node77.html">12.1 Pathname protocol encoding</A>
<B> Up:</B> <A NAME="tex2html1215"
 HREF="manual.html">CM The SML/NJ Compilation</A>
<B> Previous:</B> <A NAME="tex2html1209"
 HREF="node75.html">11.3.3 Locally declared suffixes</A>
 &nbsp <B>  <A NAME="tex2html1217"
 HREF="node1.html">Contents</A></B> 
<BR>
<BR>
<!--End of Navigation Panel-->

<H1><A NAME="SECTION000130000000000000000"></A>
<A NAME="sec:parmake"></A>
<BR>
12. Parallel and distributed compilation
</H1>

<P>
To speed up recompilation of large projects with many ML source files,
CM can exploit parallelism that is inherent in the dependency graph.
Currently, the only kind of operating system for which this is
implemented is Unix (<TT> OPSYS_UNIX</TT>), where separate processes are
used.  From there, one can distribute the work across a network of
machines by taking advantage of the network file system and the
``rsh'' facility.

<P>
To perform parallel compilations, one must attach <EM> compile
servers</EM> to the currently running CM session.  This is done using
function <TT> CM.Server.start</TT>, which has the following type:

<P>
 
<PRE>

  structure Server : sig
      type server
      val start : { name: string,
                    cmd: string * string list,
                    pathtrans: (string -&gt; string) option,
                    pref: int } -&gt; server option
  end
</PRE>

<P>
Here, <TT> name</TT> is an arbitrary string that is used by CM when
issuing diagnostic messages concerning the server<A NAME="tex2html12"
 HREF="footnode.html#foot4259"><SUP>12</SUP></A> and <TT> cmd</TT> is a value
suitable as argument to <TT> Unix.execute</TT>.

<P>
The program to be specified by <TT> cmd</TT> should be another instance of
CM--running in ``slave mode''.  To start CM in slave mode, start <TT> 
sml</TT> with a single command-line argument of <TT> @CMslave</TT>.  For
example, if you have installed in /path/to/smlnj/bin/sml, then a
server process on the local machine could be started by

<P>
 
<PRE>

  CM.Server.start { name = "A", pathtrans = NONE, pref = 0,
                    cmd = ("/path/to/smlnj/bin/sml",
                           ["@CMslave"]) };
</PRE>

<P>
To run a process on a remote machine, e.g., ``thatmachine'', as
compute server, one can use ``rsh''.<A NAME="tex2html13"
 HREF="footnode.html#foot4260"><SUP>13</SUP></A>  Unfortunately, at the moment it
is necessary to specify the full path to ``rsh'' because <TT> 
Unix.execute</TT> (and therefore <TT> CM.Server.start</TT>) does not perform
a <TT> PATH</TT> search. The remote machine
must share the file system with the local machine, for example via NFS.

<P>
 
<PRE>

  CM.Server.start { name = "thatmachine",
                    pathtrans = NONE, pref = 0,
                    cmd = ("/usr/ucb/rsh",
                           ["thatmachine",
                            "/path/to/smlnj/bin/sml",
                            "@CMslave"]) };
</PRE>

<P>
You can start as many servers as you want, but they all must have
different names.  If you attach any servers at all, then you should
attach at least two (unless you want to attach one that runs on a
machine vastly more powerful than your local one).  Local servers make
sense on multi-CPU machines: start as many servers as there are CPUs.
Parallel make is most effective on multiprocessor machines because
network latencies can have a severely limiting effect on what can be
gained in the distributed case.
(Be careful, though.  Since there is no memory-sharing to speak of
between separate instances of <TT> sml</TT>, you should be sure to check
that your machine has enough main memory.)

<P>
If servers on machines of different power are attached, one can give
some preference to faster ones by setting the <TT> pref</TT> value higher.
(But since the <TT> pref</TT> value is consulted only in the rare case
that more than one server is idle, this will rarely lead to vastly
better throughput.) All attached servers must use the same
architecture-OS combination as the controlling machine.

<P>
In parallel mode, the master process itself normally does not compile
anything.  Therefore, if you want to utilize the master's CPU for
compilation, you should start a compile server on the same machine
that the master runs on (even if it is a uniprocessor machine).

<P>
The <TT> pathtrans</TT> argument is used when connecting to a machine with
a different file-system layout.  For local servers, it can safely be
left at <TT> NONE</TT>.  The ``path transformation'' function is used to
translate local path names to their remote counterparts.  This can be
a bit tricky to get right, especially if the machines use automounters
or similar devices.  The <TT> pathtrans</TT> functions consumes and
produces names in CM's internal ``protocol encoding'' (see
Section&nbsp;<A HREF="node77.html#sec:pathencode">12.1</A>).

<P>
Once servers have been attached, one can invoke functions like
<TT> CM.recomp</TT>, <TT> CM.make</TT>, and <TT> CM.stabilize</TT>.  They should
work the way the always do, but during compilation they will take
advantage of parallelism.

<P>
When CM is interrupted using Control-C (or such), one will sometimes
experience a certain delay if servers are currently attached and busy.
This is because the interrupt-handling code will wait for the servers
to finish what they are currently doing and bring them back to an
``idle'' state first.

<P>
<BR><HR>
<!--Table of Child-Links-->
<A NAME="CHILD_LINKS"><STRONG>Subsections</STRONG></A>

<UL>
<LI><A NAME="tex2html1220"
 HREF="node77.html">12.1 Pathname protocol encoding</A>
<LI><A NAME="tex2html1221"
 HREF="node78.html">12.2 Parallel bootstrap compilation</A>
</UL>
<!--End of Table of Child-Links-->
<HR>
<!--Navigation Panel-->
<A NAME="tex2html1218"
 HREF="node77.html">
<IMG WIDTH="37" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="next" SRC="next_motif.gif"></A> 
<A NAME="tex2html1214"
 HREF="manual.html">
<IMG WIDTH="26" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="up" SRC="up_motif.gif"></A> 
<A NAME="tex2html1208"
 HREF="node75.html">
<IMG WIDTH="63" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="previous" SRC="previous_motif.gif"></A> 
<A NAME="tex2html1216"
 HREF="node1.html">
<IMG WIDTH="65" HEIGHT="24" ALIGN="BOTTOM" BORDER="0" ALT="contents" SRC="contents_motif.gif"></A>  
<BR>
<B> Next:</B> <A NAME="tex2html1219"
 HREF="node77.html">12.1 Pathname protocol encoding</A>
<B> Up:</B> <A NAME="tex2html1215"
 HREF="manual.html">CM The SML/NJ Compilation</A>
<B> Previous:</B> <A NAME="tex2html1209"
 HREF="node75.html">11.3.3 Locally declared suffixes</A>
 &nbsp <B>  <A NAME="tex2html1217"
 HREF="node1.html">Contents</A></B> 
<!--End of Navigation Panel-->
<ADDRESS>
<I>Matthias Blume</I>
<BR><I>2001-07-19</I>
</ADDRESS>
</BODY>
</HTML>
