<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta name="generator" content="AsciiDoc 8.6.9">
<title>Standard ML of New Jersey Change Log</title>
<style type="text/css">
/* Shared CSS for AsciiDoc xhtml11 and html5 backends */

/* Default font. */
body {
  font-family: Georgia,serif;
}

/* Title font. */
h1, h2, h3, h4, h5, h6,
div.title, caption.title,
thead, p.table.header,
#toctitle,
#author, #revnumber, #revdate, #revremark,
#footer {
  font-family: Arial,Helvetica,sans-serif;
}

body {
  margin: 1em 5% 1em 5%;
}

a {
  color: blue;
  text-decoration: underline;
}
a:visited {
  color: fuchsia;
}

em {
  font-style: italic;
  color: navy;
}

strong {
  font-weight: bold;
  color: #083194;
}

h1, h2, h3, h4, h5, h6 {
  color: #527bbd;
  margin-top: 1.2em;
  margin-bottom: 0.5em;
  line-height: 1.3;
}

h1, h2, h3 {
  border-bottom: 2px solid silver;
}
h2 {
  padding-top: 0.5em;
}
h3 {
  float: left;
}
h3 + * {
  clear: left;
}
h5 {
  font-size: 1.0em;
}

div.sectionbody {
  margin-left: 0;
}

hr {
  border: 1px solid silver;
}

p {
  margin-top: 0.5em;
  margin-bottom: 0.5em;
}

ul, ol, li > p {
  margin-top: 0;
}
ul > li     { color: #aaa; }
ul > li > * { color: black; }

.monospaced, code, pre {
  font-family: "Courier New", Courier, monospace;
  font-size: inherit;
  color: navy;
  padding: 0;
  margin: 0;
}
pre {
  white-space: pre-wrap;
}

#author {
  color: #527bbd;
  font-weight: bold;
  font-size: 1.1em;
}
#email {
}
#revnumber, #revdate, #revremark {
}

#footer {
  font-size: small;
  border-top: 2px solid silver;
  padding-top: 0.5em;
  margin-top: 4.0em;
}
#footer-text {
  float: left;
  padding-bottom: 0.5em;
}
#footer-badges {
  float: right;
  padding-bottom: 0.5em;
}

#preamble {
  margin-top: 1.5em;
  margin-bottom: 1.5em;
}
div.imageblock, div.exampleblock, div.verseblock,
div.quoteblock, div.literalblock, div.listingblock, div.sidebarblock,
div.admonitionblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.admonitionblock {
  margin-top: 2.0em;
  margin-bottom: 2.0em;
  margin-right: 10%;
  color: #606060;
}

div.content { /* Block element content. */
  padding: 0;
}

/* Block element titles. */
div.title, caption.title {
  color: #527bbd;
  font-weight: bold;
  text-align: left;
  margin-top: 1.0em;
  margin-bottom: 0.5em;
}
div.title + * {
  margin-top: 0;
}

td div.title:first-child {
  margin-top: 0.0em;
}
div.content div.title:first-child {
  margin-top: 0.0em;
}
div.content + div.title {
  margin-top: 0.0em;
}

div.sidebarblock > div.content {
  background: #ffffee;
  border: 1px solid #dddddd;
  border-left: 4px solid #f0f0f0;
  padding: 0.5em;
}

div.listingblock > div.content {
  border: 1px solid #dddddd;
  border-left: 5px solid #f0f0f0;
  background: #f8f8f8;
  padding: 0.5em;
}

div.quoteblock, div.verseblock {
  padding-left: 1.0em;
  margin-left: 1.0em;
  margin-right: 10%;
  border-left: 5px solid #f0f0f0;
  color: #888;
}

div.quoteblock > div.attribution {
  padding-top: 0.5em;
  text-align: right;
}

div.verseblock > pre.content {
  font-family: inherit;
  font-size: inherit;
}
div.verseblock > div.attribution {
  padding-top: 0.75em;
  text-align: left;
}
/* DEPRECATED: Pre version 8.2.7 verse style literal block. */
div.verseblock + div.attribution {
  text-align: left;
}

div.admonitionblock .icon {
  vertical-align: top;
  font-size: 1.1em;
  font-weight: bold;
  text-decoration: underline;
  color: #527bbd;
  padding-right: 0.5em;
}
div.admonitionblock td.content {
  padding-left: 0.5em;
  border-left: 3px solid #dddddd;
}

div.exampleblock > div.content {
  border-left: 3px solid #dddddd;
  padding-left: 0.5em;
}

div.imageblock div.content { padding-left: 0; }
span.image img { border-style: none; vertical-align: text-bottom; }
a.image:visited { color: white; }

dl {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
dt {
  margin-top: 0.5em;
  margin-bottom: 0;
  font-style: normal;
  color: navy;
}
dd > *:first-child {
  margin-top: 0.1em;
}

ul, ol {
    list-style-position: outside;
}
ol.arabic {
  list-style-type: decimal;
}
ol.loweralpha {
  list-style-type: lower-alpha;
}
ol.upperalpha {
  list-style-type: upper-alpha;
}
ol.lowerroman {
  list-style-type: lower-roman;
}
ol.upperroman {
  list-style-type: upper-roman;
}

div.compact ul, div.compact ol,
div.compact p, div.compact p,
div.compact div, div.compact div {
  margin-top: 0.1em;
  margin-bottom: 0.1em;
}

tfoot {
  font-weight: bold;
}
td > div.verse {
  white-space: pre;
}

div.hdlist {
  margin-top: 0.8em;
  margin-bottom: 0.8em;
}
div.hdlist tr {
  padding-bottom: 15px;
}
dt.hdlist1.strong, td.hdlist1.strong {
  font-weight: bold;
}
td.hdlist1 {
  vertical-align: top;
  font-style: normal;
  padding-right: 0.8em;
  color: navy;
}
td.hdlist2 {
  vertical-align: top;
}
div.hdlist.compact tr {
  margin: 0;
  padding-bottom: 0;
}

.comment {
  background: yellow;
}

.footnote, .footnoteref {
  font-size: 0.8em;
}

span.footnote, span.footnoteref {
  vertical-align: super;
}

#footnotes {
  margin: 20px 0 20px 0;
  padding: 7px 0 0 0;
}

#footnotes div.footnote {
  margin: 0 0 5px 0;
}

#footnotes hr {
  border: none;
  border-top: 1px solid silver;
  height: 1px;
  text-align: left;
  margin-left: 0;
  width: 20%;
  min-width: 100px;
}

div.colist td {
  padding-right: 0.5em;
  padding-bottom: 0.3em;
  vertical-align: top;
}
div.colist td img {
  margin-top: 0.3em;
}

@media print {
  #footer-badges { display: none; }
}

#toc {
  margin-bottom: 2.5em;
}

#toctitle {
  color: #527bbd;
  font-size: 1.1em;
  font-weight: bold;
  margin-top: 1.0em;
  margin-bottom: 0.1em;
}

div.toclevel0, div.toclevel1, div.toclevel2, div.toclevel3, div.toclevel4 {
  margin-top: 0;
  margin-bottom: 0;
}
div.toclevel2 {
  margin-left: 2em;
  font-size: 0.9em;
}
div.toclevel3 {
  margin-left: 4em;
  font-size: 0.9em;
}
div.toclevel4 {
  margin-left: 6em;
  font-size: 0.9em;
}

span.aqua { color: aqua; }
span.black { color: black; }
span.blue { color: blue; }
span.fuchsia { color: fuchsia; }
span.gray { color: gray; }
span.green { color: green; }
span.lime { color: lime; }
span.maroon { color: maroon; }
span.navy { color: navy; }
span.olive { color: olive; }
span.purple { color: purple; }
span.red { color: red; }
span.silver { color: silver; }
span.teal { color: teal; }
span.white { color: white; }
span.yellow { color: yellow; }

span.aqua-background { background: aqua; }
span.black-background { background: black; }
span.blue-background { background: blue; }
span.fuchsia-background { background: fuchsia; }
span.gray-background { background: gray; }
span.green-background { background: green; }
span.lime-background { background: lime; }
span.maroon-background { background: maroon; }
span.navy-background { background: navy; }
span.olive-background { background: olive; }
span.purple-background { background: purple; }
span.red-background { background: red; }
span.silver-background { background: silver; }
span.teal-background { background: teal; }
span.white-background { background: white; }
span.yellow-background { background: yellow; }

span.big { font-size: 2em; }
span.small { font-size: 0.6em; }

span.underline { text-decoration: underline; }
span.overline { text-decoration: overline; }
span.line-through { text-decoration: line-through; }

div.unbreakable { page-break-inside: avoid; }


/*
 * xhtml11 specific
 *
 * */

div.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
div.tableblock > table {
  border: 3px solid #527bbd;
}
thead, p.table.header {
  font-weight: bold;
  color: #527bbd;
}
p.table {
  margin-top: 0;
}
/* Because the table frame attribute is overriden by CSS in most browsers. */
div.tableblock > table[frame="void"] {
  border-style: none;
}
div.tableblock > table[frame="hsides"] {
  border-left-style: none;
  border-right-style: none;
}
div.tableblock > table[frame="vsides"] {
  border-top-style: none;
  border-bottom-style: none;
}


/*
 * html5 specific
 *
 * */

table.tableblock {
  margin-top: 1.0em;
  margin-bottom: 1.5em;
}
thead, p.tableblock.header {
  font-weight: bold;
  color: #527bbd;
}
p.tableblock {
  margin-top: 0;
}
table.tableblock {
  border-width: 3px;
  border-spacing: 0px;
  border-style: solid;
  border-color: #527bbd;
  border-collapse: collapse;
}
th.tableblock, td.tableblock {
  border-width: 1px;
  padding: 4px;
  border-style: solid;
  border-color: #527bbd;
}

table.tableblock.frame-topbot {
  border-left-style: hidden;
  border-right-style: hidden;
}
table.tableblock.frame-sides {
  border-top-style: hidden;
  border-bottom-style: hidden;
}
table.tableblock.frame-none {
  border-style: hidden;
}

th.tableblock.halign-left, td.tableblock.halign-left {
  text-align: left;
}
th.tableblock.halign-center, td.tableblock.halign-center {
  text-align: center;
}
th.tableblock.halign-right, td.tableblock.halign-right {
  text-align: right;
}

th.tableblock.valign-top, td.tableblock.valign-top {
  vertical-align: top;
}
th.tableblock.valign-middle, td.tableblock.valign-middle {
  vertical-align: middle;
}
th.tableblock.valign-bottom, td.tableblock.valign-bottom {
  vertical-align: bottom;
}


/*
 * manpage specific
 *
 * */

body.manpage h1 {
  padding-top: 0.5em;
  padding-bottom: 0.5em;
  border-top: 2px solid silver;
  border-bottom: 2px solid silver;
}
body.manpage h2 {
  border-style: none;
}
body.manpage div.sectionbody {
  margin-left: 3em;
}

@media print {
  body.manpage div#toc { display: none; }
}
.highlight .hll { background-color: #ffffcc }
.highlight  { background: #f8f8f8; }
.highlight .c { color: #408080; font-style: italic } /* Comment */
.highlight .err { border: 1px solid #FF0000 } /* Error */
.highlight .k { color: #008000; font-weight: bold } /* Keyword */
.highlight .o { color: #666666 } /* Operator */
.highlight .cm { color: #408080; font-style: italic } /* Comment.Multiline */
.highlight .cp { color: #BC7A00 } /* Comment.Preproc */
.highlight .c1 { color: #408080; font-style: italic } /* Comment.Single */
.highlight .cs { color: #408080; font-style: italic } /* Comment.Special */
.highlight .gd { color: #A00000 } /* Generic.Deleted */
.highlight .ge { font-style: italic } /* Generic.Emph */
.highlight .gr { color: #FF0000 } /* Generic.Error */
.highlight .gh { color: #000080; font-weight: bold } /* Generic.Heading */
.highlight .gi { color: #00A000 } /* Generic.Inserted */
.highlight .go { color: #808080 } /* Generic.Output */
.highlight .gp { color: #000080; font-weight: bold } /* Generic.Prompt */
.highlight .gs { font-weight: bold } /* Generic.Strong */
.highlight .gu { color: #800080; font-weight: bold } /* Generic.Subheading */
.highlight .gt { color: #0040D0 } /* Generic.Traceback */
.highlight .kc { color: #008000; font-weight: bold } /* Keyword.Constant */
.highlight .kd { color: #008000; font-weight: bold } /* Keyword.Declaration */
.highlight .kn { color: #008000; font-weight: bold } /* Keyword.Namespace */
.highlight .kp { color: #008000 } /* Keyword.Pseudo */
.highlight .kr { color: #008000; font-weight: bold } /* Keyword.Reserved */
.highlight .kt { color: #B00040 } /* Keyword.Type */
.highlight .m { color: #666666 } /* Literal.Number */
.highlight .s { color: #BA2121 } /* Literal.String */
.highlight .na { color: #7D9029 } /* Name.Attribute */
.highlight .nb { color: #008000 } /* Name.Builtin */
.highlight .nc { color: #0000FF; font-weight: bold } /* Name.Class */
.highlight .no { color: #880000 } /* Name.Constant */
.highlight .nd { color: #AA22FF } /* Name.Decorator */
.highlight .ni { color: #999999; font-weight: bold } /* Name.Entity */
.highlight .ne { color: #D2413A; font-weight: bold } /* Name.Exception */
.highlight .nf { color: #0000FF } /* Name.Function */
.highlight .nl { color: #A0A000 } /* Name.Label */
.highlight .nn { color: #0000FF; font-weight: bold } /* Name.Namespace */
.highlight .nt { color: #008000; font-weight: bold } /* Name.Tag */
.highlight .nv { color: #19177C } /* Name.Variable */
.highlight .ow { color: #AA22FF; font-weight: bold } /* Operator.Word */
.highlight .w { color: #bbbbbb } /* Text.Whitespace */
.highlight .mf { color: #666666 } /* Literal.Number.Float */
.highlight .mh { color: #666666 } /* Literal.Number.Hex */
.highlight .mi { color: #666666 } /* Literal.Number.Integer */
.highlight .mo { color: #666666 } /* Literal.Number.Oct */
.highlight .sb { color: #BA2121 } /* Literal.String.Backtick */
.highlight .sc { color: #BA2121 } /* Literal.String.Char */
.highlight .sd { color: #BA2121; font-style: italic } /* Literal.String.Doc */
.highlight .s2 { color: #BA2121 } /* Literal.String.Double */
.highlight .se { color: #BB6622; font-weight: bold } /* Literal.String.Escape */
.highlight .sh { color: #BA2121 } /* Literal.String.Heredoc */
.highlight .si { color: #BB6688; font-weight: bold } /* Literal.String.Interpol */
.highlight .sx { color: #008000 } /* Literal.String.Other */
.highlight .sr { color: #BB6688 } /* Literal.String.Regex */
.highlight .s1 { color: #BA2121 } /* Literal.String.Single */
.highlight .ss { color: #19177C } /* Literal.String.Symbol */
.highlight .bp { color: #008000 } /* Name.Builtin.Pseudo */
.highlight .vc { color: #19177C } /* Name.Variable.Class */
.highlight .vg { color: #19177C } /* Name.Variable.Global */
.highlight .vi { color: #19177C } /* Name.Variable.Instance */
.highlight .il { color: #666666 } /* Literal.Number.Integer.Long */


</style>
<script type="text/javascript">
/*<![CDATA[*/
var asciidoc = {  // Namespace.

/////////////////////////////////////////////////////////////////////
// Table Of Contents generator
/////////////////////////////////////////////////////////////////////

/* Author: Mihai Bazon, September 2002
 * http://students.infoiasi.ro/~mishoo
 *
 * Table Of Content generator
 * Version: 0.4
 *
 * Feel free to use this script under the terms of the GNU General Public
 * License, as long as you do not remove or alter this notice.
 */

 /* modified by Troy D. Hanson, September 2006. License: GPL */
 /* modified by Stuart Rackham, 2006, 2009. License: GPL */

// toclevels = 1..4.
toc: function (toclevels) {

  function getText(el) {
    var text = "";
    for (var i = el.firstChild; i != null; i = i.nextSibling) {
      if (i.nodeType == 3 /* Node.TEXT_NODE */) // IE doesn't speak constants.
        text += i.data;
      else if (i.firstChild != null)
        text += getText(i);
    }
    return text;
  }

  function TocEntry(el, text, toclevel) {
    this.element = el;
    this.text = text;
    this.toclevel = toclevel;
  }

  function tocEntries(el, toclevels) {
    var result = new Array;
    var re = new RegExp('[hH]([1-'+(toclevels+1)+'])');
    // Function that scans the DOM tree for header elements (the DOM2
    // nodeIterator API would be a better technique but not supported by all
    // browsers).
    var iterate = function (el) {
      for (var i = el.firstChild; i != null; i = i.nextSibling) {
        if (i.nodeType == 1 /* Node.ELEMENT_NODE */) {
          var mo = re.exec(i.tagName);
          if (mo && (i.getAttribute("class") || i.getAttribute("className")) != "float") {
            result[result.length] = new TocEntry(i, getText(i), mo[1]-1);
          }
          iterate(i);
        }
      }
    }
    iterate(el);
    return result;
  }

  var toc = document.getElementById("toc");
  if (!toc) {
    return;
  }

  // Delete existing TOC entries in case we're reloading the TOC.
  var tocEntriesToRemove = [];
  var i;
  for (i = 0; i < toc.childNodes.length; i++) {
    var entry = toc.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div'
     && entry.getAttribute("class")
     && entry.getAttribute("class").match(/^toclevel/))
      tocEntriesToRemove.push(entry);
  }
  for (i = 0; i < tocEntriesToRemove.length; i++) {
    toc.removeChild(tocEntriesToRemove[i]);
  }

  // Rebuild TOC entries.
  var entries = tocEntries(document.getElementById("content"), toclevels);
  for (var i = 0; i < entries.length; ++i) {
    var entry = entries[i];
    if (entry.element.id == "")
      entry.element.id = "_toc_" + i;
    var a = document.createElement("a");
    a.href = "#" + entry.element.id;
    a.appendChild(document.createTextNode(entry.text));
    var div = document.createElement("div");
    div.appendChild(a);
    div.className = "toclevel" + entry.toclevel;
    toc.appendChild(div);
  }
  if (entries.length == 0)
    toc.parentNode.removeChild(toc);
},


/////////////////////////////////////////////////////////////////////
// Footnotes generator
/////////////////////////////////////////////////////////////////////

/* Based on footnote generation code from:
 * http://www.brandspankingnew.net/archive/2005/07/format_footnote.html
 */

footnotes: function () {
  // Delete existing footnote entries in case we're reloading the footnodes.
  var i;
  var noteholder = document.getElementById("footnotes");
  if (!noteholder) {
    return;
  }
  var entriesToRemove = [];
  for (i = 0; i < noteholder.childNodes.length; i++) {
    var entry = noteholder.childNodes[i];
    if (entry.nodeName.toLowerCase() == 'div' && entry.getAttribute("class") == "footnote")
      entriesToRemove.push(entry);
  }
  for (i = 0; i < entriesToRemove.length; i++) {
    noteholder.removeChild(entriesToRemove[i]);
  }

  // Rebuild footnote entries.
  var cont = document.getElementById("content");
  var spans = cont.getElementsByTagName("span");
  var refs = {};
  var n = 0;
  for (i=0; i<spans.length; i++) {
    if (spans[i].className == "footnote") {
      n++;
      var note = spans[i].getAttribute("data-note");
      if (!note) {
        // Use [\s\S] in place of . so multi-line matches work.
        // Because JavaScript has no s (dotall) regex flag.
        note = spans[i].innerHTML.match(/\s*\[([\s\S]*)]\s*/)[1];
        spans[i].innerHTML =
          "[<a id='_footnoteref_" + n + "' href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
        spans[i].setAttribute("data-note", note);
      }
      noteholder.innerHTML +=
        "<div class='footnote' id='_footnote_" + n + "'>" +
        "<a href='#_footnoteref_" + n + "' title='Return to text'>" +
        n + "</a>. " + note + "</div>";
      var id =spans[i].getAttribute("id");
      if (id != null) refs["#"+id] = n;
    }
  }
  if (n == 0)
    noteholder.parentNode.removeChild(noteholder);
  else {
    // Process footnoterefs.
    for (i=0; i<spans.length; i++) {
      if (spans[i].className == "footnoteref") {
        var href = spans[i].getElementsByTagName("a")[0].getAttribute("href");
        href = href.match(/#.*/)[0];  // Because IE return full URL.
        n = refs[href];
        spans[i].innerHTML =
          "[<a href='#_footnote_" + n +
          "' title='View footnote' class='footnote'>" + n + "</a>]";
      }
    }
  }
},

install: function(toclevels) {
  var timerId;

  function reinstall() {
    asciidoc.footnotes();
    if (toclevels) {
      asciidoc.toc(toclevels);
    }
  }

  function reinstallAndRemoveTimer() {
    clearInterval(timerId);
    reinstall();
  }

  timerId = setInterval(reinstall, 500);
  if (document.addEventListener)
    document.addEventListener("DOMContentLoaded", reinstallAndRemoveTimer, false);
  else
    window.onload = reinstallAndRemoveTimer;
}

}
asciidoc.install();
/*]]>*/
</script>
</head>
<body class="article">
<div id="header">
<h1>Standard ML of New Jersey Change Log</h1>
<span id="author">The Fellowship of SML/NJ</span><br>
<span id="revnumber">version 110.80,</span>
<span id="revdate">August 18, 2016</span>
<br><span id="revremark"></span>
</div>
<div id="content">
<div id="preamble">
<div class="sectionbody">
<div class="paragraph"><p>This file documents changes to the Standard ML of New Jersey system since
March of 2000 (around Version 110.26).  The change log  primarily covers
the compiler, the compilation manager (<strong>CM</strong>), the <strong>MLRISC</strong> library, and
the runtime system.  There are occasional entries about other components
(<em>e.g.</em>, the <strong>SML/NJ Library</strong> and <strong>ML-LPT</strong>), but these components have
their own change logs that should be consulted.</p></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_80_2016_08_19">Version 110.80; 2016/08/19</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2016/08/16]
</dt>
<dd>
<div class="paragraph"><p>Fixed <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=151&group_id=33&atid=215"><b>#151</b></a> (Error installing from source on Mac OS X).  The fix
involves both changes to the <span class="monospaced">config/install.sh</span> script and the
<span class="monospaced">mk.x86-darwin</span> makefile.  With this fix, we include the <span class="monospaced">SDK</span> argument
to the <span class="monospaced">/usr/bin/as</span> only when the OS version is 10.10 (Yosemite) or
later.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2016/08/10]
</dt>
<dd>
<div class="paragraph"><p>Added the proposed <span class="monospaced">unzipMap</span>, <span class="monospaced">unzipMapi</span>, <span class="monospaced">find</span>, and <span class="monospaced">findi</span> functions
to the <span class="monospaced">ListPair</span> module.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2016/08/10]
</dt>
<dd>
<div class="paragraph"><p>Added the proposed <span class="monospaced">mapLeft</span>, <span class="monospaced">mapRight</span>, <span class="monospaced">appLeft</span>, and <span class="monospaced">appRight</span>
functions to the <span class="monospaced">Either</span> module.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2016/08/09]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=145&group_id=33&atid=215"><b>#145</b></a> (Internal exception occurs on bogus annotation
instead of typechecking diagnostic). Added missing <span class="monospaced">OVLD_UB</span> case in
function <span class="monospaced">failMessage</span> in <span class="monospaced">compiler/Elaborator/types/unify.sml</span>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~dbm">Dave MacQueen</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2016/08/04]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=166&group_id=33&atid=215"><b>#166</b></a> (Can&#8217;t install SML/NJ in directories containing
spaces).  Thanks to Eugene Sharygin for the patch.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2016/06/21]
</dt>
<dd>
<div class="paragraph"><p>Fixed incorrect dividend sign extension before 32-bit divide in amd64
code generator in MLRISC</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://gallium.inria.fr/~rainey/">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2016/06/16]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=150&group_id=33&atid=215"><b>#150</b></a> (Add title to batch script).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2016/05/11]
</dt>
<dd>
<div class="paragraph"><p>Implemented the changes for
<a href="https://github.com/SMLFamily/BasisLibrary/wiki/2016-001-Add-popCount-to-WORD-signature">
Basis Library Proposal 2016-001</a>.  This proposal added the <span class="monospaced">popCount</span>
function to the <span class="monospaced">WORD</span> signature.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2016/05/03]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=156&group_id=33&atid=215"><b>#156</b></a> (sml resumes after SIGSTOP with bogus exception
report).  The fix is a bit of a hack: I modified the <span class="monospaced">non_bt_hdl</span>
function in <span class="monospaced">evalloop.sml</span> to match an <span class="monospaced">IO.Io</span> exception with
the appropriate shape for this situation.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2016/04/07]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=154&group_id=33&atid=215"><b>#154</b></a> (Return code for ml-ulex when there is an error).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2016/04/07]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=155&group_id=33&atid=215"><b>#155</b></a> (Misleading printing of word literals in
error messages).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2016/04/02]
</dt>
<dd>
<div class="paragraph"><p>Fixed a bug in the implementation of the <span class="monospaced">--ml-lex-mode</span> flag for
<strong>ml-ulex</strong>.  The <span class="monospaced">\h</span> escape sequence is supposed to map to the
character range <span class="monospaced">[\128-\255]</span>, but did not.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2015/11/09]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=147&group_id=33&atid=215"><b>#147</b></a> (Hexadecimal escapes in strings are not supported).
We previously did not support Unicode escapes in string literals.  We now
do so, <span class="line-through">with non-ascii codepoints being mapped to the
UTF-8 encoding</span> with escape values in the range 0..255 being mapped to the
corresponding 8-bit character.  Values outside that range are flagged
as an error.</p></div>
<div class="paragraph"><p><em>Revised August 4, 2016</em></p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2015/10/28]
</dt>
<dd>
<div class="paragraph"><p>Partial fix for the noisy exception-stack traces on the <span class="monospaced">Error</span> exception.
The cases that are handled by this change are applying <span class="monospaced">use</span> to a non-existent
file and when there are compilation errors in a program being built by
<span class="monospaced">CM.make</span>.  What remains to be handled is the situation where <span class="monospaced">CM.make</span> is
applied to a non-existent file.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_79_2015_10_04">Version 110.79; 2015/10/04</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2015/10/04]
</dt>
<dd>
<div class="paragraph"><p>Patched <span class="monospaced">base/compiler/FLINT/clos/closure.sml</span> so that <strong>Twelf</strong> will
build again.  Fixes bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=140&group_id=33&atid=215"><b>#140</b></a> (Lookup failure in <span class="monospaced">closure.sml</span>
when compiling <strong>Twelf</strong>).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2015/09/28]
</dt>
<dd>
<div class="paragraph"><p>Added support for a <strong>Successor ML</strong> tool to CM.  This tool allows one
to specify that a source file <span class="monospaced">fool.sml</span> is <strong>Successor ML</strong> source code in the
following ways:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>foo.sml : succ-ml
foo.sml : sml (succ-ml)
foo.sml (succ-ml)</pre>
</div></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2015/09/28]
</dt>
<dd>
<div class="paragraph"><p>Added the directory <span class="monospaced">base/old-basis</span> to support backward-compatible
views of the <strong>Basis Library</strong>.  You can use these by replacing the
line</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>$/basis.cm</pre>
</div></div>
<div class="paragraph"><p>with</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>$/basis-2004.cm</pre>
</div></div>
<div class="paragraph"><p>in your CM files.</p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2015/09/28]
</dt>
<dd>
<div class="paragraph"><p>New implementation of <span class="monospaced">Date</span> structure in the Basis, which fixes bugs
<a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=138&group_id=33&atid=215"><b>#138</b></a> (Incorrect behavior for <span class="monospaced">Date.fromTimeLocal</span>) and
<a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=139&group_id=33&atid=215"><b>#139</b></a> (<span class="monospaced">Date.date</span> is broken).  Note that some more thought should
be given to the correct semantics of <span class="monospaced">Date.date</span> when dealing with
offsets.  For example, should an offset of +23 hours produce the same
date as an offset of -1 hours?  Currently our implementation produces
different results (by a day) for these two situations.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2015/09/25]
</dt>
<dd>
<div class="paragraph"><p>Implemented the changes for
<a href="https://github.com/SMLFamily/BasisLibrary/wiki/2015-003-Additional-operations-on-sequences">
Basis Library Proposal 2015-003</a>.  This proposal added operations to
the following signatures:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kr">signature</span> <span class="nn">ARRAY</span>
<span class="kr">signature</span> <span class="nn">LIST</span>
<span class="kr">signature</span> <span class="nn">LIST_PAIR</span>
<span class="kr">signature</span> <span class="nn">MONO_ARRAY</span>
<span class="kr">signature</span> <span class="nn">MONO_VECTOR</span>
<span class="kr">signature</span> <span class="nn">OPTION</span>
<span class="kr">signature</span> <span class="nn">STRING</span>
<span class="kr">signature</span> <span class="nn">TEXT</span>
<span class="kr">signature</span> <span class="nn">VECTOR</span>
</pre></div></div></div>
<div class="paragraph"><p>and the following structures:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kr">structure</span> <span class="nn">Array</span> <span class="p">:</span> <span class="n">ARRAY</span>
<span class="kr">structure</span> <span class="nn">CharArray</span> <span class="p">:</span> <span class="n">MONO_ARRAY</span>
<span class="kr">structure</span> <span class="nn">CharVector</span> <span class="p">:</span> <span class="n">MONO_VECTOR</span>
<span class="kr">structure</span> <span class="nn">List</span> <span class="p">:</span> <span class="n">LIST</span>
<span class="kr">structure</span> <span class="nn">ListPair</span> <span class="p">:</span> <span class="n">LIST_PAIR</span>
<span class="kr">structure</span> <span class="nn">Option</span> <span class="p">:</span> <span class="n">OPTION</span>
<span class="kr">structure</span> <span class="nn">Real64Array</span> <span class="p">:</span> <span class="n">MONO_ARRAY</span>
<span class="kr">structure</span> <span class="nn">Real64Vector</span> <span class="p">:</span> <span class="n">MONO_VECTOR</span>
<span class="kr">structure</span> <span class="nn">String</span> <span class="p">:</span> <span class="n">STRING</span>
<span class="kr">structure</span> <span class="nn">Text</span> <span class="p">:</span> <span class="n">TEXT</span>
<span class="kr">structure</span> <span class="nn">Vector</span> <span class="p">:</span> <span class="n">VECTOR</span>
<span class="kr">structure</span> <span class="nn">Word8Array</span> <span class="p">:</span> <span class="n">MONO_ARRAY</span>
<span class="kr">structure</span> <span class="nn">Word8Vector</span> <span class="p">:</span> <span class="n">MONO_VECTOR</span>
</pre></div></div></div>
<div class="paragraph"><p>While it is very unlikely that these changes will break existing code, there are
a a couple scenarios in which the code might break.  Namely, when use of <span class="monospaced">open</span>
introduces conflicts and when user code implements one of the affected Basis Library
signatures.  Both of these examples occurred in the <strong>SML/NJ</strong> source code; the former
in the <strong>ml-yacc</strong> sources and the latter in the <strong>MLRISC</strong> sources.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2015/09/25]
</dt>
<dd>
<div class="paragraph"><p>Added the optional implementations of <span class="monospaced">PackReal64Big</span> and <span class="monospaced">PackReal64Little</span>.
This addition addresses feature request <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=82&group_id=33&atid=218"><b>#82</b></a>
(Implementations of <span class="monospaced">PACK_REAL</span> missing).  The implementation
uses the approach suggested by
<a href="https://github.com/msullivan/sml-util/blob/master/libs/pack-real.sml">Michael Sullivan</a>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2015/09/24]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=45&group_id=33&atid=215"><b>#45</b></a> (Compiler bug in specialize phase).  This bug
was in <span class="monospaced">compiler/FLINT/opt/fcontract.sml</span> and was the result of a bad
interaction between eta contraction and inlining.  As part of the fix,
I cleaned up the code in this part of FLINT a bit.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2015/09/21]
</dt>
<dd>
<p>
Improvements to the error messages produced by the <strong>ml-ulex</strong> lexer generator.
</p>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2015/09/21]
</dt>
<dd>
<p>
Added <span class="monospaced">Ref</span> structure and <span class="monospaced">REF</span> signature to Basis implementation
(<a href="https://github.com/SMLFamily/BasisLibrary/wiki/2015-007-Addition-of-Ref-module">
Basis Library Proposal 2015-007</a>).
</p>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2015/09/21]
</dt>
<dd>
<p>
Added <span class="monospaced">Fn</span> structure and <span class="monospaced">FN</span> signature to Basis implementation
(<a href="https://github.com/SMLFamily/BasisLibrary/wiki/2015-005-Addition-of-Fn-module">
Basis Library Proposal 2015-005</a>).
</p>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2015/08/22]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=136&group_id=33&atid=215"><b>#136</b></a> (Incorrect raising of exceptions in <span class="monospaced">Real.fmt</span>
and <span class="monospaced">Time.fmt</span>).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2015/08/14]
</dt>
<dd>
<div class="paragraph"><p>Added <span class="monospaced">Either</span> structure and <span class="monospaced">EITHER</span> signature to Basis implementation
(<a href="https://github.com/SMLFamily/BasisLibrary/wiki/2015-002-Addition-of-Either-module">
Basis Library Proposal 2015-002</a>).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2015/07/23]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=135&group_id=33&atid=215"><b>#135</b></a> (Fails to build on Linux PowerPC).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2015/07/08]
</dt>
<dd>
<div class="paragraph"><p>Added Linux 4.* kernels to the list of operating systems recognized
by the <span class="monospaced">.arch-n-opsys</span> script (fixes bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=134&group_id=33&atid=215"><b>#134</b></a>).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2015/06/11]
</dt>
<dd>
<div class="paragraph"><p>Added Mac OS X 10.11 (El Capitan) to the list of operating systems
recognized by the <span class="monospaced">.arch-n-opsys</span> script.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2015/05/27]
</dt>
<dd>
<div class="paragraph"><p>Added support for <strong>Successor ML</strong> lexical extensions.  These can be enabled
using the command-line option <span class="monospaced">-Cparser.succ-ml=true</span> or by the assignment</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nn">Control</span><span class="p">.</span><span class="n">succML</span> <span class="n">:=</span> <span class="n">true</span><span class="p">;</span>
</pre></div></div></div>
<div class="paragraph"><p>at the REPL.  The extensions are as follows:</p></div>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
Underscore ("<span class="monospaced">_</span>") as a separator in numeric literals; <em>e.g.</em>, <span class="monospaced">123_456</span>,
    <span class="monospaced">0wxff_ff_ff_f3</span>, <span class="monospaced">123_456.1</span>, &#8230;
</p>
</li>
<li>
<p>
end-of-line comments, which are denoted using <span class="monospaced">(*)</span>.  End-of-line comments
    properly nest into conventional block comments.  For example, the following
    block comment is well formed:
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="cm">(*</span>
<span class="cm">fun f x = x (*) my identity function *)</span>
<span class="cm">*)</span>
</pre></div></div></div>
</li>
<li>
<p>
binary literals for both integers and words; <em>e.g.</em>, <span class="monospaced">0b0101_1110</span>, or
    <span class="monospaced">0wb1101</span>.
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p>This change is the beginning of a program to add <strong>Successor ML</strong> feature to <strong>SML/NJ</strong>;
See <a href="https://github.com/SMLFamily/Proposed-Definition-of-Successor-ML">https://github.com/SMLFamily/Proposed-Definition-of-Successor-ML</a> for more
details.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_78_2014_12_24">Version 110.78; 2014/12/24</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2014/12/19]
</dt>
<dd>
<div class="paragraph"><p>Major revision of the machinery for overloading resolution for both
operators (vars) and literals, now using a common mechanism. This fixes
bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=52&group_id=33&atid=215"><b>#52</b></a> by improving the error message when an overloaded
operator is inconsistent with its context. Updated 23 files, including
major changes in <span class="monospaced">overload.sml</span>, <span class="monospaced">types.sml</span>, <span class="monospaced">unify.sml</span>, <span class="monospaced">elabcore.sml</span>,
<span class="monospaced">typesutil.sml</span>. The overload declaration is still used in
<span class="monospaced">pervasives.sml</span>, where the order of the specified instances of an
ordering determines the default interpretation (<em>i.e.</em>, the first one).</p></div>
<div class="paragraph"><p>The <span class="monospaced">SCHEME</span> and <span class="monospaced">LITERAL</span> forms of tyvars are replaced by a new
<span class="monospaced">OVLD</span> form that tracks potential instantiations of the type of the
overloaded vars or literals.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~dbm">David MacQueen</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2014/12/18]
</dt>
<dd>
<div class="paragraph"><p>Moved <span class="monospaced">base/NOTES/HISTORY</span> file to <span class="monospaced">doc/src/changelog/HISTORY.txt</span>
and converted it to <a href="http://asciidoc.org">ASCIIDOC</a> format.  Have also
moved the <span class="monospaced">README</span> files from <span class="monospaced">base/READMES</span> to <span class="monospaced">doc/src/release-notes</span>.
These changes are part of a general effort to rationalize and improve
the documentation of the <strong>SML/NJ</strong> system.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2014/12/13]
</dt>
<dd>
<div class="paragraph"><p>Preliminary cleanups before changes to overloading</p></div>
<div class="paragraph"><p>Minor cleanup in <span class="monospaced">Elaborator/elaborate/elabcore</span> (function <span class="monospaced">elabOVERLOADdec</span>)
and in <span class="monospaced">ElabData/types/typesutil.sml</span> (function  <span class="monospaced">matchScheme</span>). Preparing for
a new method of handling type checking of overloaded operators. [Note
that there is no reason for the options field of <span class="monospaced">OVLDvar</span> to be a
reference&#8201;&#8212;&#8201;it is never updated. Changing this requires corresponding
change in pickling.]</p></div>
<div class="paragraph"><p>Also added an <span class="monospaced">etopdebugging</span> flag (<span class="monospaced">ElabControl</span>) for debugging in
<span class="monospaced">elabtop.sml</span>. Modified <span class="monospaced">elabcontrol.</span>{<span class="monospaced">sml</span>,<span class="monospaced">sig</span>} and
<span class="monospaced">elabtop.sml</span>. Also rearranged ast and absyn printing in <span class="monospaced">evalloop.sml</span>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~dbm">David MacQueen</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2014/10/23]
</dt>
<dd>
<div class="paragraph"><p>Improved error messages in <strong>ml-ulex</strong> for unclosed strings.  Also made
documentation improvements.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2014/10/11]
</dt>
<dd>
<div class="paragraph"><p>Added <span class="monospaced">-D_FILE_OFFSET_BITS=64</span> flag to <span class="monospaced">x86-linux</span> makefile.  This flag
is necessary to avoid spurious <span class="monospaced">EOVERFLOW</span> errors on some versions of
Linux.  The problem appears to be limited to large file systems that
have more than 2<sup>32</sup> inodes.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2014/09/13]
</dt>
<dd>
<div class="paragraph"><p>Added <span class="monospaced">%value</span> directive to <strong>ml-antlr</strong>; this addition improves the
error repair choices by allowing non-nullary tokens to be inserted
when making repairs.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_77_2014_08_22">Version 110.77; 2014/08/22</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2014/08/21]
</dt>
<dd>
<div class="paragraph"><p>Created new <span class="monospaced">doc</span> tree in <strong>SML/NJ</strong> repository.  Currently this
tree just holds the sources for UNIX-style manual pages for
the command-line tools (fixing bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=35&group_id=33&atid=215"><b>#35</b></a>).  The documentation
is written using the <a href="http://asciidoc.org">ASCIIDOC</a> format.  Use
the following <strong>svn</strong> command to checkout a copy of the documentation tree:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>svn co https://smlnj-gforge.cs.uchicago.edu/svn/smlnj/doc/trunk doc
</pre></div></div></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2014/08/19]
</dt>
<dd>
<div class="paragraph"><p>Compiling the runtime system on <strong>cygwin</strong> was failing because the file
<span class="monospaced">exceptions.h</span> was missing.  It appears to have been part of previous
versions, so a version has been incorporated verbatim in the
file <span class="monospaced">runtime/mach-base/cygwin-fault.c</span> file (fixes bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=125&group_id=33&atid=215"><b>#125</b></a>).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2014/08/19]
</dt>
<dd>
<div class="paragraph"><p>Added the <span class="monospaced">actionToString'</span> and <span class="monospaced">repairToString'</span> functions
to the <span class="monospaced">AntlrRepair</span> structure.  These functions allow one to
specialize the printing of tokens based on whether they are
being added or deleted.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2014/08/17]
</dt>
<dd>
<div class="paragraph"><p>Added patches to support <span class="monospaced">OpenBSD</span> on <span class="monospaced">PowerPC</span>.  The patches were
contributed by Jasper Lievisse Adriaanse (fixes bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=124&group_id=33&atid=215"><b>#124</b></a>).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2014/08/17]
</dt>
<dd>
<div class="paragraph"><p>Use <span class="monospaced">mkstemp</span> to implement <span class="monospaced">OS.FileSys.tmpName()</span> on systems that support
it (should be all modern versions of <strong>Unix</strong>).  This change fixes bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=128&group_id=33&atid=215"><b>#128</b></a>.
(Thanks to Johannes 5 Joemann).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2014/08/17]
</dt>
<dd>
<div class="paragraph"><p>Fixed a bug in <span class="monospaced">IntInf.~&gt;&gt;</span>, which did not handle negative arguments
correctly (bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=110&group_id=33&atid=215"><b>#110</b></a>).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2014/08/14]
</dt>
<dd>
<div class="paragraph"><p>Fixed a problem in the CPS contraction phase.  An optimization that
eliminates construction of a record that already exists was not
checking that the existing record was the same record kind (bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=119&group_id=33&atid=215"><b>#119</b></a>).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2014/07/28]
</dt>
<dd>
<div class="paragraph"><p>Switch to using <span class="monospaced">MAP_ANONYMOUS</span> to allocate memory on Linux systems.
This change avoids problems when <span class="monospaced">"/dev"</span> does not support execute
permission (as seems to be the case with some versions of <strong>Linux</strong>
running on ChromeBooks; bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=120&group_id=33&atid=215"><b>#120</b></a>).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2014/06/28]
</dt>
<dd>
<div class="paragraph"><p>Fix for bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=127&group_id=33&atid=215"><b>#127</b></a> (Crash on <strong>Windows</strong> with <span class="monospaced">OS.Process.system</span>).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2014/06/07]
</dt>
<dd>
<div class="paragraph"><p>Fixed a long-standing bug in <span class="monospaced">Socket.recvVec</span>, which prevented the result
from being used in a string pattern match (thanks to Vesa Norrman
for the fix).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2014/05/01]
</dt>
<dd>
<div class="paragraph"><p>Fixed minor issue in an error message; type variable name should be
printed with leading <span class="monospaced">'</span>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2013/11/25]
</dt>
<dd>
<div class="paragraph"><p>Added <span class="monospaced">PackWord</span>{<span class="monospaced">16</span>,<span class="monospaced">32</span>}{<span class="monospaced">Big</span>,<span class="monospaced">Little</span>} structures
to the <span class="monospaced">Unsafe</span> module.  This change makes the <span class="monospaced">UNSAFE</span> signature
closer to the <a href="http://mlton.org"><strong>MLton</strong></a> version, although we
still need to add the <span class="monospaced">PackReal</span> structures.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_76_2013_07_01">Version 110.76; 2013/07/01</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2013/06/04]
</dt>
<dd>
<div class="paragraph"><p>Fix bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=115&group_id=33&atid=215"><b>#115</b></a> (<span class="monospaced">BinPrimIO</span> writer method <span class="monospaced">getPos</span> does not
work under CML). Just needed to port the position update from <span class="monospaced">mkReader</span>
code to the <span class="monospaced">mkWriter</span> code.</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2013/06/04]
</dt>
<dd>
<div class="paragraph"><p>Fix bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=111&group_id=33&atid=215"><b>#111</b></a> (<span class="monospaced">Socket.acceptNB</span> returns somewhat broken sockets).
The problem was that under Win32, sockets returned from <span class="monospaced">accept</span> inherit
their parents' non-blocking status, whereas on <strong>UNIX</strong> they are always
blocking.</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2013/05/20]
</dt>
<dd>
<div class="paragraph"><p>Fix bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=117&group_id=33&atid=215"><b>#117</b></a> (<span class="monospaced">BinIO.openAppend</span> raises <span class="monospaced">IO</span> on non-existent file).
We were opening the file for append if it existed but not creating it
if it did not exist.</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2013/05/02]
</dt>
<dd>
<div class="paragraph"><p>Fix bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=116&group_id=33&atid=215"><b>#116</b></a> (<span class="monospaced">Socket.sameDesc</span> raises <span class="monospaced">Match</span> exception).
The problem is that on Windows the <span class="monospaced">iodesc</span> datatype (defined in
<span class="monospaced">Basis/Implementation/Win32/pre-os.sml</span>) has both an <span class="monospaced">IODesc</span> constructor
and a <span class="monospaced">SockDesc</span> constructor.  Updated the code in <span class="monospaced">Win32/os-io.sml</span> to
handle the <span class="monospaced">SockDesc</span> constructor.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2013/04/19]
</dt>
<dd>
<div class="paragraph"><p>Fix bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=113&group_id=33&atid=215"><b>#113</b></a> (Socket.select waits exactly twice the indicated timeout)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2013/01/19]
</dt>
<dd>
<div class="paragraph"><p>Fix AMD64 code generator to properly sign-extend arguments to <span class="monospaced">IDIVQ</span>.</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2012/10/20]
</dt>
<dd>
<div class="paragraph"><p>Fix bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=108&group_id=33&atid=215"><b>#108</b></a> (off-by-one error in <span class="monospaced">Util/dynamic-array.sml</span>;
iterators crash)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2012/10/20]
</dt>
<dd>
<div class="paragraph"><p>Fix bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=107&group_id=33&atid=215"><b>#107</b></a> (Bogus <span class="monospaced">Int64</span> comparison operators)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_75_2012_10_01">Version 110.75; 2012/10/01</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2012/09/28]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=92&group_id=33&atid=215"><b>#92</b></a>.  <span class="monospaced">IntInf.scan</span> now handles the "<span class="monospaced">0x</span>" prefix
correctly.  Also made minor improvements to the <span class="monospaced">NumScan</span> module.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2012/09/24]
</dt>
<dd>
<div class="paragraph"><p>Added <span class="monospaced">Base64</span> module to <strong>SML/NJ Library</strong> to support encoding and decoding
<span class="monospaced">Word8</span> vectors as <strong>base64</strong> strings.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2012/09/23]
</dt>
<dd>
<div class="paragraph"><p>Additions to the <strong>SML/NJ Library</strong>.  Added <span class="monospaced">exists</span>, <span class="monospaced">existsi</span>, <span class="monospaced">all</span>,
and <span class="monospaced">alli</span> functions to <span class="monospaced">ORD_MAP</span> signature and implementations,
and added <span class="monospaced">all</span> function to <span class="monospaced">ORD_SET</span> signature and implementations.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2012/09/21]
</dt>
<dd>
<div class="paragraph"><p>Bug fix in <strong>ml-antlr</strong> to ensure that the generated <span class="monospaced">toString</span> function
for tokens is strictly legal <strong>SML</strong> code (<em>i.e.</em>, non-printing characters
and <strong>UTF8</strong> multibyte sequences are properly escaped).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2012/09/11]
</dt>
<dd>
<div class="paragraph"><p>Added <span class="monospaced">getu</span> function to <span class="monospaced">ULexBuffer</span> as a way to improve <strong>ml-ulex</strong>
performance. This addition allows a fastpath for processing ASCII
characters, which improved lexer performance by 3-4%.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2012/08/02]
</dt>
<dd>
<div class="paragraph"><p>Fixed bugs <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=89&group_id=33&atid=215"><b>#89</b></a> and <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=96&group_id=33&atid=215"><b>#96</b></a>: Build Failure with <strong>Xcode 4.3</strong>
Also removed build support for <strong>MacOS X</strong> pre-10.5 (Leopard) on <strong>PPC</strong> and
pre-10.6 (Snow Leopard) on Intel.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2012/02/05]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=88&group_id=33&atid=215"><b>#88</b></a>.  The check for valid arcs on <strong>Unix</strong> systems now allows
any character other than slash or nul.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_74_2012_01_20">Version 110.74; 2012/01/20</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2012/01/20]
</dt>
<dd>
<div class="paragraph"><p>Fixed implementation of <span class="monospaced">Real.signBit</span> on little-endian machines.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2012/01/19]
</dt>
<dd>
<div class="paragraph"><p>1) Fix for bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=60&group_id=33&atid=215"><b>#60</b></a>
   recalculate strictness for <span class="monospaced">DEFtyc</span>s in functor bodies when functor
   is applied  (<span class="monospaced">Elaborator/modules/evalent.sml</span>)</p></div>
<div class="paragraph"><p>2) Fix for bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=77&group_id=33&atid=215"><b>#77</b></a>
   separate ast representations for datatypes and datatype replications
   in decs and specs (multiple files)</p></div>
<div class="paragraph"><p>3) set version to 110.74</p></div>
<div class="paragraph"><p>Details in <span class="monospaced">NOTES/changes/dbm_2012_1</span>.</p></div>
<div class="paragraph"><p><span class="owner">David MacQueen</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2012/01/12]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Change of <span class="monospaced">SourceMap</span> interface.
   related to fix of off-by-one error in lexer (committed earlier?),
   and cleanup of <strong>noweb</strong> code added by Norman Ramsey many years
   ago (but little used today).
</p>
</li>
<li>
<p>
Slight cleanup of match compiler, eliminating <span class="monospaced">compiler/FLINT/tempexpn.sml</span>
   file that  was part of unused implementation of pattern templates (pattern macros).
</p>
</li>
<li>
<p>
Modification of type checker to add "culprit tracking" for
   improved type error messages (printing of additional culprit
   information is controlled by <span class="monospaced">ElabControl.showTypeErrorCulprits</span>
   flag, default false, added in revision 3652).  The culprit tracking needs to be debugged
   and improved, and the presentation of the culprits needs to be done better.
</p>
<div class="paragraph"><p>Details in <span class="monospaced">NOTES/changes/dbm_2012_1</span>.</p></div>
<div class="paragraph"><p><span class="owner">David MacQueen</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2011/11/25]
</dt>
<dd>
<div class="paragraph"><p>Bug fixes for <span class="monospaced">Unsafe.blastRead</span> (bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=76&group_id=33&atid=215"><b>#76</b></a>):
  . proper error handling when reading from memory and there are
    not enough bytes.
  . pass correct data pointer and length to BlastIn (code was using
    old macros).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2011/11/25]
</dt>
<dd>
<div class="paragraph"><p>Added hash-table-based implementation of sets to SML/NJ Library.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2011/10/25]
</dt>
<dd>
<div class="paragraph"><p>Better error reporting under 32-bit linux for the missing dpkg
support (bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=70&group_id=33&atid=215"><b>#70</b></a>).
Enable 3.x kernels to build (bugs <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=80&group_id=33&atid=215"><b>#80</b></a>, <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=81&group_id=33&atid=215"><b>#81</b></a>, <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=83&group_id=33&atid=215"><b>#83</b></a>).</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2011/05/23]
</dt>
<dd>
<div class="paragraph"><p>Added new S-expression library to SML/NJ Library
(contributed by Damon Wang)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2011/05/17]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug in JSON scanner (SML/NJ Library).  It didn&#8217;t handle escaped
backslash or double quote correctly.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_73_2011_05_13">Version 110.73; 2011/05/13</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2011/05/10]
</dt>
<dd>
<div class="paragraph"><p>Added boolean literals (true and false) to the conditional-expression
syntax in CM.  Thus, you can write</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>#if true
  structure Foo
#endif</pre>
</div></div>
<div class="paragraph"><p>in a CM file.  This change is meant to make it easier to use <strong>autoconf</strong>
to configure the build process of an SML application.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2011/05/09]
</dt>
<dd>
<div class="paragraph"><p>Added missing <span class="monospaced">String.scan</span> function (bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=69&group_id=33&atid=215"><b>#69</b></a>).  This also
fixes the handling of certain corner cases by <span class="monospaced">String.fromString</span>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2011/05/03]
</dt>
<dd>
<div class="paragraph"><p>Added the <span class="monospaced">RTDSC</span> and <span class="monospaced">RTDSCP</span> instructions to the amd64 code generator.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.mpi-sws.org/~mrainey">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2011/04/08]
</dt>
<dd>
<div class="paragraph"><p>Added fix for comments in code bug (bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=63&group_id=33&atid=215"><b>#63</b></a>).
Thanks to Michael Norrish.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2011/04/08]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug in <span class="monospaced">Socket.acceptNB</span> (bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=59&group_id=33&atid=215"><b>#59</b></a>)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2011/03/31]
</dt>
<dd>
<div class="paragraph"><p>Fixed syntax error in <strong>ml-lex</strong> compatibility mode (bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=49&group_id=33&atid=215"><b>#49</b></a>)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2011/03/22]
</dt>
<dd>
<div class="paragraph"><p>Update <span class="monospaced">_arch-n-opsys</span> script for Mac OS X Lion (10.7).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2011/02/18]
</dt>
<dd>
<div class="paragraph"><p>Added <span class="monospaced">Barriers</span> module to CML.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2011/02/10]
</dt>
<dd>
<div class="paragraph"><p>Fixed <strong>ml-yacc</strong> examples to respect the changed signatures with respect
to <span class="monospaced">TextIO.inputLine</span>.</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2010/09/16]
</dt>
<dd>
<div class="paragraph"><p>Changed the <strong>Win32</strong> implementation of <span class="monospaced">validArc</span> to support directories
with extended characters (umlauts, etc.).</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2010/09/16]
</dt>
<dd>
<div class="paragraph"><p>Fixed the <strong>Win32</strong> socket and polling implementation to work correctly
with CML. Signature of <span class="monospaced">poll</span> was wrong and didn&#8217;t handle sockets at all.</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2010/06/16]
</dt>
<dd>
<div class="paragraph"><p>Fixed <span class="monospaced">Real.toString</span> and <span class="monospaced">Real.fmt</span> to include sign for negative zero.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2010/03/23]
</dt>
<dd>
<div class="paragraph"><p>Fixed the bug with <strong>Win32</strong> calls to <span class="monospaced">OS.Process.system</span> not quoting
the string.</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2010/02/11]
</dt>
<dd>
<div class="paragraph"><p>Applied patch for building on more recent versions of <strong>NetBSD</strong>
(bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=39&group_id=33&atid=215"><b>#39</b></a>).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://jonriehl.com/">Jon Riehl</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_72_2010_02_02">Version 110.72; 2010/02/02</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2009/12/20]
</dt>
<dd>
<div class="paragraph"><p>Fixed performance bugs in <span class="monospaced">List</span> module by making <span class="monospaced">@</span> and <span class="monospaced">foldr</span> be
tail recursive (bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=51&group_id=33&atid=215"><b>#51</b></a>).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2009/12/11]
</dt>
<dd>
<div class="paragraph"><p>Fixed the <strong>Win32</strong> unable to print long strings bug (bug <a href="http://smlnj-gforge.cs.uchicago.edu/tracker/index.php?func=detail&aid=37&group_id=33&atid=215"><b>#37</b></a>).</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2009/12/10]
</dt>
<dd>
<div class="paragraph"><p>Fixed an overrun during major GC. If the string arena was nearly
full, it was possible for alignment padding added during copy to
the to-space to overrun the allocated size.</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2009/11/18]
</dt>
<dd>
<div class="paragraph"><p>The <strong>ml-antlr</strong> and <strong>ml-ulex</strong> programs have been ported to build under
mlton.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2009/11/17]
</dt>
<dd>
<div class="paragraph"><p>Added <span class="monospaced">%header</span> directive to the <strong>ml-ulex</strong> scanner generator.  Also
updated the documentation.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2009/11/17]
</dt>
<dd>
<div class="paragraph"><p>Added <span class="monospaced">@SMLsuffix</span> flag to <strong>sml</strong> command.  This flag can be used to get
the suffix for heap files.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2009/11/17]
</dt>
<dd>
<div class="paragraph"><p>Added <span class="monospaced">--strict-sml</span> flag to <strong>ml-ulex</strong> for <strong>MLton</strong> compatibility.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2009/11/10]
</dt>
<dd>
<div class="paragraph"><p>Added <span class="monospaced">%header</span> directive to the <strong>ml-antlr</strong> parser generator.  Also
updated the documentation.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_71_2009_09_16">Version 110.71; 2009/09/16</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2009/09/13]
</dt>
<dd>
<div class="paragraph"><p>Changes to support compiling the runtime system on Mac OS X 10.6
(aka Snow Leopard).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2009/08/19]
</dt>
<dd>
<div class="paragraph"><p>Fixed a bug in the register-spill generator that is part of the MLRISC
register allocator. The problem was that the code in <span class="monospaced">RASpillWithRenaming</span>
functor assumed incorrectly that dedicated registers would appear in
def/use information generated by <span class="monospaced">ClusterRA</span>. Thanks to Allen Leung for
helping with this bug.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~mrainey">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2009/07/09]
</dt>
<dd>
<div class="paragraph"><p>Removed redundant implementations of various top-level operations by
consolidating them in <span class="monospaced">base/system/smlnj/init/pervasive.sml</span>.  This
change also fixes a bug in that the top-level version of <span class="monospaced">round</span> was
incorrect.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_70_2009_06_15">Version 110.70; 2009/06/15</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2009/06/12]
</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Corrected problem in config/actions that led to the so-called
   "unpickling bug" which appeared in version 110.68.
</p>
</li>
<li>
<p>
Provided fix for the 64-bit pattern match bug.
</p>
</li>
</ol></div>
</div></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2009/03/21]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug in <span class="monospaced">Int32.fmt</span> when the argument was the minimum int and the
radix was something other than <span class="monospaced">DEC</span>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2009/02/21]
</dt>
<dd>
<div class="paragraph"><p>Fixed bugs in how <strong>ml-antlr</strong> parsed ML types in <span class="monospaced">%tokens</span> specifications.</p></div>
<div class="paragraph"><p><span class="owner">Aaron Turon</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2009/01/13]
</dt>
<dd>
<div class="paragraph"><p>Picking up some additional fixes for 110.69, including a fix for
spaces in CM file paths.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.jonriehl.com/">Jon Riehl</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_69_2008_12_22">Version 110.69; 2008/12/22</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2008/12/06]
</dt>
<dd>
<div class="paragraph"><p>Re-enabled some CPS optimizations (first_contract and eta).  The most
important effect of this change is to make uses of <span class="monospaced">SMLofNJ.Cont.capture</span>
be properly tail recursive.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2008/12/03]
</dt>
<dd>
<div class="paragraph"><p>New concurrency-related instructions for x86 and amd64 code
generators.</p></div>
</dd>
</dl></div>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">PAUSE</span>: Notify the CPU that the program is spin waiting.
</p>
</li>
<li>
<p>
<span class="monospaced">MFENCE</span>: memory fence for reads and writes.
</p>
</li>
<li>
<p>
<span class="monospaced">SFENCE</span>: memory fence for writes.
</p>
</li>
<li>
<p>
<span class="monospaced">LFENCE</span>: memory fence for reads.
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p>+
<span class="owner"><a href="http://www.cs.uchicago.edu/~mrainey">Mike Rainey</a></span></p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2008/12/02]
</dt>
<dd>
<div class="paragraph"><p>Added makefile and other support for building runtime on <strong>OpenBSD</strong>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_68_2008_08_13">Version 110.68; 2008/08/13</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2008/08/11]
</dt>
<dd>
<div class="paragraph"><p>Minor fix to <strong>ml-ulex</strong> backend for regexps that match any character
and perform a single action.  Previously the emitted code would
not allow the regexps to match any character at all.</p></div>
<div class="paragraph"><p><span class="owner">Aaron Turon</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2008/08/05]
</dt>
<dd>
<div class="paragraph"><p>Added build support for <strong>OpenBSD</strong> (thanks to Brian O&#8217;Hanlon).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2008/07/12]
</dt>
<dd>
<div class="paragraph"><p>Fixed <span class="monospaced">Int64.fromString</span> to use base-10.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2008/04/12]
</dt>
<dd>
<div class="paragraph"><p>Various updates to the ml-lpt tree.  The documentation has been updated;
bugs in the parsing of negation and character classes in <strong>ml-ulex</strong> have
been fixed; and changes have been made to make the <strong>ml-lpt</strong> tools more
compatible with <strong>MLton</strong> (and other SML implementations).  Thanks to
Matthew Fluet and Aaron Turon for their patches.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2008/20/04]
</dt>
<dd>
<div class="paragraph"><p>Implemented timer-based profiling on Windows, with behavior as close
to the *nix ITIMER-based profiling as possible.</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2008/07/04]
</dt>
<dd>
<div class="paragraph"><p>Finished off the Windows subset of the basis library. Added process
support and various configuration and system identification utils.</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2008/03/18]
</dt>
<dd>
<div class="paragraph"><p>Major changes to the RegExp library: see smlnj-lib/CHANGES for details.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2008/02/14]
</dt>
<dd>
<div class="paragraph"><p>Added the Windows Status structure</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2008/02/14]
</dt>
<dd>
<div class="paragraph"><p>Added the Windows DDE structure</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2008/02/05]
</dt>
<dd>
<div class="paragraph"><p>Added the Windows Config structure</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2008/01/31]
</dt>
<dd>
<div class="paragraph"><p>Added outline of the Windows basis library and the basic registry
functionality.</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2008/01/23]
</dt>
<dd>
<div class="paragraph"><p>Fixed the amd64 code generator to compile with the current MLRISC.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~mrainey">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/11/26]
</dt>
<dd>
<div class="paragraph"><p><strong>nlffi</strong> was updated to work on Windows. It needed to pass in the correct
value for the name of the kernel32 DLL to obtain <em>base</em> bindings.
Additionally updated the README for the most basic <strong>nlffi</strong> sample with
what you need to do on MacOSX and on Windows to make it work.</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/11/21]
</dt>
<dd>
<div class="paragraph"><p>Overwrite the <span class="monospaced">SMLNJ_HOME</span> environment variable on installation
Properly change the package code so that subsequent version
installations prompt for uninstall (instead of <em>repair/remove</em>)</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/11/14]
</dt>
<dd>
<div class="paragraph"><p>Cleaned up <span class="monospaced">WININSTALL</span> file for new MSI-based setup.</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_67_2007_11_13">Version 110.67; 2007/11/13</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/11/12]
</dt>
<dd>
<div class="paragraph"><p>Ensure that the size of the allocation space is at least 128K.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/11/05]
</dt>
<dd>
<div class="paragraph"><p>Fixed type error in <strong>ml-lpt</strong> library that occurs when compiling
against a basis that was compiled with the <span class="monospaced">USE_64_BIT_POSITIONS</span>
symbol set.
(Thanks to Johannes Joemann)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/11/03]
</dt>
<dd>
<div class="paragraph"><p>Fixed the amd64 code generator to compile with the current MLRISC.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~mrainey">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/11/02]
</dt>
<dd>
<div class="paragraph"><p>Made <span class="monospaced">sml.bat</span> more resilient to either not having run the installer
and having no <span class="monospaced">SMLNJ_HOME</span> set or having just shuffled the directory
around.</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/11/01]
</dt>
<dd>
<div class="paragraph"><p>A collection of bug fixes for <span class="monospaced">machine.sml</span> in the Reactive library.
(Thanks to Timothy Bourke)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/10/28]
</dt>
<dd>
<div class="paragraph"><p>Patches for Mac OS X 10.5 (Leopard).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/10/28]
</dt>
<dd>
<div class="paragraph"><p>Fixed some bugs in the AMD64 floating-point spilling code.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~mrainey">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/10/25]
</dt>
<dd>
<div class="paragraph"><p>Added support for the atomic <span class="monospaced">XCHG</span> instruction.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~mrainey">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/10/22]
</dt>
<dd>
<div class="paragraph"><p>Added AMD64 support for floating-point negation.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~mrainey">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/10/22]
</dt>
<dd>
<div class="paragraph"><p>Fixed ^C handling in Windows
Added a Windows installer
Made it possible to build for <strong>Windows</strong> on a mapped drive from Parallels</p></div>
<div class="paragraph"><p><span class="owner">Lars Bergstrom</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/10/22]
</dt>
<dd>
<div class="paragraph"><p>Added AMD64 support for the atomic fetch and add instruction.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~mrainey">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/10/18]
</dt>
<dd>
<div class="paragraph"><p>The GAS output now favors <span class="monospaced">p2align</span> over <span class="monospaced">align</span>, since the
former is guaranteed to be consistent over multiple architectures
and the latter is not.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~mrainey">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/10/18]
</dt>
<dd>
<div class="paragraph"><p>Fixed a bug in register spilling.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~mrainey">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/10/2]
</dt>
<dd>
<div class="paragraph"><p>Added demo support for AMD64 for quick testing and fixed support for
64-bit label constants.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~mrainey">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/09/20]
</dt>
<dd>
<div class="paragraph"><p>Added support for the MLRISC <span class="monospaced">COND</span> instruction and the x86-64 <span class="monospaced">CMOVCC</span>
instruction.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~mrainey">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/09/17]
</dt>
<dd>
<div class="paragraph"><p>Fixed an instruction-selection bug when loading 64-bit labels.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~mrainey">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/09/14]
</dt>
<dd>
<div class="paragraph"><p>Fixed <span class="monospaced">Elaborator</span> and <span class="monospaced">Translate</span> performance bugs</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~gkuan">George Kuan</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/09/12]
</dt>
<dd>
<div class="paragraph"><p>Fixed <span class="monospaced">xorl</span> memory argument bug.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~mrainey">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/07/27]
</dt>
<dd>
<div class="paragraph"><p>Added <span class="monospaced">f64sgn</span> (for <span class="monospaced">Real64.signBit</span>) as a primop defined
in <span class="monospaced">MLRiscGen</span>. <span class="monospaced">signBit</span>(~0.0) not handled correctly.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~gkuan">George Kuan</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/06/21]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug in {<span class="monospaced">TextIO</span>,<span class="monospaced">BinIO</span>}<span class="monospaced">.StreamIO.endOfStream</span> that
would incorrectly signal end of stream.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/06/12]
</dt>
<dd>
<div class="paragraph"><p>Eliminated <span class="monospaced">config/allsources</span>.  The information is now drawn directly
from <span class="monospaced">config/actions</span>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_65_2007_06_07">Version 110.65; 2007/06/07</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/06/06]
</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
Aaron: fixed a number of bugs in <strong>ml-ulex</strong>.
</p>
</li>
<li>
<p>
Matthias:
</p>
<div class="ulist"><ul>
<li>
<p>
added CM control <span class="monospaced">cm.force-tools</span>; this is false by default;
      when set to true, then tools like <strong>ml-yacc</strong>, <strong>ml-lex</strong>, <strong>ml-ulex</strong>, etc.
      will be forced to run regardless of whether or not their targets
      are up-to-date
</p>
</li>
<li>
<p>
changed installer code so that <span class="monospaced">config/install.sh</span> will re-build
      heap images for all tools even if those heap images already existed
</p>
</li>
</ul></div>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/06/04]
</dt>
<dd>
<div class="paragraph"><p>After Aaron Turon&#8217;s bug fix for <strong>ml-ulex</strong> (handling the <span class="monospaced">^</span> character
in legacy mode), re-ran the lexer generator on all lex input files
and committed the results.</p></div>
<div class="paragraph"><p>This should fix the problem with <strong>ckit</strong> and <strong>nlffi</strong> that was reported
by Vesa A. Norrman.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_64_2007_05_31">Version 110.64; 2007/05/31</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/05/31]
</dt>
<dd>
<div class="paragraph"><p>3rd merge of base from primop-branch-3 into the trunk.
Additional bug fixes included:</p></div>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">Timer.cpu_timer</span>, etc. type printing corrected (by making
     <span class="monospaced">Timer</span> have opaque sig constraint in <span class="monospaced">basis/Implementation/timer.sml</span>)
</p>
</li>
<li>
<p>
Infinite loop in FLINT (<span class="monospaced">tests/typing/tests/25.sml</span>) (fix by
     Stefan Monnier)
</p>
<div class="paragraph"><p><span class="owner">Dave MacQueen</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/05/31]
</dt>
<dd>
<div class="paragraph"><p>Fixed some bugs in new Div code in <span class="monospaced">FLINT/trans/translate.sml</span>.</p></div>
<div class="paragraph"><p>Also, changed the handling of "no core access":  When <span class="monospaced">translate.sml</span>
needs access to a core exception at a time when the core has not
been set up yet (this only happens when compiling <span class="monospaced">system/smlnj/init/</span>*),
then don&#8217;t bother generating the corresponding tests.</p></div>
<div class="paragraph"><p>The old scheme was to generate a bogus value to be used in place of
the exception.  Unfortunately, that confuses the plambda type checker.
Moreover, it does not do any good, because at runtime we don&#8217;t expect
such an exception to be ever raised.  (The code in <span class="monospaced">system/smlnj/init/</span>*
has to be written very carefully with this in mind!)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/05/29]
</dt>
<dd>
<div class="paragraph"><p>Added <span class="monospaced">FSQRT</span> instructions for the AMD64 code generator.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~mrainey">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/05/29]
</dt>
<dd>
<div class="paragraph"><p><span class="monospaced">FLINT/trans/translate.sml</span> now wraps all <span class="monospaced">DIV</span>/<span class="monospaced">MOD</span>/<span class="monospaced">QUOT</span>/<span class="monospaced">REM</span>
operations with an explicit test for zero division.  This should
fixe several regressions and makes it possible for downstream optimization
phases to treat these operations as "pure" when they are applied to unsigned
operands.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/05/29]
</dt>
<dd>
<div class="paragraph"><p>Added the new MLRISC code generator for the AMD64.  This version,
in contrast to the previous one, uses SSE registers and instructions
for all floating-point computations.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~mrainey">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/05/29]
</dt>
<dd>
<div class="paragraph"><p>A number of fixes related to the formatting of dates.  These include fixes
for bugs #1415 and #1416.  We also now correctly handle format characters that
lie outside the specified set.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/05/23]
</dt>
<dd>
<div class="paragraph"><p>CMB (and CM) now automatically defines the CM "preprocessor" symbol
NO_PLUGINS during "makeml -rebuild" or when CM operates in "slave" mode.</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>(In addition, CMB_REBUILD_MODE is defined for +makeml -rebuild+,
 CM_SLAVE_MODE is defined in attached slaves while running CM.make
 or CM.rebuild, and CMB_SLAVE_MODE is defined in attached slaves
 while running +CMB.make+.  The point is that the single symbol
 NO_PLUGINS is definde in all three cases.)</pre>
</div></div>
<div class="paragraph"><p>I changed the three locations within the sources that get compiled
during <span class="monospaced">CMB.make</span> where <strong>ml-yacc</strong> or <strong>ml-lex</strong> input is processed: When
NO_PLUGINS defined, then the use of the mlyacc and mllex tools
is bypassed.</p></div>
<div class="paragraph"><p>When bootstrapping new versions of the compiler, there can be
situations where the plugin tools for <strong>ml-yacc</strong> and <strong>ml-lex</strong> (or <strong>ml-ulex</strong>)
are not available or otherwise not operational.  In this case one can
manually define the NO_PLUGINS symbol prior to running <span class="monospaced">CMB.make()</span>.  To
do so, the following command should be issued at the interactive
prompt:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>   <span class="nl">#set</span> <span class="p">(</span><span class="nn">CMB</span><span class="p">.</span><span class="n">symval</span> <span class="s2">&quot;NO_PLUGINS&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">SOME</span> <span class="mi">1</span><span class="p">);</span>
</pre></div></div></div>
<div class="paragraph"><p>A <span class="monospaced">CMB.make</span> with NO_PLUGINS defined relies on the existence of the
files that normally would be generated by <strong>ml-yacc</strong> and <strong>ml-lex</strong>.
(Copies of these files are in the repository.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/5/23]
</dt>
<dd>
<div class="paragraph"><p>Second merge of base from <span class="monospaced">primop-branch-3</span> into the trunk.
Additional bug fixes included:</p></div>
</dd>
</dl></div>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">Date.scan</span> and <span class="monospaced">Date.fromString</span> fixed;
</p>
</li>
<li>
<p>
Overloading resolution fixed and some type printing problems corrected.
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p>+
<span class="owner">David MacQueen</span></p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/05/23]
</dt>
<dd>
<div class="paragraph"><p>Changed the installation mechanism for CM tool plugins.  These are
just libaries and now get installed like ordinary libaries.</p></div>
<div class="paragraph"><p>There are now a number of new installation targets that give some
fine-grain control over what classes and suffixes are known, and what
they will map to.
See <span class="monospaced">config/targets</span> for details.</p></div>
<div class="paragraph"><p>The code that caused plugin installation as part of running a
tool&#8217;s "build" script has been removed.  (The build script is for
building, not for installing.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/05/22]
</dt>
<dd>
<div class="paragraph"><p>Added a boolean control named cm.tolerate-tool-failures (env. variable
name: CM_TOLERATE_TOOL_FAILURES).  The default is false and makes
CM fail if a shell tool reports a non-success exit status.  If
the control is set to true, then CM will press on after tool failures
in the event that the target files exist (even though they are
considered outdated).  Turning the control to true can be useful for
bootstrapping.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/05/19]
</dt>
<dd>
<div class="paragraph"><p>Merge of ml-lpt revisions for 110.64.</p></div>
<div class="paragraph"><p>The name of several ml-lpt-lib modules has changed:</p></div>
<table class="tableblock frame-none grid-none"
style="
width:50%;
">
<col style="width:40%;">
<col style="width:20%;">
<col style="width:40%;">
<tbody>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">Repair</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">AntlrRepair</span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">StreamPos</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">AntlrStreamPos</span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">ErrHandlerFn</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">AntlrErrHandler</span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">EBNF</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">AntlrEBNF</span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>The <strong>ml-antlr</strong> specification format has changed: declarations such as
<span class="monospaced">%tokens</span> and nonterminal definitions can occur <strong>multiple</strong> times in the
same specification.  The semantics are such that each new declaration
extends the previous ones.  This does not apply to <span class="monospaced">%start</span> or <span class="monospaced">%name</span>,
of course.</p></div>
<div class="paragraph"><p>Importing a grammar via <span class="monospaced">%import</span> now includes <strong>all</strong> declarations in from
the imported grammar, except for <span class="monospaced">%name</span>, <span class="monospaced">%entry</span>, and <span class="monospaced">%start</span>.  Tokens
and nonterminals can be dropped using the new <span class="monospaced">%dropping</span> clause of the
<span class="monospaced">%import</span> directive; the separate <span class="monospaced">%drop</span> and <span class="monospaced">%extend</span> have been removed.</p></div>
<div class="paragraph"><p>We now allow optional type annotations on nonterminals, using the <span class="monospaced">%nonterms</span>
directive as in <strong>ml-yacc</strong>.</p></div>
<div class="paragraph"><p>The <span class="monospaced">refcell</span> construct is now implemented using SML&#8217;s regular reference
cells, so the <span class="monospaced">:==</span> and <span class="monospaced">!!</span> notation has been deprecated.</p></div>
<div class="paragraph"><p>The <strong>ml-antlr</strong> tool now does much more checking of specifications, and
its error messages have been greatly improved.  Error repair for
generated parsers has been completely rewritten, and is now both
much faster and more accurate.</p></div>
<div class="paragraph"><p><strong>ml-ulex</strong> is now more lenient with escape codes (non-SML-standard
escape codes are now interpreted literally, so <em>e.g.</em>, <span class="monospaced">\|</span> denotes "<span class="monospaced">|</span>").
Also, character classes may now include a "<span class="monospaced">-</span>" character at the beginning
as is standard in most other regexp tools.</p></div>
<div class="paragraph"><p>All of these changes are documented in the user guide, which has
been updated and improved with this merge.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~adrassi">Aaron Turon</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/05/03]
</dt>
<dd>
<div class="paragraph"><p>Merge of the primop3 branch (base) into the trunk to create 110.63.1.
Significant changes in FLINT and the front end, mostly having to do
with a reorganized system for handling primops.  Various bug fixes
and improvements in printing signatures.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">David MacQueen</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/05/02]
</dt>
<dd>
<div class="paragraph"><p>Preliminary commit of large <strong>ml-lpt</strong> revisions (more to come for 110.64).
The <strong>ml-antlr</strong> specification format has changed: declarations such as
<span class="monospaced">%tokens</span> and nonterminal definitions can occur <strong>multiple</strong> times in the
same specification.  The semantics are such that each new declaration
extends the previous ones.  Grammar extension constructs have also
changed.  We now allow type annotations on nonterminals.  Finally,
the refcell construct is now implemented using SML&#8217;s regular reference
cells, so the <span class="monospaced">:==</span> and <span class="monospaced">!!</span> notation has been deprecated.  All of these
changes will appear in the 110.64 user guide for <strong>ml-lpt</strong>.</p></div>
<div class="paragraph"><p>The <strong>ml-antlr</strong> tool now does much more checking of specifications, and
its error messages have been greatly improved.  There has also been
some work on the error repair process for generated parsers, but this
will be further improved in 110.64.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~adrassi">Aaron Turon</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/04/24]
</dt>
<dd>
<div class="paragraph"><p>More Basis fixes: The <span class="monospaced">Char.fromString</span> (<em>etc.</em>) functions did not handle
the "<span class="monospaced">\uxxxx</span>" escape sequence.  There is still an outstanding bug with
<span class="monospaced">String.fromString</span> the tail is a format escape.  I added a comment to
this effect in <span class="monospaced">Basis/Implementation/string.sml</span>.
Thanks to Andreas Rossberg.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/04/24]
</dt>
<dd>
<div class="paragraph"><p>Added <span class="monospaced">next</span> function to <span class="monospaced">Fifo</span> and <span class="monospaced">Queue</span> modules in the SML/NJ Library.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/04/23]
</dt>
<dd>
<div class="paragraph"><p>More Basis fixes: <span class="monospaced">Time.fmt</span> dropped the leading "<span class="monospaced">~</span>" for negative time
values that had no whole part.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/04/23]
</dt>
<dd>
<div class="paragraph"><p>More Basis fixes: the <span class="monospaced">OS.Path</span> module did not include the <span class="monospaced">InvalidArc</span>
exception and did not do sufficient argument checking.
Thanks to Stephen Weeks and Adam Chilpala.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/04/16]
</dt>
<dd>
<div class="paragraph"><p>Fixed an unbound functor bug in the AMD64 CM file.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~mrainey">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/04/12]
</dt>
<dd>
<div class="paragraph"><p>Substantially changed the signature and implementation of AMD64
SVID.  It now looks similar to the ia32 SVID, yet uses staged
allocation.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~mrainey">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/04/07]
</dt>
<dd>
<div class="paragraph"><p>More Basis fixes: the <span class="monospaced">WORD</span> signature was missing {<span class="monospaced">to</span>,<span class="monospaced">from</span>}<span class="monospaced">Large.</span>
Thanks to Andreas Rossberg.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_63_2007_03_22">Version 110.63; 2007/03/22</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/03/19]
</dt>
<dd>
<div class="paragraph"><p>Fixed bogus operand sizes in AMD64 instruction spilling.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~mrainey">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/03/19]
</dt>
<dd>
<div class="paragraph"><p>Fixed a number of inconsistencies between the <span class="monospaced">Posix.TTY</span> structure
and the Basis specification.  Thanks to Adam Chilpala.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/02/26]
</dt>
<dd>
<div class="paragraph"><p>Added preliminary support in MLRISC for Staged Allocation, a technique
for specifying calling conventions (see
<span class="monospaced">http://www.eecs.harvard.edu/~nr/pubs/staged-abstract.html</span>).
Initially, we plan to use this code to generate C calls for the AMD64.</p></div>
<div class="paragraph"><p>The staged allocation code base resides in <span class="monospaced">MLRISC/staged-allocation</span>,
and specialized calling conventions go in <span class="monospaced">MLRISC/ARCH/staged-allocation</span>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~mrainey">Mike Rainey</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/02/20]
</dt>
<dd>
<div class="paragraph"><p>Bug fix: when <span class="monospaced">SaveCState</span> was called with two values to save, a subsequent
GC could cause the <span class="monospaced">RestoreCState</span> to fail because the saved state had been
promoted to tagless pair.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/02/20]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug triggered by:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>    <span class="kr">val</span> <span class="nv">a1</span> <span class="p">=</span> <span class="nn">Word8Array</span><span class="p">.</span><span class="n">array</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="mi">0w0</span><span class="p">);</span>
    <span class="kr">val</span> <span class="p">_</span>  <span class="p">=</span> <span class="nn">Word8Array</span><span class="p">.</span><span class="n">update</span><span class="p">(</span><span class="n">a1</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0w128</span><span class="p">);</span>
</pre></div></div></div>
<div class="paragraph"><p>The <span class="monospaced">x86MCEmitter</span> crashed when the immediate operand to <span class="monospaced">MOVB</span> was outside
of the range <span class="monospaced">-128</span> &#8230; <span class="monospaced">127</span>.  I&#8217;ve changed the code so that the range
check is disabled.   Only the low order 8 bits of the immediate operand
are now significant.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/02/15]
</dt>
<dd>
<div class="paragraph"><p>Eliminated any mention of <strong>lexgen</strong>, which was an early precursor
to <strong>ml-ulex</strong>.</p></div>
<div class="paragraph"><p>You should update your admin directory, so the shell scripts for
maintaining your local copy of the repository reflect this change.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/02/14]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug in CM&#8217;s parallel make facility that failed to have
the master re-link modules after letting slaves compile them.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/02/12]
</dt>
<dd>
<div class="paragraph"><p>Fixed typo in <strong>ml-build</strong> script that prevented library anchors
from being registered.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_62_2007_02_02">Version 110.62; 2007/02/02</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/01/31]
</dt>
<dd>
<div class="paragraph"><p>Brought ml-lpt manual up-to-date with the code.  Many minor
improvements to the tools, and a few minor bugfixes.  Prepared
ml-lpt-lib for integration with new <span class="monospaced">UTF8</span> structure.  Changed
the interface for creating streams in <strong>ml-ulex</strong> (we now support
stream creation from several kinds of sources).  Overall, the
tools are now quite stable, and their interfaces are unlikely to
change in a way that would break compatibility.  More work,
however, is needed in the documentation.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~adrassi">Aaron Turon</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/02/01]
</dt>
<dd>
<div class="paragraph"><p>Implemented library installer.  Moved CM plugin code for
<strong>ml-burg</strong>, <strong>ml-lex</strong>, and <strong>ml-yacc</strong> out of CM source tree and into
their respective trees.  Implemented CM plugin for <strong>ml-ulex</strong>
and <strong>ml-antlr</strong>.  Used library installer for <strong>ml-burg</strong>, <strong>ml-ulex</strong>,
and <strong>ml-antlr</strong>.</p></div>
<div class="paragraph"><p>For <strong>ml-yacc</strong> and <strong>ml-lex</strong> we continue to have permanently "plugged-in"
CM tools.  (It turns out to be too messy to do otherwise because
there is too much code that during installation relies on the presence
of these tools&#8201;&#8212;&#8201;resulting in a tricky ordering problem.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/01/30]
</dt>
<dd>
<div class="paragraph"><p>Added <span class="monospaced">SMLofNJ.shiftArgs</span> which is like a shell&#8217;s "shift" command.
Modified CM&#8217;s startup code to use <span class="monospaced">shiftArgs</span> as it processes
command line arguments.  This way, the init code in each .sml-file
or library that is mentioned at the top level will see only
those arguments that have not yet been processed at this point.
In other words, the init code can "seize control" and process the
remaining command line.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/01/30]
</dt>
<dd>
<div class="paragraph"><p>Added fromList function to the <span class="monospaced">ORD_SET</span> interface and lookup to the
<span class="monospaced">ORD_MAP</span> interface.  See the SML/NJ Library CHANGES file for details.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/01/28]
</dt>
<dd>
<div class="paragraph"><p>Added the <span class="monospaced">UTF8</span> structure and signature from the Moby compiler to
the SML/NJ library (and the CML library).  These modules will replace
the version in the ml-lpt-lib.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2007/01/26]
</dt>
<dd>
<div class="paragraph"><p>Added entries to handle ml-lpt-lib.cm in installer.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_61_1_2006_12_15">Version 110.61.1; 2006/12/15</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/12/15]
</dt>
<dd>
<div class="paragraph"><p>Fixed brown-paper-bag bug with CM&#8217;s pathname handling, which made
installation fail under <strong>Win32</strong>.</p></div>
<div class="paragraph"><p>This supersedes the pre-brown-paper-bug release (see below).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_61_2006_12_14">Version 110.61; 2006/12/14</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/14/06]
</dt>
<dd>
<div class="paragraph"><p>Fixed the code in <span class="monospaced">runtime/c-libs/posix-tty/</span>{<span class="monospaced">tcgetattr</span>,<span class="monospaced">tcsetattr</span>}<span class="monospaced">.c</span> to
get the c_cc termios data copied correctly.  Also moved the allocation
of the string to avoid problems if it caused a GC.</p></div>
<div class="paragraph"><p>Thanks to Timothy Bourke for the bug report and fix.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/12/08]
</dt>
<dd>
<div class="paragraph"><p>Added code to CM&#8217;s "standard shell tool" implementation which
causes it to tolerate (with a warning) the situation where the shell
command fails (<em>e.g.</em>, due to the shell command&#8217;s non-existence)
as long as all target files exist.</p></div>
<div class="paragraph"><p>This makes it possible to, <em>e.g.</em>, build <strong>ml-yacc</strong> from sources even if
svn checkout messed up the time stamps on files in such a way that
<span class="monospaced">yacc.grm</span> is younger than yacc.grm.sml or <span class="monospaced">yacc.grm.sig</span>.  (<strong>Ml-yacc</strong>
would be needed to re-process <span class="monospaced">yacc.grm</span>, but obviously it might not yet be
available at that time.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/12/06]
</dt>
<dd>
<div class="paragraph"><p>Fixed the types of <span class="monospaced">recvVecFrom</span>, <span class="monospaced">recvVecFrom'</span>, <span class="monospaced">recvVecFromNB</span>, and
<span class="monospaced">recvVecFromNB'</span> in the <span class="monospaced">SOCKET</span> signature.  This error is actually
in the <em>SML Basis</em> specification too.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/12/05]
</dt>
<dd>
<div class="paragraph"><p>CM now reports undefined anchors as errors and aborts execution
rather than silently pressing on using bogus values.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/11/29]
</dt>
<dd>
<div class="paragraph"><p>Use <span class="monospaced">Say.vsay</span> for printing the "<span class="monospaced">[autoloading]</span>" message, so
<span class="monospaced">#set CM.Control.verbose false</span> (or <span class="monospaced">-Ccm.verbose=false</span>) can be used
to suppress them.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/11/10]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug in CM where "<span class="monospaced">with:</span>" specifications that affect compilation
(as opposed to parsing) were ignored.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_60_2006_11_09">Version 110.60; 2006/11/09</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/11/09]
</dt>
<dd>
<div class="paragraph"><p>This is the first subversion-hosted release.  There are also changes
to the directory layout.  Here is a table:</p></div>
<table class="tableblock frame-none grid-none"
style="
width:80%;
">
<col style="width:23%;">
<col style="width:7%;">
<col style="width:23%;">
<col style="width:46%;">
<tbody>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">config</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">config</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">src/cm</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">base/cm</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">src/compiler</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">base/compiler</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">src/runtime</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">base/runtime</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">src/system</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">base/system</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">src/cm/pgraph</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">pgraph</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">src/READMES</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">base/READMES</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">src/$</span><em>note</em></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">base/NOTES/$</span><em>note</em></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock">for <em>note</em> in <span class="monospaced">BOOT</span> <span class="monospaced">CVSNOTES</span> <span class="monospaced">CYGWININSTALL</span>
      <span class="monospaced">HISTORY</span> <span class="monospaced">INSTALL</span> <span class="monospaced">MACOSXINSTALL</span> <span class="monospaced">WININSTALL</span></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">src/smlnj-lib</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">smlnj-lib</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">src/MLRISC</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">MLRISC</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">ckit</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">ckit</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">src/cml</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">cml</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">src/eXene</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">eXene</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">src/heap2asm</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">heap2asm</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">src/lexgen</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">lexgen</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">src/ml-burg</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">ml-burg</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">src/ml-lex</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">ml-lex</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">src/ml-yacc</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">ml-yacc</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">src/ml-nlffi-lib</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">nlffi/lib</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">src/ml-nlffigen</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">nlffi/gen</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">src/smlnj-c</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">smlnj-c</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
<tr>
<td class="tableblock halign-right valign-top" ><p class="tableblock"><span class="monospaced">src/tools/TraceDebugProf</span></p></td>
<td class="tableblock halign-center valign-top" ><p class="tableblock">&#8658;</p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">trace-debug-profile</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"></p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>(All pathnames are relative to the SML/NJ "root" directory.)</p></div>
<div class="paragraph"><p>In addition, there is also a new</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>  ml-lpt</pre>
</div></div>
<div class="paragraph"><p>directory containing two new program generator tools: <strong>ml-ulex</strong> and
<strong>ml-antlr</strong> (a lexer generator that handles unicode and an ANTRL-inspired
LL(k) parser generator). These tools are currently "beta-quality"</p></div>
<div class="paragraph"><p>The latest versios of the sources can now be obtained anonymously
via subversion.  For this, it is useful to first check out</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>  svn://smlnj-gforge.cs.uchicago.edu/smlnj/admin</pre>
</div></div>
<div class="paragraph"><p>and put the resulting directory on your shell&#8217;s PATH.  This provides
access to three shell scripts: checkout-all.sh, stat-all.sh,
and refresh-all.sh.</p></div>
<div class="paragraph"><p>To create a freshly checked-out copy of the sources, do</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>  checkout-all.sh [dir]</pre>
</div></div>
<div class="paragraph"><p>where dir is the optional SML/NJ root directory (default is ".").</p></div>
<div class="paragraph"><p>This creates the above directory layout.  Each subdirectory of
the root is under individual subversion control.  The stat-all.sh
and refresh-al.sh scripts apply "svn stat" or "svn update" to
each of these subtrees.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/11/02]
</dt>
<dd>
<div class="paragraph"><p>Reorganized directory layout.</p></div>
<div class="paragraph"><p>This is a temporary solution, more reorganization is to come.</p></div>
<div class="paragraph"><p>The basic idea is to have a number of toplevel trees, each corresponding
to a well-defined part of the overall system.  Each part can be
maintained individually, even in separate source repositories,
although currently we still serve everything out of the main
smlnj-gforge tree.</p></div>
<div class="paragraph"><p>Installer and and scripts have been updated to reflect the new
layout.  The installer (base/src/system/smlnj/installer) is now
"scriptable" to avoid burning too much knowledge about the
layout into SML source code.  The main script used by the installer
is in config/actions.</p></div>
<div class="paragraph"><p>The main change is that many of the subdirectories of what used to
be known as "src" have moved to the toplevel.  The "src" directory
itself has moved down into a subtree called "base".  (We may eventually
get rid of the extra level of indirection represented by "src".)</p></div>
<div class="paragraph"><p>The layout is now as follows:</p></div>
<table class="tableblock frame-none grid-all"
style="
width:90%;
">
<col style="width:40%;">
<col style="width:60%;">
<thead>
<tr>
<th class="tableblock halign-left valign-top" > toplevel tree name </th>
<th class="tableblock halign-left valign-top" > default repository
                       (using <span class="monospaced">svn://smlnj-gforge.cs.uchicago.edu/smlnj</span> for <span class="monospaced">$gf</span>)<br></th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">config</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">$gf/config/trunk</span><br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">base</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">$gf/sml/trunk</span><br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">smlnj-lib</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">$gf/smlnj-lib/trunk</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">MLRISC</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">$gf/MLRISC/trunk</span><br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">ml-yacc</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">$gf/ml-yacc/trunk</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">ml-lex</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">$gf/ml-lex/trunk</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">ml-burg</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">$gf/ml-burg/trunk</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">lexgen</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">$gf/lexgen/trunk</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">heap2asm</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">$gf/heap2asm/trunk</span><br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">cml</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">$gf/cml/trunk</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">eXene</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">$gf/eXene/trunk</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">ckit</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">$gf/ckit/trunk</span></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">nlffi</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">$gf/nlffi/trunk</span><br></p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">smlnj-c</span></p></td>
<td class="tableblock halign-left valign-top" ><p class="tableblock"><span class="monospaced">$gf/smlnj-c/trunk</span></p></td>
</tr>
</tbody>
</table>
<div class="paragraph"><p>In <span class="monospaced">$gf/admin</span> there are a few useful shell scripts for checking out
and maintaining the entire collection of trees:</p></div>
<div class="openblock">
<div class="content">
<div class="dlist"><dl>
<dt class="hdlist1">
<span class="monospaced">admin/checkout-all.sh</span> [<em>dir</em>]
</dt>
<dd>
<div class="paragraph"><p>optionally creates <em>dir</em> and checks out all trees from their
default repositories; if <em>dir</em> is missing, checkout into the
current working directory.</p></div>
</dd>
<dt class="hdlist1">
<span class="monospaced">admin/refresh-all.sh</span> [<em>dir</em>]
</dt>
<dd>
<p>
looks at all trees (from the above list) in <em>dir</em> (default: .)
and runs "<span class="monospaced">svn update</span>" if the tree exists and is under
subversion control;
non-existing or non-subversion trees are skipped
</p>
</dd>
<dt class="hdlist1">
<span class="monospaced">admin/stat-all.sh</span> [<em>dir</em>]
</dt>
<dd>
<p>
like <span class="monospaced">refresh-all.sh</span>, but runs "<span class="monospaced">svn stat</span>" instead
</p>
</dd>
</dl></div>
</div></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/10/05]
</dt>
<dd>
<div class="paragraph"><p>Merged code for AMD64 backend (Mike Rainey&#8217;s work).
Everything is hooked up but untested.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_59_2006_05_17">Version 110.59; 2006/05/17</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/05/17]
</dt>
<dd>
<div class="paragraph"><p>I am freezing 110.59.  Changes other than the version-number increase:</p></div>
<div class="openblock">
<div class="content">
<div class="dlist"><dl>
<dt class="hdlist1">
eXene
</dt>
<dd>
<div class="paragraph"><p>committed changes to eXene from Alley Stoughton:
"fixed bugs in X authorization and resource handling, as well
 as in the pile and viewport widgets"</p></div>
</dd>
<dt class="hdlist1">
Runtime
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>fixed linking problem with *NetBSD 3.x*.</pre>
</div></div>
</dd>
<dt class="hdlist1">
Lexgen
</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
<strong>lexgen</strong> tool handles non-ascii characters in 7-bit mode the same
      way that <strong>ml-lex</strong> does
</p>
</li>
<li>
<p>
lexgen propagates exceptions the same way that <strong>ml-lex</strong> does
</p>
</li>
</ul></div>
</div></div>
</dd>
<dt class="hdlist1">
CML
</dt>
<dd>
<div class="paragraph"><p>Fixed a bug in the <span class="monospaced">SyncVar</span> polling functions (<span class="monospaced">iGetPoll</span>,
<span class="monospaced">mTakePoll</span>, and <span class="monospaced">mGetPoll</span>) that could lead to livelock.</p></div>
</dd>
</dl></div>
</div></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/05/12]
</dt>
<dd>
<div class="paragraph"><p>Implemented <strong>ml-makedepend</strong> (<em>i.e.</em>, CM.sources) in a better (more robust)
way.  This should hopefully fix the <strong>ml-makedepend</strong> problem permanently.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/05/12]
</dt>
<dd>
<div class="paragraph"><p>Fixed long-standing bug with <strong>ml-makedepend</strong> where it would output a
spurious dependency to a non-existing file.  (This is a simple fix.
It might need further looking into.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/04/20]
</dt>
<dd>
<div class="paragraph"><p>Committed patches received from Johannes 5 Joemann (<a href="mailto:joemann@befree.free.de">joemann@befree.free.de</a>)
that enable <strong>heap2exec</strong> under <span class="monospaced">Linux</span> and <span class="monospaced">FreeBSD</span>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/04/14]
</dt>
<dd>
<div class="paragraph"><p>MLRISC changes:</p></div>
<div class="openblock">
<div class="content">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
renamed <span class="monospaced">GAS_PSEUDO_OPS</span> to <span class="monospaced">AS_PSEUDO_OPS</span> and put it in its own file.
</p>
</li>
<li>
<p>
added support for <span class="monospaced">NOTB</span> and <span class="monospaced">XORB</span> operators in pseudo-op expressions
</p>
</li>
<li>
<p>
added <span class="monospaced">DarwinPseudoOp</span> functor that supports Darwin&#8217;s assembler syntax.
</p>
</li>
<li>
<p>
added support for 64-bit integer literals
</p>
</li>
</ol></div>
</div></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_58_2006_03_03">Version 110.58; 2006/03/03</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/03/01]
</dt>
<dd>
<div class="paragraph"><p>Incorporated several bugfixes to <strong>lexgen</strong>.  Compiler now compiles to
fixpoint when using lexgen instead of <strong>ml-lex</strong>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/02/28]
</dt>
<dd>
<div class="paragraph"><p>Removed <strong>ml-flex</strong> and added <strong>lexgen</strong> instead, using Aaron Turon&#8217;s newly
provided tarball.  The generated lexers still have problems.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/02/26]
</dt>
<dd>
<div class="paragraph"><p>Removed <strong>ml-flex</strong>'s dependency on <strong>regexp-lib.cm</strong>.  Turned installation
of <strong>ml-flex</strong> on by default.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/02/24]
</dt>
<dd>
<div class="paragraph"><p>Added <strong>ml-flex</strong> sources.  Partially integrated, but should not be
turned on yet!  (Read: leave it commented-out in <span class="monospaced">config/targets</span>!)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/02/23]
</dt>
<dd>
<div class="paragraph"><p>Changes to support building on <strong>x86-64</strong> systems (using the 32-bit mode).
Also cleaned up signal handling on <strong>Linux</strong>.  Support for pre-2.2 <strong>Linux</strong>
kernels dropped.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/02/22]
</dt>
<dd>
<div class="paragraph"><p><strong>CM</strong> has changed.  Updated the script for rebuilding the <strong>MLRISC</strong> generated
files.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/02/14]
</dt>
<dd>
<div class="paragraph"><p>Hooked code for Darwin-specific Intel ABI into main compiler.
(This is a temporary solution which relies on the fact that the
compiler itself does not use NLFFI.  Eventually we need to divorce
intel mac from generic x86 unix code and make separate sets of binaries.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/02/13]
</dt>
<dd>
<div class="paragraph"><p>Changed <strong>MLRISC</strong> x86 <span class="monospaced">CCalls</span> for partial support of <strong>Mac OS X</strong> ABI.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2006/02/06]
</dt>
<dd>
<div class="paragraph"><p>Changes to support <strong>Mac OS X</strong> on Intel hardware.  The C-calls support in
MLRISC must also be updated to support the <strong>Mac OS X</strong> ABI.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/12/16]
</dt>
<dd>
<div class="paragraph"><p>Improved error reporting and handling in <strong>CM</strong>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/11/21]
</dt>
<dd>
<div class="paragraph"><p>Enabling <span class="monospaced">$/html-lib.cm</span> in <span class="monospaced">config/preloads</span> did not work.  This is fixed
now.  (Since the anchor mapping for <span class="monospaced">html-lib.cm</span> is not yet in effect
at the time when <span class="monospaced">config/preloads</span> is processed, the library has to
be referred to by another name.  In 110.57 this would be
<span class="monospaced">$SMLNJ-LIB/HTML/html-lib.cm</span>.  I arranged for <span class="monospaced">$smlnj/smlnj-lib/html-lib.cm</span>
to be valid as well.)</p></div>
<div class="paragraph"><p>Thanks to Todd Wilson (Fresno) for alerting me to this issue.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_57_2005_11_19">Version 110.57; 2005/11/19</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/11/19]
</dt>
<dd>
<div class="paragraph"><p>Fixed a problem in <span class="monospaced">config/install.sh</span> where it tries to "fish" the
name of the <strong>CM</strong> metadata directory from the wrong place (because
the physical location of <span class="monospaced">basis.cm</span> has changed).  Also, corrected the
path anchor for <span class="monospaced">$/html-lib.cm</span>.  (Thanks to M. Fluet for pointing out
these problems.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_57_2005_11_16">Version 110.57; 2005/11/16</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/11/16]
</dt>
<dd>
<div class="paragraph"><p>Fixed problem with bogus exception message when using back-trace
facility.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/11/15]
</dt>
<dd>
<div class="paragraph"><p>Added simple implementation of <span class="monospaced">Array2.copy</span>.  (Warning: mostly untested.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/11/15]
</dt>
<dd>
<div class="paragraph"><p>Reversed change to <span class="monospaced">src/system/smlnj/internals/versiontool.cm</span>.  This
file gets loaded as a tool&#8201;&#8212;&#8201;by the equivalent of CM.make during the
run of <span class="monospaced">CMB.make</span>.  Thus, CMB&#8217;s path configuration is meaningless for
it.  Instead, it has the status of "user code", so it should use
<span class="monospaced">$/basis.cm</span> to refer to the Basis library.  (At least that&#8217;s true for
the purpose of bootstrapping the previous change.  In the future it
might make sense to have <span class="monospaced">versiontool.cm</span> refer to
<span class="monospaced">$smlnj/basis/basis.cm</span>, <em>i.e.</em>, the version of the Basis that the
compiler itself uses.)</p></div>
<div class="paragraph"><p>Also patched <span class="monospaced">src/system/testml</span> to have it activate those extra anchor
bindings in <span class="monospaced">config/extrapathconfig</span>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/11/15]
</dt>
<dd>
<div class="paragraph"><p>This change affects the way the following libraries are tied into
the system:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>   $/basis.cm
   $/smlnj-lib.cm
   $/pp-lib.cm
   $/controls-lib.cm
   $/html-lib.cm
   $/ml-yacc-lib.cm</pre>
</div></div>
<div class="paragraph"><p>These libraries are now internally (as seen from the source code
of the implementation itself) known by the following names:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>   $smlnj/basis/basis.cm
   $smlnj/smlnj-lib/smlnj-lib.cm
   $smlnj/smlnj-lib/pp-lib.cm
   $smlnj/smlnj-lib/controls-lib.cm
   $smlnj/smlnj-lib/html-lib.cm
   $smlnj/ml-yacc/ml-yacc-lib.cm</pre>
</div></div>
<div class="paragraph"><p>This makes it possible to work with code that requires different
versions of these libraries, and which refers to these libraries using
their "default" names (<em>i.e.</em>, the first set of names above).  In other
words, one can un-define or re-define those default names without
compromising the proper functioning of the compiler itself.</p></div>
<div class="paragraph"><p>A similar procedure had already been performed for several of the
<strong>MLRISC</strong> libraries that are linked into the compiler.  I did some
cleanup on this code.</p></div>
<div class="paragraph"><p>A new file in the config directory (named extrapathconfig) is
responsible for setting up path anchors that the compiler itself does
not need, but that are typically required by user code.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/11/07]
</dt>
<dd>
<div class="paragraph"><p>Fixed erroneous out-of-bounds test in the "<span class="monospaced">update</span>" function of
various *<span class="monospaced">ArraySlice</span> modules.  (Thanks to Vesa A. Norrman for pointing
out the problem.)</p></div>
<div class="paragraph"><p>Pushed some Basis changes through ML-Lex, CML, and eXene.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/11/07]
</dt>
<dd>
<div class="paragraph"><p>Fixed a Basis incompatibility: The depreciated function <span class="monospaced">Substring.all</span>
was removed (use <span class="monospaced">Substring.full</span> instead).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/11/05]
</dt>
<dd>
<div class="paragraph"><p>Tweaked interval set API in SML/NJ library; see the CHANGES file for details.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/11/02]
</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
Runtime system bootstrap code now accepts hex digits in BOOTLIST
  in either upper case or lower case format.
</p>
</li>
<li>
<p>
Pushed changes to names of <span class="monospaced">Pack</span>&lt;<em>N</em>&gt;{<span class="monospaced">Big</span>,<span class="monospaced">Little</span>}
  structures through
  CML and eXene.
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/11/02]
</dt>
<dd>
<div class="paragraph"><p>Fixed a Basis incompatibility: <span class="monospaced">Pack</span>&lt;<em>N</em>&gt;{<span class="monospaced">Big</span>,<span class="monospaced">Little</span>}
structures should be named <span class="monospaced">PackWord</span>&lt;<em>N</em>&gt;{<span class="monospaced">Big</span>,<span class="monospaced">Little</span>}.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/10/28]
</dt>
<dd>
<div class="paragraph"><p>Fixed a minor Basis incompatibility: hex digits should be upper case.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_56_2005_10_25">Version 110.56; 2005/10/25</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/10/25]
</dt>
<dd>
<div class="paragraph"><p>Added interval sets to utility library (signatures <span class="monospaced">INTERVAL_DOMAIN</span>
and <span class="monospaced">INTERVAL_SET</span>, and functor <span class="monospaced">IntervalSetFn</span>).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/10/14]
</dt>
<dd>
<div class="paragraph"><p>Add Zhong Shao&#8217;s fix for datatype equality functions.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/10/14]
</dt>
<dd>
<div class="paragraph"><p>Bug fix a bug found by Carl Hauser.
There was a typo in the reload code for <span class="monospaced">FCMP</span> in <span class="monospaced">x86SpillInstr.sml</span>.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/10/14]
</dt>
<dd>
<div class="paragraph"><p>Removed some debugging code in file <span class="monospaced">x86Asm.sml</span>.
The function emit_operand was printing out debugging output.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/07/27]
</dt>
<dd>
<div class="paragraph"><p>Fixed <strong>ml-lex</strong> to recognize "<span class="monospaced">\r</span>" as representing carriage return.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/07/27]
</dt>
<dd>
<div class="paragraph"><p>Fixed <strong>ml-yacc</strong> to work on files with non-native end-of-line
encodings (<em>e.g.</em>, Windows text file on a Unix system).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/07/20]
</dt>
<dd>
<div class="paragraph"><p>Added changes from Dominic Evans (oldmanuk (at) gmail (dot) com)
to support <strong>HPUX 11</strong>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/07/06]
</dt>
<dd>
<div class="paragraph"><p>Changes to the <strong>SML/NJ Library</strong>.  See smlnj-lib/CHANGES for details.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/07/06]
</dt>
<dd>
<div class="paragraph"><p>Fixed reversed logic for deciding whether to "copy up" or "copy down"
in *<span class="monospaced">-array-slice.sml</span>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/05/31]
</dt>
<dd>
<div class="paragraph"><p>A typo in the Cygwin code fixed.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/05/31]
</dt>
<dd>
<div class="paragraph"><p>Updated Cygwin&#8217;s fault/signal handling to match the Windows version.
Updated the export list.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_54_2005_05_18">Version 110.54; 2005/05/18</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/05/18]
</dt>
<dd>
<div class="paragraph"><p>Added support scripts for <strong>Mac OS X PackageMaker</strong> and modified
<span class="monospaced">config/install.sh</span> so that it supports re-dumping a heap image
after customization.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/05/18]
</dt>
<dd>
<div class="paragraph"><p>Un-overloaded / to work around bug in overloading resolution code.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/05/16]
</dt>
<dd>
<div class="paragraph"><p>Added mechanism for re-creating a heap file for the interactive system
after configuration variables have been changed.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>   <span class="nn">CM</span><span class="p">.</span><span class="n">redump_heap</span> <span class="p">:</span> <span class="n">string</span> <span class="p">-&gt;</span> <span class="n">unit</span>
</pre></div></div></div>
<div class="paragraph"><p>This is much like <span class="monospaced">SMLofNJ.exportML</span>, but starting from the resulting
heap does not return to the caller of <span class="monospaced">CM.redump_heap</span> but
restarts the interactive system from scratch.  The original call of
<span class="monospaced">CM.redump_heap</span> does not return but ends the interactive session.
Thus, <span class="monospaced">CM.redump_heap</span> is a lot like <span class="monospaced">SMLofNJ.exportFn</span>.</p></div>
<div class="paragraph"><p>Internally, <span class="monospaced">redump_heap</span> winds the dynamic execution context back to
the point where the original heap image was created and re-executes
the heap image generation code in the boot code.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/05/09]
</dt>
<dd>
<div class="paragraph"><p>Added a hack to the existing hack known as <span class="monospaced">Word64</span> to make <span class="monospaced">fromString</span>
behave correctly.  I am still not sure whether <span class="monospaced">Word64.scan</span> will work
as specified with respect to the interaction of radix and prefix.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/05/04]
</dt>
<dd>
<div class="paragraph"><p>Added a gc protocol checking phase.  This phase is enabled with
the flag "check-gc".  "debug-check-gc" turns on the verbose mode.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/05/04]
</dt>
<dd>
<div class="paragraph"><p>Fixed a bug in the implementation of <span class="monospaced">div</span> and <span class="monospaced">mod</span> for <span class="monospaced">IntInf</span>.
Thanks to Neophytos Michael for reporting the problem.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/05/04]
</dt>
<dd>
<div class="paragraph"><p>Added the <span class="monospaced">join</span> combinator to the <span class="monospaced">ParserComb</span> module in the
<strong>SML/NJ Library</strong>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/02/28]
</dt>
<dd>
<div class="paragraph"><p>Fixed serious bug (brown paper bag variety) in new implementation of
structure <span class="monospaced">Atom</span> in <strong>CML</strong>.  (I had accidentally used a <span class="monospaced">mailbox</span> instead of
an <span class="monospaced">mvar</span>, leaving the door open for races.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_53_2005_02_25">Version 110.53; 2005/02/25</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/02/25]
</dt>
<dd>
<div class="paragraph"><p>Brought back <span class="monospaced">SMLofNJ.Susp</span>.  The underlying suspension type is the one
implemented in Core, which means that it is the same as the one used
by the lazy extension.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/02/24]
</dt>
<dd>
<div class="paragraph"><p>Simpler and at the same time more general implementation of structure
<span class="monospaced">Atom</span> in <strong>CML</strong>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/02/15]
</dt>
<dd>
<div class="paragraph"><p>Created new "<span class="monospaced">tools</span>" directory under "<span class="monospaced">src</span>" and moved "<span class="monospaced">TraceDebugProf</span>"
there.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/02/10]
</dt>
<dd>
<div class="paragraph"><p>Implemented "<span class="monospaced">long long</span>" arguments and results for NLFFI.  (Only the
PPC/MacOS implementation is complete, the other backends still need to
be updated.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/01/24]
</dt>
<dd>
<div class="paragraph"><p>Minor cleanup in ML-Yacc rule printing mechanism.  This should fix a
problem with certain "as" patterns which previously got rendered
using incorrect syntax.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/01/18]
</dt>
<dd>
<div class="paragraph"><p>Made time profiling code (interrupt handler) in runtime system aware
of new array representation.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/01/14]
</dt>
<dd>
<div class="paragraph"><p>Implemented new (but still experimental) <strong>heap2exec</strong> facility.  This is
tested under Mac OS X and should work under Linux (will test shortly).
It will probably also work on the Sparc (will test some time later).
Also removed old "<span class="monospaced">HACKED_STANDALONE</span>" hack from runtime</p></div>
<div class="paragraph"><p>To be able to test <strong>heap2exec</strong>, uncomment the request for "<span class="monospaced">heap2asm</span>" in
config/targets prior to installation.  (Notice that this is different
from "heap2exec" mentioned below.  Not a typo.)</p></div>
<div class="paragraph"><p>To perform an actual test, run the command</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>$ bin/heap2exec heapfile execfile</pre>
</div></div>
<div class="paragraph"><p>(You can put <strong>heap2exec</strong> on your shell&#8217;s path.)</p></div>
<div class="paragraph"><p>For example, run</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>$ bin/heap2exec bin/.heap/ml-yacc.ppc-darwin mly</pre>
</div></div>
<div class="paragraph"><p>This will create a standalone executable called "<span class="monospaced">mly</span>" that you can
then invoke directly as a command.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2005/01/07]
</dt>
<dd>
<div class="paragraph"><p>fixed off-by-one error in <span class="monospaced">ML_STRING</span> macro (<span class="monospaced">globals.c</span>)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/12/23]
</dt>
<dd>
<div class="paragraph"><p>Made <strong>ml-build</strong> script "smarter" (but only very little).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/12/21]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
Implemented access to signed and unsigned long long data in <strong>NLFFI</strong>.
(The parameter-passing part of the picture has not complete. But
data structure access seems to work.)
</p>
</li>
<li>
<p>
Fixed <strong>CM</strong>'s incorrect assumption that the PPC is little-endian.
  (On the Mac, it is big-endian.  And that&#8217;s currently our only
  <strong>PPC</strong> platform.)
</p>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/12/21]
</dt>
<dd>
<div class="paragraph"><p>Some cleanup in the <span class="monospaced">$c/memory.cm</span> library: separated some concerns by
moving allocation code and memory access code each into their own
files.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/12/17]
</dt>
<dd>
<div class="paragraph"><p>The Unix I/O library of SML/NJ on Cygwin does not understand
Windows style pathname, so problems arise when <span class="monospaced">SMLNJ_HOME</span> is set
to a Windows style pathname.  The _run-sml script now
converts <span class="monospaced">SMLNJ_HOME</span> to a POSIX pathname on Cygwin.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/12/16]
</dt>
<dd>
<div class="paragraph"><p>Last-minute changes incorporated into 110.52.  Release tag moved.</p></div>
<div class="paragraph"><p>The changes:
   - <span class="monospaced">HashString.hashString'</span> &#8594; <span class="monospaced">HashString.hashSubstring</span>
   - bug fix in <span class="monospaced">UnivariateStats</span></p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/12/15]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
+HashString.hashString' &#8594; HashString.hashSubstring
</p>
</li>
<li>
<p>
corresponding changes in <span class="monospaced">atom.sml</span>
</p>
</li>
<li>
<p>
"de-compressed" (aka. un-obfuscated) code for <span class="monospaced">UnivariateStats</span> and
  added some comments
</p>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_52_2004_12_15">Version 110.52; 2004/12/15</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/12/15]
</dt>
<dd>
<div class="paragraph"><p>More on the space problem (this time for <strong>Win32</strong>).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/12/14]
</dt>
<dd>
<div class="paragraph"><p>Hacked some of the scripts (in particular: the installer) to cope with
spaces in filenames a bit better.  But beware: the current "solution"
is likely still full of bugs and inherently incomplete.  (We need to
do away with those shell scripts for a comprehensive solution.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/12/13]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug in code for <strong>ml-makedepend</strong>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/12/09]
</dt>
<dd>
<div class="paragraph"><p>Added two simple but potentially useful statistics modules to SML/NJ Library.
(See CHANGES file there.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/12/01]
</dt>
<dd>
<div class="paragraph"><p>Updates to <strong>SML/NJ Library</strong></p></div>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
Added function <span class="monospaced">HashString.hashString'</span> for substrings.
</p>
</li>
<li>
<p>
Hand-inlined <span class="monospaced">CharVector.foldl</span> into <span class="monospaced">HashString</span> (for speed).
</p>
</li>
<li>
<p>
Modified implementation of structure <span class="monospaced">Atom</span> to avoid extracting
    strings from substrings unless necessary.
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p>(Also see CHANGES file for smlnj-lib.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/11/24]
</dt>
<dd>
<div class="paragraph"><p>Made sure <strong>CML</strong> compiles when the <span class="monospaced">Position</span> structure is <span class="monospaced">Int64</span>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/11/24]
</dt>
<dd>
<div class="paragraph"><p>The compiler can now be compiled in a mode that makes structure <span class="monospaced">Position</span>
equal to <span class="monospaced">Int64</span>.  The default, however, is unchanged (<span class="monospaced">Position</span> is <span class="monospaced">Int31</span>)
for the time being.</p></div>
<div class="paragraph"><p>To enable 64-bit positions, use the following procedure:</p></div>
<div class="openblock">
<div class="content">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Start sml
</p>
</li>
<li>
<p>
Autoload $smlnj/cmb.cm (if not already autoloaded)
</p>
</li>
<li>
<p>
Type
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="nl">#set</span> <span class="p">(</span><span class="nn">CMB</span><span class="p">.</span><span class="n">symval</span> <span class="s2">&quot;USE_64_BIT_POSITIONS&quot;</span><span class="p">)</span> <span class="p">(</span><span class="n">SOME</span> <span class="mi">1</span><span class="p">);</span>
</pre></div></div></div>
</li>
<li>
<p>
Run <span class="monospaced">CMB.make()</span> as usual.
</p>
</li>
</ol></div>
</div></div>
<div class="paragraph"><p>This is barely tested.  The only test so far was a little SML program
counting the number of characters in an 8-gigabyte file by
reading it character-by-character.  That test was successful.</p></div>
<div class="paragraph"><p>In support of 64-bit positions, a number of new functions have been
added to the runtime system.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/11/23]
</dt>
<dd>
<div class="paragraph"><p>Fixed a problem with unhelpful error messages related to problems with
<span class="monospaced">.cm</span> or <span class="monospaced">.sml</span> files that appear as part of the <strong>sml</strong> command line.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_51_2004_11_18">Version 110.51; 2004/11/18</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/11/18]
</dt>
<dd>
<div class="paragraph"><p>Enabled <span class="monospaced">dlopen</span> and friends for <strong>FreeBSD</strong> (as recommended by Johannes 5
Joemann).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/11/17]
</dt>
<dd>
<div class="paragraph"><p>Added support for <span class="monospaced">MLTree</span> constructs <span class="monospaced">LIVE</span> and <span class="monospaced">KILL</span>
to all the architectures.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/11/13]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
Stripped down the <span class="monospaced">versiontool:</span> It now only handles the version number.
  The date string is generated at bootstrap time (during makeml).
</p>
</li>
<li>
<p>
In a previous commit, fixed a minor issue with how polyequal is being
  translated.  In particular, the code now "looks through" abstractions.
  This results in slightly fewer polyEqual warnings and hopefully slightly
  more efficient code.  Important examples for where this matters are
  the new <span class="monospaced">int64</span> and <span class="monospaced">word64</span> types.
</p>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/11/12]
</dt>
<dd>
<div class="paragraph"><p>Structure <span class="monospaced">Int64</span> fully hooked in.  (The implementation is not very
efficient, though.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/11/11]
</dt>
<dd>
<div class="paragraph"><p>All the pieces of <span class="monospaced">Word64</span> are now there, with the exception of the
conversions from and to <span class="monospaced">LargeWord</span>. (Eventually these need to be identities,
but for the time being they don&#8217;t even make sense because <span class="monospaced">LargeWord</span> is
32-bit wide.)</p></div>
<div class="paragraph"><p>Also started to add similar support for <span class="monospaced">Int64</span>, but major pieces of that
are still missing.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/11/11]
</dt>
<dd>
<div class="paragraph"><p>Structure <span class="monospaced">Word64</span> is now (almost) complete, word literals and patterns
seem to work.  There are a few odd pieces missing.  In particular,
I didn&#8217;t do the {<span class="monospaced">from</span>,<span class="monospaced">to</span>}<span class="monospaced">LargeWord</span> parts because <span class="monospaced">LargeWord</span>
is still <span class="monospaced">Word32</span> at the moment.</p></div>
<div class="paragraph"><p>Making <span class="monospaced">Word64</span> official would mean that <span class="monospaced">LargeWord</span> becomes <span class="monospaced">Word64</span>.  But
this requires extreme care because most word-word conversions have to
go through <span class="monospaced">LargeWord</span>, so making a mistake means loss of efficiency or
worse.  Eventually there will be a solution similar to (but actually
simpler than) what I did with <span class="monospaced">IntInf</span>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/11/10]
</dt>
<dd>
<div class="paragraph"><p>More 64-bit hacking (but still not even half-way there yet).
Also, some assorted improvements to the handling of 8-bit words.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/11/09]
</dt>
<dd>
<div class="paragraph"><p>Started adding some infrastructure for supporting 64-bit int- and
word-types.  (Still in its very early stages.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_50_2004_10_28">Version 110.50; 2004/10/28</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/10/28]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
Changend config/srcarchiveurl from a file just
    containing the URL string into a file containing
    shell script code.  The code has access to the $VERSION variable.
</p>
</li>
<li>
<p>
Made corresponding changes to config/install.sh and config/unpack.
</p>
</li>
<li>
<p>
Default contents of config/srcarchiveurl uses $VERSION and
    normally does not have to be edited to reflect a version change.
</p>
<div class="paragraph"><p>(As a result, a version change can be done by just editing
<span class="monospaced">config/version</span>, the rest is now automatic.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/10/27]
</dt>
<dd>
<div class="paragraph"><p>BackTrace.monitor now also reports the source of the exception that
triggered the trace.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/10/27]
</dt>
<dd>
<div class="paragraph"><p>This is the HISTORY entry for two earlier commits, both concerning
the <strong>x86</strong> c-calls code in <strong>MLRISC</strong>:</p></div>
<div class="ulist"><ul>
<li>
<p>
added a missing LOAD in the code that deals with struct arguments
</p>
</li>
<li>
<p>
made sure the caller does not add the wrong number of bytes to the
    stack pointer after a call of a function returning a struct
    (the callee already pops the implicit argument which points to
     the space reserved for the result)
</p>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/10/24]
</dt>
<dd>
<div class="paragraph"><p>John discovered a bug in the syntax of <span class="monospaced">fucomip</span>.
The opcodes <span class="monospaced">FU</span>?<span class="monospaced">COMIP</span>? have been changed to</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>fu?comip? %st(i), %st</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/10/20]
</dt>
<dd>
<div class="paragraph"><p>Added a mechanism for getting back-trace information from standalone
programs.  Here is how it works:</p></div>
<div class="openblock">
<div class="content">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
The part of the program from which you want to get backtrace
  information (usually the whole program) should be wrapped with
  BackTrace.monitor.  This is a <span class="monospaced">(unit&#8594;'a)&#8594;'a</span> function, and your
  main program could be modified from something like
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kr">fun</span> <span class="nf">main</span> <span class="p">(</span><span class="n">pgm</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="p">=</span> <span class="p">...</span>
</pre></div></div></div>
<div class="paragraph"><p>to</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kr">fun</span> <span class="nf">main</span> <span class="p">(</span><span class="n">pgm</span><span class="p">,</span> <span class="n">args</span><span class="p">)</span> <span class="p">=</span> <span class="nn">BackTrace</span><span class="p">.</span><span class="n">monitor</span> <span class="p">(</span><span class="kr">fn</span> <span class="p">()</span> <span class="p">=&gt;</span> <span class="p">...)</span>
</pre></div></div></div>
</li>
<li>
<p>
To be able to access <span class="monospaced">BackTrace.monitor</span>, you have to add the
  library <span class="monospaced">$smlnj-tdp/plugins.cm</span> to the <span class="monospaced">.cm</span> file that contains your
  main function.
</p>
</li>
<li>
<p>
Remove all compiled code (<em>i.e.</em>, all the .cm/ subdirectories that
  <strong>CM</strong> might have created in the past for your project).
</p>
</li>
<li>
<p>
Build the system using this command line:
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>ml-build -Ctdp.instrument<span class="o">=</span><span class="nb">true</span> <span class="se">\$</span>smlnj-tdp/back-trace.cm myprog.cm MyProg.main myprog
</pre></div></div></div>
<div class="paragraph"><p>instead of the usual</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>ml-build myprog.cm MyProg.main myprog
</pre></div></div></div>
</li>
</ol></div>
</div></div>
<div class="paragraph"><p>I changed the library name <span class="monospaced">$/trace-debug-profile.cm</span> to <span class="monospaced">$smlnj-tdp/plugins.cm</span>,
and added the following new libraries:</p></div>
<div class="openblock">
<div class="content">
<div class="dlist"><dl>
<dt class="hdlist1">
<span class="monospaced">$smlnj-tdp/back-trace.cm</span>
</dt>
<dd>
<div class="paragraph"><p>when loaded causes the back-trace plugin to be installed</p></div>
</dd>
<dt class="hdlist1">
<span class="monospaced">$smlnj-tdp/coverage.cm</span>
</dt>
<dd>
<div class="paragraph"><p>when loaded causes the coverage plugin to be installed</p></div>
</dd>
</dl></div>
</div></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/10/18]
</dt>
<dd>
<div class="paragraph"><p>Added an "obsolete" warning for the "group owner" syntax to <strong>CM</strong>'s parser.</p></div>
<div class="paragraph"><p>Eliminated group owner specs from <span class="monospaced">.cm</span> files throughout the source tree.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/10/15]
</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
Test coverage tool added!
</p>
</li>
<li>
<p>
Further reorganization of tracing-, debugging-, and profiling support:
</p>
<div class="ulist"><ul>
<li>
<p>
moved original BTImp&#8201;&#8212;&#8201;now called BackTrace&#8201;&#8212;&#8201;into a separate
      library called $/trace-debug-profile.cm
</p>
</li>
<li>
<p>
eliminated all mentions of BTrace from SMLofNJ.Internals
</p>
</li>
<li>
<p>
only the instrumentation mechanism is now left in the compiler proper
</p>
</li>
<li>
<p>
BackTrace module is a plugin which is NOT plugged in by default
</p>
</li>
<li>
<p>
Coverage module is another such plugin
</p>
</li>
</ul></div>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p>To get the benefits of any of these plugin modules, the code in
question must be compiled with TDP instrumentation turned on.  This
can be done by setting <span class="monospaced">SMLofNJ.Internals.TDP.mode</span> to <span class="monospaced">true</span>.
(The ref cell is also controlled via the <span class="monospaced">-Ctdp.instrument=&#8230;</span> switch.)</p></div>
<div class="paragraph"><p>Plugins are selected at link time.  (Pre-compiled instrumented code
can be re-loaded with different plugins in effect.)  When an
instrumented module is linked, whatever plugins are at that time
enabled will come into effect for that module.</p></div>
<div class="paragraph"><p>To enable the back-trace plugin, load library <span class="monospaced">$/trace-debug-profile.cm</span>
and invoke <span class="monospaced">BackTrace.install()</span> (<em>e.g.</em>, from the interactive prompt).
To enable the coverage plugin, load the same library and invoke
<span class="monospaced">Coverage.install()</span>.</p></div>
<div class="paragraph"><p>Back-traces are generated automatically on uncaught exceptions and
when the code in question explicitly invokes <span class="monospaced">BackTrace.trigger()</span>.</p></div>
<div class="paragraph"><p>Coverage (and execution frequency-) information must be queried
explicitly by calling <span class="monospaced">Coverage.not_covered</span> and <span class="monospaced">Coverage.hot_spots</span>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/10/14]
</dt>
<dd>
<div class="paragraph"><p>Snapshot of a significant overhaul of how the <span class="monospaced">trace/debug/profile</span> support
is hooked into the system (specifically: <span class="monospaced">Core</span> and <span class="monospaced">SMLofNJ.Internals</span>).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/10/13]
</dt>
<dd>
<div class="paragraph"><p>Some rationalization of names:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>structure BTrace -&gt; structure TDPInstrument
etc.</pre>
</div></div>
<div class="paragraph"><p>This is is preparation of using the original back-trace
instrumentation for other purposes.  "TDP" stands for
Trace/Debug/Profile.</p></div>
<div class="paragraph"><p>The control flag controlling whether instrumentation is on or off is now
registered under a different name, so instead of running sml as</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>sml -Cinstrument.btrace-mode=true</pre>
</div></div>
<div class="paragraph"><p>one has to say</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>sml -Ctdp.instrument=true</pre>
</div></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/10/11]
</dt>
<dd>
<div class="paragraph"><p>Made some minor modifications to elabcore.sml to have source regions
be propagated more tightly&#8201;&#8212;&#8201;resulting in better (<em>i.e.</em>, smaller)
regions being reported in error- and debug messages.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/10/08]
</dt>
<dd>
<div class="paragraph"><p>Fixed handling of keywords in .cm files: After seeing "is" the lexer
treats subsequent occurrences of "group", "library", "source", "is",
"*", and "-" as ordinary identifiers rather than keywords.</p></div>
<div class="paragraph"><p>Most seriously, this fixes a problem with CM&#8217;s "shell" tool.  The tool
is supposed to accept a tool argument called "source", but this did
not work because of the clash with the keyword.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/10/07]
</dt>
<dd>
<div class="paragraph"><p>Assorted cleanup work:</p></div>
<div class="ulist"><ul>
<li>
<p>
got rid of intstrmap in favor of using the library&#8217;s
    hash table implementation
</p>
</li>
<li>
<p>
threw out most of the pathnames stuff, as it was not used anyway
</p>
</li>
<li>
<p>
simplified tokentable implementation
</p>
</li>
<li>
<p>
fixed some minor spelling errors
</p>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/10/06]
</dt>
<dd>
<div class="paragraph"><p>Cleaned up the absyn to reflect the invariant that HANDLE always
carries a FNexp as part of the type definition.  This eliminates some
superfluous sanity checks at runtime down the road.</p></div>
<div class="paragraph"><p>Some minor cleanup of the btrace code.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/10/01]
</dt>
<dd>
<div class="paragraph"><p>Added hack to make slave mode work in the presence of the version
tool.  (Still, since the master does two passes over the code for
CMB.make, the release number gets bumped twice when slaves are
attached.  I don&#8217;t know if this is worth fixing&#8230;)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/09/30]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
Moved the "version" magic into its own little library under
  src/system/smlnj/internal.  This avoids expensive reconstruction of
  a stable src/compiler/core.cm.
</p>
</li>
<li>
<p>
At the same time, structure CompilerVersion is now known as
  structure SMLNJVersion.
</p>
</li>
<li>
<p>
Arranged for the version tool to NOT kick in when rebuilding the system
  (makeml -rebuild, fixpt).  Otherwise one would never reach a fixpoint.
  Also, loading the versiontool does not work when rebuilding the system
  because CM is not properly initialized at that time.
</p>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/09/29]
</dt>
<dd>
<div class="paragraph"><p>Implemented some CM magic to have
    file src/compiler/TopLevel/main/version.sml
generated automagically.
The version is taken from two files: config/version and config/release.
The first is expected to contain a two-part version number such as 110.49.
The second should contain a single number, but it may be missing.</p></div>
<div class="paragraph"><p>If the environment variable VERSIONTOOL_BUMP_RELEASE is defined at the
time the version tool is loaded (which is the first time you say CMB.make),
then the tool will increment the value stored in config/release every
time CMB.make is invoked.</p></div>
<div class="paragraph"><p>The binfile format is now insensitive to anything beyond the first
two components of a version number, so bumping the release does not render
binfiles incompatible.  Auto-bumping can be used to keep track of versions
during development without invalidating existing binfiles.</p></div>
<div class="paragraph"><p>In any case, every CMB.make updates the date information in version.sml.
(This is the date that is printed in the banner.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/09/28]
</dt>
<dd>
<div class="paragraph"><p>Some cleanup of the controls code.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/09/27]
</dt>
<dd>
<div class="paragraph"><p>Added two pieces of functionality to the Controls interface:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kr">val</span> <span class="nv">save&#39;restore</span><span class="p">:</span> <span class="nd">&#39;a</span> <span class="n">control</span> <span class="p">-&gt;</span> <span class="n">unit</span> <span class="p">-&gt;</span> <span class="n">unit</span>
</pre></div></div></div>
<div class="paragraph"><p>grabs the current value of the control in stage 1 and restores it
in stage 2.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre><span class="kr">val</span> <span class="nv">set&#39;</span> <span class="p">:</span> <span class="nd">&#39;a</span> <span class="n">control</span> <span class="n">*</span> <span class="nd">&#39;a</span> <span class="p">-&gt;</span> <span class="n">unit</span> <span class="p">-&gt;</span> <span class="n">unit</span>
</pre></div></div></div>
<div class="paragraph"><p>stores the given value into the control in stage 2 (<em>i.e.</em>, delayed)
but does all error checking in stage 1.
(This is for string controls that need to do parse their argument&#8201;&#8212;&#8201;something that might fail.  In some cases, notably in CM, one
already knows the intended argument but wants to delay the actual
assignment until a time when error recovery would be more difficult.)</p></div>
<div class="paragraph"><p>Also changed the handling of controls in tool arguments to classes "<span class="monospaced">sml</span>" and
"<span class="monospaced">lazysml</span>":</p></div>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
use <span class="monospaced">Controls.save&#8217;restore</span> as a more robust way of restoring the
     old value (in particular: without having to re-parse the string)
</p>
</li>
<li>
<p>
use controls to handle the "<span class="monospaced">overload</span>" keyword in the init group
     (I believe this change actually fixes a long-standing obscure bug.)
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/09/27]
</dt>
<dd>
<div class="paragraph"><p>Added a new tool class called "<span class="monospaced">lazysml</span>" to CM&#8217;s tool chest.  The only
difference to "<span class="monospaced">sml</span>" is that compilation is done with <span class="monospaced">Control.lazysml</span>
set to true.  A source of class "<span class="monospaced">lazysml</span>" is automatically recognized
by a file name suffix of "<span class="monospaced">.lml</span>".</p></div>
<div class="paragraph"><p>In addition to the above feature, the original class "<span class="monospaced">sml</span>" now also
supports a tool argument "<span class="monospaced">lazy</span>" which has the same effect.  As a
result, the following three lines are equivalent:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>    foo.sml : lazysml
    foo.sml : sml (lazy)
    foo.sml (lazy)</pre>
</div></div>
<div class="paragraph"><p>The setting goes into effect both during parsing and during
compilation.  The original setting is restored right after parsing and
after compilation, respectively.</p></div>
<div class="paragraph"><p>In addition to all the above, there is also a general mechanism to set
ANY of the "controls" that are available at the command line via
"<span class="monospaced">-C&#8230;</span>" on a per-sml-file basis.  The same rules that apply for "<span class="monospaced">lazy</span>"
apply as well. (In fact, "<span class="monospaced">lazy</span>" is implemented as a special case of
the general mechanism.)</p></div>
<div class="paragraph"><p>The <span class="monospaced">.cm</span> file syntax uses a new keyword tool argument called "<span class="monospaced">with</span>".
There are several ways of indicating the desired settings:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>    foo.sml (with:parser.quotations=true)
    foo.sml (with:(name:parser.quotations value:true))
    foo.sml (with:(name:name1 value:value1 name:name2 value:value2 ...))
    foo.sml (with:(name1=value1 name2=value2 ...))
    foo.sml (with:(name1=value1 name:name2 value:value2 name3=value3 ...))</pre>
</div></div>
<div class="paragraph"><p>Another possible abbreviation is to leave out the <span class="monospaced">=v</span> or <span class="monospaced">value:v</span> part
if the name refers to a boolean control (in which case the value is
taken to be true).  Thus, one could get lazy sml also by saying:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>    foo.sml (with:parser.lazy-keyword=true)
    foo.sml (with:parser.lazy-keyword)
    foo.sml (with:(name:parser.lazy-keyword value:true))
    foo.sml (with:(name:parser.lazy-keyword))</pre>
</div></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/09/24]
</dt>
<dd>
<div class="paragraph"><p>Turned message about "emiting long form of branch" off by default.
Added a control flag to turn it back on when desired.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/09/24]
</dt>
<dd>
<div class="paragraph"><p>Applied patch for setting rounding modes under <strong>Mac OS X</strong>.  Thanks to
Melissa O&#8217;Neill for providing the code!</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/09/23]
</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Changed definition of type <span class="monospaced">ControlRegistry.registry_tree</span> to
  include control_info (<em>i.e.</em>, the name of the controlling environment
  variable).
</p>
</li>
<li>
<p>
Added command-line flags <span class="monospaced">-e</span> and <span class="monospaced">-E</span> to print the names of
  environment variables that can be used to control internal settings.
  (This uses the new API mentioned in 1.)
</p>
</li>
</ol></div>
</div></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_49_2004_09_13">Version 110.49; 2004/09/13</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/09/13]
</dt>
<dd>
<div class="paragraph"><p>Put target "<span class="monospaced">mlrisc</span>" back into the default list.
(There is no harm in having it, and some users have expressed their
wish to have "<span class="monospaced">mlrisc</span>" included by default.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/09/13]
</dt>
<dd>
<div class="paragraph"><p>Fixed the signal masking code to properly nest mask/unmask operations
on a per-signal basis.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.cs.uchicago.edu/~jhr">John Reppy</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/09/08]
</dt>
<dd>
<div class="paragraph"><p>Bumped the heap magic number to <span class="monospaced">0x09082004</span> to account for the changed
layout of the ML frame under <strong>Mac OS X</strong>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/09/03]
</dt>
<dd>
<div class="paragraph"><p>Added a patch to _arch-n-opsys to enable the Cygwin runtime.
The Cygwin runtime is turned on by setting the environment
variable SMLNJ_CYGWIN_RUNTIME to 1.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/08/31]
</dt>
<dd>
<div class="paragraph"><p>Added some exports to src/compiler/core.cm upon request by J. Joemann.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/08/30]
</dt>
<dd>
<div class="paragraph"><p>Upon request by Johannes Joemann:</p></div>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
improved ML code of installer to fall back to coping when renaming
  fails (<em>i.e.</em>, when source and target are on different file systems);
  the code compiles but has yet to be tested in anger
</p>
</li>
<li>
<p>
removed <span class="monospaced">mlrisc</span> from list of default targets (<span class="monospaced">config/targets</span>)
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/08/27]
</dt>
<dd>
<div class="paragraph"><p>Added <span class="monospaced">ptreql</span> primop to structure <span class="monospaced">InlineT</span> (upon request from Larry
Paulson).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/08/15]
</dt>
<dd>
<div class="paragraph"><p>Another bug fix from Carl Hauser:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>diff /net/niflab/smlnj48/src/MLRISC/graphs/udgraph.sml udgraph.sml
&gt; 48c48
&gt; &lt;              | rmv((e as (k,_))::es,L) = rmv(es,if k = i then es else
&gt; e::L)
&gt; ---
&gt; &gt;              | rmv((e as (k,_))::es,L) = rmv(es,if k = i then L else e::L)</pre>
</div></div>
<div class="paragraph"><p>Without this, any deletion of an edge in an undirected graph does severe
violence to the graph.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/08/10]
</dt>
<dd>
<div class="paragraph"><p>The IBM/MacOS syntax switch on <strong>PPC</strong> was incorrectly swapped.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_48_2004_08_10">Version 110.48; 2004/08/10</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/08/09]
</dt>
<dd>
<div class="paragraph"><p>Bug fix from Carl Hauser:</p></div>
<div class="paragraph"><p><span class="monospaced">single_source_shortest_paths</span> in <span class="monospaced">dijkstra.sml</span> was observed to get wrong
answers (by comparing to <span class="monospaced">single_source_shortest_paths</span> in <span class="monospaced">bellman-ford.sml</span>).</p></div>
<div class="paragraph"><p>The problem is that following the expression <span class="monospaced">A.update(dist,s,Num.zero)</span>
it is necessary to update the priority queue using <span class="monospaced">Q.decreaseWeight(Q,s)</span>.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/08/06]
</dt>
<dd>
<div class="paragraph"><p>Fiddled with handling of command-line options:</p></div>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
<strong>sml</strong> now quits after processing the command line
    if <span class="monospaced">-H</span>, <span class="monospaced">-S</span>, <span class="monospaced">-h</span>&lt;<em>n</em>&gt;, or <span class="monospaced">-s</span>&lt;<em>n</em>&gt; appears as the last
    command-line argument
</p>
</li>
<li>
<p>
a new option <span class="monospaced">-q</span> terminates the session when encountered on
    the command line; subsequent arguments will be ignored
</p>
</li>
<li>
<p>
bug fixes: short (erroneous) arguments are no longer ignored
    completely
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/08/04]
</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
Added minimal IBM assembly syntax support for PowerPC.
</p>
</li>
<li>
<p>
Cygwin: manually changed the file <span class="monospaced">cygwin.def</span>.  Some exported symbols have
    been altered in the runtime.  We need an automatic way to keep the file
    in sync.
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_47_2004_08_04">Version 110.47; 2004/08/04</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/08/03]
</dt>
<dd>
<div class="paragraph"><p>Added low-level support for choosing C calling conventions by
twiddling the type of rawccall.  (See
<span class="monospaced">src/compiler/Semant/types/cproto.sml</span> for details.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/08/02]
</dt>
<dd>
<div class="paragraph"><p>Backed out of change to <span class="monospaced">win32-filesys.c</span>.  The earlier patch to
<span class="monospaced">get_file_time</span> caused <strong>CM</strong> to produce files with the wrong time stamp.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/08/02]
</dt>
<dd>
<div class="paragraph"><p>Added <strong>NLFFI</strong> support for <strong>Win32</strong>, adapted from a patch provided by David
Hansel.  This is currently completely untested.  Also, the issue
concerning stdcall vs. ccall is still unresolved.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/07/30]
</dt>
<dd>
<div class="paragraph"><p>Gearing up towards 110.47&#8230;</p></div>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
various minor bugfixes to ml-nlffigen
</p>
</li>
<li>
<p>
a beginning of a manual for nlffi
</p>
</li>
<li>
<p>
eliminated <em>export name=value</em> in config/install.sh as this does
  not work with certain versions of /bin/sh
  (Thanks to David King at Motorola for catching this.)
</p>
</li>
<li>
<p>
several bugfixes provided or suggested by David Hansel at Reactive Systems:
</p>
<div class="ulist"><ul>
<li>
<p>
added a test for <span class="monospaced">tm==NULL</span> to <span class="monospaced">gmtime.c</span> and <span class="monospaced">localtime.c</span>
</p>
</li>
<li>
<p>
applied patch for incorrect <span class="monospaced">GetFileTime</span> under <span class="monospaced">win32</span>
</p>
</li>
<li>
<p>
<span class="monospaced">toSeconds</span> &#8594; <span class="monospaced">toMilliseconds</span> in <span class="monospaced">Win32/win32-process.sml</span>
</p>
</li>
</ul></div>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/07/21]
</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
Fixed minor issue in <strong>ml-nlffigen</strong>: Now generate structure <span class="monospaced">T_foo</span>
  for a typedef to an incomplete type, but leave out the "<span class="monospaced">typ</span>" member.
  (This is just for consistency.)
</p>
</li>
<li>
<p>
Started to produce what is supposed to become better (<em>i.e.</em>, comprehensive)
  documentation of what <strong>ml-nlffigen</strong> does and produces.
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/07/14]
</dt>
<dd>
<div class="paragraph"><p>Added <span class="monospaced">C_UNION</span> to <span class="monospaced">c-calls/c-types.sml</span> and updated the machinery
(<strong>ml-nlffigen</strong>, <span class="monospaced">cproto.sml</span>) that conveys <strong>C</strong> function interface
information to the code generator.</p></div>
<div class="paragraph"><p>However, the actual architecture-specific implementation of function
arguments and results that are <strong>C</strong> unions is still not implemented.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/07/14]
</dt>
<dd>
<div class="paragraph"><p>Added these instructions to the PowerPC architecture:
    <span class="monospaced">LBZU</span>(<span class="monospaced">X</span>), <span class="monospaced">LHZU</span>(<span class="monospaced">X</span>), <span class="monospaced">LWZU</span>(<span class="monospaced">X</span>),
    <span class="monospaced">STWU</span>(<span class="monospaced">X</span>), <span class="monospaced">STFDU</span>, <span class="monospaced">STFSU</span>,
etc&#8230;</p></div>
<div class="paragraph"><p>Note: I haven&#8217;t added their instruction encoding into the description.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/07/13]
</dt>
<dd>
<div class="paragraph"><p>Added the two instructions <span class="monospaced">LWARX</span> and <span class="monospaced">STWCX</span> to the PowerPC
instruction set.</p></div>
<div class="paragraph"><p>A (untested) rewrite of <span class="monospaced">loop-structure.sml</span>.  The old version
is completely broken.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/07/13]
</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
use <span class="monospaced">paramAlloc</span> to report c-calls with too many arguments
  (for PPC version where parameter area is pre-allocated)
</p>
</li>
<li>
<p>
added <span class="monospaced">ccall_maxargspace</span> to machspec (to implement the above)
</p>
</li>
<li>
<p>
made "make" commend in CM&#8217;s "make" tool configurable
</p>
</li>
<li>
<p>
added option (default: on) for passing the name of the SML/NJ&#8217;s "bin"
  directory to "make"; the call looks like this:
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>make &lt;options&gt; <span class="nv">SMLNJ_BINDIR</span><span class="o">=</span>&lt;dir&gt; &lt;target&gt;
</pre></div></div></div>
<div class="paragraph"><p>This can be used by the Makefile to, <em>e.g.</em>, pick the "right" version
of <strong>ml-nlffigen</strong>.
- minor code tweaks</p></div>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_46_1_2004_07_12">Version 110.46.1; 2004/07/12</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/07/12]
</dt>
<dd>
<div class="paragraph"><p>NLFFI under Mac OS X now working (sort of).  This is largely untested,
though.</p></div>
<div class="openblock">
<div class="title">Note:</div>
<div class="content">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
You have to make a new, clean build of the runtime system.
</p>
</li>
<li>
<p>
There are new BOOTFILES, you have to use them!
    (Doing the bootstrap process yourself would be <strong>very</strong> painful!
     If you absolutely have to do it, build the system under
     a different architecture and then cross-compile.)
</p>
</li>
</ol></div>
</div></div>
<div class="paragraph"><p>Version bumped to 110.46.1 to account for runtime data format changes.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/06/18]
</dt>
<dd>
<div class="paragraph"><p>Changed the implementation of structure <span class="monospaced">Unix</span> so that the same stream
is returned every time one of the {<span class="monospaced">text</span>,<span class="monospaced">bin</span>}{<span class="monospaced">In</span>,<span class="monospaced">Out</span>}<span class="monospaced">streamOf</span>
functions is invoked on the same proc.  This is not what the spec currently
says&#8201;&#8212;&#8201;although IMO it arguably should.  (See discussion below.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_46_2004_06_17">Version 110.46; 2004/06/17</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/06/17]
</dt>
<dd>
<div class="paragraph"><p>Changed the interface of structures Timer and Unix to match the most
recent Basis spec.</p></div>
<div class="paragraph"><p>In the case of Unix there still seems to be an open/weird issue:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>The {text,bin}{In,Out}streamOf functions are supposed to create
fresh streams whenever they are called -- as opposed to have them
return the same stream every time.  This design is supposed to
prevent space leaks caused by proc values hanging on to streams.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>The reap function, on the other hand, is supposed to close the
streams.  This cannot be done without having a handle on the
stream in proc after all...</pre>
</div></div>
<div class="paragraph"><p>I took the liberty to implement the following stopgap solution:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>The proc value hangs on to the most recently created stream(s).
Reap closes those.  If either or both of the two streams hadn't
been created at all yet, then reap will close the corresponding
file descriptors directly.</pre>
</div></div>
<div class="paragraph"><p>PS: I don&#8217;t understand the original space leak argument anymore.  If
a proc hangs on to the imperative stream, then I/O operations on those
will advance the state of the cached stream and avoid the space leak.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/05/28]
</dt>
<dd>
<div class="paragraph"><p>Added signature <span class="monospaced">PACK_REAL</span> and exported functor <span class="monospaced">PrimIO</span>.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/05/25]
</dt>
<dd>
<div class="paragraph"><p>CM now ignores (but still accepts) the "owner" information in group
descriptions.  The owner of a group is its next enclosing
library. Each group must have a unique owner.  (There is a virtual
"toplevel" library that owns groups which are not nested within a real
library.)  Previously, each group had to explicitly declare its owner,
and CM would check that such a declaration is correct.  The new scheme
is to have CM check that for each group there is precisely one owning
library.</p></div>
<div class="paragraph"><p>The advantage of the new scheme is that the programmer no longer needs
to maintain the somewhat annoying owner information.  The downside is
that CM cannot enforce the ownership rule across multiple runs of
CM.make.  Fortunately, enclosing the same group in two different
libraries A and B which are not part of the same program does not
cause real problems.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/05/20]
</dt>
<dd>
<div class="paragraph"><p>Made the win32 version work again.  (Strangely, a misplaced comma had
slipped into win32-process.c which prevented the runtime from being
compiled correctly.)</p></div>
<div class="paragraph"><p>Also, included a minor addition to ml-build.bat analogous to what was
done in blume-20040519-ml-build.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/05/19]
</dt>
<dd>
<div class="paragraph"><p>Arranged for <strong>ml-build</strong> to clean up after itself a little bit better.
The script generates a temporary SML source file and compiles it using
CM, so CM generates metadata (GUID, SKEL, objectfile) for it.  It now
gets rid of those at the end, so they don&#8217;t accumulate under .cm.</p></div>
<div class="paragraph"><p>This required a minor change to install.sh because the name of the
metadata directory (default: .cm) is actually configurable at
installation time.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/05/18]
</dt>
<dd>
<div class="paragraph"><p>Added Posix.IO.mk{Bin,Text}{Reader,Writer} by lifting their respective
implementations from internal modules PosixBinPrimIO and PosixTextPrimIO.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/05/11]
</dt>
<dd>
<div class="paragraph"><p>Added previously missing support for many socket-related functions
under win32.  Thanks to David Hansel &lt;<a href="mailto:hansel@reactive-systems.com">hansel@reactive-systems.com</a>&gt;
for the voluminous patch!</p></div>
<div class="paragraph"><p>(I have not tested this patch under win32 yet.)</p></div>
<div class="paragraph"><p>Here is David&#8217;s e-mail:</p></div>
<div class="paragraph"><p>Hi,</p></div>
<div class="paragraph"><p>Attached to this email you find a diff against sml/nj 110.45
that will enable socket support under Windows.</p></div>
<div class="paragraph"><p>To apply the patch (using unix or cygwin)
1) gunzip runtime.diff.gz
2) "cd" into "src/runtime" in the source tree of a fresh
   110.45 installation.
3) patch -p 1 &lt; [your/path/to]runtime.diff</p></div>
<div class="paragraph"><p>The code compiles fine but has NOT yet been extensively tested.
I only ran a few tests for basic socket client functionality
(which worked fine).  Especially the functions that use ioctl
are not tested at all and might not work (see below).</p></div>
<div class="paragraph"><p>I implemented this since we want to move to a newer version of sml/nj
but need socket support in order to use it.  This is the first time I
even had a look at the sml/nj source,  so please review my changes
before making this part of the distribution!  Here are a few issues
that I think might be better for someone to solve who is more
familiar with the sml/nj source (and socket programming):</p></div>
<div class="ulist"><ul>
<li>
<p>
getnetbyaddr.c and getnetbyname.c will raise a "not implemented"
  exception since I could not figure out what the windows equivalent
  of these functions is
</p>
</li>
<li>
<p>
In sockets-osdep.h there are a some #include statements that are
  only used in a few files that include sockets-osdep.h
</p>
</li>
<li>
<p>
In smlnj-sock-lib.c, function init_fn() calls WSAStartup() but
  does not process its return value since I don&#8217;t know how to
  report an error upwards.
</p>
</li>
<li>
<p>
It would probably be good to have a call to WSACleanup() when
  the library is unloaded (if there is such a possibility).
  Otherwise I think Windows will take care of this automatically
  when the process finishes.
</p>
</li>
<li>
<p>
I used ioctlsocket() as a replacement for ioctl() but I have
  no idea if that is actually the proper replacement on Windows.
</p>
</li>
<li>
<p>
All these issues are marked in the code by "FIXME" comments.
</p>
<div class="paragraph"><p>We use sml/nj extensively in our products and are quite happy
with it.  I hope this contribution will help you.</p></div>
<div class="paragraph"><p>Keep up the good work!</p></div>
<div class="paragraph"><p>David</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/05/11]
</dt>
<dd>
<div class="paragraph"><p>Fixed two bugs in installml script.  (Thanks to Vesa A. Norrman for
the patch.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/05/11]
</dt>
<dd>
<div class="paragraph"><p>Added support for <strong>nlffi</strong> under netbsd.  (Thanks to Vesa A. Norrman for
the patch.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/05/11]
</dt>
<dd>
<div class="paragraph"><p>As per request by Adam Chlipala &lt;<a href="mailto:adam@hcoop.net">adam@hcoop.net</a>&gt;, extended various
export lists in compiler-related .cm-files.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/05/11]
</dt>
<dd>
<div class="paragraph"><p>The installer now honors the "src-smlnj" target again, although its meaning
has changed from "all sources required for the compiler" to "all sources
the installer knows about".  In other words, if you enable "src-smlnj"
in the "targets" file, then the installer will pull in sources for
everything.  (Notice that this refers to source code only.  Compiled
code is still only installed for modules that were requested explicitly
or which are required for other modules that were requested explicitly.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/04/23]
</dt>
<dd>
<div class="paragraph"><p>Fixed IEEEReal.scan (and .fromString) so that if there is an overflow
in the exponent calculation we get INF or ZERO (depending on the mantissa
and the sign of the exponent).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/04/23]
</dt>
<dd>
<div class="paragraph"><p>The <strong>ml-build</strong> script now terminates with a non-0 status when something
goes wrong.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/04/22]
</dt>
<dd>
<div class="paragraph"><p>Made exception Option to be the same as exception Option.Option
(as it should be).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/03/19]
</dt>
<dd>
<div class="paragraph"><p>Fixed the runtime so that ml-nlffi-lib runs on the cygwin version
of SML/NJ.  The problem is that</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>lib = dlopen(NULL, ...)
f   = dlsym(lib, "malloc");</pre>
</div></div>
<div class="paragraph"><p>does not work on Windows unless we explicitly export symbols
such as <em>malloc</em> during linking.  We fixed this by explicitly
exporting the required symbols with the magic gcc incantation:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>-Wl,--export-all cygwin.def</pre>
</div></div>
<div class="paragraph"><p>where cygwin.def is a file containing all the symbols that
we wish to export.</p></div>
<div class="paragraph"><p>I suspect this is a Windows problem and we&#8217;ll have to
do the same (somehow with windows compilers) when
we build the native win32 version with the system
calls LoadLibrary/GetProcAddress.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/03/04]
</dt>
<dd>
<div class="paragraph"><p>Fixed problem with IntInf.fmt (sign would show up on the right instead
of on the left for BIN, OCT, and HEX).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/03/04]
</dt>
<dd>
<div class="paragraph"><p>Fixed problem with installer script (unix only) where bin/ml-yacc and
friends pointed (via symlinks) to absolute locations instead of just
.run-sml.  This was reported by Vesa A Norrman.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_45_2004_02_13">Version 110.45; 2004/02/13</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/01/26]
</dt>
<dd>
<div class="paragraph"><p>Improved handling of exceptions at the interactive toplevel.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2004/01/26]
</dt>
<dd>
<div class="paragraph"><p>Type of top-level "app" corrected.
Added code for setting vp_limitPtrMask to <strong>Win32</strong>-specific runtime.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/11/18]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
changed Timer interface to what might become the spec
</p>
</li>
<li>
<p>
POSIX_FLAGS &#8594; BIT_FLAGS according to spec
</p>
</li>
<li>
<p>
some other minor discrepancies wrt. spec eliminated
</p>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_44_2003_11_06">Version 110.44; 2003/11/06</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/11/04]
</dt>
<dd>
<div class="paragraph"><p>Eliminated the "dont_move_libraries" directive in config/targets.
(The mechanism was broken and could not be fixed easily.  Moreover,
there does not seem to be any reason not to move all libraries into
lib during installation.  I originally implemented this directive as a
backward-compatibility feature when I first introduced the new CM.
Now that things have been stable for a long time and going back to the
old CM is not an option, there is no reason to keep it around.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/11/03]
</dt>
<dd>
<div class="paragraph"><p>Made installer honor INSTALLDIR variable again.  (Thanks to Chris
Richards for pointing out the problem and providing the solution.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/10/01]
</dt>
<dd>
<div class="paragraph"><p>MLRISC bug fix from Lal.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/09/30]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Added openVector, nullRd, and nullWr to PRIM_IO.
</p>
</li>
<li>
<p>
Improved .bat files (for <strong>Win32</strong> port) to make things work under Win95.
   (thanks to Aaron S. Hawley for this one)
</p>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/09/26]
</dt>
<dd>
<div class="paragraph"><p>Added missing wrapper for privilege "primitive" in $smlnj/viscomp/core.cm.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_43_3_2003_09_26">Version 110.43.3; 2003/09/26</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/09/26]
</dt>
<dd>
<div class="paragraph"><p>I modified the read-eval-print loop so that the autoloader gets
invoked whenever the prettyprinter tries to look up a symbol that
is not currently defined in the toplevel environment but which
appears in CM&#8217;s autoload registry.  As a result, we see far fewer of
those ?.Foo.Bar.xxx names in the prettyprinter&#8217;s output.</p></div>
<div class="paragraph"><p>In addition to this I tried to clean up some pieces of the Basis
implementation (<em>e.g.</em>, Socket, Word8Array) in order to prevent other
instances of these ?.Foo.Bar.xxx names from being printed.</p></div>
<div class="paragraph"><p>The mechanism that picks names for types still needs some work, though.
(Right now it seems that if there is a type A.t which is defined to
be B.u, but B is unavailable at toplevel, then A.t gets printed as
"?.B.u" although the perhaps more sensible solution would be to use
"A.t" in this case.  In other words, the prettyprinter should follow
a chain of DEFtycs not farther than there are corresponding toplevel
names in the current environment.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/09/24]
</dt>
<dd>
<div class="paragraph"><p>Another installer tweak:  All the ML code for the installer is now
compiled during CMB.make and put into a little library called
$smlnj/installer.cm.  The installation then simply invokes</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>   sml -m $smlnj/installer.cm</pre>
</div></div>
<div class="paragraph"><p>and everything happens automagically.</p></div>
<div class="paragraph"><p>Win32:  ML code senses value of environment variable <span class="monospaced">SMLNJ_HOME</span>.
Unix:   ML code senses values of environment variables <span class="monospaced">ROOT</span>, <span class="monospaced">CONFIGDIR</span>,
        and <span class="monospaced">BINDIR</span>.</p></div>
<div class="paragraph"><p>The new scheme guarantees that the ML code responsible for the installation
is in sync with the APIs of the main system.  Also, the installer is
somewhat faster because the installer script is precompiled.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/09/24]
</dt>
<dd>
<div class="paragraph"><p>Added a signature SYNCHRONOUS_SOCKET to basis.cm.  This is like SOCKET
but excludes all non-blocking operations.  Defined SOCKET (in Basis)
and CML_SOCKET in terms of SYNCHRONOUS_SOCKET.  Removed superfluous
implementations of non-blocking operations from CML&#8217;s Socket
structure.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/09/24]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Fixed SOCKET API and implementation to match Basis spec.
   This required changing the internal representation of sockets to one
   that remembers (for each socket file descriptor) whether it is currently
   blocking or non-blocking.  This state is maintained lazily (<em>i.e.</em>, a system
   call is made only if the state actually needs to change).
</p>
</li>
<li>
<p>
OS-specific details of sockets were moved into separate files, thus
   making it possible to unify the bulk of the socket implementations
   between Unix and Win32.
</p>
</li>
<li>
<p>
CML&#8217;s socket API changed accordingly.
   (Note that we need to remove non-blocking functions from this API
   since they are redundant in the case of CML!)
</p>
</li>
<li>
<p>
CML&#8217;s socket implementation now makes use of non-blocking functions
   provided by Basis, thus removing all OS-dependent code from this part
   of CML.
</p>
</li>
<li>
<p>
Changed Real64.precision from 52 to 53.  Minor cleanup in Real64 code.
</p>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_43_2_2003_09_22">Version 110.43.2; 2003/09/22</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/09/22]
</dt>
<dd>
<div class="paragraph"><p>Made a new interim version and bootfiles for developer&#8217;s bootstrapping
convenience.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/09/19]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
new-install.sh &#8594; install.sh
</p>
</li>
<li>
<p>
changed default CM "metadata" directory name to ".cm" (instead of "CM")
</p>
</li>
<li>
<p>
tweaked installer so that another name instead of .cm can be chosen
   at install time (by setting the CM_DIR_ARC environment variable
   during installation); once installation is complete, the name is
   fixed
</p>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_43_1_2003_09_18">Version 110.43.1; 2003/09/18</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/09/18]
</dt>
<dd>
<div class="paragraph"><p>Made a new interim version and bootfiles for developer&#8217;s bootstrapping
convenience.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/09/18]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Exported fractionsPerSecond etc. from TimeImp (but not from Time as
   this seems to be controversial at the moment) and used those in
   Posix.ProcEnv.times.
</p>
</li>
<li>
<p>
Added Time.{from,to}Nanoseconds to Time.
</p>
</li>
<li>
<p>
Improved Real.{from,to}LargeInt by avoiding needless calculations.
   For example, fromLargeInt never needs to look at more than 3 "big
   digits" to get its 53 bits of precision.
</p>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/09/17]
</dt>
<dd>
<div class="paragraph"><p>Added an entry to the primitive environment
(compiler/Semant/statenv/prim.sml) for int32&#8594;real64 conversion and
added code to compiler/CodeGen/main/mlriscGen.sml to implement it.</p></div>
<div class="paragraph"><p>Removed some of the "magic" constants in real64.sml and replaced them
with code that generates these values from their corresponding
integer counterparts.</p></div>
<div class="paragraph"><p>Made all(?) the slice-related changes to the Basis and made everything
compile again&#8230;</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/09/15]
</dt>
<dd>
<div class="paragraph"><p>Fixed bug in Real.fromLargeInt.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/09/13]
</dt>
<dd>
<div class="paragraph"><p>Minor bugfix in config/libinstall (set anchor with path to
standalone tool after installing it, otherwise libraries that
need <strong>ml-lex</strong> or <strong>ml-yacc</strong> won&#8217;t compile the first time the installer
runs).</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/09/12]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
fixed bug in Real.toLargeInt
</p>
</li>
<li>
<p>
fixed bug in Posix.ProcEnv.times
</p>
</li>
<li>
<p>
changed inputLine functions to return an option
</p>
</li>
<li>
<p>
minor installer improvements / bugfixes
</p>
</li>
<li>
<p>
changed default @SMLalloc parameter for x86/celeron to 64k
</p>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_43_2003_09_09">Version 110.43; 2003/09/09</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/09/09]
</dt>
<dd>
<div class="paragraph"><p>Rewrote large parts of config/install.sh in SML (config/libinstall.sml).
Modified config/install.bat to take advantage of it.  Also modified
config/install.sh (and called it config/new-install.sh) to take advantage
of it on Unix systems.  (The SML code is (supposed to be) platform-
independent.)</p></div>
<div class="paragraph"><p>The installer can now install everything under Win32
as well as under *nix as long as it compiles.</p></div>
<div class="paragraph"><p>Other changes:</p></div>
<div class="ulist"><ul>
<li>
<p>
made CML compile again under Win32
</p>
</li>
<li>
<p>
made eXene compile under Win32 (by providing a fake structure UnixSock
    and by using OS.Process.getEnv instead of Posix.ProcEnv.getenv)
</p>
</li>
<li>
<p>
fixed a bug in nowhere: it assumed that type OS.Process.status is the
    same as type int;  under Win32 it isn&#8217;t
</p>
</li>
<li>
<p>
fixed some slice-related problems in the win32-specific parts of CML
</p>
</li>
<li>
<p>
added a functor argument "sameVol" to os-path-fn.sml in the Basis
    (under Win32, the volume name is case-insensitive, and the
    OS.Path code compares volume names for equality)
</p>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/09/08]
</dt>
<dd>
<div class="paragraph"><p>Made Win32 version of OS.FileSys.fullPath return current directory
when given an empty string.  This is what the spec says, and incidentally,
CM depends on it.  (CM otherwise goes into an infinite loop in certain
cases when presented with the name of a non-existing .cm file.)</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/09/04]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Changed interface to vectors and arrays in Basis to match
     (draft) Basis spec.
</p>
</li>
<li>
<p>
Added signatures and implementations of slices according to
     Basis spec.
</p>
</li>
<li>
<p>
Edited source code throughout the system to make it compile again
     under 1. and 2.  (In some cases code had to be added to have it
     match the new signatures.)
</p>
</li>
<li>
<p>
MLRISC should be backward-compatible: the copies of the originals
     of files that needed to change under 3. were retained, the .cm files
     check the compiler version number and use old versions when
     appropriate.
</p>
</li>
<li>
<p>
Changed type of OS.FileSys.readDir and Posix.FileSys.readdir to
     dirstream &#8594; string option (in accordance with Basis spec).
</p>
</li>
<li>
<p>
When generating code that counts lines, <strong>ml-lex</strong> used function
     CharVector.foldli, taking advantage of its old interface.
     This has been replaced with the corresponding code from
     CharVectorSlice.  (html-lex must be re-lexed!)
</p>
</li>
<li>
<p>
BitArray in smlnj-lib/Util has been extended/modified to match the
     new MONO_ARRAY signature.  (Do we need BitArraySlice?)
</p>
</li>
<li>
<p>
Removed temporary additions (fromInternal, toInternal) from the
     (now obsolete) IntInf in smlnj-lib/Util.
</p>
</li>
<li>
<p>
Cleaned up structure Byte.
</p>
</li>
<li>
<p>
Added localOffset, scan, and fromString to Date (according to spec).
     Cleaned/corrected implementation of Date.
     (Still need to check for correctness; implement better canonicalizeDate.)
</p>
</li>
<li>
<p>
Added "scan" to signature IEEE_REAL.
</p>
</li>
<li>
<p>
Some improvements to IntInf [in particular: efficiency-hack for
     mod and rem when second operand is 2 (for parity checks).]
</p>
</li>
<li>
<p>
Changed representation of type Time.time, using a single IntInf.int
     value counting microseconds.  This considerably simplified the
     implementation of structure Time.  We now support negative time
     values; scan and fromString handle signs.
</p>
</li>
<li>
<p>
Functor PrimIO now takes two additional arguments (VectorSlice and
     ArraySlice).
</p>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/08/28]
</dt>
<dd>
<div class="paragraph"><p>This is a major update which comes with a version number bump
(110.42.99&#8201;&#8212;&#8201;yes, we are really close to 110.43 :-), NEW BOOTFILES,
and an implementation of <span class="monospaced">IntInf</span> in the Basis.</p></div>
</dd>
</dl></div>
<div class="paragraph"><p>There are a fairly large number of related changes and updates throughout
the system:</p></div>
<div class="paragraph"><p>+
Basis:
        - Implemented IntInf.
        - Made LargeInt a projection of IntInf (by filtering through INTEGER).
        - Added some missing Real64 operations, most notably Real.toLargeInt.
        - Added FixedInt as a synonym for Int32.</p></div>
<div class="paragraph"><p>+
compiler:
        * Added support for a built-in intinf type.
       &#8201;&#8212;&#8201;          - literals
          - pattern matching
          - conversion shortcuts (<span class="monospaced">Int32.fromLarge o Int.toLarge</span> etc.)
          - overloading on literals and operations
       &#8201;&#8212;&#8201;        This required adding a primitive type intinf, some additional
        primops, and implementations for several non-trivial intinf
        operations in Core.  (The intinf type is completely abstract
        to the compiler; all operations get delegated back to the Core.)</p></div>
<div class="paragraph"><p>+
        * Intinf equality is handled by polyequal.  However, the compiler
        does not print its usual warning in this case (since polyequal
        is the right thing to do there).</p></div>
<div class="paragraph"><p>+
        * Improved the organization of structure <span class="monospaced">InlineT</span>.</p></div>
<div class="paragraph"><p>+
        * A word about conversion primops:
        If conversions involving intinf do not cancel out during
        CPS contract, then the compiler must insert calls to Core functions.
        Since all core access must be resolved already during the FLINT
        translate phase, it would be too late a the time of CPS contract
        to add new Core calls.  For this reason, conversion primops
        for intinf carry two arguments:  1. the numeric argument that
        they are supposed to convert, and 2. the Core function that
        can help with this conversion if necessary.  If CPS contract
        eliminates a primop, then the associated Core function becomes
        dead and goes away.  Intinf conversion primops that do not get
        eliminated by CPS contract get rewritten into calls of their
        core functions by a separate, new phase.</p></div>
<div class="paragraph"><p>+
interactive system:
        - Control.Print.intinfDepth controls max length of intinf constants
        being printed. (Analogous to Control.Print.stringDepth.)
        - Cleanup in printutil and pputil: got rid of unused stuff and
        duplicates; replaced some of the code with code that makes better
        use of library functionality.</p></div>
<div class="paragraph"><p>+
CM:
        Bugfix: parse-errors in init group (system/smlnj/init/init.cmi)
        are no longer silent.</p></div>
<div class="paragraph"><p>+
CKIT:
        Fixed mismatched uses of Int32 and LargeInt.  I always decided
        in favor of LargeInt&#8201;&#8212;&#8201;which is now the same as IntInf.
        CKIT-knowledgable people should check whether this is what&#8217;s
        intended and otherwise change things back to using Int32 or
        FixedInt.</p></div>
<div class="paragraph"><p>+
Throughout the code:
        Started using IntInf.int literals and built-in operations
        (<em>e.g.</em>, comparison with 0) where this seems appropriate.</p></div>
<div class="paragraph"><p>+</p></div>
<div class="paragraph"><p>+
<span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/08/13]
</dt>
<dd>
<div class="paragraph"><p>Merging changes from the mcz-branch development branch into trunk.
These changes involve replacement of the emulated old prettyprinter
interface with direct use of the SML/NJ Lib PP library, and fixing
of a couple of bugs (895, 1186) relating to error messages.  A new
prettyprinter for ast datatypes (Elaborator/print/ppast.{sig,sml})
has been added.</p></div>
<div class="paragraph"><p><span class="owner">Dave MacQueen</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_42_9_2003_08_11">Version 110.42.9; 2003/08/11</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/08/11]
</dt>
<dd>
<div class="paragraph"><p>This patch restores SML/NJ&#8217;s ability to run under win32.  There are a
number of changes, including fixes for several bugs that had gone
unnoticed until now:</p></div>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
uname "CYGWIN_NT*" is recognized as win32 (This is relevant only when
  trying to run the win32 version from within cygwin.)
</p>
</li>
<li>
<p>
There are a number of simple .bat scripts that substitute for their
  corresponding Unix shell-scripts.  (See below.)
</p>
</li>
<li>
<p>
The internals of <strong>ml-build</strong> have been modified slightly.  The main
  difference is that instead of calling ".link-sml" (or link-sml.bat)
  using <span class="monospaced">OS.Process.system</span>, the ML process delegates this task back
  to the script.  Otherwise problems arise in mixed environments such
  as Cygwin where scripts look and work like Unix scripts, but
  where OS.Process.system cannot run them.
</p>
</li>
<li>
<p>
In CM, the srcpath pickler used native pathname syntax&#8201;&#8212;&#8201;which
  is incorrect in the case of cross-compilation.  The new pickle format
  is independent of platform-specific naming conventions.
</p>
</li>
<li>
<p>
Path configuration files (such as lib/pathconfig) can now choose
  between native and standard syntax.  Placing a line of the form
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>standard!</pre>
</div></div>
<div class="paragraph"><p>into the file causes all subsequent paths to be interpreted using
CM standard pathname syntax (= Unix conventions); a line</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>native!</pre>
</div></div>
<div class="paragraph"><p>switches back to native style.  This was needed so that
path config files can be written portably, see src/system/pathconfig.</p></div>
</li>
<li>
<p>
Runtime system:
</p>
<div class="ulist"><ul>
<li>
<p>
<span class="monospaced">win32-filesys.c</span>:  <span class="monospaced">get_file_time</span> and <span class="monospaced">set_file_time</span> now
    access modification time, not creation time.
</p>
</li>
<li>
<p>
I/O code made aware of new array representation.
</p>
</li>
<li>
<p>
Bug fixes in <span class="monospaced">X86.prim.masm</span>.
</p>
</li>
<li>
<p>
<span class="monospaced">src/system/makeml</span> made aware of win32. (For use under cygwin
       and other Unix-environments for windows.)
</p>
</li>
<li>
<p>
In Basis, fixed off-by-one error in win32-io.sml (function vecF)
    which caused BinIO.inputAll to fail consistently.
</p>
</li>
</ul></div>
</li>
<li>
<p>
.bat scripts:
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>Windows .bat scripts assume that +SMLNJ_HOME+ is defined.</pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
sml.bat, ml-yacc.bat, ml-lex.bat:  Driver scripts for standalone
     applications (sml, <strong>ml-yacc</strong>, <strong>ml-lex</strong>).
</p>
</li>
<li>
<p>
ml-build.bat: analogous to <strong>ml-build</strong>.
</p>
</li>
<li>
<p>
config\install.bat:  Analogous to config/install.sh.  This requires
     that <span class="monospaced">SMLNJ_HOME</span> is set and that Microsoft Visual C is ready to use.
     (nmake etc. must be on the path, and vcvars32 must have been run.)
     Moreover, sources for <strong>ml-lex</strong> and <strong>ml-yacc</strong> need to exist under src,
     and the bootfile hierarchy must have been unpacked under
     sml.boot.x86-win32.
     The script is very primitive and does a poor job at error checking.
     It only installs the base system, <strong>ml-lex</strong>, and <strong>ml-yacc</strong>.  No other
     libraries are being installed (<em>i.e.</em>, you get only those that
     are part of the compiler.)
</p>
</li>
<li>
<p>
link-sml.bat:  analogous to .link-sml, but not currently used
</p>
</li>
</ul></div>
</li>
<li>
<p>
Unrelated bug fixes:
</p>
<div class="ulist"><ul>
<li>
<p>
ml-nlffigen now exports structures ST_* corresponding to incomplete
    types.
</p>
</li>
<li>
<p>
Added getDevice to PP/src/pp-debug-fn.sml.  (Would not compile
    otherwise.)
</p>
</li>
</ul></div>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/06/17]
</dt>
<dd>
<div class="paragraph"><p>Modified compiler/Elaborator/print/pptype.sml to fix bug 895.
Tag will be used for new development branch (mcz-branch) for
use by MacQueen, (Lucasz) Zairek, and (George) Cao at uchicago.</p></div>
<div class="paragraph"><p><span class="owner">Dave MacQueen</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/05/27]
</dt>
<dd>
<div class="paragraph"><p>Tried to eliminated most cases of polymorphic equality.</p></div>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/05/21]
</dt>
<dd>
<div class="paragraph"><p>Two changes:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Added a flag for controlling whether non-exhaustive bindings will
     be treated as errors (default is false).
</p>
</li>
<li>
<p>
Cleaned up the <strong>entire</strong> source tree so that CMB.make goes through
     without a single non-exhaustive match- or bind warning.
</p>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/05/17]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Added cases for IF, WHILE, ANDALSO, and ORELSE to Absyn.
</p>
<div class="paragraph"><p>This mainly affects the quality of error messages.  However, some
of the code is now more straightforward than before. (Treatment of
the above four constructs in translate.sml is much simpler than
the "macro-expansion" that was going on before.  Plus, the mach-
compiler no longer gets invoked just to be able to compile an
if-expression.)</p></div>
</li>
<li>
<p>
The ErrorMsg.Error exception is now caught and absorbed by the
   interactive loop.
</p>
<div class="paragraph"><p><span class="owner"><a href="http://www.tti-c.org/blume/">Matthias Blume</a></span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/05/16]
</dt>
<dd>
<div class="paragraph"><p>Ported the runtime system to cygwin, which uses the unix
x86-unix bin files.  Missing/buggy features:</p></div>
</dd>
</dl></div>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
getnetbyname, getnetbyaddr: these functions seem to be missing in
     the Cygwin library.
</p>
</li>
<li>
<p>
Ctrl-C handling may be flaky.
</p>
</li>
<li>
<p>
Windows system calls and Windows I/O are not supported.
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p>A new set of binfiles is located at:</p></div>
<div class="paragraph"><p>+
<a href="http://www.dorsai.org/~leunga/boot.x86-unix.tgz">http://www.dorsai.org/~leunga/boot.x86-unix.tgz</a></p></div>
<div class="paragraph"><p>+
This is only needed for bootstrapping the cygwin version of smlnj.
Other x86 versions can use the existing binfiles.</p></div>
<div class="paragraph"><p>+
<span class="owner">Allen Leung</span></p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/04/08]
</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Added a target <em>mlrisc</em> to installer.
</p>
</li>
<li>
<p>
Added missing elements to structure ListPair.
</p>
</li>
</ol></div>
</div></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2003/01/07]
</dt>
<dd>
<div class="paragraph"><p>Fixed a bug in Int.rem(x,y) where y is a power of 2 on x86.
The arguments to the SUBL instruction were swapped.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/12/12]
</dt>
<dd>
<div class="paragraph"><p>Fixed a serious bug in the rewrite code for FP spilling/reloading that
sent the RA into an infinite loop when floating point registers get
spilled.  (Because of this bug, <em>e.g.</em>, nucleic stopped compiling between
110.37 and 110.38.)
There was another set of potential problems related to the handling of
MLRISC annotations (but those did not yet cause real problems, apparently).</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/12/06]
</dt>
<dd>
<div class="paragraph"><p>Added a call of SrcPath.sync at the beginning of Parse.parse (in CM).
This fixes the problem of CM getting confused by files that suddenly
change their identity (<em>e.g.</em>, by getting unlinked and recreated by some
text editor such as vi).  There might be a better/cheaper/cleaner way
of doing this, but for now this will have to do.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/10/28]
</dt>
<dd>
<div class="paragraph"><p>Exported structure Typecheck from $smlnj/viscomp/core.cm.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_42_1_2002_10_17">Version 110.42.1; 2002/10/17</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/10/17]
</dt>
<dd>
<div class="paragraph"><p>In good old tradition, there has been a slight hiccup so that we have
to patch 110.42 after the fact.   The old release tag has been replaced
(see below).</p></div>
<div class="paragraph"><p>The change solves a problem with two competing approaches the
configuration problem regarding MacOS 10.1 vs. MacOS 10.2 which got in
each other&#8217;s way.</p></div>
<div class="paragraph"><p>This change only affects the runtime system code and the installer script.
(No new bootfiles.)</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_42_2002_10_16">Version 110.42; 2002/10/16</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/10/10]
</dt>
<dd>
<div class="paragraph"><p>The mltree operator DIVS must be implemented with an overflow check on
the PPC because the hardware indicates divide-by-zero using "overflow" as
well.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/07/23]
</dt>
<dd>
<div class="paragraph"><p>Sml now senses the <span class="monospaced">SMLNJ_HOME</span> environment variable.  If this is set,
then the bin dir is assumed to be in <span class="monospaced">$SMLNJ_HOME/bin</span> and (unless
<span class="monospaced">CM_PATHCONFIG</span> is also set), the path configuration file is assumed
to be in <span class="monospaced">$SMLNJ_HOME/lib/pathconfig</span>.  This way one can easily move
the entire tree to some other place and everything will "just work".</p></div>
<div class="paragraph"><p>(Companion commands such as <strong>ml-build</strong> and <strong>ml-makedepend</strong> also sense this
variable.)</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/07/12]
</dt>
<dd>
<div class="paragraph"><p>Exported two useful "step" functions from liveness module (MLRISC).</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_41_2002_07_05">Version 110.41; 2002/07/05</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/07/05]
</dt>
<dd>
<div class="paragraph"><p>Exported structure BTImp from <span class="monospaced">$smlnj/viscomp/debugprof.cm</span> so that
other clients can set up backtracing support.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/06/25]
</dt>
<dd>
<div class="paragraph"><p>Fixed a bug in translation of <span class="monospaced">INLMAX</span> (and <span class="monospaced">INLMIN</span>) for the floating-point
case.  (The sense of the <span class="monospaced">isNaN</span> test was reversed&#8201;&#8212;&#8201;which made <span class="monospaced">min</span> and
<span class="monospaced">max</span> always return their first argument.)</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/06/11]
</dt>
<dd>
<div class="paragraph"><p>Back-ported OS.Path.{from,to}UnixPath from idlbasis-devel branch.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/06/10]
</dt>
<dd>
<div class="paragraph"><p>I back-ported my implementation of <span class="monospaced">IEEEReal.fromString</span> from the
idlbasis-devel branch so that we can test it.</p></div>
<div class="paragraph"><p>Another small change is that ppDec tries to give more information
than just "&lt;sig&gt;" in the case of functors.  However, this code is
broken in some mysterious way if the functor&#8217;s body&#8217;s signature
has not been declared by ascription but gets inferred from the
implementation.  This needs fixing&#8230;</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/05/31]
</dt>
<dd>
<div class="paragraph"><p>Resurrected <span class="monospaced">SMLofNJ.Internals.BTrace.mode</span>.  (It accidentally fell by
the wayside when I switched over to using Controls everywhere.)</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/05/23]
</dt>
<dd>
<div class="paragraph"><p>Labels are now displayed in the graphical output to make
the fall-through and target blocks obvious.</p></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/05/22]
</dt>
<dd>
<div class="paragraph"><p>John tweaked yesterday&#8217;s fix for 1131 to handle an out-of-memory
situation that comes up when allocating huge arrays.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_40_2002_05_21">Version 110.40; 2002/05/21</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/05/21]
</dt>
<dd>
<div class="paragraph"><p>John Reppy fixed GC bug 1131.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/05/21]
</dt>
<dd>
<div class="paragraph"><p>CM documentation update.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/05/21]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
John tweaked runtime to be silent on heap export (except when
  GC messages are on).
</p>
</li>
<li>
<p>
I added a few more things (cross-compiling versions of CMB) to
  config/preloads (as suggestions).
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/05/20]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
Added <span class="monospaced">ControlUtil</span> structure to <span class="monospaced">control-lib.cm</span>.
</p>
</li>
<li>
<p>
Use it throughout.
</p>
</li>
<li>
<p>
Used Controls facility to define <strong>MLRISC</strong> controls (as opposed to
  registering <strong>MLRISC</strong> control ref cells with Controls after the fact)
</p>
</li>
<li>
<p>
Fixed messed-up controls priorities.
</p>
<div class="ulist"><ul>
<li>
<p>
Removed again all the stuff from <span class="monospaced">config/preloads</span> that one wouldn&#8217;t
  be able to preload at the time the initial heap image is built.
  (Many libraries, <em>e.g.</em>, CML, do not exist yet at this time.  The
   only libraries that can be preloaded via config/preloads are those
   that come bundled with the bootfiles.)
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/05/20]
</dt>
<dd>
<div class="paragraph"><p>Added a lot of commented-out suggestions for things to be included
in config/preloads.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/05/18]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
Made the mdl tool stuff compile and run again.
</p>
</li>
<li>
<p>
I&#8217;ve disabled all the stuff that depends on RTL specifications; they
  are all badly broken anyway.
</p>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/05/17]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
John Reppy made several modifications to the <strong>SML/NJ Library</strong>.
   In particular, there is a shiny new controls-lib.cm.
</p>
</li>
<li>
<p>
Pushed new controls interface through compiler so that everything
   compiles again.
</p>
</li>
<li>
<p>
Added <span class="monospaced">FormatComb</span> and <span class="monospaced">FORMAT_COMB</span> to the <strong>CML</strong> version of the
   <strong>SML/NJ Library</strong> (so that <strong>CML</strong> compiles again).
</p>
</li>
<li>
<p>
Modified init scripts because XXX_DEFAULT environment variables
   are no longer with us.  (Boot-time initialization is now done
   using the same environment variables that are also used for
   startup-time initialization of controls.)
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/05/15]
</dt>
<dd>
<div class="paragraph"><p>All pseudo-ops emitted before the first segment declaration
such as <span class="monospaced">TEXT</span>, <span class="monospaced">DATA</span>, and <span class="monospaced">BSS</span> directives are assumed to be global
declarations and are emitted first in the assembly file. This is
useful in a number of situations where one has pseudo-ops that are not
specific to any segment, and also works around the constraint that one
cannot have client pseudo-ops in the <span class="monospaced">TEXT</span> segment.</p></div>
<div class="paragraph"><p>Because no segment is associated with these declarations it is
an error to allocate any space or objects before the first segment
directive and an exception will be raised. However, we cannot make
this check for client pseudo-ops.</p></div>
<div class="paragraph"><p>These top level declarations are a field in the CFG <span class="monospaced">graph_info</span>.
In theory you can continue to add to this field after the CFG has been
built&#8201;&#8212;&#8201;provided you know what you are doing;-)</p></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/05/13]
</dt>
<dd>
<div class="paragraph"><p>A few minor bugfixes:</p></div>
<div class="ulist"><ul>
<li>
<p>
Stopgap measure for bug recently reported by Elsa Gunter (ppDec).
    (Bogus printouts for redefined bindings still occur.  Compiler
    bug should no longer occur now.  We need to redo the prettyprinter
    from scratch.)
</p>
</li>
<li>
<p>
CM pathname printer now also adds escape sequences for ( and )
</p>
</li>
<li>
<p>
commend and docu fixes for ml-nlffi
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/05/10]
</dt>
<dd>
<div class="paragraph"><p>Applied the following bugfix provided by Emden Gansner:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Output is corrupted when outputSubstr is used rather than output.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>The problem occurs when a substring</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>ss = (s, dataStart, dataLen)</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>where dataStart &gt; 0, fills a stream buffer with avail bytes left.
avail bytes of s, starting at index dataStart, are copied into the
buffer, the buffer is flushed, and then the remaining dataLen-avail
bytes of ss are copied into the beginning of the buffer. Instead of
starting this copy at index dataStart+avail in s, the current code
starts the copy at index avail.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Fix:
In text-io-fn.sml, change line 695 from
     val needsFlush = copyVec(v, avail, dataLen-avail, buf, 0)
to
     val needsFlush = copyVec(v, dataStart+avail, dataLen-avail, buf, 0)</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/04/12]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Grabbed newer assyntax.h from the XFree86 project.
</p>
</li>
<li>
<p>
Fiddled with how to compile X86.prim.asm without warnings.
</p>
</li>
<li>
<p>
(Very) Minor cleanup in CM.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/04/01]
</dt>
<dd>
<div class="paragraph"><p>Added full support for div/mod/rem/quot on the x86, using the machine
instruction&#8217;s two results (without clumsily recomputing the remainder)
directly where appropriate.</p></div>
<div class="paragraph"><p>Some more extensive power-of-two support was added to the x86 instruction
selector (avoiding expensive divs, mods, and muls where they can be
replaced with cheaper shifts and masks).  However, this sort of thing
ought to be done earlier, <em>e.g.</em>, within the CPS optimizer so that
all architectures benefit from it.</p></div>
<div class="paragraph"><p>The compiler compiles to a fixed point, but changes might be somewhat
fragile nevertheless.  Please, report any strange things that you might
see wrt. div/mod/quot/rem&#8230;</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/29]
</dt>
<dd>
<div class="paragraph"><p>Fixed my broken div/mod logic.  Unfortunately, this means that the
inline code for div/mod now has one more comparison than before.
Fast paths (quotient &gt; 0 or remainder = 0) are not affected, though.
The problem was with quotient = 0, because that alone does not tell
us which way the rounding went.  One then has to look at whether
remainder and divisor have the same sign&#8230;  :(</p></div>
<div class="paragraph"><p>Anyway, I replaced the bootfiles with fresh ones&#8230;</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_39_3_2002_03_29">Version 110.39.3; 2002/03/29</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/29]
</dt>
<dd>
<div class="paragraph"><p>Primops have changed. This means that the bin/boot-file formats have
changed as well.</p></div>
<div class="paragraph"><p>To make sure that there is no confusion, I made a new version.</p></div>
<div class="paragraph"><p>+
CHANGES:</p></div>
<div class="ulist"><ul>
<li>
<p>
removed REMT from mltree (remainder should never overflow).
</p>
</li>
<li>
<p>
added primops to deal with divisions of all flavors to the frontend
</p>
</li>
<li>
<p>
handled these primops all the way through so they map to their respective
  MLRISC support
</p>
</li>
<li>
<p>
used these primops in the implementation of Int, Int32, Word, Word32
</p>
</li>
<li>
<p>
removed INLDIV, INLMOD, and INLREM as they are no longer necessary
</p>
</li>
<li>
<p>
parameterized INLMIN, INLMAX, and INLABS by a numkind
</p>
</li>
<li>
<p>
translate.sml now deals with all flavors of INL{MIN,MAX,ABS}, including
  floating point
</p>
</li>
<li>
<p>
used INL{MIN,MAX,ABS} in the implementation of Int, Int32, Word, Word32,
  and Real (but Real.abs maps to a separate floating-point-only primop)
</p>
<div class="paragraph"><p>+
TODO items:</p></div>
</li>
<li>
<p>
Hacked Alpha32 instruction selection, disabling the selection of REMx
  instructions because the machine instruction encoder cannot handle
  them.  (Hppa, PPC, and Sparc instruction selection did not handle
  REM in the first place, and REM is supported by the x86 machine coder.)
</p>
</li>
<li>
<p>
Handle DIV and MOD with DIV_TO_NEGINF directly in the x86 instruction
  selection phase.  (The two can be streamlined because the hardware
  delivers both quotient and remainder at the same time anyway.)
</p>
</li>
<li>
<p>
Think about what to do with "valOf(Int32.minInt) div ~1" and friends.
  (Currently the behavior is inconsistent both across architectures and
  wrt. the draft Basis spec.)
</p>
</li>
<li>
<p>
Word8 should eventually be handled natively, too.
</p>
</li>
<li>
<p>
There seems to be one serious bug in mltree-gen.sml.  It appears, though,
  as if there currently is no execution path that could trigger it in
  SML/NJ.  (The assumptions underlying functions arith and promotable do not
  hold for things like multiplication and division.)
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/27]
</dt>
<dd>
<div class="paragraph"><p>Added support for all four division operations (ML&#8217;s div, mod, quot,
and rem) to MLRISC.  In the course of doing so, I also rationalized
the naming (no more annoying switch-around of DIV and QUOT), by
parameterizing the operation by div_rounding_mode (which can be either
DIV_TO_ZERO or DIV_TO_NEGINF).</p></div>
<div class="paragraph"><p>The generic MLTreeGen functor takes care of compiling all four
operations down to only round-to-zero div.</p></div>
<div class="paragraph"><p>Missing pieces:</p></div>
<div class="ulist"><ul>
<li>
<p>
Doing something smarter than relying on MLTreeGen on architectures
    like, <em>e.g.</em>, the x86 where hardware division delivers both quotient and
    remainder at the same time.  With this, the implementation of the
    round-to-neginf operations could be further streamlined.
</p>
</li>
<li>
<p>
Remove inlining support for div/mod/rem from the frontend and replace it
    with primops that get carried through to the backend.  Do this for all
    int and word types.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/25]
</dt>
<dd>
<div class="paragraph"><p>I improved (hopefully without breaking them) the implementation of Int.div,
Int.mod, and Int.rem.   For this, the code in translate.sml now takes
advantage of the following observations:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Let  q = x quot y      r = x rem y
     d = x div  y      m = x mod y</pre>
</div></div>
<div class="paragraph"><p>where "quot" is the round-to-zero version of integer division that
hardware usually provides.  Then we have:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>r = x - q * y        where neither the * nor the - will overflow
d = if q &gt;= 0 orelse x = q * y then q else q - 1
                     where neither the * nor the - will overflow
m = if q &gt;= 0 orelse r = 0 then r else r + y
                     where the + will not overflow</pre>
</div></div>
<div class="paragraph"><p>This results in substantial simplification of the generated code.
The following table shows the number of CFG nodes and edges generated
for
        fun f (x, y) = x OPER y
        (* with OPER \in div, mod, quot, rem *)</p></div>
<div class="paragraph"><p>+
    OPER | nodes(old) | edges(old) | nodes(new) | edges(new)
    --------------------------------------------------------
     div |         24 |         39 |         12 |         16
     mod |         41 |         71 |         12 |         16
    quot |          8 |         10 |          8 |         10
     rem |         10 |         14 |          8 |         10</p></div>
<div class="paragraph"><p>+
<span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/25]
</dt>
<dd>
<div class="paragraph"><p>Fixed a bug in cproto (c prototype decoder).</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/25]
</dt>
<dd>
<div class="paragraph"><p>I did some cleanup to Allen&#8217;s new primop code and
replaced yesterday&#8217;s bootfiles with new ones.
(But they are stored in the same place.)</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/24]
</dt>
<dd>
<div class="paragraph"><p>Made the bootfiles that Allen asked for.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/23]
</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Changes to FLINT primops:
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>    <span class="cm">(* make a call to a C-function;</span>
<span class="cm">     * The primop carries C function prototype information and specifies</span>
<span class="cm">     * which of its (ML-) arguments are floating point. C prototype</span>
<span class="cm">     * information is for use by the backend, ML information is for</span>
<span class="cm">     * use by the CPS converter. *)</span>
  <span class="n">|</span> <span class="n">RAW_CCALL</span> <span class="kr">of</span> <span class="p">{</span> <span class="n">c_proto</span><span class="p">:</span> <span class="nn">CTypes</span><span class="p">.</span><span class="n">c_proto</span><span class="p">,</span>
                   <span class="n">ml_args</span><span class="p">:</span> <span class="n">ccall_type</span> <span class="n">list</span><span class="p">,</span>
                   <span class="n">ml_res_opt</span><span class="p">:</span> <span class="n">ccall_type</span> <span class="n">option</span><span class="p">,</span>
                   <span class="n">reentrant</span> <span class="p">:</span> <span class="n">bool</span>
                 <span class="p">}</span> <span class="n">option</span>
   <span class="cm">(* Allocate uninitialized storage on the heap.</span>
<span class="cm">    * The record is meant to hold short-lived C objects, _i.e._, they</span>
<span class="cm">    * are not ML pointers.  With the tag, the representation is</span>
<span class="cm">    * the same as RECORD with tag tag_raw32 (sz=4), or tag_fblock (sz=8)</span>
<span class="cm">    *)</span>
  <span class="n">|</span> <span class="n">RAW_RECORD</span> <span class="kr">of</span> <span class="p">{</span><span class="n">tag</span><span class="p">:</span><span class="n">bool</span><span class="p">,</span><span class="n">sz</span><span class="p">:</span><span class="n">int</span><span class="p">}</span>
  <span class="kr">and</span> <span class="nv">ccall_type</span> <span class="p">=</span> <span class="n">CCALL_INT32</span> <span class="n">|</span> <span class="n">CCALL_REAL64</span> <span class="n">|</span> <span class="n">CCALL_ML_PTR</span>
</pre></div></div></div>
</li>
<li>
<p>
These CPS primops are now overloaded:
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>       <span class="n">rawload</span> <span class="kr">of</span> <span class="p">{</span><span class="n">kind</span><span class="p">:</span><span class="n">numkind</span><span class="p">}</span>
       <span class="n">rawstore</span> <span class="kr">of</span> <span class="p">{</span><span class="n">kind</span><span class="p">:</span><span class="n">numkind</span><span class="p">}</span>
</pre></div></div></div>
<div class="paragraph"><p>The one argument form is:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>         <span class="n">rawload</span> <span class="p">{</span><span class="n">kind</span><span class="p">}</span> <span class="n">address</span>
</pre></div></div></div>
<div class="paragraph"><p>The two argument form is:</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>         <span class="n">rawload</span> <span class="p">{</span><span class="n">kind</span><span class="p">}</span> <span class="p">[</span><span class="n">ml</span> <span class="n">object</span><span class="p">,</span> <span class="n">byte-offset</span><span class="p">]</span>
</pre></div></div></div>
</li>
<li>
<p>
RAW_CCALL/RCC now takes two extra arguments:
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
The first is whether the C call is reentrant, <em>i.e.</em>, whether
        ML state should be saved and restored.
</p>
</li>
<li>
<p>
The second argument is a string argument specifying the name of
        library and the C function.
</p>
<div class="paragraph"><p>These things are currently not handled in the code generator, yet.</p></div>
</li>
</ol></div>
</li>
<li>
<p>
In CProto,
</p>
<div class="paragraph"><p>An encoding type of "bool" means "ml object" and is mapped into
C prototype of PTR.  Note that "bool" is different than "string",
even though "string" is also mapped into PTR, because "bool"
is assigned an CPS type of BOGt, while "string" is assigned INT32t.</p></div>
</li>
<li>
<p>
Pickler/unpicker
</p>
<div class="paragraph"><p>Changed to handle <span class="monospaced">RAW_RECORD</span> and newest <span class="monospaced">RAW_CCALL</span></p></div>
</li>
<li>
<p>
MLRiscGen,
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
Changed to handle the new rawload/rawstore/rawrecord operators.
</p>
</li>
<li>
<p>
Code for handling C Calls has been moved to a new module CPSCCalls,
   in the file <span class="monospaced">CodeGen/cpscompile/cps-c-calls.sml</span>
</p>
</li>
</ol></div>
</li>
<li>
<p>
Added the conditional move operator
</p>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>         <span class="n">condmove</span> <span class="kr">of</span> <span class="n">branch</span>
</pre></div></div></div>
<div class="paragraph"><p>to cps.  Generation of this is still buggy so it is currently
disabled.</p></div>
</li>
</ol></div>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/22]
</dt>
<dd>
<div class="paragraph"><p>Implemented the Ball-Larus branch prediction-heuristics, and
incorporated graphical viewers for control flow graphs.</p></div>
<div class="paragraph"><p><strong>Ball-Larus Heuristics:</strong></p></div>
<div class="paragraph"><p>See the file compiler/CodeGen/cpscompile/cpsBranchProb.sml.</p></div>
<div class="paragraph"><p>By design it uses the Dempster-Shafer theory for combining
probabilities.  For example, in the function:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>fun f(n,acc) = if n = 0 then acc else f(n-1, n*acc)</pre>
</div></div>
<div class="paragraph"><p>the ball-larus heuristics predicts that the n=0 is unlikely
(OH-heuristic), and the <em>then</em> branch is unlikely because of the
RH-heuristic&#8201;&#8212;&#8201;giving the <em>then</em> branch an even lower combined
probability using the Dempster-Shafer theory.</p></div>
<div class="paragraph"><p>Finally, John Reppy&#8217;s loop analysis in MLRISC, further lowers the
probability of the <em>then</em> branch because of the loop in the else
branch.</p></div>
<div class="paragraph"><p>+
<strong>Graphical Viewing:</strong></p></div>
<div class="paragraph"><p>I merely plugged in Allen&#8217;s graphical viewers into the compiler. The
additional code is not much. At the top level, saying:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Control.MLRISC.getFlag "cfg-graphical-view" := true;</pre>
</div></div>
<div class="paragraph"><p>will display the graphical view of the control flow graph just before
back-patching.  daVinci must be in your path for this to work. If
daVinci is not available, then the default viewer can be changed
using:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Control.MLRISC.getString "viewer"</pre>
</div></div>
<div class="paragraph"><p>which can be set to "dot" or "vcg" for the corresponding viewers. Of
course, these viewers must be in your path.</p></div>
<div class="paragraph"><p>The above will display the compilation unit at the level of clusters,
many of which are small, boring, and un-interesting. Also setting:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Control.MLRISC.getInt "cfg-graphical-view_size"</pre>
</div></div>
<div class="paragraph"><p>will display clusters that are larger than the value set by the above.</p></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/21]
</dt>
<dd>
<div class="paragraph"><p>Changed the interface to the KMP routine in PreString and fixed
a minor bug in one place where it was used.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/21]
</dt>
<dd>
<div class="paragraph"><p>Fixed a potential problem in cfg edge splitting.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/21]
</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Recoded the buggy parts of x86-fp.
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
All the block reordering code has been removed.
        We now depend on the block placement phases to do this work.
</p>
</li>
<li>
<p>
Critical edge splitting code has been simplified and moved into the
        CFG modules, as where they belong.
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>Both of these were quite buggy and complex.  The code is now much, much
simpler.</pre>
</div></div>
</li>
</ol></div>
</li>
<li>
<p>
X86 backend.
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
Added instructions for 64-bit support.  Instruction selection for
        64-bit has not been committed, however, since that
        requires changes to MLTREE which haven&#8217;t been approved by
        Lal and John.
</p>
</li>
<li>
<p>
Added support for FUCOMI and FUCOMIP when generating code for
        PentiumPro and above.  We only generate these instructions in
        the fast-fp mode.
</p>
</li>
<li>
<p>
Added cases for JP and JNP in X86FreqProps.
</p>
</li>
</ol></div>
</li>
<li>
<p>
CFG
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>CFG now has a bunch of methods for edge splitting and merging.</pre>
</div></div>
</li>
<li>
<p>
Machine description.
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>John's simplification of MLTREE_BASIS.fcond broke a few machine
description things:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>rtl-build.{sig,sml} and hppa.mdl fixed.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>NOTE: the machine description stuff in the repository is still broken.
      Again, I can't put my fixes in because that involves
      changes to MLTREE.</pre>
</div></div>
</li>
</ol></div>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/20]
</dt>
<dd>
<div class="paragraph"><p>Implemented Knuth-Morris-Pratt string matching in PreString and used
it for String.isSubstring, Substring.isSubstring, and
Substring.position.</p></div>
<div class="paragraph"><p>(Might need some stress-testing.  Simple examples worked fine.)</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/19]
</dt>
<dd>
<div class="paragraph"><p>Added a structure C.W and functions convert/Ptr.convert to ml-nlffi-lib.</p></div>
<div class="paragraph"><p>This implements a generic mechanism for changing constness qualifiers
anywhere within big C types without resorting to outright "casts".
(So far, functions such as C.rw/C.ro or C.Ptr.rw/C.Ptr.ro only let you
modify the constness at the outermost level.)
The implementation of "convert" is based on the idea of "witness"
values&#8201;&#8212;&#8201;values that are not used by the operation but whose types
"testify" to their applicability.  On the implementation side, "convert"
is simply a projection (returning its second curried argument).  With
cross-module inlining, it should not result in any machine code being
generated.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/15]
</dt>
<dd>
<div class="paragraph"><p>Provided (preliminary?) implementations for</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>{String,Substring}.{concatWith,isSuffix,isSubstring}</pre>
</div></div>
<div class="paragraph"><p>and</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Substring.full</pre>
</div></div>
<div class="paragraph"><p>Those are in the Basis spec but they were missing in SML/NJ.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/14]
</dt>
<dd>
<div class="paragraph"><p><strong>Controls:</strong></p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Factored out the recently-added Controls : CONTROLS stuff and put
   it into its own library $/controls-lib.cm.  The source tree for
   this is under src/smlnj-lib/Controls.
</p>
</li>
<li>
<p>
Changed the names of types and functions in this interface, so they
   make a bit more "sense":
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>module -&gt; registry
'a registry -&gt; 'a group</pre>
</div></div>
</li>
<li>
<p>
The interface now deals in ref cells only.  The getter/setter interface
   is (mostly) gone.
</p>
</li>
<li>
<p>
Added a function that lets one register an already-existing ref cell.
</p>
</li>
<li>
<p>
Made the corresponding modifications to the rest of the code so that
   everything compiles again.
</p>
</li>
<li>
<p>
Changed the implementation of Controls.MLRISC back to something closer
   to the original.  In particular, this module (and therefore MLRISC)
   does not depend on Controls.  There now is some link-time code in
   int-sys.sml that registers the MLRISC controls with the Controls
   module.
</p>
<div class="paragraph"><p><strong>CM:</strong></p></div>
<div class="ulist"><ul>
<li>
<p>
One can now specify the lambda-split aggressiveness in init.cmi.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/13]
</dt>
<dd>
<div class="paragraph"><p>Bug fix for:</p></div>
<div class="listingblock">
<div class="content monospaced">
<pre>&gt; leunga@weaselbane:~/Yale/tmp/sml-dist{21} bin/sml
&gt; Standard ML of New Jersey v110.39.1 [FLINT v1.5], March 08, 2002
&gt; - fun f(x,(y,z)) = Real.~ y;
&gt; [autoloading]
&gt; [autoloading done]
&gt;       fchsl   (%eax), 184(%esp)
&gt; Error: MLRisc bug: X86MCEmitter.emitInstr
&gt;
&gt; uncaught exception Error
&gt;   raised at: ../MLRISC/control/mlriscErrormsg.sml:16.14-16.19</pre>
</div></div>
<div class="paragraph"><p>The problem was that the code generator did not generate any fp registers
in this case, and the ra didn&#8217;t know that it needed to run the X86FP phase to
translate the pseudo fp instruction.   This only happened with unary fp
operators in certain situations.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/13]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Added _overload as a synonym for overload for backward compatibility.
   (Control.overloadKW must be true for either version to be accepted.)
</p>
</li>
<li>
<p>
Fixed bug in install script that caused more things to be installed
   than what was requested in config/targets.
</p>
</li>
<li>
<p>
Made CM aware of the (_)overload construct so that autoloading
   works.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/12]
</dt>
<dd>
<div class="paragraph"><p>Forgot to update BOOT and srcarchiveurl.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_39_2_2002_03_12">Version 110.39.2; 2002/03/12</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/12]
</dt>
<dd>
<div class="paragraph"><p>Yet another version number bump (because of small changes to the
binfile format).  Version number is now 110.39.2.  NEW BOOTFILES!</p></div>
<div class="paragraph"><p>Changes:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>The new pid generation scheme described a few weeks ago was overly
complicated.  I implemented a new mechanism that is simpler and
provides a bit more "stability":  Once CM has seen a compilation
unit, it keeps its identity constant (as long as you do not delete
those crucial CM/GUID/* files).  This means that when you change
an interface, compile, then go back to the old interface, and
compile again, you arrive at the original pid.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>There now also is a mechanism that instructs CM to use the plain
environment hash as a module's pid (effectively making its GUID
the empty string).  For this, "noguid" must be specified as an
option to the .sml file in question within its .cm file.
This is most useful for code that is being generated by tools such
as ml-nlffigen (because during development programmers tend to
erase the tool's entire output directory tree including CM's cached
GUIDs).  "noguid" is somewhat dangerous (since it can be used to locally
revert to the old, broken behavior of SML/NJ, but in specific cases
where there is no danger of interface confusion, its use is ok
(I think).</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>ml-nlffigen by default generates "noguid" annotations.  They can be
turned off by specifying -guid in its command line.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/12]
</dt>
<dd>
<div class="paragraph"><p>Integrated jump chaining and static block frequency into the
compiler. More details and numbers later.</p></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/11]
</dt>
<dd>
<div class="paragraph"><p>Tested the jump chain elimination on all architectures (except the
hppa).  This is on by default right now and is profitable for the
alpha and x86, however, it may not be profitable for the sparc and ppc
when compiling the compiler.</p></div>
<div class="paragraph"><p>The gc test will typically jump to a label at the end of the cluster,
where there is another jump to an external cluster containing the actual
code to invoke gc. This is to allow factoring of common gc invocation
sequences. That is to say, we generate:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>f:
   testgc
   ja   L1      % jump if above to L1</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>L1:
   jmp L2</pre>
</div></div>
<div class="paragraph"><p>+
After jump chain elimination the <em>ja L1</em> instructions is converted to
<em>ja L2</em>. On the sparc and ppc, many of the <em>ja L2</em> instructions may end
up being implemented in their long form (if L2 is far away) using:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>   jbe     L3      % jump if below or equal to L3
   jmp     L2
L3:
   ...</pre>
</div></div>
<div class="paragraph"><p>+
For large compilation units L2  may be far away.</p></div>
<div class="paragraph"><p>+
<span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/11]
</dt>
<dd>
<div class="paragraph"><p>A functor parameter was missing.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/11]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>   The representation of the empty string now points to a
legal null terminated C string instead of unit.  It is now possible
to convert an ML string into C string with InlineT.CharVector.getData.
This compiles into one single machine instruction.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/10]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>Added machine generation for CALL instruction (relative displacement mode)</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_39_1_2002_03_08">Version 110.39.1; 2002/03/08</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/08]
</dt>
<dd>
<div class="paragraph"><p>Entrypoints: non-zero offset into a code object where execution should begin.</p></div>
<div class="ulist"><ul>
<li>
<p>
Added the notion of an entrypoint to CodeObj.
</p>
</li>
<li>
<p>
Added reading/writing of entrypoint info to Binfile.
</p>
</li>
<li>
<p>
Made runtime system bootloader aware of entrypoints.
</p>
</li>
<li>
<p>
Use the address of the label of the first function given to mlriscGen
  as the entrypoint.  This address is currently always 0, but it will
  not be 0 once we turn on block placement.
</p>
</li>
<li>
<p>
Removed the linkage cluster code (which was The Other Way(tm) of dealing
  with entry points) from mlriscGen.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/07]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>Bug fixes for CMOVcc on x86.</pre>
</div></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Added machine code generation for CMOVcc
</p>
</li>
<li>
<p>
CMOVcc is now generated in preference over SETcc on PentiumPro or above.
</p>
</li>
<li>
<p>
CMOVcc cannot have an immediate operand as argument.
</p>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/07]
</dt>
<dd>
<div class="paragraph"><p>This is a very large but mostly boring patch which makes (almost)
every tuneable compiler knob (<em>i.e.</em>, pretty much everything under
Control.* plus a few other things) configurable via both the command
line and environment variables in the style CM did its configuration
until now.</p></div>
<div class="paragraph"><p>Try starting sml with <em>-h</em> (or, if you are brave, <em>-H</em>)</p></div>
<div class="paragraph"><p>To this end, I added a structure Controls : CONTROLS to smlnj-lib.cm which
implements the underlying generic mechanism.</p></div>
<div class="paragraph"><p>The interface to some of the existing such facilities has changed somewhat.
For example, the MLRiscControl module now provides mkFoo instead of getFoo.
(The getFoo interface is still there for backward-compatibility, but its
use is deprecated.)</p></div>
<div class="paragraph"><p>The <strong>ml-build</strong> script passes -Cxxx=yyy command-line arguments through so
that one can now twiddle the compiler settings when using this "batch"
compiler.</p></div>
<div class="paragraph"><p>TODO items:</p></div>
<div class="paragraph"><p>We should go through and throw out all controls that are no longer
connected to anything.  Moreover, we should go through and provide
meaningful (and correct!) documentation strings for those controls
that still are connected.</p></div>
<div class="paragraph"><p>Currently, multiple calls to Controls.new are accepted (only the first
has any effect).  Eventually we should make sure that every control
is being made (via Controls.new) exactly once.  Future access can then
be done using Controls.acc.</p></div>
<div class="paragraph"><p>Finally, it would probably be a good idea to use the getter-setter
interface to controls rather than ref cells.  For the time being, both
styles are provided by the Controls module, but getter-setter pairs are
better if thread-safety is of any concern because they can be wrapped.</p></div>
<div class="sidebarblock">
<div class="content">
<div class="paragraph"><p>+
One bug fix: The function blockPlacement in three of the MLRISC
backpatch files used to be hard-wired to one of two possibilities at
link time (according to the value of the placementFlag).  But (I
think) it should rather sense the flag every time.</p></div>
<div class="paragraph"><p>+</p></div>
</div></div>
<div class="paragraph"><p>Other assorted changes (by other people who did not supply a HISTORY entry):</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
the cross-module inliner now works much better (Monnier)
</p>
</li>
<li>
<p>
representation of weights, frequencies, and probabilities in MLRISC
   changed in preparation of using those for weighted block placement
   (Reppy, George)
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/07]
</dt>
<dd>
<div class="paragraph"><p>Tested the weighted block placement optimization on all architectures
(except the hppa) using AMPL to generate the block and edge frequencies.
Changes were required in the machine properties to correctly
categorize trap instructions. There is an MLRISC flag
"weighted-block-placement" that can be used to enable weighted block
placement, but this will be ineffective without block/edge
frequencies (coming soon).</p></div>
<div class="paragraph"><p>+
<span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/05]
</dt>
<dd>
<div class="paragraph"><p>In order to support the block placement optimization, a new cluster
is generated as the very first cluster (called the linkage cluster).
It contains a single jump to the <em>real</em> entry point for the compilation
unit. Block placement has no effect on the linkage cluster itself, but
all the other clusters  have full freedom in the manner in which they
reorder blocks or functions.</p></div>
<div class="paragraph"><p>On the x86 the typical linkage code that is generated is:
   ----------------------
        .align 2
   L0:
        addl    $L1-L0, 72(%esp)
        jmp     L1</p></div>
<div class="paragraph"><p>+
        .align  2
   L1:
   ----------------------</p></div>
<div class="paragraph"><p>72(%esp) is the memory location for the stdlink register. This
must contain the address of the CPS function being called. In the
above example, it contains the address of  L0; before
calling L1 (the real entry point for the compilation unit), it
must contain the address for L1, and hence</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>addl $L1-L0, 72(%esp)</pre>
</div></div>
<div class="paragraph"><p>I have tested this on all architectures except the hppa.The increase
in code size is of course negligible</p></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/03/03]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>Added #[ ... ] expressions to mlrisc tools</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/02/27]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
made types in structure C and C_Debug to be equal
</p>
</li>
<li>
<p>
got rid of code duplication (c-int.sml vs. c-int-debug.sml)
</p>
</li>
<li>
<p>
there no longer is a C_Int_Debug (C_Debug is directly derived from C)
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/02/26]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Fixed a minor bug in CM&#8217;s "noweb" tool:
   If numbering is turned off, then truly don&#8217;t number (<em>i.e.</em>, do not
   supply the -L option to noweb).  The previous behavior was to supply
   -L''&#8201;&#8212;&#8201;which caused noweb to use the "default" line numbering scheme.
   Thanks to Chris Richards for pointing this out (and supplying the fix).
</p>
</li>
<li>
<p>
Once again, I reworked some aspects of the FFI:
</p>
<div class="olist upperalpha"><ol class="upperalpha">
<li>
<p>
The incomplete/complete type business:
</p>
<div class="ulist"><ul>
<li>
<p>
Signatures POINTER_TO_INCOMPLETE_TYPE and accompanying functors are
     gone!
</p>
</li>
<li>
<p>
ML types representing an incomplete type are now <strong>equal</strong> to
     ML types representing their corresponding complete types (just like
     in C).  This is still safe because ml-nlffigen will not generate
     RTTI for incomplete types, nor will it generate functions that
     require access to such RTTI.   But when ML code generated from both
     incomplete and complete versions of the C type meet, the ML types
     are trivially interoperable.
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>NOTE:  These changes restore the full generality of the translation
(which was previously lost when I eliminated functorization)!</pre>
</div></div>
</li>
</ul></div>
</li>
<li>
<p>
Enum types:
</p>
<div class="ulist"><ul>
<li>
<p>
Structure C now has a type constructor "enum" that is similar to
     how the "su" constructor works.  However, "enum" is not a phantom
     type because each "T enum" has values (and is isomorphic to
     MLRep.Signed.int).
</p>
</li>
<li>
<p>
There are generic access operations for enum objects (using
     MLRep.Signed.int).
</p>
</li>
<li>
<p>
ml-nlffigen will generate a structure E_foo for each "enum foo".
</p>
<div class="ulist"><ul>
<li>
<p>
The structure contains the definition of type "mlrep" (the ML-side
     representation type of the enum).  Normally, mlrep is the same
     as "MLRep.Signed.int", but if ml-nlffigen was invoked with "-ec",
     then mlrep will be defined as a datatype&#8201;&#8212;&#8201;thus facilitating
     pattern matching on mlrep values.
     ("-ec" will be suppressed if there are duplicate values in an
      enumeration.)
</p>
</li>
<li>
<p>
Constructors ("-ec") or values (no "-ec") e_xxx of type mlrep
     will be generated for each C enum constant xxx.
</p>
</li>
<li>
<p>
Conversion functions m2i and i2m convert between mlrep and
     MLRep.Signed.int.  (Without "-ec", these functions are identities.)
</p>
</li>
<li>
<p>
Coversion functions c and ml convert between mlrep and "tag enum".
</p>
</li>
<li>
<p>
Access functions (get/set) fetch and store mlrep values.
</p>
</li>
</ul></div>
</li>
<li>
<p>
By default (unless ml-nlffigen was invoked with "-nocollect"), unnamed
     enumerations are merged into one single enumeration represented by
     structure E_'.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</li>
</ol></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/02/25]
</dt>
<dd>
<div class="paragraph"><p>This is a new implementation of the CPS spill phase.
The new phase is in the new file compiler/CodeGen/cpscompile/spill-new.sml
In case of problems, replace it with the old file spill.sml</p></div>
<div class="paragraph"><p>The current compiler runs into some serious performance problems when
constructing a large record.  This can happen when we try to compile a
structure with many items.  Even a very simple structure like the following
makes the compiler slow down.</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>    <span class="kr">structure</span> <span class="nn">Foo</span> <span class="p">=</span> <span class="kr">struct</span>
       <span class="kr">val</span> <span class="nv">x_1</span> <span class="p">=</span> <span class="mi">0w1</span> <span class="p">:</span> <span class="nn">Word32</span><span class="p">.</span><span class="n">int</span>
       <span class="kr">val</span> <span class="nv">x_2</span> <span class="p">=</span> <span class="mi">0w2</span> <span class="p">:</span> <span class="nn">Word32</span><span class="p">.</span><span class="n">int</span>
       <span class="kr">val</span> <span class="nv">x_3</span> <span class="p">=</span> <span class="mi">0w3</span> <span class="p">:</span> <span class="nn">Word32</span><span class="p">.</span><span class="n">int</span>
       <span class="p">...</span>
       <span class="kr">val</span> <span class="nv">x_N</span> <span class="p">=</span> <span class="mi">0</span><span class="n">wN</span> <span class="p">:</span> <span class="nn">Word32</span><span class="p">.</span><span class="n">int</span>
    <span class="kr">end</span>
</pre></div></div></div>
<div class="paragraph"><p>The following table shows the compile time, from N=1000 to N=4000,
with the old compiler:</p></div>
<div class="paragraph"><p>N
1000   CPS 100 spill                           0.04u  0.00s  0.00g
       MLRISC ra                               0.06u  0.00s  0.05g
          (spills = 0 reloads = 0)
       TOTAL                                   0.63u  0.07s  0.21g</p></div>
<div class="paragraph"><p>1100   CPS 100 spill                           8.25u  0.32s  0.64g
       MLRISC ra                               5.68u  0.59s  3.93g
          (spills = 0 reloads = 0)
       TOTAL                                   14.71u  0.99s  4.81g</p></div>
<div class="paragraph"><p>1500   CPS 100 spill                           58.55u  2.34s  1.74g
       MLRISC ra                               5.54u  0.65s  3.91g
          (spills = 543 reloads = 1082)
       TOTAL                                   65.40u  3.13s  6.00g</p></div>
<div class="paragraph"><p>2000   CPS 100 spill                           126.69u  4.84s  3.08g
       MLRISC ra                               0.80u  0.10s  0.55g
          (spills = 42 reloads = 84)
       TOTAL                                   129.42u  5.10s  4.13g</p></div>
<div class="paragraph"><p>3000   CPS 100 spill                           675.59u  19.03s  11.64g
       MLRISC ra                               2.69u  0.27s  1.38g
          (spills = 62 reloads = 124)
       TOTAL                                   682.48u  19.61s  13.99g</p></div>
<div class="paragraph"><p>4000   CPS 100 spill                           2362.82u  56.28s  43.60g
       MLRISC ra                               4.96u  0.27s  2.72g
          (spills = 85 reloads = 170)
       TOTAL                                   2375.26u  57.21s  48.00g</p></div>
<div class="paragraph"><p>As you can see the old cps spill module suffers from some serious
performance problem.  But since I cannot decipher the old code fully,
instead of patching the problems up, I&#8217;m reimplementing it
with a different algorithm.  The new code is more modular,
smaller when compiled, and substantially faster
(O(n log n) time and O(n) space).  Timing of the new spill module:</p></div>
<div class="paragraph"><p>4000  CPS 100 spill                           0.02u  0.00s  0.00g
      MLRISC ra                               0.25u  0.02s  0.15g
         (spills=1 reloads=3)
      TOTAL                                   7.74u  0.34s  1.62g</p></div>
<div class="paragraph"><p>Implementation details:</p></div>
<div class="paragraph"><p>As far as I can tell, the purpose of the CPS spill module is to make sure the
number of live variables at any program point (the bandwidth)
does not exceed a certain limit, which is determined by the
size of the spill area.</p></div>
<div class="paragraph"><p>When the bandwidth is too large, we decrease the register pressure by
packing live variables into spill records.  How we achieve this is
completely different than what we did in the old code.</p></div>
<div class="paragraph"><p>First, there is something about the MLRiscGen code generator
that we should be aware of:</p></div>
<div class="paragraph"><p><strong>MLRiscGen performs code motion!</strong></p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>In particular, it will move floating point computations and
address computations involving only the heap pointer to
their use sites (if there is only a single use).
What this means is that if we have a CPS record construction
statement</pre>
</div></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>       <span class="n">RECORD</span><span class="p">(</span><span class="n">k</span><span class="p">,</span><span class="n">vl</span><span class="p">,</span><span class="n">w</span><span class="p">,</span><span class="n">e</span><span class="p">)</span>
</pre></div></div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>we should never count the new record address w as live if w
has only one use (which is often the case).</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>We should do something similar to floating point, but the transformation
there is much more complex, so I won't deal with that.</pre>
</div></div>
<div class="paragraph"><p>Secondly, there are now two new cps primops at our disposal:</p></div>
<div class="openblock">
<div class="content">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
rawrecord of record_kind option
    This pure operator allocates some uninitialized storage from the heap.
    There are two forms:
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>rawrecord NONE [INT n]  allocates a tagless record of length n
rawrecord (SOME rk) [INT n] allocates a tagged record of length n
                            and initializes the tag.</pre>
</div></div>
</li>
<li>
<p>
rawupdate of cty
      rawupdate cty (v,i,x)
      Assigns to x to the ith component of record v.
      The storelist is not updated.
</p>
</li>
</ol></div>
</div></div>
<div class="paragraph"><p>We use these new primops for both spilling and increment record construction.</p></div>
<div class="openblock">
<div class="content">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Spilling.
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>This is implemented with a linear scan algorithm (but generalized
to trees).  The algorithm will create a single spill record at the
beginning of the cps function and use rawupdate to spill to it,
and SELECT or SELp to reload from it.  So both spills and reloads
are fine-grain operations.  In contrast, in the old algorithm
"spills" have to be bundled together in records.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Ideally, we should sink the spill record construction to where
it is needed.  We can even split the spill record into multiple ones
at the places where they are needed.  But CPS is not a good
representation for global code motion, so I'll keep it simple and
am not attempting this.</pre>
</div></div>
</li>
<li>
<p>
Incremental record construction (aka record splitting).
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>Long records with many component values which are simulatenously live
(recall that single use record addresses are not considered to
 be live) are constructed with rawrecord and rawupdate.
We allocate space on the heap with rawrecord first, then gradually
fill it in with rawupdate.  This is the technique suggested to me
by Matthias.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Some restrictions on when this is applicable:
a. It is not a VECTOR record.  The code generator currently does not handle
   this case. VECTOR record uses double indirection like arrays.
b. All the record component values are defined in the same "basic block"
   as the record constructor.  This is to prevent speculative
   record construction.</pre>
</div></div>
</li>
</ol></div>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/02/22]
</dt>
<dd>
<div class="paragraph"><p>Minor bug fixes in the parser and rewriter</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/02/21]
</dt>
<dd>
<div class="paragraph"><p>Regenerated the peephole files.  Some contained typos in the specification
and some didn&#8217;t compile because of pretty printing bugs in the old version
of <em>nowhere</em>.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/02/19]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>Minor bug fixes to the mlrisc-tools library:</pre>
</div></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Fixed up parsing colon suffixed keywords
</p>
</li>
<li>
<p>
Added the ability to shut the error messages up
</p>
</li>
<li>
<p>
Reimplemented the pretty printer and fixed up/improved
       the pretty printing of handle and &#8594; types.
</p>
</li>
<li>
<p>
Fixed up generation of literal symbols in the nowhere tool.
</p>
</li>
<li>
<p>
Added some SML keywords to to sml.sty
</p>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/02/19]
</dt>
<dd>
<div class="paragraph"><p>A wild mix of changes, some minor, some major:</p></div>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
All C FFI-related libraries are now anchored under $c:
    $/c.cm      -&#8594; $c/c.cm
    $/c-int.cm  -&#8594; $c/internals/c-int.cm
    $/memory.cm -&#8594; $c/memory/memory.cm
</p>
</li>
<li>
<p>
"make" tool (in CM) now treats its argument pathname slightly
  differently:
</p>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
If the native expansion is an absolute name, then before invoking
       the "make" command on it, CM will apply OS.Path.mkRelative
       (with relativeTo = OS.FileSys.getDir()) to it.
</p>
</li>
<li>
<p>
The argument will be passed through to subsequent phases of CM
       processing without "going native".  In particular, if the argument
       was an anchored path, then "make" will not lose track of that anchor.
</p>
</li>
</ol></div>
</li>
<li>
<p>
Compiler backends now "know" their respective C calling conventions
  instead of having to be told about it by ml-nlffigen.  This relieves
  ml-nlffigen from one of its burdens.
</p>
</li>
<li>
<p>
The X86Backend has been split into X86CCallBackend and X86StdCallBackend.
</p>
</li>
<li>
<p>
Export C_DEBUG and C_Debug from $c/c.cm.
</p>
</li>
<li>
<p>
C type encoding in ml-nlffi-lib has been improved to model the conceptual
  subtyping relationship between incomplete pointers and their complete
  counterparts.  For this, ('t, 'c) ptr has been changed to 'o ptr&#8201;&#8212;&#8201;  with the convention of instantiating 'o with ('t, 'c) obj whenever
  the pointer target type is complete.  In the incomplete case, 'o
  will be instantiated with some "'c iobj"&#8201;&#8212;&#8201;a type obtained by
  using one of the functors PointerToIncompleteType or PointerToCompleteType.
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>Operations that work on both incomplete and complete pointer types are
typed as taking an 'o ptr while operations that require the target to
be known are typed as taking some ('t, 'c) obj ptr.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>voidptr is now a bit "more concrete", namely "type voidptr = void ptr'"
where void is an eqtype without any values.  This makes it possible
to work on voidptr values using functions meant to operate on light
incomplete pointers.</pre>
</div></div>
</li>
<li>
<p>
As a result of the above, signature POINTER_TO_INCOMPLETE_TYPE has
  been vastly simplified.
</p>
</li>
</ul></div>
</div></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/02/19]
</dt>
<dd>
<div class="paragraph"><p>Applied Chris Okasaki&#8217;s bug fix for priority queues.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_39_2002_02_15">Version 110.39; 2002/02/15</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/02/15]
</dt>
<dd>
<div class="paragraph"><p>Added EnvRef.listBoundSymbols and CM.State.showBindings.  Especially
the latter can be useful for exploring what bindings are available at
the interactive prompt.  (The first function returns only the list
of symbols that are really bound, the second prints those but also the
ones that CM&#8217;s autoloading mechanism knows about.)</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/02/15]
</dt>
<dd>
<div class="paragraph"><p>Two improvements to ml-nlffigen:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Write files only if they do not exist or if their current contents
     do not coincide with what&#8217;s being written.  (That is, avoid messing
     with the time stamps unless absolutely necessary.)
</p>
</li>
<li>
<p>
Implement a "repository" mechanism for generated files related
     to "incomplete pointer types".   See the README file for details.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/02/14]
</dt>
<dd>
<div class="paragraph"><p>Added a type <em>t t_</em> to tag.sml (in ml-nlffi-lib.cm).  This is required
because of the new and improved tag generation scheme.  (Thanks to Allen
Leung for pointing it out.)</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/02/14]
</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="paragraph"><p>Fixed the MLRISC bug sent by Markus Wenzel regarding the compilation
of Isabelle on the x86.</p></div>
<div class="paragraph"><p>+
From Allen:</p></div>
<div class="paragraph"><p>+
* I&#8217;ve found the problem:</p></div>
<div class="paragraph"><p>+
     in ra-core.sml, I use the counter "blocked" to keep track of the
     true number of elements in the freeze queue.  When the counter goes
     to zero, I skip examining the queue.  But I&#8217;ve messed up the
     bookkeeping in combine():</p></div>
<div class="paragraph"><p>+</p></div>
<div class="listingblock">
<div class="content"><div class="highlight"><pre>         <span class="kr">else</span> <span class="p">();</span>
         <span class="kr">case</span> <span class="n">!ucol</span> <span class="kr">of</span>
           <span class="n">PSEUDO</span> <span class="p">=&gt;</span> <span class="p">(</span><span class="kr">if</span> <span class="n">!cntv</span> <span class="n">&gt;</span> <span class="mi">0</span> <span class="kr">then</span>
                 <span class="p">(</span><span class="kr">if</span> <span class="n">!cntu</span> <span class="n">&gt;</span> <span class="mi">0</span> <span class="kr">then</span> <span class="n">blocked</span> <span class="n">:=</span> <span class="n">!blocked</span> <span class="n">-</span> <span class="mi">1</span> <span class="kr">else</span> <span class="p">();</span>
                                    <span class="n">^^^^^^^^^^^^^^^^^^^^^^^</span>
                  <span class="n">moveu</span> <span class="n">:=</span> <span class="n">mergeMoveList</span><span class="p">(</span><span class="n">!movev</span><span class="p">,</span> <span class="n">!moveu</span><span class="p">)</span>
                 <span class="p">)</span>
              <span class="kr">else</span> <span class="p">();</span>
</pre></div></div></div>
<div class="paragraph"><p>+
     combine() is called to coalesce two nodes u and v.
     I think I was thinking that if the move counts of u and v are both
     greater than zero then after they are coalesced then one node is
     removed from the freeze queue.  Apparently I was thinking that
     both u and v are of low degree, but that&#8217;s clearly not necessarily true.</p></div>
<div class="paragraph"><p>+</p></div>
<div class="paragraph"><p>+
* 02/12/2002:</p></div>
<div class="paragraph"><p>+
    Here&#8217;s the patch.  HOL now compiles.</p></div>
<div class="paragraph"><p>+
    I don&#8217;t know how this impact on performance (compile
    time or runtime).  This bug caused the RA (especially on the x86)
    to go thru the potential spill phase when there are still nodes on the
    freeze queue.</p></div>
</div></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/02/13]
</dt>
<dd>
<div class="paragraph"><p>Fixed a bug in ml-nlffigen that was introduced with one of the previous
updates.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/02/13]
</dt>
<dd>
<div class="paragraph"><p>Added new priority queue export symbols (which have just been added to
smlnj-lib.cm) to CML&#8217;s version of smlnj-lib.cm.  (Otherwise CML would
not compile and the installer would choke.)</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/02/13]
</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
More tweaks to ml-nlffigen:
</p>
<div class="ulist"><ul>
<li>
<p>
better internal datastructures (resulting in slight speedup)
</p>
</li>
<li>
<p>
"-match" option requires exact match
</p>
</li>
<li>
<p>
"localized" gensym counters (untagged structs/unions nested within
     other structs/unions or within typedefs get a fresh counter; their
     tag will be prefixed by a concatenation of their parents' tags)
</p>
</li>
<li>
<p>
bug fixes (related to calculation of transitive closure of types
     to be included in the output)
</p>
</li>
</ul></div>
</li>
<li>
<p>
Minor Basis updates:
</p>
<div class="ulist"><ul>
<li>
<p>
added implementations for List.collate and Option.app
</p>
</li>
</ul></div>
</li>
</ol></div>
</div></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/02/11]
</dt>
<dd>
<div class="paragraph"><p>Added a "-gensym" option to command line of ml-nlffigen.  This can be
used to specify a "stem"&#8201;&#8212;&#8201;a string that is inserted in all "gensym&#8217;d"
names (ML structure names that correspond to unnamed C structs, unions,
and enums), so that separate runs of ml-nlffigen do not clash.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/02/11]
</dt>
<dd>
<div class="paragraph"><p>A quick fix for a problem with GenSML (in the pgraph-util library):
Make generation of toplevel "local" optional.  (Strictly speaking,
signature definitions within "local" are not legal SML.)</p></div>
<div class="paragraph"><p>Other than that: updates to INSTALL and cm/TODO.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_38_1_2002_02_08">Version 110.38.1; 2002/02/08</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/02/08]
</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
The installer (config/install.sh) has gotten smarter:
</p>
<div class="openblock">
<div class="content">
<div class="ulist"><ul>
<li>
<p>
Configuration options are a bit easier to specify now
       (in config/targets).
</p>
</li>
<li>
<p>
Bug in recognizing .tar.bz2 files fixed.
</p>
</li>
<li>
<p>
Installer automatically resolves dependencies between
       configuration options (<em>e.g.</em>, if you ask for eXene, you will
       also get cml&#8201;&#8212;&#8201;regardless whether you asked for it or not).
</p>
</li>
<li>
<p>
Installer can run in "quieter mode" by setting the environment
       variable INSTALL_QUIETLY to "true".  "Quieter" does not mean
       "completely silent", though.
</p>
</li>
<li>
<p>
Build HashCons library as part of smlnj-lib.
</p>
</li>
</ul></div>
</div></div>
</li>
<li>
<p>
A new scheme for assigning persistent identifiers to compilation
   units (and, by extension, to types etc.) has been put into place.
   This fixes a long-standing bug where types and even dynamic values
   can get internally confused, thereby compromising type safety
   (abstraction) and dynamic correctness.  See
     <a href="http://cm.bell-labs.com/cm/cs/who/blume/pid-confusion.tgz">http://cm.bell-labs.com/cm/cs/who/blume/pid-confusion.tgz</a>
   for an example of how things could go wrong until now.
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>The downside of the new scheme is that pids are not quite as
persistent as they used to be: CM will generate a fresh pid
for every compilation unit that it thinks it sees for the first
time.  That means that if you compile starting from a clean, fresh
source tree at two different times, you end up with different
binaries.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Cutoff recompilation, however, has not been compromised because
CM keeps pid information in special caches between runs.</pre>
</div></div>
</li>
</ol></div>
</div></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/02/07]
</dt>
<dd>
<div class="paragraph"><p>Compilers that generate assembly code may produce  global labels
whose value is resolved at link time. The various peephole optimization
modules did not take this in account.</p></div>
<div class="paragraph"><p>TODO. The Labels.addrOf function should really return an option
type so that clients are forced to deal with this issue, rather
than an exception being raised.</p></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/02/06]
</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
A bug fix from Allen:
    A typo causes extra <span class="monospaced">fstp %st(0)</span> instructions to be generated at compensation
    edges, which might cause stack underflow traps at runtime.  This
    occurs in fft where there are extraneous fstps right before the <span class="monospaced">into</span>
    trap instruction (in this case they are harmless since none of the
    integers overflow.)
</p>
</li>
<li>
<p>
Pulled out various utility modules that were embedded in the modules
   of the register allocator. I need these modules for other purposes, but
   they are not complete enough to put into a library (just yet).
</p>
</li>
</ol></div>
</div></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/01/31]
</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Fixed a bug where C-calls on SPARC needlessly allocated a huge chunk (96 bytes)
   of extra stack space by mistake.
</p>
</li>
<li>
<p>
Bug in logic of handling of command-line options in ml-nlffigen fixed.
</p>
</li>
</ol></div>
</div></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/01/30]
</dt>
<dd>
<div class="paragraph"><p>MLRISC bug fixes:</p></div>
</dd>
</dl></div>
<div class="openblock">
<div class="content">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Fixed a bindings computation bug in the <em>nowhere</em> program generator tool.
</p>
</li>
<li>
<p>
MachineInt.fromString was negating its value.
</p>
</li>
</ol></div>
</div></div>
<div class="paragraph"><p>+
<span class="owner">Allen Leung</span></p></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/01/29]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
Added somewhat detailed installation instructions (file INSTALL).
</p>
</li>
<li>
<p>
Fixed curl-detection bug in config/install.sh.
</p>
</li>
<li>
<p>
It is now possible to select the URL getter using the URLGETTER
  environment variable:
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>not set / "unknown"      --&gt; automatic detection (script tries wget,
                             curl, and lynx)
"wget" / "curl" / "lynx" --&gt; use the specified program (script "knows"
                             how to properly invoke them)
other                    --&gt; use $URLGETTER directly, it must take
                             precisely two command-line arguments
                             (source URL and destination file name)</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/01/28]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
Fixed problem with calculation of "used" registers in sparc-c-calls.
</p>
</li>
<li>
<p>
Make use of the allocParam argument in sparc-c-calls.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/01/28]
</dt>
<dd>
<div class="paragraph"><p>John Reppy:  Changes c-calls API to accept client-callback for
allocating extra stack space.
me: Corresponding changes to mlriscGen (using a dummy argument that
    does not change the current behavior).</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_38_2002_01_28">Version 110.38; 2002/01/28</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/01/28]
</dt>
<dd>
<div class="openblock">
<div class="content">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Retracted earlier 110.38.  (The Release_110_38 tag has been replaced
   with blume-Release_110_38-retracted.)
</p>
</li>
<li>
<p>
Fixed a problem with incorrect rounding modes in real64.sml.
   (Thanks to Andrew Mccreight &lt;<a href="mailto:andrew.mccreight@yale.edu">andrew.mccreight@yale.edu</a>&gt;.)
</p>
</li>
<li>
<p>
A bug in ml-nlffigen related to the handling of unnamed structs, unions,
   and enums fixed.  The naming of corresponding ML identifiers should
   now be consistent again.
</p>
</li>
</ol></div>
</div></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/01/27]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>Added a target called nowhere in the configuration scripts.
Enabling this will build the MLRISC 'nowhere' tool (for translating
programs with where-clauses into legal SML code) during installation.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/01/25]
</dt>
<dd>
<div class="paragraph"><p>Call it a (working) release!  Version is 110.38. Bootfiles are ready.</p></div>
<div class="paragraph"><p>README will be added later.</p></div>
<div class="paragraph"><p>!!! NOTE:  Re-tagged as blume-Release_110_38-retracted. Original tag
(Release_110_38) removed.  Reason: Last-minute bug fixes.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/01/25]
</dt>
<dd>
<div class="paragraph"><p>A large number of tweaks and improvements to ml-nlffi-lib and
ml-nlffigen:</p></div>
<div class="ulist"><ul>
<li>
<p>
ML represenation types have been streamlined
</p>
</li>
<li>
<p>
getter and setter functions work with concrete values, not abstract
     ones where possible
</p>
</li>
<li>
<p>
ml-nlffigen command line more flexible (see README file there)
</p>
</li>
<li>
<p>
some bugs have been fixed (hopefully)
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/01/24]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>There is a dramatic simplification in the interface to the
register allocator for RISC architectures as a result of making
parallel copy instructions explicit.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/01/22]
</dt>
<dd>
<div class="paragraph"><p>Bug fix for c-calls on x86 (having to do with how char- and
short-arguments are being handled).</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/01/21]
</dt>
<dd>
<div class="paragraph"><p>Another day of fiddling with the FFI&#8230;</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Bug fix/workaround:  CKIT does not complain about negative array
   dimensions, so ml-nlffigen has to guard itself against this possibility.
   (Otherwise a negative dimension would send it into an infinite loop.)
</p>
</li>
<li>
<p>
Some of the abstract types (light objects, light pointers, most "base"
   types) in structure C are now eqtypes.
</p>
</li>
<li>
<p>
Added constructors and test functions for NULL function pointers.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/01/18]
</dt>
<dd>
<div class="paragraph"><p>Made config/srcarchiveurl point to a new place.  (Will provide boot
files shortly.)</p></div>
<div class="paragraph"><p>Maybe we christen this to be 110.38?</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/01/18]
</dt>
<dd>
<div class="paragraph"><p>Today&#8217;s FFI fiddling:</p></div>
<div class="ulist"><ul>
<li>
<p>
Provided a structure CGetSet with "convenient" versions of C.Get.* and
    C.Set.* that use concrete (MLRep.*) arguments and results instead
    of abstract ones.
</p>
</li>
<li>
<p>
Provided word-style bit operations etc. for "int" representation
    types in MLRep.S&lt;Foo&gt;Bitops where &lt;Foo&gt; ranges over Char, Int, Short,
    and Long.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/01/18]
</dt>
<dd>
<div class="paragraph"><p>Now that x86-fast-fp seems to be working, I turned it back on again
by default.  (Seems to work fine now, even with the FFI.)</p></div>
<div class="paragraph"><p>Other than that, I added some documentation about the FFI to
src/ml-nlffigen/README and updated the FFI test examples in
src/ml-nlffi-lib/Tests/*.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/01/17]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Fixed a problem with handling return fp values when x86&#8217;s fast fp
      mode is turned on.
</p>
</li>
<li>
<p>
Minor pretty printing fix for cellset.  Print %st(0) as %st(0) instead
      of %f32.
</p>
</li>
<li>
<p>
Added a constructor INT32lit to the ast of MLRISC tools.
</p>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/01/16]
</dt>
<dd>
<div class="paragraph"><p>More fiddling with the FFI interface:</p></div>
<div class="ulist"><ul>
<li>
<p>
Make constness 'c instead of rw wherever possible.  This eliminates
   the need for certain explicit coercions.  (However, due to ML&#8217;s
   value polymorphism, there will still be many cases where explicit
   coercions are necessary.  Phantom types are not the whole answer
   to modeling a subtyping relationship in ML.)
</p>
</li>
<li>
<p>
ro/rw coersions for pointers added.  (Avoids the detour through */&amp;.)
</p>
</li>
<li>
<p>
"printf" test example added to src/ml-nlffi-lib/Tests.  (Demonstrates
   clumsy workaround for varargs problem.)
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/01/15]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Since COPY instructions are no longer native to the architecture,
   a generic functor can be used to implement the expandCopies function.
</p>
</li>
<li>
<p>
Allowed EXPORT and IMPORT pseudo-op declarations to appear inside a
   TEXT segment.
</p>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/01/15]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Fix for bug resulting in single-precision float values being returned
   incorrectly from FFI calls.
</p>
</li>
<li>
<p>
Small modifications to C FFI API:
</p>
<div class="ulist"><ul>
<li>
<p>
memory-allocation routines return straight objects (no options)
      and raise an exception in out-of-memory situations
</p>
</li>
<li>
<p>
unsafe extensions to cast between function pointers and pointers
      from/to ints
</p>
</li>
<li>
<p>
added structure C_Debug as an alternative to structure C where
      pointer-dereferencing (|<strong>| and |</strong>!) always check for null-pointers
</p>
</li>
<li>
<p>
added open_lib' to DynLinkage;  open_lib' works like open_lib
      but also takes a (possibly empty) list of existing library handles
      that the current library depends on
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2002/01/10]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Updates to portable graph code.
</p>
</li>
<li>
<p>
Major update to ml-nlffigen and ml-nlffi-lib.  Things are much
   more scalable now so that even huge interfaces such as the one
   for GTK compile in finite time and space. :-)
   See src/ml-nlffigen/README for details on what&#8217;s new.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/01/09]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>Removed the native COPY and FCOPY instructions
from all the architectures and replaced it with the
explicit COPY instruction from the previous commit.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>It is now possible to simplify many of the optimizations
modules that manipulate copies. This has not been
done in this change.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/12/06]
</dt>
<dd>
<div class="paragraph"><p>Changed the representation of instructions from being fully abstract
to being partially concrete. That is to say:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>from
      type instruction</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>to
      type instr                              (* machine instruction *)</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>datatype instruction =
    LIVE of {regs: C.cellset, spilled: C.cellset}
  | KILL of {regs: C.cellset, spilled: C.cellset}
  | COPYXXX of {k: CB.cellkind, dst: CB.cell list, src: CB.cell list}
  | ANNOTATION of {i: instruction, a: Annotations.annotation}
  | INSTR of instr</pre>
</div></div>
<div class="paragraph"><p>This makes the handling of certain special instructions that appear on
all architectures easier and uniform.</p></div>
<div class="paragraph"><p>LIVE and KILL say that a list of registers are live or killed at the
program point where they appear. No spill code is generated when an
element of the <em>regs</em> field is spilled, but the register is moved to
the <em>spilled</em> (which is present, more for debugging than anything else).</p></div>
<div class="paragraph"><p>LIVE replaces the (now deprecated) DEFFREG instruction on the alpha.
We used to generate:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>DEFFREG f1
f1 := f2 + f3
trapb</pre>
</div></div>
<div class="paragraph"><p>but now generate:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>f1 := f2 + f3
trapb
LIVE {regs=[f1,f2,f3], spilled=[]}</pre>
</div></div>
<div class="paragraph"><p>Furthermore, the DEFFREG (hack) required that all floating point instruction
use all registers mentioned in the instruction. Therefore f1 := f2 + f3,
defines f1 and uses [f1,f2,f3]! This hack is no longer required resulting
in a cleaner alpha implementation. (Hopefully, intel will not get rid of
this architecture).</p></div>
<div class="paragraph"><p>COPYXXX is intended to replace the parallel COPY and FCOPY  available on
all the architectures. This will result in further simplification of the
register allocator that must be aware of them for coalescing purposes, and
will also simplify certain aspects of the machine description that provides
callbacks related to parallel copies.</p></div>
<div class="paragraph"><p>ANNOTATION should be obvious, and now INSTR represents the honest to God
machine instruction set!</p></div>
<div class="paragraph"><p>The &lt;arch&gt;/instructions/&lt;arch&gt;Instr.sml files define certain utility
functions for making porting easier&#8201;&#8212;&#8201;essentially converting upper case
to lower case. All machine instructions (of type instr) are in upper case,
and the lower case form generates an MLRISC instruction. For example on
the alpha we have:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>datatype instr =
   LDA of {r:cell, b:cell, d:operand}
 | ...</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>val lda : {r:cell, b:cell, d:operand} -&gt; instruction
  ...</pre>
</div></div>
<div class="paragraph"><p>where lda is just (INSTR o LDA), etc.</p></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_37_2001_11_22">Version 110.37; 2001/11/22</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/11/21]
</dt>
<dd>
<div class="paragraph"><p>Removed the "Release_110_37" tag because of a serious bug.
This will be re-tagged once the bug is fixed.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/11/21]
</dt>
<dd>
<div class="paragraph"><p>Forgot to add a file.  (Just a .tex-file&#8201;&#8212;&#8201;part of
the CM manual source.)</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/11/21]
</dt>
<dd>
<div class="paragraph"><p>Note: I removed the original tag "Release_110_37" from this commit
      because we found a serious bug in all non-x86 backends.
      - Matthias</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Modifications to the SML/NJ code generator and to the runtime system
   so that code object name strings are directly inserted into code
   objects at code generation time.  The only business the runtime system
   has with this is now to read the name strings on occasions.
   (The encoding of the name string has also changed somewhat.)
</p>
</li>
<li>
<p>
CM now implements a simple "set calculus" for specifying export lists.
   In particular, it is now possible to refer to the export lists of
   other libraries/groups/sources and form unions as well as differences.
   See the latest CM manual for details.
</p>
</li>
<li>
<p>
An separate notion of "proxy" libraries has again be eliminated from
   CM&#8217;s model.  (Proxy libraries are now simply a special case of using
   the export list calculus.)
</p>
</li>
<li>
<p>
Some of the existing libraries now take advantage of the new set
   calculus.
   (Notice that not all libraries have been converted because some
   of the existing .cm-files are supposed to be backward compatible
   with 110.0.x.)
</p>
</li>
<li>
<p>
Some cleanup in stand-alone programs.  (Don&#8217;t use "exnMessage"&#8201;&#8212;&#8201;use
   "General.exnMessage"!  The former relies on a certain hook to be
   initialized, and that often does not happen in the stand-alone case.)
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/11/21]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>Implemented a complete redesign of MLRISC pseudo-ops. Now there
ought to never be any question of incompatabilities with
pseudo-op syntax expected by host assemblers.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>For now, only modules supporting GAS syntax are implemented
but more should follow, such as MASM, and vendor assembler
syntax, _e.g._ IBM as, Sun as, etc.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/11/14]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Routed the name of the current source file to mlriscgen where it
   should be directly emitted into the code object.  (This last part
   is yet to be done.)
</p>
</li>
<li>
<p>
Some cleanup of the pgraph code to make it match the proposal that
   I put out the other day.  (The proposal notwithstanding, things are
   still in flux here.)
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/11/14]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>Fix for a backpatching bug reported by Allen.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Because the boundary between short and long span-dependent
instructions is +/- 128, there are an astounding number of
span-dependent instructions whose size is over estimated.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Allen came up with the idea of letting the size of span
dependent instructions be non-monotonic, for a maxIter
number of times, after which the size must be monotonically
increasing.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>This table shows the number of span-dependent instructions
whose size was over-estimated as a function of maxIter, for the
file Parse/parse/ml.grm.sml:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>maxIter            # of instructions:
   10                      687
   20                      438
   30                      198
   40                        0</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>In compiling the compiler, there is no significant difference in
compilation speed between maxIter=10 and maxIter=40. Actually,
my measurements showed that maxIter=40 was a tad faster than
maxIter=10! Also 96% of the  files in the compiler reach a fix
point within 13 iterations, so fixing maxIter at 40, while high,
is okay.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/10/31]
</dt>
<dd>
<div class="paragraph"><p>CKIT:
* Changed the "Function" constructor of type Ast.ctype to carry optional
  argument identifiers.
* Changed the return type of TypeUtil.getFunction accordingly.
* Type equality ignores the argument names.
* TypeUtil.composite tries to preserve argument names but gives up quickly
  if there is a mismatch.</p></div>
<div class="paragraph"><p>installation script:
* attempts to use "curl" if available (unless "wget" is available as well)</p></div>
<div class="paragraph"><p>CM:
* has an experimental implementation of "portable graphs" which I will
  soon propose as an implementation-independent library format
* there are also new libraries $/pgraph.cm and $/pgraph-util.cm</p></div>
<div class="paragraph"><p>NLFFI-LIB:
* some cleanup (all cosmetic)</p></div>
<div class="paragraph"><p>NLFFIGEN:
* temporarily disabled the mechanism that suppresses ML output for
  C definitions whose identifiers start with an underscore character
* generate val bindings for enum constants
* user can request that only one style (light or heavy) is being used;
  default is to use both (command-line arguments: -heavy and -light)
* fixed bug in handling of function types involving incomplete pointers
* generate ML entry points that take record arguments (<em>i.e.</em>, using
  named arguments) for C functions that have a prototype with named
  arguments
  (see changes to CKIT)</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/10/27]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>Fixed the bug described in blume-20010920-slowfp.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>The fix involves
   1. generating FCOPYs in FSTP in ia32-svid
   2. marking a CALL with the appropriate annotation</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/10/16]
</dt>
<dd>
<div class="paragraph"><p>Underscore patch from Chris Richards (fixing problem with compiling
runtime system under recent NetBSD).</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/10/12]
</dt>
<dd>
<div class="paragraph"><p>X86RA now uses a valid (instead of dummy) PrintFlowgraph module.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/10/11]
</dt>
<dd>
<div class="paragraph"><p>The representation of a program point never expected to see more
than 65536 instructions in a basic block!</p></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/10/09]
</dt>
<dd>
<div class="paragraph"><p>Changed the machine description files to support printing of
local and global labels in assembly code, based on host assembler
conventions.</p></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/09/25]
</dt>
<dd>
<div class="paragraph"><p>I provided a non-hook implementation of exnName (at the toplevel) and
made the "dummy" implementation of exnMessage (at the toplevel) more
useful: if nothing gets "hooked in", then at least you are going to
see the exception name and a message indicating why you don&#8217;t see more.</p></div>
<div class="paragraph"><p>[For the time being, programs that need exnMessage and want to use
<strong>ml-build</strong> should either use General.exnMessage (strongly recommended) or
refer to structure General at some other point so that CM sees a
static dependency.]</p></div>
<div class="paragraph"><p>[Similar remarks go for "print" and "use":  If you want to use their
functionality in stand-alone programs generated by <strong>ml-build</strong>, then use
TextIO.output and Backend.Interact.useFile (from $smlnj/compiler.cm).]</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/09/20]
</dt>
<dd>
<div class="paragraph"><p>Allen says that x86-fast-fp is not safe yet, so I turned it off again&#8230;</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/09/20]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Updated the BOOT file (something that I forgot to do earlier).
</p>
</li>
<li>
<p>
Small internal change to CM so that it avoids "/../" in filenames
   as much as possible (but only where it is safe).
</p>
</li>
<li>
<p>
Changed config/_run-sml (resulting in a changed bin/.run-sml) so
   that arguments that contain delimiters are passed through correctly.
   This change also means that all "special" arguments of the form
   @SMLxxx&#8230; must come first.
</p>
</li>
<li>
<p>
Changed install script to put relative anchor names for tool commands
   into pathconfig.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_36_2001_09_18">Version 110.36; 2001/09/18</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/09/14]
</dt>
<dd>
<div class="paragraph"><p>John committed some changes that Allen made, in particular a (hopefully)
correctly working version of the x86-fp module.</p></div>
<div class="paragraph"><p>I changed the default setting of the Control.MLRISC.getFlag "x86-fast-fp"
flag to "true".  Everything seems to compile to a fixpoint ok, and
"mandelbrot" speeds up by about 15%.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/09/13]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Stefan Monnier&#8217;s patch to fix a miscompilation problem that
   was brought to light by John Reppy&#8217;s work on Moby.
</p>
</li>
<li>
<p>
Implemented a minimal "structure Compiler" that contains just
   "version" and "architecture".  The minimal version will be
   available when the full version is not.  This is for backward-
   compatibility with code that wants to test Compiler.version.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/08/28]
</dt>
<dd>
<div class="paragraph"><p>Fix for bug 1581, received from Neophytos Michael.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_35_2001_08_24">Version 110.35; 2001/08/24</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/08/24]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>removed clusters from MLRISC completely and replaced with graphs.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/08/23]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
some reorganization of the code that implements various kinds of
  environments in the compiler (static, dynamic, symbolic, combined)
</p>
</li>
<li>
<p>
re-implemented the EnvRef module so that evalStream works properly
  (if the stream contains references to "use", "CM.make", etc.)
</p>
</li>
<li>
<p>
cleaned up evalloop.sml and interact.sml (but they need more cleaning)
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/08/20]
</dt>
<dd>
<div class="paragraph"><p>I forgot to commit a few files.  Here they are&#8230;</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/08/20]
</dt>
<dd>
<div class="paragraph"><p>!!!! NEW BOOTFILES !!!!</p></div>
<div class="paragraph"><p>This is another round of reorganizing the compiler sources.  This
time the main goal was to factor out all the "instrumentation"
passes (for profiling and backtracing) into their own library.
The difficulty was to do it in such a way that it does not depend
on elaborate.cm but only on elabdata.cm.</p></div>
<div class="paragraph"><p>Therefore there have been further changes to both elaborate.cm and
elabdata.cm&#8201;&#8212;&#8201;more "generic" things have been moved from the former
to the latter.  As a result, I was forced to split the assignment
of numbers indicating "primtyc"s into two portions: SML-generic and
SML/NJ-specific.  Since it would have been awkward to maintain,
I bit the bullet and actually <em>changed</em> the mapping between these
numbers and primtycs.  The bottom line of this is that you need
a new set of bin- and bootfiles.</p></div>
<div class="paragraph"><p>I have built new bootfiles for all architectures, so doing a fresh
checkout and config/install.sh should be all you need.</p></div>
<div class="paragraph"><p>The newly created library&#8217;s name is</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>$smlnj/viscomp/debugprof.cm</pre>
</div></div>
<div class="paragraph"><p>and its sources live under</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>src/compiler/DebugProf</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/08/15]
</dt>
<dd>
<div class="paragraph"><p>This is a first cut at reorganizing the CM libraries that make up the
core of the compiler.  The idea is to separate out pieces that could
be used independently by tools, <em>e.g.</em>, the parser, the typechecker, etc.</p></div>
<div class="paragraph"><p>The current status is a step in this direction, but it is not quite
satisfactory yet.  Expect more changes in the future.</p></div>
<div class="paragraph"><p>Here is the current (new) organization&#8230;</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>What used to be $smlnj/viscomp/core.cm is now divided into
six CM libraries:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>$smlnj/viscomp/basics.cm
              /parser.cm
              /elabdata.cm
              /elaborate.cm
              /execute.cm
              /core.cm</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>The CM files for these libraries live under src/system/smlnj/viscomp.
All these libraries are proxy libraries that contain precisely
one CM library component.  Here are the locations of the components
(all within the src/compiler tree):</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Basics/basics.cm
Parse/parser.cm
ElabData/elabdata.cm
Elaborator/elaborate.cm
Execution/execute.cm
core.cm</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>[This organization is the same that has been used already
for a while for the architecture-specific parts of the visible
compiler and for the old version of core.cm.]</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>As you will notice, many source files have been moved from their
respective original locations to a new home in one of the above
subtrees.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>The division of labor between the new libraries is the following:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>basics.cm:
   - Simple, basic definitions that pertain to many (or all) of
     the other libraries.
parser.cm:
   - The SML parser, producing output of type Ast.dec.
   - The type family for Ast is also defined and exported here.
elabdata.cm:
   - The datatypes that describe input and output of the elaborator.
     This includes types, absyn, and static environments.
elaborator.cm:
   - The SML/NJ type checker and elaborator.
     This maps an Ast.dec (with a given static environment) to
     an Absyn.dec (with a new static environment).
   - This libraries implements certain modules that used to be
     structures as functors (to remove dependencies on FLINT).
execute.cm:
   - Everything having to do with executing binary code objects.
   - Dynamic environments.
core.cm:
   - SML/NJ-specific instantiations of the elaborator and MLRISC.
   - Top-level modules.
   - FLINT (this should eventually become its own library)</pre>
</div></div>
<div class="paragraph"><p>Notes:</p></div>
<div class="paragraph"><p>I am not 100% happy with the way I separated the elaborator (and its
data structures) from FLINT.  Two instances of the same problem:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Data structures contain certain fields that carry FLINT-specific
       information.  I hacked around this using exn and the property list
       module from smlnj-lib.  But the fact that there are middle-end
       specific fields around at all is a bit annoying.
</p>
</li>
<li>
<p>
The elaborator calculates certain FLINT-related information.  I tried
       to make this as abstract as I could using functorization, but, again,
       the fact that the elaborator has to perform calculations on behalf
       of the middle-end at all is not nice.
</p>
</li>
<li>
<p>
Having to used exn and property lists is unfortunate because it
       weakens type checking.  The other alternative (parameterizing
       nearly <strong>everything</strong>) is not appealing, though.
</p>
<div class="paragraph"><p>I removed the "rebinding =" warning hack because due to the new organization
it was awkward to maintain it.  As a result, the compiler now issues some of
these warnings when compiling init.cmi during bootstrap compilation. On
the plus side, you also get a warning when you do, for example:
   val op = = Int32.+
which was not the case up to now.</p></div>
<div class="paragraph"><p>I placed "assign" and "deref" into the _Core structure so that the
code that deals with the "lazy" keyword can find them there.  This
removes the need for having access to the primitive environment
during elaboration.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/08/13]
</dt>
<dd>
<div class="paragraph"><p>This fix was sent to us by Zhong Shao.  It is supposed to improve the
performance of certain loops by avoiding needless closure allocation.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/07/31]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>There was a bug where call instructions would mysteriously
vanish. The call instruction had to be one that returned
a floating point value.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/07/19]
</dt>
<dd>
<div class="paragraph"><p>I have dramatically simplified the interface for CELLS in MLRISC.</p></div>
<div class="paragraph"><p>In summary, the cells interface is broken up into three parts:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
CellsBasis : CELLS_BASIS
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>CellsBasis is a top level structure and common for all
architectures.  it contains the definitions of basic datatypes
and utility  functions over these types.</pre>
</div></div>
</li>
<li>
<p>
functor Cells() : CELLS
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>Cells generates an interface for CELLS that incorporates the
specific resources on the target architecture, such as the
presence of special register classes, their number and size,
and various useful substructures.</pre>
</div></div>
</li>
<li>
<p>
&lt;ARCH&gt;CELLS
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>_e.g._ SparcCells: SPARCCELLS</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>&lt;ARCH&gt;CELLS usually contains additional bindings for special
registers  on the architecture, such as:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>val r0 : cell           (* register zero *)
val y : cell            (* Y register *)
val psr : cell          (* processor status register *)
...</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>The structure returned by applying the Cells functor is opened
in this interface.</pre>
</div></div>
<div class="paragraph"><p>The main implication of all this is that the datatypes for cells is
split between CellsBasis and CELLS&#8201;&#8212;&#8201;a fairly simple change for user
code.</p></div>
<div class="paragraph"><p>In the old scheme the CELLS interface had a definitional binding of
the form:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>signature CELLS = sig</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>structure CellsBasis = CellsBasis</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>...</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>end</pre>
</div></div>
<div class="paragraph"><p>With all the sharing constraints that goes on in MLRISC, this old
design  quickly leads to errors such as:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>"structure definition spec inside of sharing ... "</pre>
</div></div>
<div class="paragraph"><p>+
and appears to require an unacceptable amount of sharing and where
constraint hackery.</p></div>
<div class="paragraph"><p>I think this error message (the interaction of definitional specs and
sharing) requires more explanation on our web page.</p></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/07/19]
</dt>
<dd>
<div class="paragraph"><p>This update puts together a fairly extensive but straightforward change
to the way the libraries that implement the interactive system are
organized:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>The biggest change is the elimination of structure Compiler.  As a
replacement for this structure, there is now a CM library
(known as $smlnj/compiler.cm or $smlnj/compiler/current.cm)
that exports all the substructures of the original structure Compiler
directly.  So instead of saying Compiler.Foo.bar one now simply
says Foo.bar.  (The CM libraries actually export a collection of
structures that is richer than the collection of substructures of
structure Compiler.)</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>To make the transition smooth, there is a separate library called
$smlnj/compiler/compiler.cm which puts together and exports the
original structure Compiler (or at least something very close to it).</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>There are five members of the original structure Compiler
that are not exported directly but which instead became members
of a new structure Backend (described by signature BACKEND).  These are:
structure Profile (: PROFILE), structure Compile (: COMPILE), structure
Interact (: INTERACT), structure Machine (: MACHINE), and val
architecture (: string).</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Structure Compiler.Version has become structure CompilerVersion.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Cross-compilers for alpha32, hppa, ppc, sparc, and x86 are provided
by $smlnj/compiler/&lt;arch&gt;.cm where &lt;arch&gt; is alpha32, hppa, ppc, sparc,
or x86, respectively.
Each of these exports the same frontend structures that
$smlnj/compiler.cm exports.  But they do not have a structure Backend
and instead export some structure &lt;Arch&gt;Backend where &lt;Arch&gt; is Alpha32,
Hppa, PPC, Sparc, or X86, respectively.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Library $smlnj/compiler/all.cm exports the union of the exports of
$smlnj/compiler/&lt;arch&gt;.cm</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>There are no structures &lt;Arch&gt;Compiler anymore, use
$smlnj/compiler/&lt;arch&gt;.cm instead.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Library host-compiler-0.cm is gone.  Instead, the internal library
that instantiates CM is now called cm0.cm.  Selection of the host
compiler (backend) is no longer done here but. (Responsibility for it
now lies with $smlnj/compiler/current.cm.  This seems to be more
logical.)</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Many individual files have been moved or renamed.  Some files have
been split into multiple files, and some "dead" files have been deleted.</pre>
</div></div>
<div class="paragraph"><p>Aside from these changes to library organization, there are also changes
to the way the code itself is organized:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Structure Binfile has been re-implemented in such a way that it no
longer needs any knowledge of the compiler.  It exclusively deals
with the details of binfile layout.  It no longer invokes the
compiler (for the purpose of creating new prospective binfile
content), and it no longer has any knowledge of how to interpret
pickles.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Structure Compile (: COMPILE) has been stripped down to the bare
essentials of compilation.  It no longer deals with linking/execution.
The interface has been cleaned up considerably.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Utility routines for dealing with linking and execution have been
moved into their own substructures.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>(The ultimate goal of these changes is to provide a light-weight
binfile loader/linker (at least for, _e.g._, stable libraries) that
does not require CM or the compiler to be present.)</pre>
</div></div>
<div class="paragraph"><p>CM documentation has been updated to reflect the changes to library
organization.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/07/10]
</dt>
<dd>
<div class="paragraph"><p>Minor tweak to 110.34 (re-tagged):</p></div>
<div class="ulist"><ul>
<li>
<p>
README.html file added to CVS repository
</p>
</li>
<li>
<p>
runtime compiles properly under FreeBSD 3.X and 4.X
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_34_2001_07_10">Version 110.34; 2001/07/10</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/07/09]
</dt>
<dd>
<div class="paragraph"><p>I changed the handling of varargs in ml-nlffigen again:
The ellipsis &#8230; will now simply be ignored (with an accompanying warning).</p></div>
<div class="paragraph"><p>The immediate effect is that you can actually call a varargs function
from ML&#8201;&#8212;&#8201;but you can&#8217;t actually supply any arguments beyond the ones
specified explicitly.  (For example, you can call printf with its format
string, but you cannot pass additional arguments.)</p></div>
<div class="paragraph"><p>This behavior is only marginally more useful than the one before, but
it has the advantage that a function or, more importantly, a function
type never gets dropped on the floor, thus avoiding follow-up problems with
other types that refer to the offending one.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/07/09]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
ckit-lib.cm now exports structure Error
</p>
</li>
<li>
<p>
ml-nlffigen reports occurences of "&#8230;" (<em>i.e.</em>, varargs function types)
   with a warning accompanied by a source location.  Moreover, it
   merely skips the offending function or type and proceeds with the
   rest of its work.u  As a result, one can safely feed C code containing
   "&#8230;" to ml-nlffigen.
</p>
</li>
<li>
<p>
There are some internal improvements to CM, providing slightly
   more general string substitutions in the tools subsystem.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/06/27]
</dt>
<dd>
<div class="paragraph"><p>Fixed a small bug in CM&#8217;s handling of parallel compilation.
(You could observe the bug by Control-C-interrupting an ordinary
CMB.make or CM.stabilize and then attaching some compile servers.
The result was that all of a sudden the previously interrupted
compilation would continue on its own.  This was because of
an over-optimization: CM did not bother to clean out certain queues
when no servers were attached "anyway", resulting in the contents
of these queues to grab control when new servers did get attached.)</p></div>
<div class="paragraph"><p>There is also another minor update to the CM manual.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/06/26]
</dt>
<dd>
<div class="paragraph"><p>Minor typo fixed in CM manual (syntax diagram for libraries).</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/06/25]
</dt>
<dd>
<div class="paragraph"><p>Fixed a nasty bug in the X86 assembly code that caused signal
handlers to fail (crash) randomly.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/06/25]
</dt>
<dd>
<div class="paragraph"><p>This update fixes a number of minor bugs in ml-nlffigen as reported by
Nick Carter &lt;<a href="mailto:nbc@andrew.cmu.edu">nbc@andrew.cmu.edu</a>&gt;.</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Silly but ok typedefs of the form "typedef void myvoid;" are now accepted.
</p>
</li>
<li>
<p>
Default names for generated files are now derived from the name of
     the C file <strong>without its directory</strong>.  In particular, this causes generated
     files to be placed locally even if the C file is in some system directory.
</p>
</li>
<li>
<p>
Default names for generated signatures and structures are also derived
     from the C file name without its directory.  This avoids silly things
     like "structure GL/GL".
     (Other silly names are still possible because ml-nlffigen does not do
      a thorough check of whether generated names are legal ML identifiers.
      When in doubt, use command line arguments to force particular names.)
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/06/21]
</dt>
<dd>
<div class="paragraph"><p>eXene now compiles and (sort of) works again.</p></div>
<div class="paragraph"><p>The library name (for version &gt; 110.33) is $/eXene.cm.</p></div>
<div class="paragraph"><p>I also added an new example in src/eXene/examples/nbody.  See the
README file there for details.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/06/20]
</dt>
<dd>
<div class="paragraph"><p>CML now compiles and works again.</p></div>
<div class="paragraph"><p>Libraries (for version &gt; 110.33):</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>$cml/cml.cm            Main CML library.
$cml/basis.cm          CML's version of $/basis.cm.
$cml/cml-internal.cm   Internal helper library.
$cml/core-cml.cm       Internal helper library.
$cml-lib/trace-cml.cm  Tracing facility.
$cml-lib/smlnj-lib.cm  CML's version of $/smlnj-lib.cm</pre>
</div></div>
<div class="paragraph"><p>The installer (config/install.sh) has been taught how to properly
install this stuff.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/06/19]
</dt>
<dd>
<div class="paragraph"><p>This un-breaks the fix for bug 1432.
(The bug was originally fixed in 110.9 but I broke it again some
time after that.)</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/06/19]
</dt>
<dd>
<div class="paragraph"><p>This should (hopefully) fix the long-standing signal handling bug.
(The runtime system was constructing a continuation record with an
incorrect descriptor which would cause the GC to drop data on the floor&#8230;)</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/06/15]
</dt>
<dd>
<div class="paragraph"><p>Here is a short late-hour update related to Sparc c-calls:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>-- made handling of double-word arguments a bit smarter</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>-- instruction selection phase tries to collapse certain clumsily
   constructed ML-Trees; typical example:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>ADD(ty,ADD(_,e,LI d1),LI d2)  -&gt;  ADD(ty,e,LI(d1+d2))</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>This currently has no further impact on SML/NJ since mlriscGen does
not seem to generate such patterns in the first place, and c-calls
(which did generate them in the beginning) has meanwhile been fixed
so as to avoid them as well.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/06/15]
</dt>
<dd>
<div class="paragraph"><p>The purpose of this update is to provide an implementation of NLFFI
on Sparc machines.</p></div>
<div class="paragraph"><p>Here are the changes in detail:</p></div>
<div class="ulist"><ul>
<li>
<p>
src/MLRISC/sparc/c-calls/sparc-c-calls.sml is a new file containing
   the Sparc implementation of the c-calls API.
</p>
</li>
<li>
<p>
The Sparc backend of SML/NJ has been modified to uniformely use %fp
   for accessing the ML frame.  Thus, we have a real frame pointer and
   can freely modify %sp without need for an omit-frame-ptr phase.
   The vfp logic in src/compiler/CodeGen/* has been changed to accomodate
   this case.
</p>
</li>
<li>
<p>
ml-nlffigen has been taught to produce code for different architectures
   and calling conventions.
</p>
</li>
<li>
<p>
In a way similar to what was done in the x86 case, the Sparc
   backend uses its own specific extension to mltree.  (For example,
   it needs to be able to generate UNIMP instructions which are part
   of the calling convention.)
</p>
</li>
<li>
<p>
ml-nlffi-lib was reorganized to make it more modular (in particular,
   to make it easier to plug in new machine- and os-dependent parts).
</p>
<div class="paragraph"><p>There are some other fairly unrelated bug fixes and cleanups as well:</p></div>
</li>
<li>
<p>
I further hacked the .cm files for MLRISC tools (like MDLGen) so
   that they properly share their libraries with existing SML/NJ libraries.
</p>
</li>
<li>
<p>
I fixed a minor cosmetic bug in CM, supressing certain spurious
   follow-up error messages.
</p>
</li>
<li>
<p>
Updates to CM/CMB documentation.
</p>
<div class="paragraph"><p>TODO items:</p></div>
</li>
<li>
<p>
MLRISC should use a different register as its asmTemp on the Sparc.
     (The current %o2 is a really bad choice because it is part of the
     calling conventions, so things might interfere in unexpected ways.)
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/06/07]
</dt>
<dd>
<div class="paragraph"><p>A number of internal changes related to C calls and calling conventions:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
ML-Tree CALL statements now carry a "pops" field.  It indicates the
   number of bytes popped implicitly (by the callee).  In most cases
   this field is 0 but on x86/win32 it is some non-zero value.  This
   is information provided for the benefit of the "omit-frameptr" pass.
</p>
</li>
<li>
<p>
The CALL instruction on the x86 carries a similar "pops" field.
   The instruction selection phase copies its value from the ML-Tree
   CALL statement.
</p>
</li>
<li>
<p>
On all other architectures, the instruction selection phase checks
   whether "pops=0" and complains if not.
</p>
</li>
<li>
<p>
The c-calls implementation for x86 now accepts two calling conventions:
   "ccall" and "stdcall".  When "ccall" is selected, the caller cleans
   up after the call and pops is set to 0.  For "stdcall", the caller
   does nothing, leaving the cleanup to the callee; pops is set to
   the number of bytes that were pushed onto the stack.
</p>
</li>
<li>
<p>
The cproto decoder (compiler/Semant/types/cproto.sml) now can
   distinguish between "ccall" and "stdcall".
</p>
</li>
<li>
<p>
The UNIMP instruction has been added to the supported Sparc instruction
   set. (This is needed for implementing the official C calling convention
   on this architecture.)
</p>
</li>
<li>
<p>
I fixed some of the .cm files under src/MLRISC/Tools to make them
   work with the latest CM.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/06/05]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
The "lambdasplit" parameter for class "sml" in CM has been documented.
</p>
</li>
<li>
<p>
CM can now generate "index files".  These are human-readable files
   that list on a per-.cm-file basis each toplevel symbol defined or
   imported.  The location of the index file for
   &lt;p&gt;/&lt;d&gt;.cm is &lt;p&gt;/CM/INDEX/&lt;d&gt;.cm.
   To enable index-file generation, set CM.Control.generate_index to true
   or export an environment-symbol: export CM_GENERATE_INDEX=true.
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>The CM manual has been updated accordingly.</pre>
</div></div>
</li>
<li>
<p>
I made some slight modifications to the c-calls API in MLRISC.
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>a) There is now a callback to support saving/restoring of
   dedicated but caller-save registers around the actual call
   instruction.
b) One can optionally specify a comment-annotation for the
   call instruction.</pre>
</div></div>
</li>
<li>
<p>
SML/NJ (mlriscGen.sml) uses this new API for the rawccall primop.
   (For example, the comment annotation shows the C prototype of
    the function being called.)
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/06/01]
</dt>
<dd>
<div class="paragraph"><p>This is mostly a cleanup of MLFFI stuff:</p></div>
<div class="ulist"><ul>
<li>
<p>
some signature files have been put into a more exposed place
</p>
</li>
<li>
<p>
the ugly 'f type parameter is gone (simplifies types tremendously!)
</p>
</li>
<li>
<p>
ml-nlffigen changed accordingly
</p>
</li>
<li>
<p>
tutorial updated
</p>
<div class="paragraph"><p>Other changes:</p></div>
</li>
<li>
<p>
author&#8217;s affiliation in CM manual(s) updated
</p>
</li>
<li>
<p>
some more recognized keywords added to Allen&#8217;s sml.sty
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/05/25]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
put the official 110.33-README (as it appears on the ftp server) under
    CVS
</p>
</li>
<li>
<p>
fixed a small bug related to incomplete pointer types in
    ml-nlffigen
</p>
</li>
<li>
<p>
small cosmetic change to the ml-nlffi-lib&#8217;s "arr" type constructor
    (it does not need the 'f type parameter)
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_33_2001_05_23">Version 110.33; 2001/05/23</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/05/22]
</dt>
<dd>
<div class="paragraph"><p>Made install.sh use file config/targets.customized if it exists, falling
back to config/targets if it doesn&#8217;t.  This way one can have a customized
version of the targets file without touching the "real thing", thus
eliminating the constant fear of accidentally checking something bogus
back into the CVS repository&#8230;  (File config/targets.customized must
not be added to the repository!)</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/05/22]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Bug fix in ml-nlffigen; now (hopefully) correctly handling
   struct returns.
</p>
</li>
<li>
<p>
Added src/ml-nlffi-lib/Doc/mini-tutorial.txt.  This is some very
   incomplete, preliminary documentation for NLFFI.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/05/14]
</dt>
<dd>
<div class="paragraph"><p>Some bugs in install script fixed.</p></div>
<div class="paragraph"><p>In addition to that I also made a slight change to the NLFFI API:
Functors generated by ml-nlffigen now take the dynamic library as a
straight functor argument, not as a suspended one.  (The original
functor code used to force the suspension right away anyway, so there
was nothing gained by this complication of the interface.)</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/05/11]
</dt>
<dd>
<div class="paragraph"><p>I finally took the plunge and added my new FFI code to the main
repository.  For x86-linux it is now ready for prime-time.</p></div>
<div class="paragraph"><p>There are two new subdirectories of "src":</p></div>
<div class="ulist"><ul>
<li>
<p>
ml-nlffi-lib:
       The utility library for programs using the FFI interface.
       Here is the implementation of $/c.cm and its associated low-level
       partners $/c-int.cm and $/memory.cm.
</p>
</li>
<li>
<p>
ml-nlffigen:
       A stand-alone program for generating ML glue code from C source
       code.
</p>
<div class="paragraph"><p>Building ml-nlffigen requires $/ckit-lib.cm.</p></div>
<div class="paragraph"><p>The config/install.sh script has been updates to do the Right Thing
(hopefully).</p></div>
<div class="paragraph"><p>Notice that the source tree for the C-Kit will not be put under "src"
but directly under the installation root directory.  (This is the
structure that currently exists on the CVS server when you check out
module "sml".)  Fortunately, config/install.sh knows about this oddity.</p></div>
<div class="paragraph"><p>Bugs: No documentation yet.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/05/09]
</dt>
<dd>
<div class="paragraph"><p>Fixed a bug in the accounting code in cpsopt/contract.sml.  (The
wrapper/unwrapper elimination did not decrement usage counts and some
dead variables got overlooked by the dead-up logic.)</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/05/08]
</dt>
<dd>
<div class="paragraph"><p>Changes to implement the omit-frame-pointer optimization to support
raw C calls. For now, there is only support on the Intel x86, but
other architectures will follow as more experience is gained with this.</p></div>
<div class="paragraph"><p>+
<span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/05/07]
</dt>
<dd>
<div class="paragraph"><p>I made into "proxy libraries" all libraries that qualify for such a
change.  (A qualifying library is a library that has another library or
groups as its sole member and repeats that member&#8217;s export list
verbatim.  A proxy library avoids this repetition by omitting its export
list, effectively inheriting the list that its (only) member exports.
See the CM manual for more explanation.)
The main effect is that explicit export lists for these libraries
do not have to be kepts in sync, making maintenance a bit easier.</p></div>
<div class="paragraph"><p>I also added copyright notices to many .cm-files.</p></div>
<div class="paragraph"><p>Last but not least, I made a new set of bootfiles.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/05/04]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
John merged pending changes to $/smlnj-lib.cm
</p>
</li>
<li>
<p>
Allen&#8217;s previous change accidentally backed out of one of Lal&#8217;s
   earlier changes.  I undid this mistake (re-introducing Lal&#8217;s change).
</p>
</li>
<li>
<p>
I used the new topOrder' function from graph-scc.sml (from $/smlnj-lib.cm)
   within the compiler where applicable.  There is some code simplification
   because of that.
</p>
</li>
<li>
<p>
The "split" phase (in FLINT) is now part of the default list of phases.
   Compiler.Control.LambdaSplitting.* can be used to globally control the
   lambda-splitting (cross-module-inlining) engine.  In addition to that,
   it can now also be controlled on a per-source basis: CM has been taught
   a new tool parameter applicable to ML source files.
</p>
<div class="ulist"><ul>
<li>
<p>
To turn lambda-splitting off completely:
        local open Compiler.Control.LambdaSplitting in
            val _ = set Off
        end
</p>
</li>
<li>
<p>
To make "no lambda-splitting" the global default (but allow per-source
     overriding); this is the initial setting:
        local open Compiler.Control.LambdaSplitting in
            val _ = set (Default NONE)
        end
</p>
</li>
<li>
<p>
To make "lambda-splitting with aggressiveness a" the global default
     (and allow per-source overriding):
        local open Compiler.Control.LambdaSplitting in
            val _ = set (Default (SOME a))
        end
</p>
</li>
<li>
<p>
To turn lambda-splitting off for a given ML souce file (say: a.sml)
     write (in the respective .cm-file):
        a.sml (lambdasplitting:off)
</p>
</li>
<li>
<p>
To turn lambda-splitting for a.sml on with minimal aggressiveness:
        a.sml (lambdasplitting:on)
</p>
</li>
<li>
<p>
To turn lambda-splitting for a.sml on with aggressiveness &lt;a&gt; (where
     &lt;a&gt; is a decimal non-negative integer):
        a.sml (lambdasplitting:&lt;a&gt;)
</p>
</li>
<li>
<p>
To turn lambda-splitting for a.sml on with maximal aggressiveness:
        a.sml (lambdasplitting:infinity)
</p>
</li>
<li>
<p>
To use the global default for a.sml:
        a.sml (lambdasplitting:default)
     or simply
        a.sml
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/05/04]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>MLRISC features.</pre>
</div></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Fix to <span class="monospaced">CMPXCHG</span> instructions.
</p>
</li>
<li>
<p>
Changed RA interface to allow annotations in callbacks.
</p>
</li>
<li>
<p>
Added a new method to the stream interface to allow annotations updates.
</p>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/05/01]
</dt>
<dd>
<div class="paragraph"><p>Changed install.sh to use the current working directory instead of
/usr/tmp for a temporary file (pcedittmp).  The previous choice
of /usr/tmp caused trouble with MacOS X because of file premission
problems.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/04/20]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
added vp_limitPtrMask to vproc-state.h
   (for use by the raw-C-calls mechanism to implement proper interrupt
    handling)
</p>
</li>
<li>
<p>
made the ML compiler aware of various data-structure offsets so it
   can generate code for accessing the vp_inML flag and vp_limitPtrMask
</p>
</li>
<li>
<p>
tweaked mlriscGen.sml to have it emit interrupt-handling code for
   raw C-calls
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/04/20]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
Changes to port to Mac OS X; Darwin.
</p>
</li>
<li>
<p>
In the process I found that sqrt was broken on the PPC, because the
   fsqrt instruction is not implemented.
</p>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/04/18]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
fixed two off-by-4 errors in the x86-specific c-calls implementation
   (this bug prevented structure arguments containing pointers from being
    passed correctly)
</p>
</li>
<li>
<p>
changed the raw-C-call code in mlriscGen.sml in such a way that
   structure arguments are represented as a pointer to the beginning
   of the structure (instead of having a series of synthesized arguments,
   one for each structure member)
</p>
</li>
<li>
<p>
made makeml script&#8217;s verbosity level configurable via environment
   variable (MAKEML_VERBOSITY)
</p>
</li>
<li>
<p>
eliminated placeholder implementations for f32l, w16s, i16s, and f32s
   in rawmem-x86.sml; we are now using the real thing
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/03/22]
</dt>
<dd>
<div class="paragraph"><p>Created a new set of bootfiles (for your automatic installation convenience).</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/03/22]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
All "raw memory access" primitives for the new FFI are implemented now
   (at least on the x86).
</p>
</li>
<li>
<p>
Some further cleanup of CM&#8217;s parallel make mechanism.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/03/19]
</dt>
<dd>
<div class="paragraph"><p>Parallel make (using compile servers) now works again.</p></div>
<div class="paragraph"><p>To this end, CM.stabilize and CMB.make have been modified to work in
two passes when compile servers are attached:
   1. Compile everything, do not perform stabilization; this pass
      uses compile servers
   2. Stabilize everything; this pass does not use compile servers
If there are no compile servers, the two passes are combined into one
(as before).  Splitting the passes increases the inherent parallelism
in the dependency graph because the entire graph including all
libraries is available at the same time.  This, in turn, improves
server utilization.  The downside is that the master process will
have to do some extra work after compilation is done (because for
technical reasons it must re-read all the binfiles during stabilization).</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/03/16]
</dt>
<dd>
<div class="paragraph"><p>Created a new set of bootfiles (for your automatic installation convenience).</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/03/16]
</dt>
<dd>
<div class="paragraph"><p>This is a minor fixup for an (untagged) earlier commit by Allen.
(A file was missing).</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/03/05]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
New support for alternative control-flow in MLTREE.
   Currently we support
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>FLOW_TO(CALL ...., [k1,...,kn])</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>This is needed for 'cuts to' in C-- and try/handle-like constructs
in Moby</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>New assembler flag "asm-show-cutsto" to turn on control-flow debugging.</pre>
</div></div>
</li>
<li>
<p>
Register Allocator
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>Changes in interface [from Fermin, John]</pre>
</div></div>
</li>
<li>
<p>
Alpha 8-bit SLL support [Fermin]
</p>
</li>
<li>
<p>
All architectures
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>A new module (ClusterExpandCopies) for expanding parallel copies.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/02/27]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Alpha bug fix for CMOVNE
</p>
</li>
<li>
<p>
Handle mltree COND(..,FCMP &#8230;,&#8230;)
</p>
</li>
<li>
<p>
Bug fix in simplifier
</p>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/01/30]
</dt>
<dd>
<div class="paragraph"><p>This is just a minor update to sync my devel branch with the main brach.
The only visible change is the addition of some README files.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/01/12]
</dt>
<dd>
<div class="paragraph"><p>Made a new set of bootfiles that goes with the current state of the
repository.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/01/12]
</dt>
<dd>
<div class="paragraph"><p>I am just flushing out some minor changes that had accumulated in
my private branch in order to sync with the main tree.  (This is
mainly because I had CVS trouble when trying to merge <em>into</em> my
private branch.)</p></div>
<div class="paragraph"><p>Most people should be completely unaffected by this.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/01/22]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Removed the type LabelExp and replace it by MLTree.
</p>
</li>
<li>
<p>
Rewritten mltree-simplify with the pattern matcher tool.
</p>
</li>
<li>
<p>
There were some bugs in alpha code generator which would break
    64-bit code generation.
</p>
</li>
<li>
<p>
Redo the tools to generate code with the
</p>
</li>
<li>
<p>
The CM files in MLRISC (and in src/system/smlnj/MLRISC)
    are now generated by perl scripts.
</p>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/01/10]
</dt>
<dd>
<div class="paragraph"><p>The RCC stuff now seems to work (but only on the x86).
This required hacking of the c-calls interface (and -implementation) in
MLRISC.</p></div>
<div class="paragraph"><p>Normal compiler users should be unaffected.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/01/09]
</dt>
<dd>
<div class="paragraph"><p>This is a fairly big patch, flushing out a large number of pending
changes that I made to my development copy over the last couple of days.</p></div>
<div class="paragraph"><p>Of practical relevance at this moment is a workaround for a pickling
bug that Allen ran into the other day.  The cause of the bug itself is
still unknown and it might be hard to fix it properly, but the
workaround has some merits of its own (namely somewhat reducing pickling
overhead for certain libraries).  Therefore, I think this solution should
be satisfactory at this time.</p></div>
<div class="paragraph"><p>The rest of the changes (<em>i.e.</em>, the vast majority) has to do with my
ongoing efforts of providing direct support for C function calls from
ML.  At the moment there is a new primop "RAW_CCALL", typing magic
in types/cproto.sml (invoked from FLINT/trans/translate.sml), a new
case in the FLINT CPS datatype (RCC), changes to cps/convert.sml to
translate uses of RAW_CCALL into RCC, and changes to mlriscGen.sml to
handle RCC.</p></div>
<div class="paragraph"><p>The last part (the changes to mlriscGen.sml) are still known to be
wrong on the x86 and not implemented on all other architectures.  But
the infrastructure is in place. I had to change a few functor
signatures in the backend to be able to route the CCalls interface
from MLRISC there, and I had to specialize the mltree type (on the
x86) to include the necessary extensions. (The extensions themselves
were already there and redy to go in MLRISC/x86).</p></div>
<div class="paragraph"><p>Everything should be very happy as soon as someone helps me with
mlriscGen.sml&#8230;</p></div>
<div class="paragraph"><p>In any case, nothing of this should matter to anyone as long as the
new primop is not being used (which is going to be the case unless you
find it where I hid it :). The rest of the compiler is completely
unaffected.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2001/01/05]
</dt>
<dd>
<div class="paragraph"><p>Added some experimental support for work that I am doing right now.
These changes mostly concern added primops, but there is also a new
experimental C library in the runtime system (but currently not enabled
anywhere except on Linux/X86).</p></div>
<div class="paragraph"><p>In the course of adding primops (and playing with them), I discovered that
Zhong&#8217;s INL_PRIM hack (no type info for certain primops) was, in fact, badly
broken.  (Zhong was very right he labeled this stuff as "major gross hack".)
To recover, I made type information in INL_PRIM mandatory and changed
prim.sml as well as built-in.sml accordingly.  The InLine structure now
has complete, correct type information (<em>i.e.</em>, no bottom types).</p></div>
<div class="paragraph"><p>Since all these changes mean that we need new binfiles, I also bumped the
version number to 110.32.1.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/12/30]
</dt>
<dd>
<div class="paragraph"><p>Added proxy libraries for MLRISC and let MLRISC libraries refer
to each other using path anchors.  (See CM manual for explanation.)</p></div>
<div class="paragraph"><p>Updated CM documentation.</p></div>
<div class="paragraph"><p>Fixed some bugs in CM.</p></div>
<div class="paragraph"><p>Implemented "proxy" libraries (= syntactic sugar for CM).</p></div>
<div class="paragraph"><p>Added "-quiet" option to makeml and changed runtime system accordingly.</p></div>
<div class="paragraph"><p>Added cleanup handler for exportML to reset timers and compiler stats.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/12/22]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>Infinite precision used throughout MLRISC.
see MLRISC/mltree/machine-int.sig</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/12/22]
</dt>
<dd>
<div class="paragraph"><p>Corrected wording and formatting of some CM warning message which I
broke in my previous patch.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/12/22]
</dt>
<dd>
<div class="paragraph"><p>Fixed CM&#8217;s handling of anchor environments in connection with CMB.make.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/12/22]
</dt>
<dd>
<div class="paragraph"><p>Removed src/cm/ffi which does not (and did not) belong here.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/12/21]
</dt>
<dd>
<div class="paragraph"><p>Probably most important: CM no longer silently swallows all exceptions
in the compiler.
Plus: some other minor CM changes.  For example, CM now reports some
sizes for generated binfiles (code, data, envpickle, lambdapickle).</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/12/15]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
"dir" tool added.
</p>
</li>
<li>
<p>
improvements and cleanup to Tools structure
</p>
</li>
<li>
<p>
documentation updates
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/12/14]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>   In IntInf, added these standard functions, which are missing from our
implementation:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>andb : int * int -&gt; int
xorb : int * int -&gt; int
orb  : int * int -&gt; int
notb : int -&gt; int
 &lt;&lt;   : int * word -&gt; int
~&gt;&gt;  : int * word -&gt; int</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Not tested, I hope they are correct.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/12/08]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>  Slight improvements to the 'nowhere' tool to handle OR-patterns,
to generate better error messages etc.  Plus a brief manual.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/12/08]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
Version 110.31
</p>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/12/07]
</dt>
<dd>
<div class="paragraph"><p>Major MLRISC internal changes.  Affect all clients.
Summary:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Type CELLS.cell = int is now replaced by a datatype.
    As a result, the old regmap is now gone.  Almost all interfaces
    in MLRISC change as a consequence.
</p>
</li>
<li>
<p>
A new brand version of machine description tool (v3.0) that generates
    modules expecting the new interface.  The old version is removed.
</p>
</li>
<li>
<p>
The RA interface has been further abstracted into two new functors.
    RISC_RA and X86RA.  These functors have much simpler interfaces.
    [See also directory MLRISC/demo.]
</p>
</li>
<li>
<p>
Some other new source&#8594;source code generation tools are available:
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
MLRISC/Tools/RewriteGen&#8201;&#8212;&#8201;generate rewriters from rules.
</p>
</li>
<li>
<p>
MLRISC/Tools/WhereGen&#8201;&#8212;&#8201;expands conditional pattern matching rules.
       I use this tool to generate the peephole optimizers---with the new
       cell type changes, peephole rules are becoming difficult to write
       without conditional pattern matching.
</p>
</li>
</ol></div>
</li>
<li>
<p>
More Intmap &#8594; IntHashTable change.  Previous changes by Matthias didn&#8217;t
    cover the entire MLRISC source tree so many things broke.
</p>
</li>
<li>
<p>
CM files have been moved to the subdirectory MLRISC/cm.
    They are moved because there are a lot of them and they clutter up the
    root dir.
</p>
</li>
<li>
<p>
More detailed documentation to come&#8230;
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>NOTE: To rebuild from 110.30 (ftp distribution), you'll have to do
a makeml -rebuild first.  This is because of other other
changes that Matthias has made (see below).</pre>
</div></div>
<div class="paragraph"><p>+
<span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/11/30]
</dt>
<dd>
<div class="paragraph"><p>Some manual updates and some file reorganizations in CM.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/11/24]
</dt>
<dd>
<div class="paragraph"><p>Drastically improved link traversal code for the case that the dynamic
value was already loaded at bootstrap time.  As a result, CM and CMB
now both load blazingly fast&#8201;&#8212;&#8201;even on a very slow machine.  Also,
memory consumption has been further reduced by this.</p></div>
<div class="paragraph"><p>Warning: The format of the PIDMAP file has changed.  THerefore, to
bootstrap you have to do this:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Run CMB.make
</p>
</li>
<li>
<p>
Make a symbolic link for the boot directory:
     ln -s sml.boot.ARCH-OS xxx
</p>
</li>
<li>
<p>
"Rebuild" the boot directory:
     ./makeml -boot xxx -rebuild sml ; rm xxx
</p>
</li>
<li>
<p>
Boot normally:
      ./makeml
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/11/21]
</dt>
<dd>
<div class="paragraph"><p>Continued hacking on autoloading problem&#8201;&#8212;&#8201;with success this time.
Also changed tool-plugin mechanism.  See new CM manual.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/11/19]
</dt>
<dd>
<div class="paragraph"><p>Some hacking to make autoloading faster.  Success for CMB, no success
so far for CM.  There is a reduced structure CM' that autoloads faster.
(This is a temporary, non-documented hack to be eliminated again when
the general problem is solved.)</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/11/17]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Eliminated comp-lib.cm
</p>
</li>
<li>
<p>
Made pickle-lib.cm
</p>
</li>
<li>
<p>
Eliminated all uses of intset.sml (from comp-lib.cm)
</p>
</li>
<li>
<p>
Replaced all uses of intmap.{sig,sml} (from comp-lib.cm) with
   equivalent constructs from smlnj-lib.cm (INtHashTable).
</p>
</li>
<li>
<p>
Point 4. also goes for those uses of intmap.* in MLRISC.
   Duplicated intmap modules thrown out.
</p>
</li>
<li>
<p>
Hunted down all duplicated SCC code and replaced it with
   equivalent stuff (GraphSCCFn from smlnj-lib.cm).
</p>
</li>
<li>
<p>
Rewrote Feedback module.
</p>
</li>
<li>
<p>
Moved sortedlist.sml into viscomp-lib.cm.  Eventually it
   should be thrown out and equivalent modules from smlnj-lib.cm
   should be used (IntRedBlackSet, IntListSet, &#8230;).
</p>
<div class="paragraph"><p>Confirmed that compiler compiles to fixpoint.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/11/10]
</dt>
<dd>
<div class="paragraph"><p>A new x86 floating point code generator has been added.
By default this is turned off.  To turn this on, do:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>CM.autoload "$smlnj/compiler.cm";
Compiler.Control.MLRISC.getFlag "x86-fast-fp" := true;</pre>
</div></div>
<div class="paragraph"><p>Changes:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Changed FTAN to FPTAN so that the assembly output is correct.
</p>
</li>
<li>
<p>
Changed the extension callback for FTANGENT to generate:
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>      fptan
      fstp  %st(0)
instead of
      fptan
      fstpl ftempmem</pre>
</div></div>
</li>
<li>
<p>
Numerous assembly fixes for x86.
</p>
</li>
<li>
<p>
Cleaned up the machine code output module x86/x86MC.sml and added
    support for a whole bunch of instructions and addressing modes:
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>fadd/fsub/fsubr/fmul/fdiv/fdivr  %st, %st(n)
faddp/fsubp/fsubrp/fmulp/fdivp/fdivrp  %st, %st(n)
fadd/fsub/fsubr/fmul/fdiv/fdivr  %st(n), %st
fiadd/fisub/fisubr/fimul/fidiv/fidivr mem
fxch %st(n)
fld %st(n)
fst %st(n)
fst mem
fstp %st(n)
fucom %st(n)
fucomp %st(n)</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>All these are now generated when the fast fp mode is turned on.</pre>
</div></div>
</li>
<li>
<p>
Removed the dedicated registers %st(0), &#8230;, %st(7) from X86CpsRegs
</p>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/11/09]
</dt>
<dd>
<div class="paragraph"><p>Eliminated some code duplication:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Added "where" clause to GraphSCCFn in SML/NJ Library.
   (Otherwise the functor is useless.)
</p>
</li>
<li>
<p>
Used GraphSCCFn where SCCUtilFun was used previously.
</p>
</li>
<li>
<p>
Got rid of SCCUtilFun (in comp-lib.cm).
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_30_2000_11_06">Version 110.30; 2000/11/06</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/11/04]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
Made <strong>ml-build</strong> faster on startup.
</p>
</li>
<li>
<p>
Documentation fixes.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/11/02]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
Small tweaks to pickler&#8201;&#8212;&#8201;new BOOTFILES!
</p>
</li>
<li>
<p>
Version bumped to 110.29.2.
</p>
</li>
<li>
<p>
Added conditional compilation facility to init.cmi (see comment there).
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/10/23]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Minor RA changes that improves spilling on x86 (affects Moby and C-- only)
</p>
</li>
<li>
<p>
Test programs for the graph library updated
</p>
</li>
<li>
<p>
Some new MLRISC demo programs added
</p>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/08/31]
</dt>
<dd>
<div class="paragraph"><p>More error message grief: Where there used to be no messages, there
now were some that had bogus error regions.  Fixed.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_29_1_2000_08_31">Version 110.29.1; 2000/08/31</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/08/31]
</dt>
<dd>
<div class="paragraph"><p>I made a version 110.29.1 with new bootfiles.</p></div>
<div class="paragraph"><p>Changes:  Modified pickler/unpickler for faster and leaner unpickling.
          CM documentation changes and a small bugfix in CM&#8217;s error reporting.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/09/27]
</dt>
<dd>
<div class="paragraph"><p>Changed the type of the nodestatus, so that:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>SPILLED(~1)             is now SPILLED
SPILLED(m) where m&gt;=0   is now MEMREG(m)
SPILLED(s) where s&lt;~1   is now SPILL_LOC(~s)</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/09/07]
</dt>
<dd>
<div class="paragraph"><p>Small tweak to CM to avoid getting ML syntax error messages twice.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/08/31]
</dt>
<dd>
<div class="paragraph"><p>New URL for boot files (because the 110.29 files on the BL server do
now work correctly with my updated install scripts for yacc and lex).</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/08/08]
</dt>
<dd>
<div class="paragraph"><p>Tiny update to CM manual.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/08/7]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>  Moby, C--, SSA, x86, machine descriptions etc.  Should only affect C--
and Mobdy.</pre>
</div></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
x86
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
Fixes to peephole module by John and Dan.
</p>
</li>
<li>
<p>
Assembly fix to SETcc by Allen.
</p>
</li>
<li>
<p>
Fix to c-call by John.
</p>
</li>
<li>
<p>
Fix to spilling by John.  (This one deals with the missing FSTPT case)
</p>
</li>
<li>
<p>
Instruction selection optimization to SETcc as suggested by John.
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>For example,</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>MV(32, x, COND(32, CMP(32, LT, a, b), LI 1, LI 0))</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>should generate:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>MOVL a, x
SUBL b, x
SHRL 31, x</pre>
</div></div>
</li>
</ol></div>
</li>
<li>
<p>
IR stuff
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>A bunch of new DJ-graph related algorithms added.  These
speed up SSA construction.</pre>
</div></div>
</li>
<li>
<p>
SSA + Scheduling
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>Added code for SSA and scheduling to the repository</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/07/27]
</dt>
<dd>
<div class="paragraph"><p>+
 Made changes to support Linux PPC.
 p.s. I have confirmation that the 110.29 boot files work fine.</p></div>
<div class="paragraph"><p><span class="owner">Lal George</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/07/27]
</dt>
<dd>
<div class="paragraph"><p>!!!! WARNING !!!!
You must recompile the runtime system!
!!!! WARNING !!!!</p></div>
<div class="paragraph"><p>This is basically another round of script-enhancements:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
sml, <strong>ml-build</strong>, and <strong>ml-makedepend</strong> accept options -D and -U to define
   and undefine CM preprocessor symbols.
</p>
</li>
<li>
<p>
<strong>ml-build</strong> avoids generating a new heap image if it finds that the
   existing one is still ok.  (The condition is that no ML file had to
   be recompiled and all ML files are found to be older that the heap
   file.)
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>To make this work smoothly, I also hacked the runtime system as
well as SMLofNJ.SysInfo to get access to the heap image suffix
(.sparc-solaris, ...) that is currently being used.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Moreover, the signature of CM.mk_standalone has changed.  See the
CM manual.</pre>
</div></div>
</li>
<li>
<p>
<strong>ml-makedepend</strong> accepts additional options -n, -a, and -o.  (See the
   CM manual for details.)
</p>
</li>
<li>
<p>
More CM manual updates:
</p>
<div class="ulist"><ul>
<li>
<p>
all of the above has been documented.
</p>
</li>
<li>
<p>
there is now a section describing the (CM-related) command line
      arguments that are accepted by the "sml" command
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/07/25]
</dt>
<dd>
<div class="paragraph"><p>Added a script called <strong>ml-makedepend</strong>.  This can be used in makefiles
for Unix' make in a way very similar to the "makedepend" command for
C.</p></div>
<div class="paragraph"><p>The script internally uses function CM.sources.</p></div>
<div class="paragraph"><p>Synopsis:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>*ml-makedepend* [-f makefile] cmfile targetname</pre>
</div></div>
<div class="paragraph"><p>The default for the makefile is "makefile" (or "Makefile" should
"makefile" not exist).</p></div>
<div class="paragraph"><p><strong>ml-makedepend</strong> adds a cmfile/targetname-specific section to this
makefile (after removing the previous version of this section).  The
section contains a single dependency specification with targetname on
the LHS (targetname is an arbitrary name), and a list of files derived
from the cmfile on the RHS.  Some of the files on the RHS are
ARCH/OPSYS-specific.  Therefore, <strong>ml-makedepend</strong> inserts references to
"make" variables $(ARCH) and $(OPSYS) in place of the corresponding
path names.  The makefile writer is responsible for making sure that
these variables have correct at the time "make" is invoked.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/07/22]
</dt>
<dd>
<div class="paragraph"><p>Changed BOOT and config/srcarchiveurl to point to BL server:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>ftp://ftp.research.bell-labs.com/dist/smlnj/working/110.29/</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_29_2000_07_18">Version 110.29; 2000/07/18</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/07/18]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Updated src/compiler/TopLevel/main/version.sml to version 110.29
</p>
</li>
<li>
<p>
Updated config/version to 110.29
</p>
</li>
<li>
<p>
Updated config/srcarchiveurl
</p>
</li>
<li>
<p>
New boot files!
   <a href="ftp://ftp.cs.princeton.edu/pub/people/blume/sml/110.29-autofetch">ftp://ftp.cs.princeton.edu/pub/people/blume/sml/110.29-autofetch</a>
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/07/11]
</dt>
<dd>
<div class="paragraph"><p>Fixed a few typos in CM manual.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/06/15]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
x86 peephole improvement sp += k; sp -= k &#8658; nop  [from John]
</p>
</li>
<li>
<p>
fix to x86 RET bug [found by Dan Grossman]
</p>
</li>
<li>
<p>
sparc assembly bug fix for ticc instructions [found by Fermin]
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>Affects c-- and moby only</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/07/04]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Improvements to CM manual.
</p>
</li>
<li>
<p>
SMLofNJ.Internals.BTrace.trigger reinstated as an alternative way
   of getting a back-trace.  The function, when called, raises an
   internal exception which explicitly carries the full back-trace history,
   so it is unaffected by any intervening handle-raise pairs ("trivial"
   or not).  The interactive loop will print that history once it arrives
   at top level.
   Short of having all exceptions implicitly carry the full history, the
   recommended way of using this facility is:
</p>
<div class="ulist"><ul>
<li>
<p>
compile your program with instrumentation "on"
</p>
</li>
<li>
<p>
run it, when it raises an exception, look at the history
</p>
</li>
<li>
<p>
if the history is "cut off" because of some handler, go and modify
       your program so that it explicitly calls BTrace.trigger
</p>
</li>
<li>
<p>
recompile (still instrumented), and rerun; look at the full history
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/07/03]
</dt>
<dd>
<div class="paragraph"><p>Small corrections and updates to CM manual.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/06/29]
</dt>
<dd>
<div class="paragraph"><p>Changes:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Class "mlyacc" now takes separate arguments to pass options to
   generated .sml- and .sig-files independently.
</p>
</li>
<li>
<p>
Corresponding CM manual updates.
</p>
</li>
<li>
<p>
BTrace module now also reports call sites.  (However, for loop clusters
   it only shows from where the cluster was entered.)  There are associated
   modifications to core.sml, internals.{sig,sml}, btrace.sml, and btimp.sml.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/06/27]
</dt>
<dd>
<div class="paragraph"><p>Changes:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Implemented "subdir" and "witness" options for noweb tool.
    This caused some slight internal changes in CM&#8217;s tool implementation.
</p>
</li>
<li>
<p>
Fixed bug in "tool plugin" mechanism.  This is essentially cleaning
    some remaining issues from earlier path anchor changes.
</p>
</li>
<li>
<p>
Updated CM manual accordingly.
</p>
</li>
<li>
<p>
Changed implementation of back-tracing so that I now consider it
    ready for prime-time.
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>In particular, you don't have to explicitly trigger the back-trace
anymore.  Instead, if you are running BTrace-instrumented code and
there is an uncaught exception (regardless of whether or not it was
raised in instrumented code), the top-level evalloop will print
the back-trace.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Features:</pre>
</div></div>
<div class="ulist"><ul>
<li>
<p>
Instrumented and uninstrumented code work together seemlessly.
        (Of course, uninstrumented code is never mentioned in actual
         back-traces.)
</p>
</li>
<li>
<p>
Asymptotic time- and space-complexity of instrumented code is
        equal to that of uninstrumented code.  (This means that
        tail-recursion is preserved by the instrumentation phase.)
</p>
</li>
<li>
<p>
Modules whose code has been instrumented in different sessions
        work together without problem.
</p>
</li>
<li>
<p>
There is no penalty whatsoever on uninstrumented code.
</p>
</li>
<li>
<p>
There is no penalty on "raise" expressions, even in
        instrumented code.
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>A potential bug (or perhaps it is a feature, too):</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>A back-trace reaches no further than the outermost instrumented
non-trivial "raise".  Here, a "trivial" raise is one that is the
sole RHS of a "handle" rule.  Thus, back-traces reach trough</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>&lt;exp&gt; handle e =&gt; raise e</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>and even</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>&lt;exp&gt; handle Foo =&gt; raise Bar</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>and, of course, through</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>&lt;exp&gt; handle Foo =&gt; ...</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>if the exception was not Foo.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Back-traces always reach right through any un-instrumented code
including any of its "handle" expressions, trivial or not.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>To try this out, do the following:</pre>
</div></div>
</li>
<li>
<p>
Erase all existing binfiles for your program.
       (You may keep binfiles for those modules where you think you
        definitely don&#8217;t need back-tracing.)
</p>
</li>
<li>
<p>
Turn on back-trace instrumentation:
          SMLofNJ.Internals.BTrace.mode (SOME true);
</p>
</li>
<li>
<p>
Recompile your program.  (I.e., run "CM.make" or "use".)
</p>
</li>
<li>
<p>
You may now turn instrumentation off again (if you want):
          SMLofNJ.Internals.BTrace.mode (SOME false);
</p>
</li>
<li>
<p>
Run your program as usual.  If it raises an exception that
       reaches the interactive toplevel, then a back-trace will
       automatically be printed.  After that, the toplevel loop
       will print the exception history as usual.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/06/26]
</dt>
<dd>
<div class="paragraph"><p>CM: - setup-parameter to "sml" added; this can be used to run arbitrary
      ML code before and after compiling a file (<em>e.g.</em>, to set compiler
      flags)</p></div>
<div class="paragraph"><p>Compiler: - improved btrace API (in core.sml, internals.{sig,sml})
          - associated changes to btrace.sml (BTrace instrumentation pass)
          - cleaner implementation of btimp.sml (BTrace tracing and report
            module)</p></div>
<div class="paragraph"><p>CM manual: * new path encoding documented
           * description of setup-parameter to "sml" added</p></div>
<div class="paragraph"><p>The biggest user-visible change to back-tracing is that it is no
longer necessary to compile all traced modules within the same
session.  (This was a real limitation.)</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/06/24]
</dt>
<dd>
<div class="paragraph"><p>Fixes startup slowdown problem.  (I was calling SrcPath.sync a <em>tad</em>
bit too often&#8201;&#8212;&#8201;to put it mildly. :)</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/06/23]
</dt>
<dd>
<div class="paragraph"><p>This updates adds a backtrace facility to aid programmers in debugging
their programs.  This involves the following changes:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Module system/smlnj/init/core.sml (structure _Core) now has hooks for
   keeping track of the current call stack.  When programs are compiled
   in a special mode, the compiler will insert calls to these hooks
   into the user program.
   "Hook" means that it is possible for different implementations of
   back-tracing to register themselves (at different times).
</p>
</li>
<li>
<p>
compiler/MiscUtil/profile/btrace.sml implements the annotation phase
   as an Absyn.dec&#8594;Absyn.dec rewrite.  Normally this phase is turned off.
   It can be turned on using this call:
     SMLofNJ.Internals.BTrace.mode (SOME true);
   Turning it off again:
     SMLofNJ.Internals.BTrace.mode (SOME false);
   Querying the current status:
     SMLofNJ.Internals.BTrace.mode NONE;
   Annotated programs are about twice as big as normal ones, and they
   run a factor of 2 to 4 slower with a dummy back-trace plugin (one
   where all hooks do nothing).  The slowdown with a plugin that is
   actually useful (such as the one supplied by default) is even greater,
   but in the case of the default plugin it is still only an constant
   factor (amortized).
</p>
</li>
<li>
<p>
system/Basis/Implementation/NJ/internals.{sig,sml} have been augmented
   with a sub-structure BTrace for controlling back-tracing.  In particular,
   the above-mentioned function "mode" controls whether the annotation
   phase is invoked by the compiler.  Another important function is
   "trigger": when called it aborts the current execution and causes
   the top-level loop to print a full back-trace.
</p>
</li>
<li>
<p>
compiler/MiscUtil/profile/btimp.sml is the current default plugin
   for back-tracing.  It keeps track of the dynamic call stack and in
   addition to that it keeps a partial history at each "level" of that
   stack.  For example, if a tail-calls b, b tail-calls c, and c tail-calls
   d and b (at separate times, dynamically), then the report will show:
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>   GOTO   d
         /c
   GOTO  \b
   CALL   a</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>This shows that there was an initial non-tail call of a, then a
tail-call to b or c, looping behavior in a cluster of functions that
consist of b and c, and then a goto from that cluster (_i.e._, either from
b or from c) to d.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Note that (depending on the user program) the amount of information
that the back-trace module has to keep track of at each level is bounded
by a constant.  Thus, the whole implementation has the same asymptotical
complexity as the original program (both in space and in time).</pre>
</div></div>
</li>
<li>
<p>
compiler/TopLevel/interact/evalloop.sml has been modified to
   handle the special exception SMLofNJ.Internals.BTrace.BTrace
   which is raised by the "trigger" function mentioned above.
</p>
<div class="paragraph"><p>Notes on usage:</p></div>
<div class="ulist"><ul>
<li>
<p>
Annotated code works well together with unannotated code:
Unannotated calls simply do not show up at all in the backtrace.
</p>
</li>
<li>
<p>
It is not a good idea to let modules that were annotated during
different sessions run at the same time.  This is because the compiler
chooses small integers to identify individual functions, and there
will be clashes if different modules were compiled in separate sessions.
(Nothing will crash, and you will even be told about the clashes, but
back-trace information will in general not be useful.)
</p>
</li>
<li>
<p>
Back-tracing can be confused by callcc and capture.
</p>
</li>
<li>
<p>
The only way of getting a back-trace right now is to explicitly
invoke the "trigger" function from your user program.  Eventually, we
should make every exception carry back-trace information (if
available).  But since this creates more overhead at "raise"-time
(similar to the current exnHistory overhead), I have not yet
implemented this.  (The implementation will be rather easy.)  With
exceptions carrying back-trace information, this facility will be even
more useful because users don&#8217;t need to modify their programs&#8230;
</p>
</li>
<li>
<p>
While it is possible to compile the compiler with back-trace
annotations turned on (I did it to get some confidence in
correctness), you must make absolutely sure that core.sml and
btimp.sml are compiled WITHOUT annotation!  (core.sml cannot actually
be compiled with annotation because there is no core access yet, but
if you compile btimp.sml with annotation, then the system will go into
an infinite recursion and crash.)
Since CM currently does not know about BTrace, the only way to turn
annotations on and off for different modules of the compiler is to
interrupt CMB.make, change the settings, and re-invoke it.  Of course,
this is awkward and clumsy.
</p>
<div class="paragraph"><p>Sample sessions:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Standard ML of New Jersey v110.28.1 [FLINT v1.5], June 5, 2000
- SMLofNJ.Internals.BTrace.mode (SOME true);
[autoloading]
[autoloading done]
val it = false : bool
- structure X = struct
-     fun main n = let
-         fun a (x, 0) = d x
-           | a (x, n) = b (x, n - 1)
-         and b (x, n) = c (x, n)
-         and c (x, n) = a (x, n)
-         and d x = e (x, 3)
-         and e (x, 0) = f x
-           | e (x, n) = e (x, n - 1)
-         and f 0 = SMLofNJ.Internals.BTrace.trigger ()
-           | f n = n * g (n - 1)
-         and g n = a (n, 3)
-     in
-         f n
-     end
- end;
structure X : sig val main : int -&gt; int end
- X.main 3;
*** BACK-TRACE ***
GOTO   stdIn:4.2-13.20: X.main[2].f
GOTO-( stdIn:4.2-13.20: X.main[2].e
GOTO   stdIn:4.2-13.20: X.main[2].d
     / stdIn:4.2-13.20: X.main[2].a
     | stdIn:4.2-13.20: X.main[2].b
GOTO-\ stdIn:4.2-13.20: X.main[2].c
CALL   stdIn:4.2-13.20: X.main[2].g
GOTO   stdIn:4.2-13.20: X.main[2].f
GOTO-( stdIn:4.2-13.20: X.main[2].e
GOTO   stdIn:4.2-13.20: X.main[2].d
     / stdIn:4.2-13.20: X.main[2].a
     | stdIn:4.2-13.20: X.main[2].b
GOTO-\ stdIn:4.2-13.20: X.main[2].c
CALL   stdIn:4.2-13.20: X.main[2].g
GOTO   stdIn:4.2-13.20: X.main[2].f
GOTO-( stdIn:4.2-13.20: X.main[2].e
GOTO   stdIn:4.2-13.20: X.main[2].d
     / stdIn:4.2-13.20: X.main[2].a
     | stdIn:4.2-13.20: X.main[2].b
GOTO-\ stdIn:4.2-13.20: X.main[2].c
CALL   stdIn:4.2-13.20: X.main[2].g
GOTO   stdIn:4.2-13.20: X.main[2].f
CALL   stdIn:2.15-17.4: X.main[2]
-</pre>
</div></div>
<div class="paragraph"><p>(Note that because of a FLINt bug the above code currently does not
compile without BTrace turned on.)</p></div>
<div class="paragraph"><p>Here is another example, using my modified Tiger compiler:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Standard ML of New Jersey v110.28.1 [FLINT v1.5], June 5, 2000
- SMLofNJ.Internals.BTrace.mode (SOME true);
[autoloading]
[autoloading done]
val it = false : bool
- CM.make "sources.cm";
[autoloading]
...
[autoloading done]
[scanning sources.cm]
[parsing (sources.cm):parse.sml]
[creating directory CM/SKEL ...]
[parsing (sources.cm):tiger.lex.sml]
...
[wrote CM/sparc-unix/semant.sml]
[compiling (sources.cm):main.sml]
[wrote CM/sparc-unix/main.sml]
[New bindings added.]
val it = true : bool
- Main.compile ("../testcases/merge.tig", "foo.out");
*** BACK-TRACE ***
CALL   lib/semant.sml:99.2-396.21: SemantFun[2].transExp.trvar
CALL   lib/semant.sml:99.2-396.21: SemantFun[2].transExp.trexp
CALL   lib/semant.sml:289.3-295.22: SemantFun[2].transExp.trexp.check[2]
GOTO   lib/semant.sml:289.3-295.22: SemantFun[2].transExp.trexp.check[2]
CALL   lib/semant.sml:99.2-396.21: SemantFun[2].transExp.trexp
CALL   lib/semant.sml:99.2-396.21: SemantFun[2].transExp.trexp
CALL   lib/semant.sml:488.3-505.6: SemantFun[2].transDec.trdec[2].transBody[2]
     / lib/semant.sml:411.65-543.8: SemantFun[2].transDec
CALL-\ lib/semant.sml:413.2-540.9: SemantFun[2].transDec.trdec[2]
CALL   lib/semant.sml:99.2-396.21: SemantFun[2].transExp.trexp
CALL   lib/semant.sml:8.52-558.4: SemantFun[2].transProg[2]
CALL   main.sml:1.18-118.4: Main.compile[2]
-</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/06/21]
</dt>
<dd>
<div class="paragraph"><p>CM manual update: Path environments documented.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blumen</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/06/19]
</dt>
<dd>
<div class="paragraph"><p>CM manual and system/README update.  This only covers the fact that
there are no more implicit anchors.  (Path environments and the "bind"
option to "cm" have yet to be documented.)</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/06/19]
</dt>
<dd>
<div class="paragraph"><p>Fixed a bug in new SrcPath module that sometimes led to a bad chDir call.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/06/18]
</dt>
<dd>
<div class="paragraph"><p>I updates the previous HISTORY entry where I forgot to mention that
implicit anchors are no longer with us.</p></div>
<div class="paragraph"><p>The current update also gets rid of the (now useless) controller
CM.Control.implicit_anchors.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/06/16]
</dt>
<dd>
<div class="paragraph"><p>This patch implements the long anticipated (just kidding :) "anchor
environment" mechanism.  In the course of doing this, I also
re-implemented CM&#8217;s internal "SrcPath" module from scratch.  The new
one should be more robust in certain boundary cases.  In any case, it
is a lot cleaner than its predecessor (IMHO).</p></div>
<div class="paragraph"><p>This time, although there is yet another boot file format change, I
kept the unpickler backward-compatible.  As a result, no new bootfiles
are necessary and bootstrapping is straightforward.  (You cannot read
new bootfiles into an old system, but the other way around is no
problem.)</p></div>
<div class="paragraph"><p>Visible changes:</p></div>
<div class="openblock">
<div class="content">
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Implicit path anchors (without the leading $-symbol) are no
   longer recognized at all. This means that such path names are not
   illegal either.  For example, the name basis.cm simply refers to a
   local file called "basis.cm" (i.e, the name is an ordinary path
   relative to .cm-files directory).  Or, to put it differently, only
   names that start with $ are anchored paths.
</p>
</li>
<li>
<p>
The $&lt;singlearc&gt; abbreviation for $/&lt;singlearc&gt; has finally vanished.
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>John (Reppy) had critizised this as soon as I originally proposed and
implemented it, but at that time I did not really deeply believe
him. :) Now I came full-circle because I need the $&lt;singlearc&gt; syntax
in another place where it cannot be seen as an abbreviation for
$/&lt;singlearc&gt;.  To avoid the confusion, $&lt;singlearc&gt; now means what it
seems to mean (_i.e._, it "expands" into the corresponding anchor
value).</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>However, when paths are used as members in CM description files, it
continues to be true that there must be at least another arc after the
anchor.  This is now enforced separately during semantic analysis
(_i.e._, from a lexical/syntactical point of view, the notation is ok.)</pre>
</div></div>
</li>
<li>
<p>
The "cm" class now accepts an option "bind".  The option&#8217;s value
   is a sub-option list of precisely two items&#8201;&#8212;&#8201;one labeled "anchor"
   and the other one labeled "value".  As you might expect, "anchor" is
   used to specify an anchor name to be bound, and "value" specifies what
   the anchor is being bound to.
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>The value must be a directory name and can be given in either standard
syntax (including the possibility that it is itself an anchored path)
or native syntax.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Examples:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>foo.cm (bind:(anchor:bar value:$mystuff/bar))
lib.cm (bind:(anchor:a value:"H:\\x\\y\\z"))  (* only works under windows *)</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>and so on.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>The meaning of this is that the .cm-file will be processed with an
augmented anchor environment where the given anchor(s) is/are bound to
the given values(s).</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>The rationale for having this feature is this: Suppose you are trying
to use two different (already stable) libraries a.cm and b.cm (that
you perhaps didn't write yourself).  Further, suppose each of these
two libraries internally uses its own auxiliary library $aux/lib.cm.
Normally you would now have a problem because the anchor "lib" can not
be bound to more than one value globally.  Therefore, the project that
uses both a.cm and b.cm must locally redirect the anchor to some other
place:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>a.cm (bind:(anchor:lib value:/usr/lib/smlnj/a-stuff))
b.cm (bind:(anchor:lib value:/usr/lib/smlnj/b-stuff))</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>This hard-wires $lib/aux.cm to /usr/lib/smlnj/a-stuff/aux.cm or
/usr/lib/smlnj/b-stuff/aux.cm, respectively.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Hard-wiring path names is a bit inflexible (and CM will verbosely warn
you when you do so at the time of CM.stabilize).  Therefore, you can
also use an anchored path as the value:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>a.cm (bind:(anchor:lib value:$a-lib))
b.cm (bind:(anchor:lib value:$b-lib))</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Now you can globally configure (using the usual CM.Anchor.anchor or
pathconfig machinery) bindings for "a-lib" and "b-lib".  Since "lib"
itself is always locally bound, setting it globally is no longer
meaningful or necessary (but it does not hurt either).  In fact, "lib"
can still be used as a global anchor for separate purposes.  As a
matter of fact, one can locally define "lib" in terms of a global
"lib":</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>a.cm (bind:(anchor:lib value:$lib/a))
b.cm (bind:(anchor:lib value:$lib/b))</pre>
</div></div>
<div class="paragraph"><p>4: The encoding of path names has changed.  This affects the way
   path names are shown in CM&#8217;s progress report and also the internal
   protocol encoding used for parallel make.</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>The encoding now uses one or more ':'-separated segments.  Each
segments corresponds to a file that has been specified relative to the
file given by its preceding segment.  The first segment is either
relative to the CWD, absolute, or anchored.  Each segment itself is
basically a Unix pathname; all segments but the first are relative.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Example:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>$foo/bar/baz.cm:a/b/c.sml</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>This path denotes the file bar/a/b/c.sml relative to the directory
denoted by anchor "foo".  Notice that the encoding also includes
baz.cm which is the .cm-file that listed a/b/c.sml.  As usual, such
paths are resolved relative to the .cm-files directory, so baz.cm must
be ignored to get the "real" pathname.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>To make this fact more obvious, CM puts the names of such "virtual
arcs" into parentheses when they appear in progress reports. (No
parentheses will appear in the internal protocol encoding.)  Thus,
what you really see is:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>$foo/bar/(baz.cm):a/b/c.sml</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>I find this notation to be much more informative than before.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Another new feature of the encoding is that special characters
including parentheses, colons, (back)slashes, and white space are
written as \ddd (where ddd is the decimal encoding of the character).</pre>
</div></div>
</li>
</ol></div>
</div></div>
<div class="paragraph"><p><strong>NOTE:</strong> The CM manual still needs to be updated.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/06/15]
</dt>
<dd>
<div class="paragraph"><p>x86 Peephole fix by Fermin.  Affects c-- and moby only.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/06/12]
</dt>
<dd>
<div class="paragraph"><p>More cleanup after changing the file naming scheme: This time I
repaired the parallel make mechanism for CMB.make which I broke earlier.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/06/09]
</dt>
<dd>
<div class="paragraph"><p>None of these things should affect normal SML/NJ operations</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Peephole improvements provided by Fermin (c--)
</p>
</li>
<li>
<p>
New annotation DEFUSE for adding extra dependence (moby)
</p>
</li>
<li>
<p>
New X86 LOCK instructions (moby)
</p>
</li>
<li>
<p>
New machine description language for reservation tables (scheduling)
</p>
</li>
<li>
<p>
Fixes to various optimization/analysis modules (branch chaining, dominator
   trees etc.)
</p>
</li>
<li>
<p>
I&#8217;ve changed the CM files so that they can work with versions
   110.0.6, 110.25 and 110.28
</p>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/06/09]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
Removed all(?) remaining RCS Log entries from sources.
</p>
</li>
<li>
<p>
Fixed bug in <strong>ml-yacc</strong> and <strong>ml-lex</strong> sources (use explicit anchors for
  anchored paths).
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/06/07]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
This update changes the default setting for
CM.Control.implicit_anchors from true to false.  This means that
implicit anchors are no longer permitted by default.  I also tried to
make sure that nothing else still relies on implicit anchors.
(This is the next step on the schedule towards a CM that does not even
have the notion of implicit anchors anymore.)
</p>
</li>
<li>
<p>
More CM manual updates.
</p>
</li>
<li>
<p>
I managed to track down and fix the pickling bug I mentioned last
time.  Because of the previously existing workaround, this entails no
immediate practical changes.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_28_1_2000_06_06">Version 110.28.1; 2000/06/06</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/06/06]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
The main purpose of this update is to make library pickles lazier in
order to reduce the initial space penalty for autoloading a library.
As a result, it is now possible to have $smlnj/compiler.cm
pre-registered.  This should take care of the many complaints or
inquiries about missing structure Compiler.  This required changes to
CM&#8217;s internal data structures and small tweaks to some algorithms.
</p>
<div class="paragraph"><p>As a neat additional effect, it is no longer necessary (for the sake
of lean heap image files) to distinguish between a "minimal" CM and a
"full" CM.  Now, there is only one CM (<em>i.e.</em>, the "full" version:
$smlnj/cm.cm aka $smlnj/cm/full.cm), and it is always available at the
interactive top level. ($smlnj/cm/minimal.cm is gone.)</p></div>
<div class="paragraph"><p>To make the life of compiler-hackers easier, "makeml" now also
pre-registers $smlnj/cmb.cm (aka $smlnj/cmb/current.cm).  In other
words, after you bootstrap a new sml for the first time, you will not
have to autoload $smlnj/cmb.cm again afterwards.  (The first time
around you will still have to do it, though.)</p></div>
</li>
<li>
<p>
A second change consists of major updates to the CM manual.  There
are now several appendices with summary information and also a full
specification of the CM description file syntax.
</p>
</li>
<li>
<p>
In directory src/system I added the script "allcross".  This script
invokes sml and cross-compiles the compiler for all supported
architectures.  (Useful when providing a new set of boot files.)
</p>
</li>
<li>
<p>
There seems to be a latent bug in my "lazy pickles" mechanism.  I
added a small tweak to pickle-util.sml to work around this problem,
but it is not a proper fix yet.  I will investigate further.  (The
effect of the bug was an inflation of library pickle size.)
</p>
</li>
<li>
<p>
Version number increased to 110.28.1 (to avoid compatibility problems).
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/05/25]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>Fixed a bug in freezing phase of the register allocator.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/05/15]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Alpha
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>Slight cleanup.  Removed the instruction SGNXL</pre>
</div></div>
</li>
<li>
<p>
X86
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>Added the following instructions to the instruction set:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>ROLx, RORx,
BTx, BTSx, BTLx, BTRx,
XCHGx, and variants with the LOCK prefix</pre>
</div></div>
</li>
<li>
<p>
Register Allocation
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>The module ra-rewrite-with-renaming has been improved.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>These have no effect on SML/NJ.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/05/15]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
I added an alternative to "-rebuild" to "makeml".  The difference is
   that prior to calling CMB.make' the CM-variable "LIGHT" will be
   defined.  In effect, the command will not build any cross-compiler
   backends and therefore finish more quickly.
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>The "fixpt" script also takes a "-light" switch to be able to use
this new facility while compiling for a fixpoint.</pre>
</div></div>
</li>
<li>
<p>
I replaced all mentions of anchored paths in group owner specifications
   with simple relative paths (usually starting with "..").
   The rationale is that a library&#8217;s internal workings should not be
   compromised by the lack of some anchor.  (An anchor is necessary
   for someone who wants to refer to the library by an anchored path,
   but it should not be necessary to build the same library in the first
   place.)
</p>
</li>
<li>
<p>
I changed the way CM&#8217;s tool mechanism determines the shell command
   string used for things like <strong>ml-yacc</strong> etc. so that it does not break
   when CM.Control.implicit_anchors is turned off.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/05/12]
</dt>
<dd>
<div class="paragraph"><p>Fixed a bug in config/_ml-build that prevented <strong>ml-yacc</strong> and <strong>ml-lex</strong> from
getting installed properly (by config/install.sh).</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/05/12]
</dt>
<dd>
<div class="paragraph"><p>!!! NEW BOOT FILES !!!</p></div>
<div class="paragraph"><p>This change is in preparation of fading out support for "implicitly
anchored path names".  I went through all sources and used the
explicit (and relatively new) $-notation.  See system/README and the
CM manual for more info on this.</p></div>
<div class="paragraph"><p>I also modified the anchoring scheme for some things such as "smlnj",
"MLRISC", "cm", etc. to take advantage of the fact that explicit
anchors are more expressive: anchor name and first arc do not have to
coincide.  This entails the following user-visible change:</p></div>
<div class="paragraph"><p>You have to write $smlnj/foo/bar instead of smlnj/foo/bar.  In
particular, when you fire up sml with a command-line argument, say,
<em>e.g.</em>:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>sml '$smlnj/cmb.cm'</pre>
</div></div>
<div class="paragraph"><p>At the ML toplevel prompt:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>CM.autoload "$smlnj/cmb.cm";</pre>
</div></div>
<div class="paragraph"><p>There is also a new controller in CM.Control that can be used to turn
off all remaining support for implicit anchors by saying:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>CM.autoload "$smlnj/
#set CM.Control.implicit_anchors false;</pre>
</div></div>
<div class="paragraph"><p>This causes CM to reject implicitly anchored paths.  This is (for the
time being) less permissive than the "final" version where there will
be no more such implicit anchors and relative paths will be just that:
relative.</p></div>
<div class="paragraph"><p>The next step (version after next version?) will be to make the
default for CM.Control.implicit_anchors false.  After the dust has
settled, I can then produce the "final" version of this&#8230;</p></div>
<div class="paragraph"><p>Note: Since bootstrapping is a bit tricky, I provided new boot files.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/05/11]
</dt>
<dd>
<div class="paragraph"><p>The main change is that I added function CM.sources as a generalized
version of the earlier CM.makedepend.  This entails the following
additional changes:</p></div>
<div class="ulist"><ul>
<li>
<p>
CM.makedepend has been dropped.
</p>
</li>
<li>
<p>
CM manual has been updated.
</p>
</li>
<li>
<p>
TOOLS signature and API have been changed.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/05/10]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>  Various bug fixes and new features for C--, Moby and MLRISC optimizations.
None of these affect SML/NJ.</pre>
</div></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Register Allocation
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
A new ra spilling module (ra/ra-spill-with-renaming) is implemented.
       This module tries to remove local (<em>i.e.</em> basic block level) redundancies
       during spilling.
</p>
</li>
<li>
<p>
A new framework for performing region based register allocation.
       Not yet entirely functional.
</p>
</li>
</ol></div>
</li>
<li>
<p>
X86
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
DefUse for POP was missing the stack pointer [found by Lal]
</p>
</li>
<li>
<p>
Reload for CALL was incorrect in X86Spill [found by John]
</p>
</li>
<li>
<p>
Various fixes in X86Spill so that it can be used correctly for
      the new spilling module.
</p>
</li>
</ol></div>
</li>
<li>
<p>
SSA/IR
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
New module ir/dj-dataflow.sml implements elimination based
      data flow analysis.
</p>
</li>
</ol></div>
</li>
<li>
<p>
MLRiscGen
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
Fix for gc type annotation
</p>
</li>
</ol></div>
</li>
<li>
<p>
MDGen
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>Various fixes for machine description -&gt; ml code translation.  For ssa
only.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/05/08]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>Fermin has found a few assembly problems with constant expressions
generated in LabelExp.  Mostly, the problems involve extra parentheses,
which choke on dumb assemblers.  This is his fix.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_28_2000_04_09">Version 110.28; 2000/04/09</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/04/09]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Updated src/compiler/TopLevel/main/version.sml to version 110.28
</p>
</li>
<li>
<p>
Updated config/version to 110.28
</p>
</li>
<li>
<p>
Updated config/srcarchiveurl
</p>
</li>
<li>
<p>
New boot files!
   <a href="ftp://ftp.research.bell-labs.com/dist/smlnj/working/110.28/">ftp://ftp.research.bell-labs.com/dist/smlnj/working/110.28/</a>
</p>
<div class="paragraph"><p><span class="owner">Dave MacQueen</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/05/01]
</dt>
<dd>
<div class="paragraph"><p>A new noweb tool has been added.  The existing system is entirely
unaffected by this, but some CM users have asked for renewed noweb
support.  Everything is documented in the CM manual.</p></div>
<div class="paragraph"><p>New (plugin) libraries:</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>noweb-tool.cm
nw-ext.cm</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/04/30]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Fix for bug 1498
   smlnj/src/system/Basis/Implementation/Unsafe/object.sig
   smlnj/src/system/Basis/Implementation/Unsafe/object.sml
     added toRealArray function
   smlnj/src/compiler/MiscUtil/print/ppobj.sml
     added check for tag Obj.RealArray to array printing case in ppObj
</p>
</li>
<li>
<p>
Fix for bug 1510
   smlnj/src/compiler/Semant/types/typesutil.sml
     fixed definition of dummyargs (used by equalTycon) so that
     dummy args are distinct types
</p>
<div class="paragraph"><p><span class="owner">Dave MacQueen</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/04/30]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
CM version numbering added.  This is an implementation of Lal&#8217;s
   proposal for adding version numbers and version checking to .cm
   files.  Lal said that his proposal was just that&#8201;&#8212;&#8201;a proposal.
   For the time being I went ahead and implemented it so that people
   can comment on it.  Everything is completely backward-compatible
   (except for the stable library format, <em>i.e.</em>, new bootfiles!).
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>As usual, see the CM manual for details.</pre>
</div></div>
</li>
<li>
<p>
An alternative syntax for anchored paths has been implemented.
   Dave has recently voiced the same concerns that I had when I did
   this, so there should be some support.  My take is that eventually
   I will let support for the current syntax (where anchors are
   "implicit") fade out in favor of the new, explicit syntax.
   In order to be backward-compatible, both old and new syntax are
   currently supported.
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>Again, see the CM manual for details.</pre>
</div></div>
</li>
<li>
<p>
Parallel make is trying to be slightly smarter:  When the master
   process finds a "bottleneck", <em>i.e.</em>, when there is only one
   compilation unit that can be compiled and everybody else is
   waiting on it, then it will simply compile it directly instead
   of clumsily telling one of the slaves to do it.
</p>
</li>
<li>
<p>
Support for "unsharing" added.  This is necessary in order to be
   able to have two different versions of the same library running
   at the same time (<em>e.g.</em>, for trying out a new MLRISC while still
   having the old MLRISC linked into the current compiler, etc.)
   See the CM manual.
</p>
</li>
<li>
<p>
Simple "makedepend" functionality added for generating Makefile
   dependency information.  (This is rather crude at the moment.
   Expect some changes here in the future.)
</p>
</li>
<li>
<p>
".fun" added as a recognized suffix for ML files. Also documented
   explicitly in the manual that the fallback behavior (unknown suffix
   &#8594; ML file) is not an official feature!
</p>
</li>
<li>
<p>
Small changes to the pickler for stable libraries.
</p>
</li>
<li>
<p>
Several internal changes to CM (for cleanup/improvement).
</p>
<div class="paragraph"><p>+
!!!! NEW BINFILES !!!!</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/04/28]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
I changed config/install.sh to remove duplicate entries from the
   lib/pathconfig file at the end.  Moreover, the final version of
   lib/pathconfig is sorted alphabetically.  The same (sorting) is done
   in src/system/installml.
</p>
</li>
<li>
<p>
The config/install.sh script now consistently uses relative
   pathnames in lib/pathconfig whenever the anchor is in the lib
   directory.  (So far this was true for the libraries that come
   pre-compiled and bundled as part of the bootfiles but not for
   libraries that are compiled by the script itself.)
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/04/26]
</dt>
<dd>
<div class="paragraph"><p>Added ".fun" as a recognized file name suffix (for ML code).</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/04/25]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Alpha
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>    PSEUDOARITH was missing in AlphaRewrite.  This causes an endless loop
in C--.</pre>
</div></div>
</li>
<li>
<p>
RA
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>Added a flag "ra-dump-size" to print out the size of the flowgraph
and the interference graph.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/04/25]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>Updated mlyacc.tex sections 5 and 7 for SML '97 and CM.
Updated all three examples in src/ml-yacc/examples to run
under 110.* using CM.make.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Dave MacQueen</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/04/20]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>  This update synchronizes my repository with Yale's.  Most of these
changes, however, do not affect SML/NJ at all (the RA is an exception).</pre>
</div></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Register Allocator
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
An improvement in the interference graph construction:
      Given a copy
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>s &lt;- t</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>no interference edge between s and t is added for this definition of s.</pre>
</div></div>
</li>
<li>
<p>
I&#8217;ve added two new spill heuristic modules that Fermin and I developed
      (in the new library RA.cm). These are unused in SML/NJ but maybe
      useful for others (Moby?)
</p>
</li>
</ol></div>
</li>
<li>
<p>
X86
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
Various fixes in the backend provided by Fermin [C--] and Lal.
</p>
</li>
</ol></div>
</li>
<li>
<p>
Alpha
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
Added the BSR instruction and code generation that goes with it [C--]
</p>
</li>
<li>
<p>
Other fixes too numerous to recount provided by Fermin [C--]
</p>
</li>
</ol></div>
</li>
<li>
<p>
Regmaps
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
The regmaps are not initialized with the identity physical bindings
      at creation time.  This is unneeded.
</p>
</li>
</ol></div>
</li>
<li>
<p>
MLRISC Optimizations
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
The DJ-Graph module can now compute the iterated dominance frontiers
      intersects with liveness incrementally in linear time! Woohoo!
      This is now used in my new SSA construction algorithm.
</p>
</li>
<li>
<p>
THe branch reorganization module is now smarter about linear chains of
      basic blocks.
</p>
<div class="paragraph"><p>+
<span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/04/12]
</dt>
<dd>
<div class="paragraph"><p>Changed install.sh script to handle archive files without version number
and to use "boot.&lt;arch&gt;-&lt;os&gt;" instead of "sml.boot.&lt;arch&gt;-&lt;os&gt;" for the
name of the boot file archive.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_27_2000_04_09">Version 110.27; 2000/04/09</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/04/09]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Updated src/compiler/TopLevel/main/version.sml to version 110.27
</p>
</li>
<li>
<p>
Updated src/config/version to 110.27
</p>
</li>
<li>
<p>
New boot files!
</p>
<div class="paragraph"><p><span class="owner">Dave MacQueen</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/04/09]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Yet another fix for x86 assembly for idivl, imull, mull and friends.
</p>
</li>
<li>
<p>
Miscellaneous improvements to MLRISC (unused in sml/nj)
</p>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/04/07]
</dt>
<dd>
<div class="paragraph"><p>Improved handling of branches (mostly those generated from
polymorphic equality), removed switchoff and changed the
default optimization settings (more cpsopt and less flintopt).</p></div>
<div class="paragraph"><p><span class="owner">Stefan</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/04/06]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>Forgot a few files.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/04/06]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
New Peephole code
</p>
</li>
<li>
<p>
Minor improvement to X86 instruction selection
</p>
</li>
<li>
<p>
Various fixes to SSA and machine description &#8594; code translator
</p>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/04/05]
</dt>
<dd>
<div class="paragraph"><p>This update just merges three minor cosmetic updates to CM&#8217;s sources
to get ready for the 110.27 code freeze on Friday.  No functionality
has changed.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/04/04]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Fixed a problem in X86 assembly.
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>Things like</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>jmp %eax
jmp (%eax)</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>should be output as</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>jmp *%eax
jmp *(%eax)</pre>
</div></div>
</li>
<li>
<p>
Assembly output
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>Added a new flag</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>"asm-indent-copies" (default to false)</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>When this flag is on, parallel copies will be indented an extra level.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/04/04]
</dt>
<dd>
<div class="literalblock">
<div class="content monospaced">
<pre>All of these fixes are related to C--, Moby, and my own optimization
stuff; so they shouldn't affect SML/NJ.</pre>
</div></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
X86
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>Various fixes related floating point, and extensions.</pre>
</div></div>
</li>
<li>
<p>
Alpha
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>Some extra patterns related to loads with signed/zero extension
provided by Fermin.</pre>
</div></div>
</li>
<li>
<p>
Assembly
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>When generating assembly, resolve the value of client defined constants,
instead of generating symbolic values.  This is controlled by the
new flag "asm-resolve-constants", which is default to true.</pre>
</div></div>
</li>
<li>
<p>
Machine Descriptions
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
The precedence parser was slightly broken when parsing infixr symbols.
</p>
</li>
<li>
<p>
The type generalizing code had the bound variables reversed, resulting
       in a problem during arity raising.
</p>
</li>
<li>
<p>
Various fixes in machine descriptions.
</p>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/04/03]
</dt>
<dd>
<div class="paragraph"><p>I eliminated coreEnv from compInfo.  Access to the "Core" structure is
now done via the ordinary static environment that is context to each
compilation unit.</p></div>
<div class="paragraph"><p>To this end, I arranged that instead of "structure Core" as "structure
_Core" is bound in the pervasive environment.  Core access is done via
_Core (which can never be accidentally rebound because _Core is not a
legal surface-syntax symbol).</p></div>
<div class="paragraph"><p>The current solution is much cleaner because the core environment is
now simply part of the pervasive environment which is part of every
compilation unit&#8217;s context anyway.  In particular, this eliminates all
special-case handling that was necessary until now in order to deal
with dynamic and symbolic parts of the core environment.</p></div>
<div class="paragraph"><p>Remaining hackery (to bind the "magic" symbol _Core) is localized in the
compilation manager&#8217;s bootstrap compiler (actually: in the "init group"
handling).  See the comments in src/system/smlnj/init/init.cmi for
more details.</p></div>
<div class="paragraph"><p>I also tried to track down all mentions of "Core" (as string argument
to Symbol.strSymbol) in the compiler and replaced them with a
reference to the new CoreSym.coreSym.  Seems cleaner since the actual
name appears in one place only.</p></div>
<div class="paragraph"><p>Binfile and bootfile format have not changed, but the switchover from
the old "init.cmi" to the new one is a bit tricky, so I supplied new
bootfiles anyway.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/04/02]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Renamed the constructor CALL in MLTREE by popular demand.
</p>
</li>
<li>
<p>
Added a bunch of files from my repository.  These are currently
      used by other non-SMLNJ backends.
</p>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/03/31]
</dt>
<dd>
<div class="paragraph"><p>This update contains a rewritten (and hopefully more correct) module
for extracting aliasing information from CPS.</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>To turn on this feature:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Compiler.Control.CG.memDisambiguate := true</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>To pretty print the region information with assembly</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Compiler.Control.MLRISC.getFlag "asm-show-region" := true;</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>To control how many levels of aliasing information are printed, use:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Compiler.Control.MLRISC.getInt "points-to-show-level" := n</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>The default of n is 3.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/03/31]
</dt>
<dd>
<div class="paragraph"><p>This update contains:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
runtime/c-lib/c-libraries.c
   includes added in revision 1.2 caused compilation errors on hppa-hpux
</p>
</li>
<li>
<p>
fix for bug 1556
   system/Basis/Implementation/NJ/internal-signals.sml
</p>
<div class="paragraph"><p><span class="owner">David MacQueen</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/03/31]
</dt>
<dd>
<div class="paragraph"><p>This update contains:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
A small change to CM&#8217;s handling of stable libraries:
   CM now maintains one "global" modmap that is used for all stable
   libraries.  The use of such a global modmap maximizes sharing and
   minimizes the need for re-traversing parts of environments during
   modmap construction.  (However, this has minor impact since modmap
   construction seems to account for just one percent or less of total
   compile time.)
</p>
</li>
<li>
<p>
I added a "genmap" phase to the statistics.  This is where I got the
   "one percent" number (see above).
</p>
</li>
<li>
<p>
CM&#8217;s new tool parameter mechanism just became <em>even</em> better. :)
</p>
<div class="ulist"><ul>
<li>
<p>
The parser understands named parameters and recursive options.
</p>
</li>
<li>
<p>
The "make" and "shell" tools use these new features.
     (This makes it a lot easier to cascade these tools.)
</p>
</li>
<li>
<p>
There is a small syntax change: named parameters use a
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>&lt;name&gt; : ( &lt;option&gt; ... )            or
&lt;name&gt; : &lt;string&gt;</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>syntax.  Previously, named parameters were implemented in an
ad-hoc fashion by each tool individually (by parsing strings)
and had the form</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>&lt;name&gt;=&lt;string&gt;</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>See the CM manual for a full description of these issues.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</li>
</ol></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_26_2_2000_03_30">Version 110.26.2; 2000/03/30</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/03/30]
</dt>
<dd>
<div class="paragraph"><p>!!!!! WARNING !!!!!!
!!  New binfiles  !!
!!!!!!!!!!!!!!!!!!!!</p></div>
<div class="paragraph"><p>This update contains:</p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Moderate changes to CM:
</p>
<div class="ulist"><ul>
<li>
<p>
Changes to CM&#8217;s tools mechanism.  In particular, it is now possible
   to have tools that accept additional "command line" parameters
   (specified in the .cm file at each instance where the tool&#8217;s class is
   used).
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>This was done to accommodate the new "make" and "shell" tools which
facilitate fairly seamless hookup to portions of code managed using
Makefiles or Shell scripts.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>There are no classes "shared" or "private" anymore.  Instead, the
sharing annotation is now a parameter to the "sml" class.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>There is a bit of generic machinery for implementing one's own
tools that accept command-line parameters.  However, I am not yet fully
satisfied with that part, so expect changes here in the future.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>All existing tools are described in the CM manual.</pre>
</div></div>
</li>
<li>
<p>
Slightly better error handling.  (CM now suppresses many followup
   error messages that tended to be more annoying than helpful.)
</p>
</li>
</ul></div>
</li>
<li>
<p>
Major changes to the compiler&#8217;s static environment data structures.
</p>
<div class="ulist"><ul>
<li>
<p>
no CMStaticEnv anymore.
</p>
</li>
<li>
<p>
no CMEnv, no "BareEnvironment" (actually, <em>only</em> BareEnvironment,
          but it is called Environment), no conversions between different
          kinds of static environments
</p>
</li>
<li>
<p>
There is still a notion of a "modmap", but such modmaps are generated
     on demand at the time when they are needed.  This sounds slow, but I
     sped up the code that generates modmaps enough for this not to lead to
     a slowdown of the compiler (at least I didn&#8217;t detect any).
</p>
</li>
<li>
<p>
To facilitate rapid modmap generation, static environments now
     contain an (optional) "modtree" structure.  Modtree annotations are
     constructed by the unpickler during unpickling.  (This means that
     the elaborator does not have to worry about modtrees at all.)
     Modtrees have the advantage that they are compositional in the same
     way as the environment data structure itself is compositional.
     As a result, modtrees never hang on to parts of an environment that
     has already been rendered "stale" by filtering or rebinding.
</p>
</li>
<li>
<p>
I went through many, many trials and errors before arriving at the
     current solution.  (The initial idea of "linkpaths" did not work.)
     But the result of all this is that I have touched a lot of files that
     depend on the "modules" and "types" data structures (most of the
     elaborator). There were a lot of changes during my "linkpath" trials
     that could have been reverted to their original state but weren&#8217;t.
     Please, don&#8217;t be too harsh on me for messing with this code a bit more
     than what was strictly necessary&#8230;  (I <em>did</em> resist the temptation
     of doing any "global reformatting" to avoid an untimely death at
     Dave&#8217;s hands. :)
</p>
</li>
<li>
<p>
One positive aspect of the previous point:  At least I made sure that
     all files that I touched now compile without warnings (other than
     "polyEqual").
</p>
</li>
<li>
<p>
compiler now tends to run "leaner" (<em>i.e.</em>, ties up less memory in
     redundant modmaps)
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/03/29]
</dt>
<dd>
<div class="paragraph"><p>Boot files (optional): <a href="ftp://react-ilp.cs.nyu.edu/leunga/110.26.1-sml.boot.x86-unix-20000330.tar.gz">ftp://react-ilp.cs.nyu.edu/leunga/110.26.1-sml.boot.x86-unix-20000330.tar.gz</a></p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>   This update contains *MAJOR* changes to the way code is generated from CPS
in the module mlriscGen, and in various backend modules.</pre>
</div></div>
<div class="paragraph"><p><strong>CHANGES</strong></p></div>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
MLRiscGen: forward propagation fix.
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>There was a bug in forward propagation introduced at about the same time
as the MLRISC x86 backend, which prohibits coalescing to be
performed effectively in loops.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Effect: speed up of loops in RISC architectures.
        By itself, this actually slowed down certain benchmarks on the x86.</pre>
</div></div>
</li>
<li>
<p>
MLRiscGen:  forward propagating addresses from consing.
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>I've changed the way consing code is generated.  Basically I separated
out the initialization part:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>store tag,   offset(allocptr)
store elem1, offset+4(allocptr)
store elem2, offset+8(allocptr)
...
store elemn, offset+4n(allocptr)</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>and the address computation part:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>celladdr &lt;- offset+4+alloctpr</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>and move the address computation part</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Effect:  register pressure is generally lower as a result.  This
         makes compilation of certain expressions much faster, such as
         long lists with non-trivial elements.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>[(0,0), (0,0), .... (0,0)]</pre>
</div></div>
</li>
<li>
<p>
MLRiscGen: base pointer elimination.
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>As part of the linkage mechanism, we generate the sequence:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>L:  ...  &lt;- start of the code fragment</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>L1:
    base pointer &lt;- linkreg - L1 + L</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>  The base pointer was then used for computing relocatable addresses
in the code fragment.  Frequently (such as in lots of continuations)
this is not needed.  We now eliminate this sequence whenever possible.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>  For compile time efficiency, I'm using a very stupid local heuristic.
But in general, this should be done as a control flow analysis.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Effect:  Smaller code size.  Speed up of most programs.</pre>
</div></div>
</li>
<li>
<p>
Hppa back end
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>   Long jumps in span dependence resolution used to depend on the existence
of the base pointer.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>A jump to a long label L was expanded into the following sequence:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>LDIL %hi(L-8192), %r29
LDO  %lo(L-8192)(%r29), %r29
ADD  %r29, baseptr, %r29
BV,n %r0(%r29)</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>  In the presence of change (3) above, this will not work.  I've changed
it so that the following sequence of instructions are generated, which
doesn't mention the base pointer at all:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>     BL,n  L', %r29           /* branch and link, L' + 4 -&gt; %r29 */
L':  ADDIL L-(L'+4), %r29     /* Compute address of L */
     BV,n  %r0(%r29)          /* Jump */</pre>
</div></div>
</li>
<li>
<p>
Alpha back end
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>   New alpha instructions LDB/LDW have been added, as per Fermin's
suggestions.   This is unrelated to all other changes.</pre>
</div></div>
</li>
<li>
<p>
X86 back end
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>I've changed andl to testl in the floating point test sequence
whenever appropriate.  The Intel optimization guide states that
testl is preferable to andl.</pre>
</div></div>
</li>
<li>
<p>
RA (x86 only)
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>  I've improved the spill propagation algorithm, using an approximation
of maximal weighted independent sets.   This seems to be necessary to
alleviate the negative effect in light of the slow down in (1).</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>I'll write down the algorithm one of these days.</pre>
</div></div>
</li>
<li>
<p>
MLRiscGen: frequencies
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>  I've added an annotation that states that all call gc blocks have zero
execution frequencies.  This improves register allocation on the x86.</pre>
</div></div>
<div class="paragraph"><p><strong>BENCHMARKS</strong></p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>I've only perform the comparison on 110.25.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>The platforms are:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>HPPA  A four processor HP machine (E9000) with 5G of memory.
X86   A 300Hhz Pentium II with 128M of memory, and
SPARC An Ultra sparc 2 with 512M of memory.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>I used the following parameters for the SML benchmarks:</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>        @SMLalloc
HPPA    256k
SPARC   512k
X86     256k</pre>
</div></div>
<div class="paragraph"><p><strong>COMPILATION TIME</strong></p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Here are the numbers comparing the compilation times of the compilers.
I've only compared 110.25 compiling the new sources versus
a fixpoint version of the new compiler compiling the same.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>            110.25                                  New
      Total  Time in RA  Spill+Reload   Total  Time In RA Spill+Reload
HPPA   627s    116s        2684+3584     599s    95s       1003+1879
SPARC  892s    173s        2891+3870     708s    116s      1004+1880
X86    999s    315s       94006+130691   987s    296s    108877+141957</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>          110.25         New
       Code Size      Code Size
HPPA   8596736         8561421
SPARC  8974299         8785143
X86    9029180         8716783</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>So in summary, things are at least as good as before.   Dramatic
reduction in compilation is obtained on the Sparc; I can't explain it,
but it is reproducible.  Perhaps someone should try to reproduce this
on their own machines.</pre>
</div></div>
<div class="paragraph"><p><strong>SML BENCHMARKS</strong></p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>On the average, all benchmarks perform at least as well as before.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>HPPA         Compilation Time     Spill+Reload      Run Time
           110.25  New            110.25    New   110.25  New</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>    barnesHut  3.158  3.015  4.75%    1+1       0+0   2.980  2.922   2.00%
        boyer  6.152  5.708  7.77%    0+0       0+0   0.218  0.213   2.34%
 count-graphs  1.168  1.120  4.32%    0+0       0+0  22.705 23.073  -1.60%
          fft  0.877  0.792 10.74%    1+3       1+3   0.602  0.587   2.56%
  knuthBendix  3.180  2.857 11.32%    0+0       0+0   0.675  0.662   2.02%
       lexgen  6.190  5.290 17.01%    0+0       0+0   0.913  0.788  15.86%
         life  0.803  0.703 14.22%   25+25      0+0   0.153  0.140   9.52%
        logic  2.048  2.007  2.08%    6+6       1+1   4.133  4.008   3.12%
   mandelbrot  0.077  0.080 -4.17%    0+0       0+0   0.765  0.712   7.49%
       mlyacc 22.932 20.937  9.53%  154+181    32+57  0.468  0.430   8.91%
      nucleic  5.183  5.060  2.44%    2+2       0+0   0.125  0.120   4.17%
ratio-regions  3.357  3.142  6.84%    0+0       0+0  116.225 113.173 2.70%
          ray  1.283  1.290 -0.52%    0+0       0+0   2.887  2.855   1.11%
       simple  6.307  6.032  4.56%   28+30      5+7   3.705  3.658   1.28%
          tsp  0.888  0.862  3.09%    0+0       0+0   7.040  6.893   2.13%
         vliw 24.378 23.455  3.94%  106+127    25+45  2.758  2.707   1.91%
--------------------------------------------------------------------------
 Average                     6.12%                                   4.09%</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>SPARC        Compilation Time     Spill+Reload      Run Time
           110.25  New            110.25    New   110.25  New</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>    barnesHut  3.778  3.592  5.20%    2+2       0+0   3.648  3.453    5.65%
        boyer  6.632  6.110  8.54%    0+0       0+0   0.258  0.242    6.90%
 count-graphs  1.435  1.325  8.30%    0+0       0+0  33.672 34.737   -3.07%
          fft  0.980  0.940  4.26%    3+9       2+6   0.838  0.827    1.41%
  knuthBendix  3.590  3.138 14.39%    0+0       0+0   0.962  0.967   -0.52%
       lexgen  6.593  6.072  8.59%    1+1       0+0   1.077  1.078   -0.15%
         life  0.972  0.868 11.90%   26+26      0+0   0.143  0.140    2.38%
        logic  2.525  2.387  5.80%    7+7       1+1   5.625  5.158    9.05%
   mandelbrot  0.090  0.093 -3.57%    0+0       0+0   0.855  0.728   17.39%
       mlyacc 26.732 23.827 12.19%  162+189    32+57  0.550  0.560   -1.79%
      nucleic  6.233  6.197  0.59%    3+3       0+0   0.163  0.173   -5.77%
ratio-regions  3.780  3.507  7.79%    0+0       0+0 133.993 131.035   2.26%
          ray  1.595  1.550  2.90%    1+1       0+0   3.440  3.418    0.63%
       simple  6.972  6.487  7.48%   29+32      5+7   3.523  3.525   -0.05%
          tsp  1.115  1.063  4.86%    0+0       0+0   7.393  7.265    1.77%
         vliw 27.765 24.818 11.87%  110+135    25+45  2.265  2.135    6.09%
----------------------------------------------------------------------------
 Average                     6.94%                                    2.64%</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>X86          Compilation Time     Spill+Reload      Run Time
           110.25  New            110.25    New   110.25  New</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>    barnesHut  5.530  5.420  2.03%  593+893   597+915   3.532  3.440   2.66%
        boyer  8.768  7.747 13.19%  493+199   301+289   0.327  0.297  10.11%
 count-graphs  2.040  2.010  1.49%  298+394   315+457  26.578 28.660  -7.26%
          fft  1.327  1.302  1.92%  112+209   115+210   1.055  0.962   9.71%
  knuthBendix  5.218  5.475 -4.69%  451+598   510+650   0.928  0.932  -0.36%
       lexgen  9.970  9.623  3.60% 1014+841  1157+885   0.947  0.928   1.97%
         life  1.183  1.183  0.00%  162+182   145+148   0.127  0.103  22.58%
        logic  3.285  3.512 -6.45%  514+684   591+836   5.682  5.577   1.88%
   mandelbrot  0.147  0.143  2.33%   38+41     33+54    0.703  0.690   1.93%
       mlyacc 35.457 32.763  8.22% 3496+4564 3611+4860  0.552  0.550   0.30%
      nucleic  7.100  6.888  3.07%  239+168   201+158   0.175  0.173   0.96%
ratio-regions  6.388  6.843 -6.65% 1182+257   981+300  120.142 120.345 -0.17%
          ray  2.332  2.338 -0.29%  346+398   402+494   3.593  3.540   1.51%
       simple  9.912  9.903  0.08% 1475+941  1579+1168  3.057  3.178  -3.83%
          tsp  1.623  1.532  5.98%  266+200   250+211   8.045  7.878   2.12%
         vliw 33.947 35.470 -4.29% 2629+2774 2877+3171  2.072  1.890   9.61%
----------------------------------------------------------------------------
 Average                     1.22%                                     3.36%</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/03/23]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
X86 fixes/changes
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
The old code generated for SETcc was completely wrong.
       The Intel optimization guide is VERY misleading.
</p>
</li>
</ol></div>
</li>
<li>
<p>
ALPHA fixes/changes
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
Added the instructions LDBU, LDWU, STB, STW as per Fermin&#8217;s suggestion.
</p>
</li>
<li>
<p>
Added a new mode byteWordLoadStores to the functor parameter to Alpha()
</p>
</li>
<li>
<p>
Added reassociation code for address computation.
</p>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/03/22]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
X86 fixes/changes
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
x86Rewrite bug with MUL3 (found by Lal)
</p>
</li>
<li>
<p>
Added the instructions FSTS, FSTL
</p>
</li>
</ol></div>
</li>
<li>
<p>
PA-RISC fixes/changes
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
B label should not be a delay slot candidate!  Why did this work?
</p>
</li>
<li>
<p>
ADDT(32, REG(32, r), LI n) now generates one instruction instead of two,
       as it should be.
</p>
</li>
<li>
<p>
The assembly syntax for fstds and fstdd was wrong.
</p>
</li>
<li>
<p>
Added the composite instruction COMICLR/LDO, which is the immediate
       operand variant of COMCLR/LDO.
</p>
</li>
</ol></div>
</li>
<li>
<p>
Generic MLRISC
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
shuffle.sml rewritten to be slightly more efficient
</p>
</li>
<li>
<p>
DIV bug in mltree-simplify fixed (found by Fermin)
</p>
</li>
</ol></div>
</li>
<li>
<p>
Register Allocator
</p>
<div class="olist loweralpha"><ol class="loweralpha">
<li>
<p>
I now release the interference graph earlier during spilling.
       May improve memory usage.
</p>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</li>
</ol></div>
</li>
</ol></div>
</dd>
</dl></div>
</div>
</div>
<div class="sect1">
<h2 id="_version_110_26_1_2000_03_14">Version 110.26.1; 2000/03/14</h2>
<div class="sectionbody">
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/03/14]
</dt>
<dd>
<div class="olist arabic"><ol class="arabic">
<li>
<p>
Tools.registerStdShellCmdTool (from smlnj/cm/tool.cm) takes an
additional argument called "template" which is an optional string that
specifies the layout of the tool command line.  See the CM manual for
explanation.
</p>
</li>
<li>
<p>
A special-purpose tool can be "registered" by simply dropping the
corresponding &lt;&#8230;&gt;-tool.cm (and/or &lt;&#8230;&gt;-ext.cm) into the same
directory where the .cm file lives that uses this tool.  (The
behavior/misfeature until now was to look for the tool description
files in the current working directory.)  As before, tool description
files could also be anchored&#8201;&#8212;&#8201;in which case they can live anywhere
they like.  Following the recent e-mail discussion, this change should
make it easier to have special-purpose tools that are shipped together
with the sources of the program that uses them.
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ol></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/03/10]
</dt>
<dd>
<div class="paragraph"><p>I added a re-written version of Dave&#8217;s fixpt script to src/system.
Changes relative to the original version:
  - sh-ified (not everybody has ksh)
  - automatically figures out which architecture it runs on
  - uses ./makeml a bit more cleverly
  - never invokes ./installml (and, thus, does not clobber your
    good and working installation of sml in case something goes wrong)
  - accepts max iteration count using option "-iter &lt;n&gt;"
  - accepts a "base" name using option "-base &lt;base&gt;"</p></div>
<div class="paragraph"><p>It does not build any extraneous heap images but directly rebuilds
bin- and boot-hierarchies using makeml&#8217;s "-rebuild" switch. Finally,
it can incorporate existing bin- and boot- hierarchies.  For example,
suppose the base is set to "sml" (which is the default).  Then it
successively builds</p></div>
<div class="literalblock">
<div class="content monospaced">
<pre>        sml.bin.&lt;arch&gt;-unix and sml.boot.&lt;arch&gt;-unix
then    sml1.bin.&lt;arch&gt;-unix and sml1.boot.&lt;arch&gt;-unix
then    sml2.bin.&lt;arch&gt;-unix and sml2.boot.&lt;arch&gt;-unix
...
then    sml&lt;n&gt;.bin.&lt;arch&gt;-unix and sml&lt;n&gt;.boot.&lt;arch&gt;-unix</pre>
</div></div>
<div class="paragraph"><p>and so on.  If any of these already exist, it will just use what&#8217;s
there.  In particular, many people will have the initial set of bin
and boot files around, so this saves time for at least one full
rebuild.  Having sets of the form &lt;base&gt;&lt;k&gt;.{bin,boot}.&lt;arch&gt;-unix for
&lt;k&gt;=1,2,&#8230; is normally not a good idea when invoking fixpt.  However,
they might be the result of an earlier partial run of fixpt (which
perhaps got accidentally killed).  In this case, fixpt will quickly
move through what exists before continuing where it left off earlier,
and, thus, saves a lot of time.</p></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/03/10]
</dt>
<dd>
<div class="paragraph"><p>More assembly output problems involving the indexed addressing mode
on the x86 have been found and corrected. Thanks to Fermin Reig for the
fix.</p></div>
<div class="paragraph"><p>The interface and implementation of the register allocator have been changed
slightly to accommodate the possibility to skip the register allocation
phases completely and go directly to memory allocation.  This is needed
for C-- use.</p></div>
<div class="paragraph"><p><span class="owner">Allen Leung</span></p></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/03/09]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
Complete re-organization of library names.  Many libraries have been
consolidated so that they share the same path anchor.  For example,
all MLRISC-related libraries are anchored at MLRISC, most libraries that
are SML/NJ-specific are under "smlnj".  Notice that names like
host-cmb.cm or host-compiler.cm no longer exist.  See system/README
for a complete description of the new naming scheme.  Quick reference:
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>host-cmb.cm        -&gt; smlnj/cmb.cm
host-compiler.cm   -&gt; smlnj/compiler.cm
full-cm.cm         -&gt; smlnj/cm.cm
&lt;arch&gt;-&lt;os&gt;.cm     -&gt; smlnj/cmb/&lt;arch&gt;-&lt;os&gt;.cm
&lt;arch&gt;-compiler.cm -&gt; smlnj/compiler/&lt;arch&gt;.cm</pre>
</div></div>
</li>
<li>
<p>
Bug fixes in CM.
</p>
<div class="ulist"><ul>
<li>
<p>
exceptions in user code are being passed through (<em>i.e.</em>, reach top level)
</p>
</li>
<li>
<p>
more bugs in paranoia mode fixed
</p>
</li>
<li>
<p>
bug related to checking group owners fixed
</p>
</li>
</ul></div>
</li>
<li>
<p>
New install.sh script that automagically fetches archive files:
  The new file config/srcarchiveurl must contain the URL of the
  (remote) directory that contains bin files (or other source archives).
  If install.sh does not find the archive locally, it tries to get
  it from that remote directory.
  This should simplify installation further:  For machines that have
  access to the internet, just fetch &lt;version&gt;-config.tgz, unpack it,
  edit config/targets, and go (run config/install.sh).  The script will
  fetch everything else that it might need all by itself.
</p>
<div class="literalblock">
<div class="content monospaced">
<pre>For CVS users, this mechanism is not relevant for source archives, but
it is convenient for getting new sets of binfiles.</pre>
</div></div>
<div class="literalblock">
<div class="content monospaced">
<pre>Archives should be tar files compressed with either gzip, compress, or
bzip2.  The script recognizes .tgz, .tar, tar.gz, tz, .tar.Z, and .tar.bz2.</pre>
</div></div>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
<div class="dlist"><dl>
<dt class="hdlist1">
[2000/03/07]
</dt>
<dd>
<div class="ulist"><ul>
<li>
<p>
size info in BOOTLIST
</p>
<div class="ulist"><ul>
<li>
<p>
no fixed upper limits for number of bootfiles or length of
       bootfile names in runtime
</p>
</li>
<li>
<p>
falling back to old behavior if no BOOTLIST size info found
</p>
</li>
</ul></div>
</li>
<li>
<p>
allocation size heuristics in .run-sml
</p>
<div class="ulist"><ul>
<li>
<p>
tries to read cache size from /proc/cpuinfo (this is important for
        small-cache Celeron systems!)
</p>
</li>
</ul></div>
</li>
<li>
<p>
install.sh robustified
</p>
</li>
<li>
<p>
CM manual updates
</p>
</li>
<li>
<p>
paranoid mode
</p>
<div class="ulist"><ul>
<li>
<p>
no more CMB.deliver() (<em>i.e.</em>, all done by CMB.make())
</p>
</li>
<li>
<p>
can re-use existing sml.boot.* files
</p>
</li>
<li>
<p>
init.cmi now treated as library
</p>
</li>
<li>
<p>
library stamps for consistency checks
</p>
</li>
</ul></div>
</li>
<li>
<p>
sml.boot.&lt;arch&gt;-&lt;os&gt;/PIDMAP file
</p>
<div class="ulist"><ul>
<li>
<p>
This file is read by the CM startup code.  This is used to minimize
       the amount of dynamic state that needs to be stowed away for the
       purpose of sharing between interactive system and user code.
</p>
</li>
</ul></div>
</li>
<li>
<p>
CM.Anchor.anchor instead of CM.Anchor.{set,cancel}
</p>
<div class="ulist"><ul>
<li>
<p>
Upon request by Elsa.  Anchors now controlled by get-set-pair
       like most other CM state variables.
</p>
</li>
</ul></div>
</li>
<li>
<p>
Compiler.CMSA eliminated
</p>
<div class="ulist"><ul>
<li>
<p>
No longer supported by CM anyway.
</p>
</li>
</ul></div>
</li>
<li>
<p>
fixed bugs in pickler that kept biting Stefan
</p>
<div class="ulist"><ul>
<li>
<p>
past refs to past refs (was caused by the possibility that
       ad-hoc sharing is more discriminating than hash-cons sharing)
</p>
</li>
<li>
<p>
integer overflow on LargeInt.minInt
</p>
</li>
</ul></div>
</li>
<li>
<p>
ml-{lex,yacc} build scripts now use new mechanism
  for building standalone programs
</p>
</li>
<li>
<p>
fixed several gcc -Wall warnings that were caused by missing header
  files, missing initializations, etc., in runtime (not all warnings
  eliminated, though)
</p>
<div class="paragraph"><p><span class="owner">Matthias Blume</span></p></div>
</li>
</ul></div>
</dd>
</dl></div>
</div>
</div>
</div>
<div id="footnotes"><hr></div>
<div id="footer">
<div id="footer-text">
Version 110.80<br>
Last updated 2016-08-18 09:38:31 CDT
</div>
</div>
</body>
</html>
