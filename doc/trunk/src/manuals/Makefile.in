# Makefile for external manuals
#
# COPYRIGHT (c) 2018 The Fellowship of SML/NJ (http://www.smlnj.org)
# All rights reserved.
#

SHELL =         @SHELL@
INSTALL =       @INSTALL@
@SET_MAKE@

include @MK_DIR@/doc-rules.gmk

# place to put documentation for doc target
#
DOC_DIR =		@OUT_DIR@
PDF_DIR =		$(DOC_DIR)/pdf

ASDL_SRCS =		$(wildcard asdl/*.tex asdl/*.bib)
CM_SRCS =		$(wildcard cm/*.tex cm/*.bib)
ML_LPT_SRCS =		$(wildcard ml-lpt/*.tex ml-lpt/*.bib)

ALL_MANUALS =		asdl/manual.pdf \
			cm/manual.pdf \
			cm/btcomp.pdf \
			ml-lpt/manual.pdf

# doc target for all manuals
#
.PHONY:			doc
doc:			$(ALL_MANUALS) $(PDF_DIR)
	cp -p asdl/manual.pdf $(PDF_DIR)/asdl-manual.pdf
	cp -p cm/manual.pdf $(PDF_DIR)/cm-manual.pdf
	cp -p cm/btcomp.pdf $(PDF_DIR)/btcomp-manual.pdf
	cp -p ml-lpt/manual.pdf $(PDF_DIR)/ml-lpt-manual.pdf

$(PDF_DIR):
	mkdir -p $(PDF_DIR)

# ASDL manual
#
asdl/manual.pdf:	$(ASDL_SRCS)
	(cd asdl; $(LATEXMK_PDF) manual.tex)

# CM manual
#
cm/manual.pdf:		$(CM_SRCS)
	(cd cm; $(LATEXMK_PDF) manual.tex)

# bootstrap compiler manual
#
cm/btcomp.pdf:		$(CM_SRCS)
	(cd cm; $(LATEXMK_PDF) btcomp.tex)

# ML-LPT manual
#
ml-lpt/manual.pdf:	$(ML_LPT_SRCS)
	(cd ml-lpt; $(LATEXMK_PDF) manual.tex)

##### CLEANUP #####

include @MK_DIR@/clean-rules.gmk

CLAN_FILES =		$(ALL_MANUALS)
